/*!
 * eFit Website
 * An app for financial training in educational environments
 * http://www.e-fit.com
 * @author Armin Pfurtscheller
 * @version 1.0.0
 * Copyright 2017. MIT licensed.
 */
!function(e,t){"use strict";var s=function(e,t,s){this.workshops=s,this.$injector=t,this.$scope=e,this._resultsSource=null,this._userSources={},this._workshops={},this._tasks={},this._initWorkshops(),this._initListener()};s.$inject=["$scope","$injector","workshops"],s.prototype.name=null,s.prototype.code=null,s.prototype.nameMinLength=8,s.prototype.codeMinLength=8,s.prototype.codePattern=/^[A-Za-z0-9]+$/,s.prototype.deleteWorkshop=null,s.prototype.drawingWorkshop=null,s.prototype.drawingTickets=null,s.prototype.drawingAmount=2,s.prototype.chartResults=null,s.prototype.chartTask=null,s.prototype.uiOnParamsChanged=function(e){var t=this._workshops[e.expand];return t?(t.$$expanded=!0,void(this._expanded=t)):this._expanded?(this._expanded.$$expanded=!1,void(this._expanded=null)):void 0},s.prototype.create=function(){var e=this.$injector.get("notification"),t=this.$injector.get("Workshop"),s=this.$injector.get("i18n"),o=new t({name:this.name,code:this.code}),i=this,n=function(t){var o=s.get("Workshop has been created successfully!");e.success(o),i.workshops.unshift(t),i._initWorkshop(t),i.name=null,i.code=null},r=function(){};o.$create().then(n,r)},s.prototype["delete"]=function(e){var t=this.$injector.get("notification"),s=this.$injector.get("i18n"),o=this,i=function(){var i=s.get("Workshop has been deleted successfully!");t.success(i);var n=o.workshops.indexOf(e);o.workshops.splice(n,1),o._removeUsersStream(e)},n=function(){};e.$delete().then(i,n)},s.prototype.markWorkshopForDrawing=function(e){var t=this.$injector.get("Ticket"),s=this.$injector.get("random"),o=this,i=function(t){o.drawingTickets=s.shuffle(t),o.drawingWorkshop=e},n=function(){},r=t.getByWorkshop({workshopId:e.id});r.$promise.then(i,n)},s.prototype.markWorkshopForDeletion=function(e){this.deleteWorkshop=e},s.prototype.toggleWorkshop=function(e){var t=this.$injector.get("notification"),s=this.$injector.get("i18n"),o=this,i=function(e){var i=s.get(e.isActive?"Workshop has been unlocked successfully. Students can register now!":"Workshop has been locked successfully. Students can now only use their access from home!");t.success(i),o._initWorkshop(e)},n=function(){e.isActive=!e.isActive};e.isActive=!e.isActive,e.$update().then(i,n)},s.prototype.markTaskForChart=function(e){var t=this.$injector.get("Result"),s=this,o=function(t){s.chartResults=t,s.chartTask=e},i=function(){},n=t.getByTask({taskId:e.id});n.$promise.then(o,i)},s.prototype.toggleTask=function(e){var t=this.$injector.get("notification"),s=this.$injector.get("i18n"),o=this.$injector.get("Task"),i=function(){var o=s.get(e.isActive?"Task has been unlocked successfully. Students can send results now!":"Task has been locked successfully. Students cannot send results currently!");t.success(o)},n=function(){e.isActive=!e.isActive};e.isActive=!e.isActive;var r=o.update({id:e.id},e);r.$promise.then(i,n)},s.prototype.expand=function(e){var t=this.$injector.get("$state"),s=e.$$expanded?null:e.id;t.go("backend.workshops",{expand:s})},s.prototype._addUsersStream=function(e){var t=this.$injector.get("API_URL"),s=this.$injector.get("sse"),o=this,i=function(t){o.$scope.$evalAsync(function(){e.$$users=t})},n=t+"/sse/workshop/"+e.id+"/users",r={onMessage:i,sleep:10},c=s.addSource(n,r);this._userSources[e.id]=c},s.prototype._removeUsersStream=function(e){var t=this.$injector.get("sse"),s=this._userSources[e.id];s&&(delete this._userSources[e.id],t.removeSource(s))},s.prototype._streamResults=function(){var e=this.$injector.get("API_URL"),s=this.$injector.get("sse"),o=this,i=function(e,i){o.$scope.$evalAsync(function(){e.isActive||s.removeSource(o._resultsSource),t.forEach(i,function(e){var t=o._tasks[e.id];t.$$results=e.results})})},n=function(){return o._expanded&&o._expanded.isActive},r=function(){if(o._resultsSource&&s.removeSource(o._resultsSource),o._expanded){var t=e+"/sse/workshop/"+o._expanded.id+"/results",n=i.bind(o,o._expanded),r={onMessage:n,sleep:5};o._resultsSource=s.addSource(t,r)}};this._unwatch=this.$scope.$watch(n,r)},s.prototype._initWorkshops=function(){var e=this.$injector.get("$uiRouterGlobals");t.forEach(this.workshops,this._initWorkshop.bind(this)),this.uiOnParamsChanged(e.params),this._streamResults()},s.prototype._initWorkshop=function(e){var s=this;t.forEach(e.tasks,function(e){var t=s._tasks[e.id]||null;e.$$results=null!==t?t.$$results:0,s._tasks[e.id]=e});var o=this._expanded&&this._expanded.id;e.$$expanded=e.id===o,e.$$users=e.users.length,e.isActive?this._addUsersStream(e):this._removeUsersStream(e),this._workshops[e.id]=e},s.prototype._initListener=function(){var e=this.$injector.get("sse"),t=this,s=function(){for(var s in t._userSources)e.removeSource(t._userSources[s]);t._resultsSource&&e.removeSource(t._resultsSource),t._resultsSource=null,t._userSources={},t._unlisten(),t._unwatch()};this._unlisten=this.$scope.$on("$destroy",s)},t.module(e).controller("WorkshopController",s)}(ANGULAR_MODULE,angular);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC9jb250cm9sbGVycy93b3Jrc2hvcC5qcyJdLCJuYW1lcyI6WyJtb2R1bGUiLCJhbmd1bGFyIiwiV29ya3Nob3AiLCIkc2NvcGUiLCIkaW5qZWN0b3IiLCJ3b3Jrc2hvcHMiLCJ0aGlzIiwiX3Jlc3VsdHNTb3VyY2UiLCJfdXNlclNvdXJjZXMiLCJfd29ya3Nob3BzIiwiX3Rhc2tzIiwiX2luaXRXb3Jrc2hvcHMiLCJfaW5pdExpc3RlbmVyIiwiJGluamVjdCIsInByb3RvdHlwZSIsIm5hbWUiLCJjb2RlIiwibmFtZU1pbkxlbmd0aCIsImNvZGVNaW5MZW5ndGgiLCJjb2RlUGF0dGVybiIsImRlbGV0ZVdvcmtzaG9wIiwiZHJhd2luZ1dvcmtzaG9wIiwiZHJhd2luZ1RpY2tldHMiLCJkcmF3aW5nQW1vdW50IiwiY2hhcnRSZXN1bHRzIiwiY2hhcnRUYXNrIiwidWlPblBhcmFtc0NoYW5nZWQiLCJwYXJhbXMiLCJ3b3Jrc2hvcCIsImV4cGFuZCIsIiQkZXhwYW5kZWQiLCJfZXhwYW5kZWQiLCJjcmVhdGUiLCJub3RpZmljYXRpb24iLCJnZXQiLCJpMThuIiwibWUiLCJzdWNjZXNzQ2FsbGJhY2siLCJtZXNzYWdlIiwic3VjY2VzcyIsInVuc2hpZnQiLCJfaW5pdFdvcmtzaG9wIiwiZmFpbHVyZUNhbGxiYWNrIiwiJGNyZWF0ZSIsInRoZW4iLCJpbmRleCIsImluZGV4T2YiLCJzcGxpY2UiLCJfcmVtb3ZlVXNlcnNTdHJlYW0iLCIkZGVsZXRlIiwibWFya1dvcmtzaG9wRm9yRHJhd2luZyIsIlRpY2tldCIsInJhbmRvbSIsInRpY2tldHMiLCJzaHVmZmxlIiwicmVzb3VyY2UiLCJnZXRCeVdvcmtzaG9wIiwid29ya3Nob3BJZCIsImlkIiwiJHByb21pc2UiLCJtYXJrV29ya3Nob3BGb3JEZWxldGlvbiIsInRvZ2dsZVdvcmtzaG9wIiwiaXNBY3RpdmUiLCIkdXBkYXRlIiwibWFya1Rhc2tGb3JDaGFydCIsInRhc2siLCJSZXN1bHQiLCJyZXN1bHRzIiwiZ2V0QnlUYXNrIiwidGFza0lkIiwidG9nZ2xlVGFzayIsIlRhc2siLCJ1cGRhdGUiLCIkc3RhdGUiLCJnbyIsIl9hZGRVc2Vyc1N0cmVhbSIsIkFQSV9VUkwiLCJzc2UiLCJfb25NZXNzYWdlIiwiZGF0YSIsIiRldmFsQXN5bmMiLCIkJHVzZXJzIiwidXJsIiwib3B0aW9ucyIsIm9uTWVzc2FnZSIsInNsZWVwIiwic291cmNlIiwiYWRkU291cmNlIiwicmVtb3ZlU291cmNlIiwiX3N0cmVhbVJlc3VsdHMiLCJmb3JFYWNoIiwiaXRlbSIsIiQkcmVzdWx0cyIsIl93YXRjaEV4cHJlc3Npb24iLCJfd2F0Y2hDYWxsYmFjayIsImJpbmQiLCJfdW53YXRjaCIsIiR3YXRjaCIsIiR1aVJvdXRlckdsb2JhbHMiLCJ0YXNrcyIsIm9sZCIsInVzZXJzIiwibGVuZ3RoIiwiX29uRGVzdHJveSIsIl91bmxpc3RlbiIsIiRvbiIsImNvbnRyb2xsZXIiLCJBTkdVTEFSX01PRFVMRSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Q0FTQSxTQUFVQSxFQUFRQyxHQUNoQixZQUtBLElBQUlDLEdBQVcsU0FBU0MsRUFBUUMsRUFBV0MsR0FDekNDLEtBQUtELFVBQVlBLEVBQ2pCQyxLQUFLRixVQUFZQSxFQUNqQkUsS0FBS0gsT0FBU0EsRUFFZEcsS0FBS0MsZUFBaUIsS0FDdEJELEtBQUtFLGdCQUNMRixLQUFLRyxjQUNMSCxLQUFLSSxVQUVMSixLQUFLSyxpQkFDTEwsS0FBS00sZ0JBR1BWLEdBQVNXLFNBQVcsU0FBVSxZQUFhLGFBTzNDWCxFQUFTWSxVQUFVQyxLQUFPLEtBRzFCYixFQUFTWSxVQUFVRSxLQUFPLEtBRzFCZCxFQUFTWSxVQUFVRyxjQUFnQixFQUduQ2YsRUFBU1ksVUFBVUksY0FBZ0IsRUFHbkNoQixFQUFTWSxVQUFVSyxZQUFjLGlCQUdqQ2pCLEVBQVNZLFVBQVVNLGVBQWlCLEtBR3BDbEIsRUFBU1ksVUFBVU8sZ0JBQWtCLEtBR3JDbkIsRUFBU1ksVUFBVVEsZUFBaUIsS0FHcENwQixFQUFTWSxVQUFVUyxj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b2JhbCBBTkdVTEFSX01PRFVMRSwgYW5ndWxhciAqL1xuKGZ1bmN0aW9uKG1vZHVsZSwgYW5ndWxhcikge1xuICAndXNlIHN0cmljdCc7XG5cbiAvKipcbiAgKiBAY29uc3RydWN0b3JcbiAgKi9cbiAgdmFyIFdvcmtzaG9wID0gZnVuY3Rpb24oJHNjb3BlLCAkaW5qZWN0b3IsIHdvcmtzaG9wcykge1xuICAgIHRoaXMud29ya3Nob3BzID0gd29ya3Nob3BzO1xuICAgIHRoaXMuJGluamVjdG9yID0gJGluamVjdG9yO1xuICAgIHRoaXMuJHNjb3BlID0gJHNjb3BlO1xuXG4gICAgdGhpcy5fcmVzdWx0c1NvdXJjZSA9IG51bGw7XG4gICAgdGhpcy5fdXNlclNvdXJjZXMgPSB7fTtcbiAgICB0aGlzLl93b3Jrc2hvcHMgPSB7fTtcbiAgICB0aGlzLl90YXNrcyA9IHt9O1xuXG4gICAgdGhpcy5faW5pdFdvcmtzaG9wcygpO1xuICAgIHRoaXMuX2luaXRMaXN0ZW5lcigpO1xuICB9O1xuXG4gIFdvcmtzaG9wLiRpbmplY3QgPSBbJyRzY29wZScsICckaW5qZWN0b3InLCAnd29ya3Nob3BzJ107XG5cbiAgLy9cbiAgLy8gUFJPUEVSVElFU1xuICAvL1xuXG4gIC8qKiBAdmFyIHtzdHJpbmd9IG5hbWUgTmFtZSBvZiBuZXcgd29ya3Nob3AuICovXG4gIFdvcmtzaG9wLnByb3RvdHlwZS5uYW1lID0gbnVsbDtcblxuICAvKiogQHZhciB7c3RyaW5nfSBjb2RlIENvZGUgb2YgbmV3IHdvcmtzaG9wLiAqL1xuICBXb3Jrc2hvcC5wcm90b3R5cGUuY29kZSA9IG51bGw7XG5cbiAgLyoqIEB2YXIge1JlZ0V4cH0gbmFtZU1pbkxlbmd0aCBNaW5pbXVtIGxlbmd0aCBvZiB3b3Jrc2hvcCBuYW1lLiAqL1xuICBXb3Jrc2hvcC5wcm90b3R5cGUubmFtZU1pbkxlbmd0aCA9IDg7XG5cbiAgLyoqIEB2YXIge1JlZ0V4cH0gY29kZU1pbkxlbmd0aCBNaW5pbXVtIGxlbmd0aCBvZiB3b3Jrc2hvcCBjb2RlLiAqL1xuICBXb3Jrc2hvcC5wcm90b3R5cGUuY29kZU1pbkxlbmd0aCA9IDg7XG5cbiAgLyoqIEB2YXIge1JlZ0V4cH0gdXNlcnBhdHRlcm4gUmVndWxhciBleHByZXNzaW9uIGZvciBgdXNlcm5hbWVgIHByb3BlcnR5LiAqL1xuICBXb3Jrc2hvcC5wcm90b3R5cGUuY29kZVBhdHRlcm4gPSAvXltBLVphLXowLTldKyQvO1xuXG4gIC8qKiBAdmFyIHtvYmplY3R9IGRlbGV0ZVdvcmtzaG9wIEN1cnJlbnRseSBtYXJrZWQgd29ya3Nob3AgZm9yIGRlbGV0aW9uLiAqL1xuICBXb3Jrc2hvcC5wcm90b3R5cGUuZGVsZXRlV29ya3Nob3AgPSBudWxsO1xuXG4gIC8qKiBAdmFyIHtvYmplY3R9IGRyYXdpbmdXb3Jrc2hvcCBDdXJyZW50bHkgbWFya2VkIHdvcmtzaG9wIGZvciBkcmF3aW5nLiAqL1xuICBXb3Jrc2hvcC5wcm90b3R5cGUuZHJhd2luZ1dvcmtzaG9wID0gbnVsbDtcblxuICAvKiogQHZhciB7YXJyYXl9IGRyYXdpbmdUaWNrZXRzIFJhbmRvbWx5IHBpY2tlZCB0aWNrZXRzIG9mIGRyYXdpbmcuICovXG4gIFdvcmtzaG9wLnByb3RvdHlwZS5kcmF3aW5nVGlja2V0cyA9IG51bGw7XG5cbiAgLyoqIEB2YXIge2FycmF5fSBkcmF3aW5nQW1vdW50IEFtb3VudCBvZiBjaG9zZW4gdGlja2V0cyBmb3IgZHJhd2luZy4gKi9cbiAgV29ya3Nob3AucHJvdG90eXBlLmRyYXdpbmdBbW91bnQgPSAyO1xuXG4gIC8qKiBAdmFyIHthcnJheX0gY2hhcnRSZXN1bHRzIEN1cnJlbnRseSBsb2FkZWQgcmVzdWx0cyBmb3IgY2hhcnQuICovXG4gIFdvcmtzaG9wLnByb3RvdHlwZS5jaGFydFJlc3VsdHMgPSBudWxsO1xuXG4gIC8qKiBAdmFyIHtvYmplY3R9IGNoYXJ0VGFzayBDdXJyZW50bHkgc2VsZWN0ZWQgdGFzayBvZiByZXN1bHRzLiAqL1xuICBXb3Jrc2hvcC5wcm90b3R5cGUuY2hhcnRUYXNrID0gbnVsbDtcblxuICAvL1xuICAvLyBNRVRIT0RTXG4gIC8vXG5cbiAgLyoqXG4gICAqIFRvZ2dsZXMgYCQkZXhwYW5kZWRgIGZsYWcgb24gd29ya3Nob3AgZGVwZW5kaW5nIG9uIHF1ZXJ5IHBhcmFtcy5cbiAgICogaHR0cHM6Ly91aS1yb3V0ZXIuZ2l0aHViLmlvL25nMS9kb2NzL2xhdGVzdC9pbnRlcmZhY2VzL25nMS5uZzFjb250cm9sbGVyLmh0bWwjdWlvbnBhcmFtc2NoYW5nZWRcbiAgICpcbiAgICogQHB1YmxpY1xuICAgKiBAbWV0aG9kIHVpT25QYXJhbXNDaGFuZ2VkXG4gICAqIEBwYXJhbSB7b2JqZWN0fSBwYXJhbXNcbiAgICogQHJldHVybiB7dm9pZH1cbiAgICovXG4gIFdvcmtzaG9wLnByb3RvdHlwZS51aU9uUGFyYW1zQ2hhbmdlZCA9IGZ1bmN0aW9uKHBhcmFtcylcbiAgICB7XG4gICAgICB2YXIgd29ya3Nob3AgPSB0aGlzLl93b3Jrc2hvcHNbcGFyYW1zLmV4cGFuZF07XG5cbiAgICAgIGlmICh3b3Jrc2hvcCkge1xuICAgICAgICB3b3Jrc2hvcC4kJGV4cGFuZGVkID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5fZXhwYW5kZWQgPSB3b3Jrc2hvcDtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy5fZXhwYW5kZWQpIHtcbiAgICAgICAgdGhpcy5fZXhwYW5kZWQuJCRleHBhbmRlZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLl9leHBhbmRlZCA9IG51bGw7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICB9O1xuXG4gIC8qKlxuICAgKiBDcmVhdGVzIGEgbmV3IHdvcmtzaG9wLlxuICAgKlxuICAgKiBAcHVibGljXG4gICAqIEBtZXRob2QgY3JlYXRlXG4gICAqIEByZXR1cm4ge3ZvaWR9XG4gICAqL1xuICBXb3Jrc2hvcC5wcm90b3R5cGUuY3JlYXRlID0gZnVuY3Rpb24oKVxuICAgIHtcbiAgICAgIHZhciBub3RpZmljYXRpb24gPSB0aGlzLiRpbmplY3Rvci5nZXQoJ25vdGlmaWNhdGlvbicpO1xuICAgICAgdmFyIFdvcmtzaG9wID0gdGhpcy4kaW5qZWN0b3IuZ2V0KCdXb3Jrc2hvcCcpO1xuICAgICAgdmFyIGkxOG4gPSB0aGlzLiRpbmplY3Rvci5nZXQoJ2kxOG4nKTtcblxuICAgICAgdmFyIHdvcmtzaG9wID0gbmV3IFdvcmtzaG9wKHtcbiAgICAgICAgbmFtZTogdGhpcy5uYW1lLFxuICAgICAgICBjb2RlOiB0aGlzLmNvZGVcbiAgICAgIH0pO1xuXG4gICAgICB2YXIgbWUgPSB0aGlzO1xuXG4gICAgICB2YXIgc3VjY2Vzc0NhbGxiYWNrID0gZnVuY3Rpb24od29ya3Nob3ApXG4gICAgICAgIHtcbiAgICAgICAgICB2YXIgbWVzc2FnZSA9IGkxOG4uZ2V0KCdXb3Jrc2hvcCBoYXMgYmVlbiBjcmVhdGVkIHN1Y2Nlc3NmdWxseSEnKTtcbiAgICAgICAgICBub3RpZmljYXRpb24uc3VjY2VzcyhtZXNzYWdlKTtcblxuICAgICAgICAgIG1lLndvcmtzaG9wcy51bnNoaWZ0KHdvcmtzaG9wKTtcbiAgICAgICAgICBtZS5faW5pdFdvcmtzaG9wKHdvcmtzaG9wKTtcblxuICAgICAgICAgIG1lLm5hbWUgPSBudWxsO1xuICAgICAgICAgIG1lLmNvZGUgPSBudWxsO1xuICAgICAgICB9O1xuXG4gICAgICB2YXIgZmFpbHVyZUNhbGxiYWNrID0gZnVuY3Rpb24oKVxuICAgICAgICB7XG4gICAgICAgICAgLy8gbm9vcFxuICAgICAgICB9O1xuXG4gICAgICB3b3Jrc2hvcC4kY3JlYXRlKCkudGhlbihcbiAgICAgICAgc3VjY2Vzc0NhbGxiYWNrLFxuICAgICAgICBmYWlsdXJlQ2FsbGJhY2tcbiAgICAgICk7XG4gICAgfTtcblxuICAvKipcbiAgICogRGVsZXRlcyBhIHdvcmtzaG9wIGFmdGVyIGNvbmZpcm1hdGlvbi5cbiAgICpcbiAgICogQHB1YmxpY1xuICAgKiBAbWV0aG9kIGRlbGV0ZVxuICAgKiBAcGFyYW0ge29iamVjdH0gd29ya3Nob3BcbiAgICogQHJldHVybiB7dm9pZH1cbiAgICovXG4gIFdvcmtzaG9wLnByb3RvdHlwZS5kZWxldGUgPSBmdW5jdGlvbih3b3Jrc2hvcClcbiAgICB7XG4gICAgICB2YXIgbm90aWZpY2F0aW9uID0gdGhpcy4kaW5qZWN0b3IuZ2V0KCdub3RpZmljYXRpb24nKTtcbiAgICAgIHZhciBpMThuID0gdGhpcy4kaW5qZWN0b3IuZ2V0KCdpMThuJyk7XG5cbiAgICAgIHZhciBtZSA9IHRoaXM7XG5cbiAgICAgIHZhciBzdWNjZXNzQ2FsbGJhY2sgPSBmdW5jdGlvbigpXG4gICAgICAgIHtcbiAgICAgICAgICB2YXIgbWVzc2FnZSA9IGkxOG4uZ2V0KCdXb3Jrc2hvcCBoYXMgYmVlbiBkZWxldGVkIHN1Y2Nlc3NmdWxseSEnKTtcbiAgICAgICAgICBub3RpZmljYXRpb24uc3VjY2VzcyhtZXNzYWdlKTtcblxuICAgICAgICAgIHZhciBpbmRleCA9IG1lLndvcmtzaG9wcy5pbmRleE9mKHdvcmtzaG9wKTtcbiAgICAgICAgICBtZS53b3Jrc2hvcHMuc3BsaWNlKGluZGV4LCAxKTtcblxuICAgICAgICAgIG1lLl9yZW1vdmVVc2Vyc1N0cmVhbSh3b3Jrc2hvcCk7XG4gICAgICAgIH07XG5cbiAgICAgIHZhciBmYWlsdXJlQ2FsbGJhY2sgPSBmdW5jdGlvbigpXG4gICAgICAgIHtcbiAgICAgICAgICAvLyBub29wXG4gICAgICAgIH07XG5cbiAgICAgIHdvcmtzaG9wLiRkZWxldGUoKS50aGVuKFxuICAgICAgICBzdWNjZXNzQ2FsbGJhY2ssXG4gICAgICAgIGZhaWx1cmVDYWxsYmFja1xuICAgICAgKTtcbiAgICB9O1xuXG4gIC8qKlxuICAgKiBMb2FkcyB0YXNrJ3MgcmVzdWx0cyBhbmQgaW52b2tlcyBtb2RhbCBkaWFsb2cuXG4gICAqXG4gICAqIEBwdWJsaWNcbiAgICogQG1ldGhvZCBtYXJrV29ya3Nob3BGb3JEcmF3aW5nXG4gICAqIEBwYXJhbSB7b2JqZWN0fSB3b3Jrc2hvcFxuICAgKiBAcmV0dXJuIHt2b2lkfVxuICAgKi9cbiAgV29ya3Nob3AucHJvdG90eXBlLm1hcmtXb3Jrc2hvcEZvckRyYXdpbmcgPSBmdW5jdGlvbih3b3Jrc2hvcClcbiAgICB7XG4gICAgICB2YXIgVGlja2V0ID0gdGhpcy4kaW5qZWN0b3IuZ2V0KCdUaWNrZXQnKTtcbiAgICAgIHZhciByYW5kb20gPSB0aGlzLiRpbmplY3Rvci5nZXQoJ3JhbmRvbScpO1xuXG4gICAgICB2YXIgbWUgPSB0aGlzO1xuICAgICAgdmFyIHN1Y2Nlc3NDYWxsYmFjayA9IGZ1bmN0aW9uKHRpY2tldHMpXG4gICAgICAgIHtcbiAgICAgICAgICBtZS5kcmF3aW5nVGlja2V0cyA9IHJhbmRvbS5zaHVmZmxlKHRpY2tldHMpO1xuICAgICAgICAgIG1lLmRyYXdpbmdXb3Jrc2hvcCA9IHdvcmtzaG9wO1xuICAgICAgICB9O1xuXG4gICAgICB2YXIgZmFpbHVyZUNhbGxiYWNrID0gZnVuY3Rpb24oKVxuICAgICAgICB7XG4gICAgICAgIH07XG5cbiAgICAgIHZhciByZXNvdXJjZSA9IFRpY2tldC5nZXRCeVdvcmtzaG9wKHsgd29ya3Nob3BJZDogd29ya3Nob3AuaWQgfSk7XG4gICAgICByZXNvdXJjZS4kcHJvbWlzZS50aGVuKFxuICAgICAgICBzdWNjZXNzQ2FsbGJhY2ssXG4gICAgICAgIGZhaWx1cmVDYWxsYmFja1xuICAgICAgKTtcbiAgICB9O1xuXG4gIC8qKlxuICAgKiBJbnZva2VzIGNvbmZpcm1hdGlvbiBtb2RhbCBmb3IgZGVsZXRpbmcgYSB3b3Jrc2hvcC5cbiAgICpcbiAgICogQHB1YmxpY1xuICAgKiBAbWV0aG9kIG1hcmtXb3Jrc2hvcEZvckRlbGV0aW9uXG4gICAqIEBwYXJhbSB7b2JqZWN0fSB3b3Jrc2hvcFxuICAgKiBAcmV0dXJuIHt2b2lkfVxuICAgKi9cbiAgV29ya3Nob3AucHJvdG90eXBlLm1hcmtXb3Jrc2hvcEZvckRlbGV0aW9uID0gZnVuY3Rpb24od29ya3Nob3ApXG4gICAge1xuICAgICAgdGhpcy5kZWxldGVXb3Jrc2hvcCA9IHdvcmtzaG9wO1xuICAgIH07XG5cbiAgLyoqXG4gICAqIFRvZ2dsZXMgYGlzQWN0aXZlYCBvZiBhIHdvcmtzaG9wLlxuICAgKlxuICAgKiBAcHVibGljXG4gICAqIEBtZXRob2QgdG9nZ2xlQWN0aXZlXG4gICAqIEBwYXJhbSB7b2JqZWN0fSB3b3Jrc2hvcFxuICAgKiBAcmV0dXJuIHt2b2lkfVxuICAgKi9cbiAgV29ya3Nob3AucHJvdG90eXBlLnRvZ2dsZVdvcmtzaG9wID0gZnVuY3Rpb24od29ya3Nob3ApXG4gICAge1xuICAgICAgdmFyIG5vdGlmaWNhdGlvbiA9IHRoaXMuJGluamVjdG9yLmdldCgnbm90aWZpY2F0aW9uJyk7XG4gICAgICB2YXIgaTE4biA9IHRoaXMuJGluamVjdG9yLmdldCgnaTE4bicpO1xuXG4gICAgICB2YXIgbWUgPSB0aGlzO1xuXG4gICAgICB2YXIgc3VjY2Vzc0NhbGxiYWNrID0gZnVuY3Rpb24od29ya3Nob3ApXG4gICAgICAgIHtcbiAgICAgICAgICB2YXIgbWVzc2FnZSA9IGkxOG4uZ2V0KFxuICAgICAgICAgICAgd29ya3Nob3AuaXNBY3RpdmUgP1xuICAgICAgICAgICAgICAnV29ya3Nob3AgaGFzIGJlZW4gdW5sb2NrZWQgc3VjY2Vzc2Z1bGx5LiBTdHVkZW50cyBjYW4gcmVnaXN0ZXIgbm93IScgOlxuICAgICAgICAgICAgICAnV29ya3Nob3AgaGFzIGJlZW4gbG9ja2VkIHN1Y2Nlc3NmdWxseS4gU3R1ZGVudHMgY2FuIG5vdyBvbmx5IHVzZSB0aGVpciBhY2Nlc3MgZnJvbSBob21lISdcbiAgICAgICAgICApO1xuICAgICAgICAgIG5vdGlmaWNhdGlvbi5zdWNjZXNzKG1lc3NhZ2UpO1xuXG4gICAgICAgICAgbWUuX2luaXRXb3Jrc2hvcCh3b3Jrc2hvcCk7XG4gICAgICAgIH07XG5cbiAgICAgIHZhciBmYWlsdXJlQ2FsbGJhY2sgPSBmdW5jdGlvbigpXG4gICAgICAgIHtcbiAgICAgICAgICAvLyByZXZlcnQgdGhlIGNoYW5nZSBvbiBmYWlsZWQgdXBkYXRlIVxuICAgICAgICAgIHdvcmtzaG9wLmlzQWN0aXZlID0gIXdvcmtzaG9wLmlzQWN0aXZlO1xuICAgICAgICB9O1xuXG4gICAgICB3b3Jrc2hvcC5pc0FjdGl2ZSA9ICF3b3Jrc2hvcC5pc0FjdGl2ZTtcblxuICAgICAgd29ya3Nob3AuJHVwZGF0ZSgpLnRoZW4oXG4gICAgICAgIHN1Y2Nlc3NDYWxsYmFjayxcbiAgICAgICAgZmFpbHVyZUNhbGxiYWNrXG4gICAgICApO1xuICAgIH07XG5cbiAgLyoqXG4gICAqIExvYWRzIHRhc2sncyByZXN1bHRzIGFuZCBpbnZva2VzIG1vZGFsIGRpYWxvZy5cbiAgICpcbiAgICogQHB1YmxpY1xuICAgKiBAbWV0aG9kIG1hcmtUYXNrRm9yQ2hhcnRcbiAgICogQHBhcmFtIHtvYmplY3R9IHRhc2tcbiAgICogQHJldHVybiB7dm9pZH1cbiAgICovXG4gIFdvcmtzaG9wLnByb3RvdHlwZS5tYXJrVGFza0ZvckNoYXJ0ID0gZnVuY3Rpb24odGFzaylcbiAgICB7XG4gICAgICB2YXIgUmVzdWx0ID0gdGhpcy4kaW5qZWN0b3IuZ2V0KCdSZXN1bHQnKTtcblxuICAgICAgdmFyIG1lID0gdGhpcztcbiAgICAgIHZhciBzdWNjZXNzQ2FsbGJhY2sgPSBmdW5jdGlvbihyZXN1bHRzKVxuICAgICAgICB7XG4gICAgICAgICAgbWUuY2hhcnRSZXN1bHRzID0gcmVzdWx0cztcbiAgICAgICAgICBtZS5jaGFydFRhc2sgPSB0YXNrO1xuICAgICAgICB9O1xuXG4gICAgICB2YXIgZmFpbHVyZUNhbGxiYWNrID0gZnVuY3Rpb24oKVxuICAgICAgICB7XG4gICAgICAgIH07XG5cbiAgICAgIHZhciByZXNvdXJjZSA9IFJlc3VsdC5nZXRCeVRhc2soeyB0YXNrSWQ6IHRhc2suaWQgfSk7XG4gICAgICByZXNvdXJjZS4kcHJvbWlzZS50aGVuKFxuICAgICAgICBzdWNjZXNzQ2FsbGJhY2ssXG4gICAgICAgIGZhaWx1cmVDYWxsYmFja1xuICAgICAgKTtcbiAgICB9O1xuXG4gIC8qKlxuICAgKiBUb2dnbGVzIGBpc0FjdGl2ZWAgb2YgYSB0YXNrLlxuICAgKlxuICAgKiBAcHVibGljXG4gICAqIEBtZXRob2QgdG9nZ2xlVGFza1xuICAgKiBAcGFyYW0ge29iamVjdH0gdGFza1xuICAgKiBAcmV0dXJuIHt2b2lkfVxuICAgKi9cbiAgV29ya3Nob3AucHJvdG90eXBlLnRvZ2dsZVRhc2sgPSBmdW5jdGlvbih0YXNrKVxuICAgIHtcbiAgICAgIHZhciBub3RpZmljYXRpb24gPSB0aGlzLiRpbmplY3Rvci5nZXQoJ25vdGlmaWNhdGlvbicpO1xuICAgICAgdmFyIGkxOG4gPSB0aGlzLiRpbmplY3Rvci5nZXQoJ2kxOG4nKTtcbiAgICAgIHZhciBUYXNrID0gdGhpcy4kaW5qZWN0b3IuZ2V0KCdUYXNrJyk7XG5cbiAgICAgIHZhciBzdWNjZXNzQ2FsbGJhY2sgPSBmdW5jdGlvbigvKndvcmtzaG9wKi8pXG4gICAgICAgIHtcbiAgICAgICAgICB2YXIgbWVzc2FnZSA9IGkxOG4uZ2V0KFxuICAgICAgICAgICAgdGFzay5pc0FjdGl2ZSA/XG4gICAgICAgICAgICAgICdUYXNrIGhhcyBiZWVuIHVubG9ja2VkIHN1Y2Nlc3NmdWxseS4gU3R1ZGVudHMgY2FuIHNlbmQgcmVzdWx0cyBub3chJyA6XG4gICAgICAgICAgICAgICdUYXNrIGhhcyBiZWVuIGxvY2tlZCBzdWNjZXNzZnVsbHkuIFN0dWRlbnRzIGNhbm5vdCBzZW5kIHJlc3VsdHMgY3VycmVudGx5ISdcbiAgICAgICAgICApO1xuICAgICAgICAgIG5vdGlmaWNhdGlvbi5zdWNjZXNzKG1lc3NhZ2UpO1xuICAgICAgICB9O1xuXG4gICAgICB2YXIgZmFpbHVyZUNhbGxiYWNrID0gZnVuY3Rpb24oKVxuICAgICAgICB7XG4gICAgICAgICAgLy8gcmV2ZXJ0IHRoZSBjaGFuZ2Ugb24gZmFpbGVkIHVwZGF0ZSFcbiAgICAgICAgICB0YXNrLmlzQWN0aXZlID0gIXRhc2suaXNBY3RpdmU7XG4gICAgICAgIH07XG5cbiAgICAgIHRhc2suaXNBY3RpdmUgPSAhdGFzay5pc0FjdGl2ZTtcblxuICAgICAgdmFyIHJlc291cmNlID0gVGFzay51cGRhdGUoe8KgaWQ6IHRhc2suaWR9LCB0YXNrKTtcbiAgICAgIHJlc291cmNlLiRwcm9taXNlLnRoZW4oXG4gICAgICAgIHN1Y2Nlc3NDYWxsYmFjayxcbiAgICAgICAgZmFpbHVyZUNhbGxiYWNrXG4gICAgICApO1xuICAgIH07XG5cbiAgLyoqXG4gICAqIFNldHMgYGV4cGFuZGAgcXVlcnkgcGFyYW1ldGVyIGRlcGVuZGVuZGluZyBvblxuICAgKiB3b3Jrc2hvcCdzIGN1cnJlbnQgYCQkZXhwYW5kZWRgIGZsYWcgaW5mby5cbiAgICpcbiAgICogQHB1YmxpY1xuICAgKiBAbWV0aG9kIGV4cGFuZFxuICAgKiBAcGFyYW0ge29iamVjdH0gd29ya3Nob3BcbiAgICogQHJldHVybiB7dm9pZH1cbiAgICovXG4gIFdvcmtzaG9wLnByb3RvdHlwZS5leHBhbmQgPSBmdW5jdGlvbih3b3Jrc2hvcClcbiAgICB7XG4gICAgICB2YXIgJHN0YXRlID0gdGhpcy4kaW5qZWN0b3IuZ2V0KCckc3RhdGUnKTtcbiAgICAgIHZhciBleHBhbmQgPSAhd29ya3Nob3AuJCRleHBhbmRlZCA/XG4gICAgICAgIHdvcmtzaG9wLmlkIDrCoFxuICAgICAgICBudWxsO1xuXG4gICAgICAkc3RhdGUuZ28oJ2JhY2tlbmQud29ya3Nob3BzJywge1xuICAgICAgICBleHBhbmQ6IGV4cGFuZFxuICAgICAgfSk7XG4gICAgfTtcblxuICAvKipcbiAgICogU2V0cyB1cCBhbiBldmVudCBzb3VyY2UgZm9yIHN0cmVhbWluZyB1c2VyIGNvdW50LlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAbWV0aG9kIF9hZGRVc2Vyc1N0cmVhbVxuICAgKiBAcGFyYW0ge29iamVjdH0gd29ya3Nob3BcbiAgICogQHJldHVybiB7dm9pZH1cbiAgICovXG4gIFdvcmtzaG9wLnByb3RvdHlwZS5fYWRkVXNlcnNTdHJlYW0gPSBmdW5jdGlvbih3b3Jrc2hvcClcbiAgICB7XG4gICAgICB2YXIgQVBJX1VSTCA9IHRoaXMuJGluamVjdG9yLmdldCgnQVBJX1VSTCcpO1xuICAgICAgdmFyIHNzZSA9IHRoaXMuJGluamVjdG9yLmdldCgnc3NlJyk7XG5cbiAgICAgIHZhciBtZSA9IHRoaXM7XG5cbiAgICAgIHZhciBfb25NZXNzYWdlID0gZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICBtZS4kc2NvcGUuJGV2YWxBc3luYyhmdW5jdGlvbigpe1xuICAgICAgICAgIHdvcmtzaG9wLiQkdXNlcnMgPSBkYXRhO1xuICAgICAgICB9KTtcbiAgICAgIH07XG5cbiAgICAgIHZhciB1cmwgPSBBUElfVVJMICsgJy9zc2Uvd29ya3Nob3AvJyArIHdvcmtzaG9wLmlkICsgJy91c2Vycyc7XG4gICAgICB2YXIgb3B0aW9ucyA9IHsgb25NZXNzYWdlOiBfb25NZXNzYWdlLCBzbGVlcDogMTAgfTtcbiAgICAgIHZhciBzb3VyY2UgPSBzc2UuYWRkU291cmNlKHVybCwgb3B0aW9ucyk7XG4gICAgICB0aGlzLl91c2VyU291cmNlc1t3b3Jrc2hvcC5pZF0gPSBzb3VyY2U7XG4gICAgfTtcblxuICAvKipcbiAgICogUmVtb3ZlcyBhbiBldmVudCBzb3VyY2UgZnJvbSBpbnRlcm5hbCBzdGFjayBhbmQgc2VydmljZS5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICogQG1ldGhvZCBfcmVtb3ZlVXNlcnNTdHJlYW1cbiAgICogQHBhcmFtIHtvYmplY3R9IHdvcmtzaG9wXG4gICAqIEByZXR1cm4ge3ZvaWR9XG4gICAqL1xuICBXb3Jrc2hvcC5wcm90b3R5cGUuX3JlbW92ZVVzZXJzU3RyZWFtID0gZnVuY3Rpb24od29ya3Nob3ApXG4gICAge1xuICAgICAgdmFyIHNzZSA9IHRoaXMuJGluamVjdG9yLmdldCgnc3NlJyk7XG5cbiAgICAgIHZhciBzb3VyY2UgPSB0aGlzLl91c2VyU291cmNlc1t3b3Jrc2hvcC5pZF07XG4gICAgICBpZiAoIXNvdXJjZSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGRlbGV0ZSB0aGlzLl91c2VyU291cmNlc1t3b3Jrc2hvcC5pZF07XG4gICAgICBzc2UucmVtb3ZlU291cmNlKHNvdXJjZSk7XG4gICAgfTtcblxuICAvKipcbiAgICogU2V0cyB1cCBldmVudCBzb3VyY2VzIGZvciB1cGRhdGluZyByZXN1bHQgY291bnRlcnMuXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqIEBtZXRob2QgX3N0cmVhbVJlc3VsdHNcbiAgICogQHJldHVybiB7dm9pZH1cbiAgICovXG4gIFdvcmtzaG9wLnByb3RvdHlwZS5fc3RyZWFtUmVzdWx0cyA9IGZ1bmN0aW9uKClcbiAgICB7XG4gICAgICB2YXIgQVBJX1VSTCA9IHRoaXMuJGluamVjdG9yLmdldCgnQVBJX1VSTCcpO1xuICAgICAgdmFyIHNzZSA9IHRoaXMuJGluamVjdG9yLmdldCgnc3NlJyk7XG5cbiAgICAgIHZhciBtZSA9IHRoaXM7XG5cbiAgICAgIC8vIC0tLSBTU0UgLS0tXG4gICAgICB2YXIgX29uTWVzc2FnZSA9IGZ1bmN0aW9uKHdvcmtzaG9wLCBkYXRhKSB7XG4gICAgICAgIG1lLiRzY29wZS4kZXZhbEFzeW5jKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgLy8gcmVtb3ZlIGV2ZW50IHNvdXJjZSBpZiB3b3Jrc2hvcCBpcyBub3RcbiAgICAgICAgICAvLyBhY3RpdmUgYXQgdGhlIG1vbWVudCA9PT0gb25lLXNob3Qgb25seVxuICAgICAgICAgIGlmICghd29ya3Nob3AuaXNBY3RpdmUpIHtcbiAgICAgICAgICAgIHNzZS5yZW1vdmVTb3VyY2UobWUuX3Jlc3VsdHNTb3VyY2UpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaChkYXRhLCBmdW5jdGlvbihpdGVtKXtcbiAgICAgICAgICAgIHZhciB0YXNrID0gbWUuX3Rhc2tzW2l0ZW0uaWRdO1xuICAgICAgICAgICAgdGFzay4kJHJlc3VsdHMgPSBpdGVtLnJlc3VsdHM7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcblxuICAgICAgdmFyIF93YXRjaEV4cHJlc3Npb24gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgLy8gd29ya3Nob3AgbXVzdCBiZSBvcGVuZWQsIGJ1dCB3ZSBhbHNvIG5lZWRcbiAgICAgICAgLy8gdG8gd2F0Y2ggYGlzQWN0aXZlYCBzdGF0ZSB0byBjYXRjaCB0b2dnbGVcbiAgICAgICAgLy8gZnJvbSBwcm9wZXJ0eSB0byByZWluaXRpYWxpemUgZXZlbnQgc291cmNlXG4gICAgICAgIHJldHVybiBtZS5fZXhwYW5kZWQgJiYgbWUuX2V4cGFuZGVkLmlzQWN0aXZlO1xuICAgICAgfTtcblxuICAgICAgdmFyIF93YXRjaENhbGxiYWNrID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmIChtZS5fcmVzdWx0c1NvdXJjZSkge1xuICAgICAgICAgIHNzZS5yZW1vdmVTb3VyY2UobWUuX3Jlc3VsdHNTb3VyY2UpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG1lLl9leHBhbmRlZCkge1xuICAgICAgICAgIHZhciB1cmwgPSBBUElfVVJMICsgJy9zc2Uvd29ya3Nob3AvJyArIG1lLl9leHBhbmRlZC5pZCArICcvcmVzdWx0cyc7XG4gICAgICAgICAgdmFyIG9uTWVzc2FnZSA9IF9vbk1lc3NhZ2UuYmluZChtZSwgbWUuX2V4cGFuZGVkKTtcbiAgICAgICAgICB2YXIgb3B0aW9ucyA9IHsgb25NZXNzYWdlOiBvbk1lc3NhZ2UsIHNsZWVwOsKgNSB9O1xuICAgICAgICAgIG1lLl9yZXN1bHRzU291cmNlID0gc3NlLmFkZFNvdXJjZSh1cmwsIG9wdGlvbnMpO1xuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICB0aGlzLl91bndhdGNoID0gdGhpcy4kc2NvcGUuJHdhdGNoKFxuICAgICAgICBfd2F0Y2hFeHByZXNzaW9uLFxuICAgICAgICBfd2F0Y2hDYWxsYmFja1xuICAgICAgKTtcbiAgICB9O1xuXG4gIC8qKlxuICAgKiBNYXBzIGFsbCB3b3Jrc2hvcHMgdG8gaGFzaCBtYXBzLCBzZXRzIHVwIHN0cmVhbWluZyBhbmQgcXVlcnkgcGFyYW1zLlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAbWV0aG9kIF9pbml0V29ya3Nob3BzXG4gICAqIEByZXR1cm4ge3ZvaWR9XG4gICAqL1xuICBXb3Jrc2hvcC5wcm90b3R5cGUuX2luaXRXb3Jrc2hvcHMgPSBmdW5jdGlvbigpXG4gICAge1xuICAgICAgdmFyICR1aVJvdXRlckdsb2JhbHMgPSB0aGlzLiRpbmplY3Rvci5nZXQoJyR1aVJvdXRlckdsb2JhbHMnKTtcblxuICAgICAgLy8gY3JlYXRlIGhhc2ggbWFwcyBmb3Igd29ya3Nob3BzIGFuZCB0YXNrcyBmb3IgZWFzZSBsb29rdXBzXG4gICAgICBhbmd1bGFyLmZvckVhY2godGhpcy53b3Jrc2hvcHMsIHRoaXMuX2luaXRXb3Jrc2hvcC5iaW5kKHRoaXMpKTtcblxuICAgICAgLy8gbm93IG1ha2UgdGhlIGluaXRpYWwgY2FsbCB0byBjaGFuZ2UgaGFuZGxlclxuICAgICAgdGhpcy51aU9uUGFyYW1zQ2hhbmdlZCgkdWlSb3V0ZXJHbG9iYWxzLnBhcmFtcyk7XG5cbiAgICAgIC8vIGtpY2sgb2ZmIGdlbmVyYWwgc3RyZWFtaW5nIG9mIHRhc2sgcmVzdWx0c1xuICAgICAgdGhpcy5fc3RyZWFtUmVzdWx0cygpO1xuICAgIH07XG5cbiAgLyoqXG4gICAqIEFkZHMgd29ya3Nob3AgYW5kIHRhc2tzIHRvIGhhc2ggbWFwIGFuZCBpbml0aWFsaXplc1xuICAgKiBzdHJlYW1pbmcgZm9yIHdvcmtzaG9wIGRlcGVuZGluZyBvbiBgaXNBY3RpdmVgIGZsYWcuXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqIEBtZXRob2QgX2luaXRXb3Jrc2hvcFxuICAgKiBAcGFyYW0ge29iamVjdH0gd29ya3Nob3BcbiAgICogQHJldHVybiB7dm9pZH1cbiAgICovXG4gIFdvcmtzaG9wLnByb3RvdHlwZS5faW5pdFdvcmtzaG9wID0gZnVuY3Rpb24od29ya3Nob3ApXG4gICAge1xuICAgICAgLy8gbWFwIGFsbCBgdGFza3NgIHRvIGludGVybmFsIGhhc2ggYW5kIHNldCBgJCRyZXN1bHRzYFxuICAgICAgdmFyIG1lID0gdGhpcztcbiAgICAgIGFuZ3VsYXIuZm9yRWFjaCh3b3Jrc2hvcC50YXNrcywgZnVuY3Rpb24odGFzayl7XG4gICAgICAgIHZhciBvbGQgPSBtZS5fdGFza3NbdGFzay5pZF0gfHzCoG51bGw7XG4gICAgICAgIHRhc2suJCRyZXN1bHRzID0gb2xkICE9PSBudWxsID9cbiAgICAgICAgICBvbGQuJCRyZXN1bHRzXG4gICAgICAgICAgOiAwO1xuXG4gICAgICAgIG1lLl90YXNrc1t0YXNrLmlkXSA9IHRhc2s7XG4gICAgICB9KTtcblxuICAgICAgLy8gY2hlY2sgYCQkZXhwYW5kZWRgIGZsYWcgZm9yIHRoaXMgd29ya3Nob3BcbiAgICAgIHZhciBpZCA9IHRoaXMuX2V4cGFuZGVkICYmIHRoaXMuX2V4cGFuZGVkLmlkO1xuICAgICAgd29ya3Nob3AuJCRleHBhbmRlZCA9IHdvcmtzaG9wLmlkID09PSBpZDtcblxuICAgICAgLy8gaW5pdGlhbGl6ZSBgJCR1c2Vyc2AgYW5kIHNldCB1cCBzdHJlYW1pbmdcbiAgICAgIHdvcmtzaG9wLiQkdXNlcnMgPSB3b3Jrc2hvcC51c2Vycy5sZW5ndGg7XG5cbiAgICAgIGlmICghd29ya3Nob3AuaXNBY3RpdmUpIHtcbiAgICAgICAgdGhpcy5fcmVtb3ZlVXNlcnNTdHJlYW0od29ya3Nob3ApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5fYWRkVXNlcnNTdHJlYW0od29ya3Nob3ApO1xuICAgICAgfVxuXG4gICAgICB0aGlzLl93b3Jrc2hvcHNbd29ya3Nob3AuaWRdID0gd29ya3Nob3A7XG4gICAgfTtcblxuICAvKipcbiAgICogUmVtb3ZlcyBhbGwgd2F0Y2hlcywgbGlzdGVuZXJzIGFuZCBzb3VyY2VzXG4gICAqIGFzIHNvb24gYXMgY29udHJvbGxlcidzICRzY29wZSBpcyBkZXN0cm95ZWQuXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqIEBtZXRob2QgX2luaXRMaXN0ZW5lclxuICAgKiBAcmV0dXJuIHt2b2lkfVxuICAgKi9cbiAgV29ya3Nob3AucHJvdG90eXBlLl9pbml0TGlzdGVuZXIgPSBmdW5jdGlvbigpXG4gICAge1xuICAgICAgdmFyIHNzZSA9IHRoaXMuJGluamVjdG9yLmdldCgnc3NlJyk7XG5cbiAgICAgIHZhciBtZSA9IHRoaXM7XG5cbiAgICAgIHZhciBfb25EZXN0cm95ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIGZvciAodmFyIGlkIGluIG1lLl91c2VyU291cmNlcykge1xuICAgICAgICAgIHNzZS5yZW1vdmVTb3VyY2UobWUuX3VzZXJTb3VyY2VzW2lkXSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAobWUuX3Jlc3VsdHNTb3VyY2UpIHtcbiAgICAgICAgICBzc2UucmVtb3ZlU291cmNlKG1lLl9yZXN1bHRzU291cmNlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIG1lLl9yZXN1bHRzU291cmNlID0gbnVsbDtcbiAgICAgICAgbWUuX3VzZXJTb3VyY2VzID0ge307XG5cbiAgICAgICAgbWUuX3VubGlzdGVuKCk7XG4gICAgICAgIG1lLl91bndhdGNoKCk7XG4gICAgICB9O1xuXG4gICAgICB0aGlzLl91bmxpc3RlbiA9IHRoaXMuJHNjb3BlLiRvbignJGRlc3Ryb3knLCBfb25EZXN0cm95KTtcbiAgICB9O1xuXG5cbiAgYW5ndWxhci5tb2R1bGUobW9kdWxlKS5jb250cm9sbGVyKCdXb3Jrc2hvcENvbnRyb2xsZXInLCBXb3Jrc2hvcCk7XG5cbn0pKEFOR1VMQVJfTU9EVUxFLCBhbmd1bGFyKTtcbiJdfQ==
