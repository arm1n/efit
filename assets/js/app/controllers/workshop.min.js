/*!
 * eFit Website
 * An app for financial training in educational environments
 * http://www.e-fit.com
 * @author Armin Pfurtscheller
 * @version 1.0.0
 * Copyright 2017. MIT licensed.
 */
!function(e,t){"use strict";var s=function(e,t,s){this.workshops=s,this.$injector=t,this.$scope=e,this._resultsSource=null,this._userSources={},this._workshops={},this._tasks={},this._initWorkshops(),this._initListener()};s.$inject=["$scope","$injector","workshops"],s.prototype.name=null,s.prototype.code=null,s.prototype.nameMinLength=8,s.prototype.codeMinLength=8,s.prototype.codePattern=/^[A-Za-z0-9]+$/,s.prototype.deleteWorkshop=null,s.prototype.chartResults=null,s.prototype.chartTask=null,s.prototype.uiOnParamsChanged=function(e){var t=this._workshops[e.expand];return t?(t.$$expanded=!0,void(this._expanded=t)):this._expanded?(this._expanded.$$expanded=!1,void(this._expanded=null)):void 0},s.prototype.create=function(){var e=this.$injector.get("notification"),t=this.$injector.get("Workshop"),s=this.$injector.get("i18n"),o=new t({name:this.name,code:this.code}),i=this,n=function(t){var o=s.get("Workshop has been created successfully!");e.success(o),i.workshops.unshift(t),i._initWorkshop(t),i.name=null,i.code=null},r=function(){};o.$create().then(n,r)},s.prototype["delete"]=function(e){var t=this.$injector.get("notification"),s=this.$injector.get("i18n"),o=this,i=function(){var i=s.get("Workshop has been deleted successfully!");t.success(i);var n=o.workshops.indexOf(e);o.workshops.splice(n,1),o._removeUsersStream(e)},n=function(){};e.$delete().then(i,n)},s.prototype.markWorkshopForDeletion=function(e){this.deleteWorkshop=e},s.prototype.toggleWorkshop=function(e){var t=this.$injector.get("notification"),s=this.$injector.get("i18n"),o=this,i=function(e){var i=s.get(e.isActive?"Workshop has been unlocked successfully. Students can register now!":"Workshop has been locked successfully. Students can now only use their access from home!");t.success(i),o._initWorkshop(e)},n=function(){e.isActive=!e.isActive};e.isActive=!e.isActive,e.$update().then(i,n)},s.prototype.markTaskForChart=function(e){var t=this.$injector.get("Result"),s=this,o=function(t){s.chartResults=t,s.chartTask=e},i=function(){console.log(arguments)},n=t.getByTask({taskId:e.id});n.$promise.then(o,i)},s.prototype.toggleTask=function(e){var t=this.$injector.get("notification"),s=this.$injector.get("i18n"),o=this.$injector.get("Task"),i=function(){var o=s.get(e.isActive?"Task has been unlocked successfully. Students can send results now!":"Task has been locked successfully. Students cannot send results currently!");t.success(o)},n=function(){e.isActive=!e.isActive};e.isActive=!e.isActive;var r=o.update({id:e.id},e);r.$promise.then(i,n)},s.prototype.expand=function(e){var t=this.$injector.get("$state"),s=e.$$expanded?null:e.id;t.go("backend.workshops",{expand:s})},s.prototype._addUsersStream=function(e){var t=this.$injector.get("API_URL"),s=this.$injector.get("sse"),o=this,i=function(t){o.$scope.$evalAsync(function(){e.$$users=t})},n=t+"/sse/workshop/"+e.id+"/users",r={onMessage:i,sleep:10},c=s.addSource(n,r);this._userSources[e.id]=c},s.prototype._removeUsersStream=function(e){var t=this.$injector.get("sse"),s=this._userSources[e.id];s&&(delete this._userSources[e.id],t.removeSource(s))},s.prototype._streamResults=function(){var e=this.$injector.get("API_URL"),s=this.$injector.get("sse"),o=this,i=function(e,i){o.$scope.$evalAsync(function(){e.isActive||s.removeSource(o._resultsSource),t.forEach(i,function(e){var t=o._tasks[e.id];t.$$results=e.results})})},n=function(){return o._expanded&&o._expanded.isActive},r=function(){if(o._resultsSource&&s.removeSource(o._resultsSource),o._expanded){var t=e+"/sse/workshop/"+o._expanded.id+"/results",n=i.bind(o,o._expanded),r={onMessage:n,sleep:5};o._resultsSource=s.addSource(t,r)}};this._unwatch=this.$scope.$watch(n,r)},s.prototype._initWorkshops=function(){var e=this.$injector.get("$uiRouterGlobals");t.forEach(this.workshops,this._initWorkshop.bind(this)),this.uiOnParamsChanged(e.params),this._streamResults()},s.prototype._initWorkshop=function(e){var s=this;t.forEach(e.tasks,function(e){var t=s._tasks[e.id]||null;e.$$results=null!==t?t.$$results:0,s._tasks[e.id]=e});var o=this._expanded&&this._expanded.id;e.$$expanded=e.id===o,e.$$users=e.users.length,e.isActive?this._addUsersStream(e):this._removeUsersStream(e),this._workshops[e.id]=e},s.prototype._initListener=function(){var e=this.$injector.get("sse"),t=this,s=function(){for(var s in t._userSources)e.removeSource(t._userSources[s]);t._resultsSource&&e.removeSource(t._resultsSource),t._resultsSource=null,t._userSources={},t._unlisten(),t._unwatch()};this._unlisten=this.$scope.$on("$destroy",s)},t.module(e).controller("WorkshopController",s)}(ANGULAR_MODULE,angular);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC9jb250cm9sbGVycy93b3Jrc2hvcC5qcyJdLCJuYW1lcyI6WyJtb2R1bGUiLCJhbmd1bGFyIiwiV29ya3Nob3AiLCIkc2NvcGUiLCIkaW5qZWN0b3IiLCJ3b3Jrc2hvcHMiLCJ0aGlzIiwiX3Jlc3VsdHNTb3VyY2UiLCJfdXNlclNvdXJjZXMiLCJfd29ya3Nob3BzIiwiX3Rhc2tzIiwiX2luaXRXb3Jrc2hvcHMiLCJfaW5pdExpc3RlbmVyIiwiJGluamVjdCIsInByb3RvdHlwZSIsIm5hbWUiLCJjb2RlIiwibmFtZU1pbkxlbmd0aCIsImNvZGVNaW5MZW5ndGgiLCJjb2RlUGF0dGVybiIsImRlbGV0ZVdvcmtzaG9wIiwiY2hhcnRSZXN1bHRzIiwiY2hhcnRUYXNrIiwidWlPblBhcmFtc0NoYW5nZWQiLCJwYXJhbXMiLCJ3b3Jrc2hvcCIsImV4cGFuZCIsIiQkZXhwYW5kZWQiLCJfZXhwYW5kZWQiLCJjcmVhdGUiLCJub3RpZmljYXRpb24iLCJnZXQiLCJpMThuIiwibWUiLCJzdWNjZXNzQ2FsbGJhY2siLCJtZXNzYWdlIiwic3VjY2VzcyIsInVuc2hpZnQiLCJfaW5pdFdvcmtzaG9wIiwiZmFpbHVyZUNhbGxiYWNrIiwiJGNyZWF0ZSIsInRoZW4iLCJpbmRleCIsImluZGV4T2YiLCJzcGxpY2UiLCJfcmVtb3ZlVXNlcnNTdHJlYW0iLCIkZGVsZXRlIiwibWFya1dvcmtzaG9wRm9yRGVsZXRpb24iLCJ0b2dnbGVXb3Jrc2hvcCIsImlzQWN0aXZlIiwiJHVwZGF0ZSIsIm1hcmtUYXNrRm9yQ2hhcnQiLCJ0YXNrIiwiUmVzdWx0IiwicmVzdWx0cyIsImNvbnNvbGUiLCJsb2ciLCJhcmd1bWVudHMiLCJyZXNvdXJjZSIsImdldEJ5VGFzayIsInRhc2tJZCIsImlkIiwiJHByb21pc2UiLCJ0b2dnbGVUYXNrIiwiVGFzayIsInVwZGF0ZSIsIiRzdGF0ZSIsImdvIiwiX2FkZFVzZXJzU3RyZWFtIiwiQVBJX1VSTCIsInNzZSIsIl9vbk1lc3NhZ2UiLCJkYXRhIiwiJGV2YWxBc3luYyIsIiQkdXNlcnMiLCJ1cmwiLCJvcHRpb25zIiwib25NZXNzYWdlIiwic2xlZXAiLCJzb3VyY2UiLCJhZGRTb3VyY2UiLCJyZW1vdmVTb3VyY2UiLCJfc3RyZWFtUmVzdWx0cyIsImZvckVhY2giLCJpdGVtIiwiJCRyZXN1bHRzIiwiX3dhdGNoRXhwcmVzc2lvbiIsIl93YXRjaENhbGxiYWNrIiwiYmluZCIsIl91bndhdGNoIiwiJHdhdGNoIiwiJHVpUm91dGVyR2xvYmFscyIsInRhc2tzIiwib2xkIiwidXNlcnMiLCJsZW5ndGgiLCJfb25EZXN0cm95IiwiX3VubGlzdGVuIiwiJG9uIiwiY29udHJvbGxlciIsIkFOR1VMQVJfTU9EVUxFIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztDQVNBLFNBQVVBLEVBQVFDLEdBQ2hCLFlBS0EsSUFBSUMsR0FBVyxTQUFTQyxFQUFRQyxFQUFXQyxHQUN6Q0MsS0FBS0QsVUFBWUEsRUFDakJDLEtBQUtGLFVBQVlBLEVBQ2pCRSxLQUFLSCxPQUFTQSxFQUVkRyxLQUFLQyxlQUFpQixLQUN0QkQsS0FBS0UsZ0JBQ0xGLEtBQUtHLGNBQ0xILEtBQUtJLFVBRUxKLEtBQUtLLGlCQUNMTCxLQUFLTSxnQkFHUFYsR0FBU1csU0FBVyxTQUFVLFlBQWEsYUFPM0NYLEVBQVNZLFVBQVVDLEtBQU8sS0FHMUJiLEVBQVNZLFVBQVVFLEtBQU8sS0FHMUJkLEVBQVNZLFVBQVVHLGNBQWdCLEVBR25DZixFQUFTWSxVQUFVSSxjQUFnQixFQUduQ2hCLEVBQVNZLFVBQVVLLFlBQWMsaUJBR2pDakIsRUFBU1ksVUFBVU0sZUFBaUIsS0FHcENsQixFQUFTWSxVQUFVTyxhQUFlLEtBR2xDbkIsRUFBU1ksVUFBVVEsVUFBWSxLQWUvQnBCLEVBQVNZLFVBQVVTLGtCQUFvQixTQUFTQyxHQUU1QyxHQUFJQyxHQUFXbkIsS0FBS0csV0FBV2UsRUFBT0UsT0FFdEMsT0FBSUQsSUFDRkEsRUFBU0UsWUFBYSxPQUN0QnJCLEtBQUtzQixVQUFZSCxJQUlmbkIsS0FBS3NCLFdBQ1B0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SUFBTXBDLEdBV25DdkIsRUFBU1ksVUFBVUYsY0FBZ0IsV0FFL0IsR0FBSTBELEdBQU1oRSxLQUFLRixVQUFVMkIsSUFBSSxPQUV6QkUsRUFBSzNCLEtBRUwwRixFQUFhLFdBQ2YsSUFBSyxHQUFJbkMsS0FBTTVCLEdBQUd6QixhQUNoQjhELEVBQUlXLGFBQWFoRCxFQUFHekIsYUFBYXFELEdBRy9CNUIsR0FBRzFCLGdCQUNMK0QsRUFBSVcsYUFBYWhELEVBQUcxQixnQkFHdEIwQixFQUFHMUIsZUFBaUIsS0FDcEIwQixFQUFHekIsZ0JBRUh5QixFQUFHZ0UsWUFDSGhFLEVBQUd3RCxXQUdMbkYsTUFBSzJGLFVBQVkzRixLQUFLSCxPQUFPK0YsSUFBSSxXQUFZRixJQUlqRC9GLEVBQVFELE9BQU9BLEdBQVFtRyxXQUFXLHFCQUFzQmpHLElBRXZEa0csZUFBZ0JuRyIsImZpbGUiOiJhcHAvY29udHJvbGxlcnMvd29ya3Nob3AubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyogZ2xvYmFsIEFOR1VMQVJfTU9EVUxFLCBhbmd1bGFyICovXG4oZnVuY3Rpb24obW9kdWxlLCBhbmd1bGFyKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuIC8qKlxuICAqIEBjb25zdHJ1Y3RvclxuICAqL1xuICB2YXIgV29ya3Nob3AgPSBmdW5jdGlvbigkc2NvcGUsICRpbmplY3Rvciwgd29ya3Nob3BzKSB7XG4gICAgdGhpcy53b3Jrc2hvcHMgPSB3b3Jrc2hvcHM7XG4gICAgdGhpcy4kaW5qZWN0b3IgPSAkaW5qZWN0b3I7XG4gICAgdGhpcy4kc2NvcGUgPSAkc2NvcGU7XG5cbiAgICB0aGlzLl9yZXN1bHRzU291cmNlID0gbnVsbDtcbiAgICB0aGlzLl91c2VyU291cmNlcyA9IHt9O1xuICAgIHRoaXMuX3dvcmtzaG9wcyA9IHt9O1xuICAgIHRoaXMuX3Rhc2tzID0ge307XG5cbiAgICB0aGlzLl9pbml0V29ya3Nob3BzKCk7XG4gICAgdGhpcy5faW5pdExpc3RlbmVyKCk7XG4gIH07XG5cbiAgV29ya3Nob3AuJGluamVjdCA9IFsnJHNjb3BlJywgJyRpbmplY3RvcicsICd3b3Jrc2hvcHMnXTtcblxuICAvL1xuICAvLyBQUk9QRVJUSUVTXG4gIC8vXG5cbiAgLyoqIEB2YXIge3N0cmluZ30gbmFtZSBOYW1lIG9mIG5ldyB3b3Jrc2hvcC4gKi9cbiAgV29ya3Nob3AucHJvdG90eXBlLm5hbWUgPSBudWxsO1xuXG4gIC8qKiBAdmFyIHtzdHJpbmd9IGNvZGUgQ29kZSBvZiBuZXcgd29ya3Nob3AuICovXG4gIFdvcmtzaG9wLnByb3RvdHlwZS5jb2RlID0gbnVsbDtcblxuICAvKiogQHZhciB7UmVnRXhwfSBuYW1lTWluTGVuZ3RoIE1pbmltdW0gbGVuZ3RoIG9mIHdvcmtzaG9wIG5hbWUuICovXG4gIFdvcmtzaG9wLnByb3RvdHlwZS5uYW1lTWluTGVuZ3RoID0gODtcblxuICAvKiogQHZhciB7UmVnRXhwfSBjb2RlTWluTGVuZ3RoIE1pbmltdW0gbGVuZ3RoIG9mIHdvcmtzaG9wIGNvZGUuICovXG4gIFdvcmtzaG9wLnByb3RvdHlwZS5jb2RlTWluTGVuZ3RoID0gODtcblxuICAvKiogQHZhciB7UmVnRXhwfSB1c2VycGF0dGVybiBSZWd1bGFyIGV4cHJlc3Npb24gZm9yIGB1c2VybmFtZWAgcHJvcGVydHkuICovXG4gIFdvcmtzaG9wLnByb3RvdHlwZS5jb2RlUGF0dGVybiA9IC9eW0EtWmEtejAtOV0rJC87XG5cbiAgLyoqIEB2YXIge29iamVjdH0gZGVsZXRlV29ya3Nob3AgQ3VycmVudGx5IG1hcmtlZCB3b3Jrc2hvcCBmb3IgZGVsZXRpb24uICovXG4gIFdvcmtzaG9wLnByb3RvdHlwZS5kZWxldGVXb3Jrc2hvcCA9IG51bGw7XG5cbiAgLyoqIEB2YXIge2FycmF5fSBjaGFydFJlc3VsdHMgQ3VycmVudGx5IGxvYWRlZCByZXN1bHRzIGZvciBjaGFydC4gKi9cbiAgV29ya3Nob3AucHJvdG90eXBlLmNoYXJ0UmVzdWx0cyA9IG51bGw7XG5cbiAgLyoqIEB2YXIge29iamVjdH0gY2hhcnRUYXNrIEN1cnJlbnRseSBzZWxlY3RlZCB0YXNrIG9mIHJlc3VsdHMuICovXG4gIFdvcmtzaG9wLnByb3RvdHlwZS5jaGFydFRhc2sgPSBudWxsO1xuXG4gIC8vXG4gIC8vIE1FVEhPRFNcbiAgLy9cblxuICAvKipcbiAgICogVG9nZ2xlcyBgJCRleHBhbmRlZGAgZmxhZyBvbiB3b3Jrc2hvcCBkZXBlbmRpbmcgb24gcXVlcnkgcGFyYW1zLlxuICAgKiBodHRwczovL3VpLXJvdXRlci5naXRodWIuaW8vbmcxL2RvY3MvbGF0ZXN0L2ludGVyZmFjZXMvbmcxLm5nMWNvbnRyb2xsZXIuaHRtbCN1aW9ucGFyYW1zY2hhbmdlZFxuICAgKlxuICAgKiBAcHVibGljXG4gICAqIEBtZXRob2QgdWlPblBhcmFtc0NoYW5nZWRcbiAgICogQHBhcmFtIHtvYmplY3R9IHBhcmFtc1xuICAgKiBAcmV0dXJuIHt2b2lkfVxuICAgKi9cbiAgV29ya3Nob3AucHJvdG90eXBlLnVpT25QYXJhbXNDaGFuZ2VkID0gZnVuY3Rpb24ocGFyYW1zKVxuICAgIHtcbiAgICAgIHZhciB3b3Jrc2hvcCA9IHRoaXMuX3dvcmtzaG9wc1twYXJhbXMuZXhwYW5kXTtcblxuICAgICAgaWYgKHdvcmtzaG9wKSB7XG4gICAgICAgIHdvcmtzaG9wLiQkZXhwYW5kZWQgPSB0cnVlO1xuICAgICAgICB0aGlzLl9leHBhbmRlZCA9IHdvcmtzaG9wO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLl9leHBhbmRlZCkge1xuICAgICAgICB0aGlzLl9leHBhbmRlZC4kJGV4cGFuZGVkID0gZmFsc2U7XG4gICAgICAgIHRoaXMuX2V4cGFuZGVkID0gbnVsbDtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgIH07XG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgYSBuZXcgd29ya3Nob3AuXG4gICAqXG4gICAqIEBwdWJsaWNcbiAgICogQG1ldGhvZCBjcmVhdGVcbiAgICogQHJldHVybiB7dm9pZH1cbiAgICovXG4gIFdvcmtzaG9wLnByb3RvdHlwZS5jcmVhdGUgPSBmdW5jdGlvbigpXG4gICAge1xuICAgICAgdmFyIG5vdGlmaWNhdGlvbiA9IHRoaXMuJGluamVjdG9yLmdldCgnbm90aWZpY2F0aW9uJyk7XG4gICAgICB2YXIgV29ya3Nob3AgPSB0aGlzLiRpbmplY3Rvci5nZXQoJ1dvcmtzaG9wJyk7XG4gICAgICB2YXIgaTE4biA9IHRoaXMuJGluamVjdG9yLmdldCgnaTE4bicpO1xuXG4gICAgICB2YXIgd29ya3Nob3AgPSBuZXcgV29ya3Nob3Aoe1xuICAgICAgICBuYW1lOiB0aGlzLm5hbWUsXG4gICAgICAgIGNvZGU6IHRoaXMuY29kZVxuICAgICAgfSk7XG5cbiAgICAgIHZhciBtZSA9IHRoaXM7XG5cbiAgICAgIHZhciBzdWNjZXNzQ2FsbGJhY2sgPSBmdW5jdGlvbih3b3Jrc2hvcClcbiAgICAgICAge1xuICAgICAgICAgIHZhciBtZXNzYWdlID0gaTE4bi5nZXQoJ1dvcmtzaG9wIGhhcyBiZWVuIGNyZWF0ZWQgc3VjY2Vzc2Z1bGx5IScpO1xuICAgICAgICAgIG5vdGlmaWNhdGlvbi5zdWNjZXNzKG1lc3NhZ2UpO1xuXG4gICAgICAgICAgbWUud29ya3Nob3BzLnVuc2hpZnQod29ya3Nob3ApO1xuICAgICAgICAgIG1lLl9pbml0V29ya3Nob3Aod29ya3Nob3ApO1xuXG4gICAgICAgICAgbWUubmFtZSA9IG51bGw7XG4gICAgICAgICAgbWUuY29kZSA9IG51bGw7XG4gICAgICAgIH07XG5cbiAgICAgIHZhciBmYWlsdXJlQ2FsbGJhY2sgPSBmdW5jdGlvbigpXG4gICAgICAgIHtcbiAgICAgICAgICAvLyBub29wXG4gICAgICAgIH07XG5cbiAgICAgIHdvcmtzaG9wLiRjcmVhdGUoKS50aGVuKFxuICAgICAgICBzdWNjZXNzQ2FsbGJhY2ssXG4gICAgICAgIGZhaWx1cmVDYWxsYmFja1xuICAgICAgKTtcbiAgICB9O1xuXG4gIC8qKlxuICAgKiBEZWxldGVzIGEgd29ya3Nob3AgYWZ0ZXIgY29uZmlybWF0aW9uLlxuICAgKlxuICAgKiBAcHVibGljXG4gICAqIEBtZXRob2QgZGVsZXRlXG4gICAqIEBwYXJhbSB7b2JqZWN0fSB3b3Jrc2hvcFxuICAgKiBAcmV0dXJuIHt2b2lkfVxuICAgKi9cbiAgV29ya3Nob3AucHJvdG90eXBlLmRlbGV0ZSA9IGZ1bmN0aW9uKHdvcmtzaG9wKVxuICAgIHtcbiAgICAgIHZhciBub3RpZmljYXRpb24gPSB0aGlzLiRpbmplY3Rvci5nZXQoJ25vdGlmaWNhdGlvbicpO1xuICAgICAgdmFyIGkxOG4gPSB0aGlzLiRpbmplY3Rvci5nZXQoJ2kxOG4nKTtcblxuICAgICAgdmFyIG1lID0gdGhpcztcblxuICAgICAgdmFyIHN1Y2Nlc3NDYWxsYmFjayA9IGZ1bmN0aW9uKClcbiAgICAgICAge1xuICAgICAgICAgIHZhciBtZXNzYWdlID0gaTE4bi5nZXQoJ1dvcmtzaG9wIGhhcyBiZWVuIGRlbGV0ZWQgc3VjY2Vzc2Z1bGx5IScpO1xuICAgICAgICAgIG5vdGlmaWNhdGlvbi5zdWNjZXNzKG1lc3NhZ2UpO1xuXG4gICAgICAgICAgdmFyIGluZGV4ID0gbWUud29ya3Nob3BzLmluZGV4T2Yod29ya3Nob3ApO1xuICAgICAgICAgIG1lLndvcmtzaG9wcy5zcGxpY2UoaW5kZXgsIDEpO1xuXG4gICAgICAgICAgbWUuX3JlbW92ZVVzZXJzU3RyZWFtKHdvcmtzaG9wKTtcbiAgICAgICAgfTtcblxuICAgICAgdmFyIGZhaWx1cmVDYWxsYmFjayA9IGZ1bmN0aW9uKClcbiAgICAgICAge1xuICAgICAgICAgIC8vIG5vb3BcbiAgICAgICAgfTtcblxuICAgICAgd29ya3Nob3AuJGRlbGV0ZSgpLnRoZW4oXG4gICAgICAgIHN1Y2Nlc3NDYWxsYmFjayxcbiAgICAgICAgZmFpbHVyZUNhbGxiYWNrXG4gICAgICApO1xuICAgIH07XG5cbiAgLyoqXG4gICAqIEludm9rZXMgY29uZmlybWF0aW9uIG1vZGFsIGZvciBkZWxldGluZyBhIHdvcmtzaG9wLlxuICAgKlxuICAgKiBAcHVibGljXG4gICAqIEBtZXRob2QgbWFya1dvcmtzaG9wRm9yRGVsZXRpb25cbiAgICogQHBhcmFtIHtvYmplY3R9IHdvcmtzaG9wXG4gICAqIEByZXR1cm4ge3ZvaWR9XG4gICAqL1xuICBXb3Jrc2hvcC5wcm90b3R5cGUubWFya1dvcmtzaG9wRm9yRGVsZXRpb24gPSBmdW5jdGlvbih3b3Jrc2hvcClcbiAgICB7XG4gICAgICB0aGlzLmRlbGV0ZVdvcmtzaG9wID0gd29ya3Nob3A7XG4gICAgfTtcblxuICAvKipcbiAgICogVG9nZ2xlcyBgaXNBY3RpdmVgIG9mIGEgd29ya3Nob3AuXG4gICAqXG4gICAqIEBwdWJsaWNcbiAgICogQG1ldGhvZCB0b2dnbGVBY3RpdmVcbiAgICogQHBhcmFtIHtvYmplY3R9IHdvcmtzaG9wXG4gICAqIEByZXR1cm4ge3ZvaWR9XG4gICAqL1xuICBXb3Jrc2hvcC5wcm90b3R5cGUudG9nZ2xlV29ya3Nob3AgPSBmdW5jdGlvbih3b3Jrc2hvcClcbiAgICB7XG4gICAgICB2YXIgbm90aWZpY2F0aW9uID0gdGhpcy4kaW5qZWN0b3IuZ2V0KCdub3RpZmljYXRpb24nKTtcbiAgICAgIHZhciBpMThuID0gdGhpcy4kaW5qZWN0b3IuZ2V0KCdpMThuJyk7XG5cbiAgICAgIHZhciBtZSA9IHRoaXM7XG5cbiAgICAgIHZhciBzdWNjZXNzQ2FsbGJhY2sgPSBmdW5jdGlvbih3b3Jrc2hvcClcbiAgICAgICAge1xuICAgICAgICAgIHZhciBtZXNzYWdlID0gaTE4bi5nZXQoXG4gICAgICAgICAgICB3b3Jrc2hvcC5pc0FjdGl2ZSA/XG4gICAgICAgICAgICAgICdXb3Jrc2hvcCBoYXMgYmVlbiB1bmxvY2tlZCBzdWNjZXNzZnVsbHkuIFN0dWRlbnRzIGNhbiByZWdpc3RlciBub3chJyA6XG4gICAgICAgICAgICAgICdXb3Jrc2hvcCBoYXMgYmVlbiBsb2NrZWQgc3VjY2Vzc2Z1bGx5LiBTdHVkZW50cyBjYW4gbm93IG9ubHkgdXNlIHRoZWlyIGFjY2VzcyBmcm9tIGhvbWUhJ1xuICAgICAgICAgICk7XG4gICAgICAgICAgbm90aWZpY2F0aW9uLnN1Y2Nlc3MobWVzc2FnZSk7XG5cbiAgICAgICAgICBtZS5faW5pdFdvcmtzaG9wKHdvcmtzaG9wKTtcbiAgICAgICAgfTtcblxuICAgICAgdmFyIGZhaWx1cmVDYWxsYmFjayA9IGZ1bmN0aW9uKClcbiAgICAgICAge1xuICAgICAgICAgIC8vIHJldmVydCB0aGUgY2hhbmdlIG9uIGZhaWxlZCB1cGRhdGUhXG4gICAgICAgICAgd29ya3Nob3AuaXNBY3RpdmUgPSAhd29ya3Nob3AuaXNBY3RpdmU7XG4gICAgICAgIH07XG5cbiAgICAgIHdvcmtzaG9wLmlzQWN0aXZlID0gIXdvcmtzaG9wLmlzQWN0aXZlO1xuXG4gICAgICB3b3Jrc2hvcC4kdXBkYXRlKCkudGhlbihcbiAgICAgICAgc3VjY2Vzc0NhbGxiYWNrLFxuICAgICAgICBmYWlsdXJlQ2FsbGJhY2tcbiAgICAgICk7XG4gICAgfTtcblxuICAvKipcbiAgICogTG9hZHMgdGFzaydzIHJlc3VsdHMgYW5kIGludm9rZXMgbW9kYWwgZGlhbG9nLlxuICAgKlxuICAgKiBAcHVibGljXG4gICAqIEBtZXRob2QgbWFya1Rhc2tGb3JDaGFydFxuICAgKiBAcGFyYW0ge29iamVjdH0gdGFza1xuICAgKiBAcmV0dXJuIHt2b2lkfVxuICAgKi9cbiAgV29ya3Nob3AucHJvdG90eXBlLm1hcmtUYXNrRm9yQ2hhcnQgPSBmdW5jdGlvbih0YXNrKVxuICAgIHtcbiAgICAgIHZhciBSZXN1bHQgPSB0aGlzLiRpbmplY3Rvci5nZXQoJ1Jlc3VsdCcpO1xuXG4gICAgICB2YXIgbWUgPSB0aGlzO1xuICAgICAgdmFyIHN1Y2Nlc3NDYWxsYmFjayA9IGZ1bmN0aW9uKHJlc3VsdHMpXG4gICAgICAgIHtcbiAgICAgICAgICBtZS5jaGFydFJlc3VsdHMgPSByZXN1bHRzO1xuICAgICAgICAgIG1lLmNoYXJ0VGFzayA9IHRhc2s7XG4gICAgICAgIH07XG5cbiAgICAgIHZhciBmYWlsdXJlQ2FsbGJhY2sgPSBmdW5jdGlvbigpXG4gICAgICAgIHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhhcmd1bWVudHMpO1xuICAgICAgICB9O1xuXG4gICAgICB2YXIgcmVzb3VyY2UgPSBSZXN1bHQuZ2V0QnlUYXNrKHsgdGFza0lkOiB0YXNrLmlkIH0pO1xuICAgICAgcmVzb3VyY2UuJHByb21pc2UudGhlbihcbiAgICAgICAgc3VjY2Vzc0NhbGxiYWNrLFxuICAgICAgICBmYWlsdXJlQ2FsbGJhY2tcbiAgICAgICk7XG4gICAgfTtcblxuICAvKipcbiAgICogVG9nZ2xlcyBgaXNBY3RpdmVgIG9mIGEgdGFzay5cbiAgICpcbiAgICogQHB1YmxpY1xuICAgKiBAbWV0aG9kIHRvZ2dsZVRhc2tcbiAgICogQHBhcmFtIHtvYmplY3R9IHRhc2tcbiAgICogQHJldHVybiB7dm9pZH1cbiAgICovXG4gIFdvcmtzaG9wLnByb3RvdHlwZS50b2dnbGVUYXNrID0gZnVuY3Rpb24odGFzaylcbiAgICB7XG4gICAgICB2YXIgbm90aWZpY2F0aW9uID0gdGhpcy4kaW5qZWN0b3IuZ2V0KCdub3RpZmljYXRpb24nKTtcbiAgICAgIHZhciBpMThuID0gdGhpcy4kaW5qZWN0b3IuZ2V0KCdpMThuJyk7XG4gICAgICB2YXIgVGFzayA9IHRoaXMuJGluamVjdG9yLmdldCgnVGFzaycpO1xuXG4gICAgICB2YXIgc3VjY2Vzc0NhbGxiYWNrID0gZnVuY3Rpb24oLyp3b3Jrc2hvcCovKVxuICAgICAgICB7XG4gICAgICAgICAgdmFyIG1lc3NhZ2UgPSBpMThuLmdldChcbiAgICAgICAgICAgIHRhc2suaXNBY3RpdmUgP1xuICAgICAgICAgICAgICAnVGFzayBoYXMgYmVlbiB1bmxvY2tlZCBzdWNjZXNzZnVsbHkuIFN0dWRlbnRzIGNhbiBzZW5kIHJlc3VsdHMgbm93IScgOlxuICAgICAgICAgICAgICAnVGFzayBoYXMgYmVlbiBsb2NrZWQgc3VjY2Vzc2Z1bGx5LiBTdHVkZW50cyBjYW5ub3Qgc2VuZCByZXN1bHRzIGN1cnJlbnRseSEnXG4gICAgICAgICAgKTtcbiAgICAgICAgICBub3RpZmljYXRpb24uc3VjY2VzcyhtZXNzYWdlKTtcbiAgICAgICAgfTtcblxuICAgICAgdmFyIGZhaWx1cmVDYWxsYmFjayA9IGZ1bmN0aW9uKClcbiAgICAgICAge1xuICAgICAgICAgIC8vIHJldmVydCB0aGUgY2hhbmdlIG9uIGZhaWxlZCB1cGRhdGUhXG4gICAgICAgICAgdGFzay5pc0FjdGl2ZSA9ICF0YXNrLmlzQWN0aXZlO1xuICAgICAgICB9O1xuXG4gICAgICB0YXNrLmlzQWN0aXZlID0gIXRhc2suaXNBY3RpdmU7XG5cbiAgICAgIHZhciByZXNvdXJjZSA9IFRhc2sudXBkYXRlKHvCoGlkOiB0YXNrLmlkfSwgdGFzayk7XG4gICAgICByZXNvdXJjZS4kcHJvbWlzZS50aGVuKFxuICAgICAgICBzdWNjZXNzQ2FsbGJhY2ssXG4gICAgICAgIGZhaWx1cmVDYWxsYmFja1xuICAgICAgKTtcbiAgICB9O1xuXG4gIC8qKlxuICAgKiBTZXRzIGBleHBhbmRgIHF1ZXJ5IHBhcmFtZXRlciBkZXBlbmRlbmRpbmcgb25cbiAgICogd29ya3Nob3AncyBjdXJyZW50IGAkJGV4cGFuZGVkYCBmbGFnIGluZm8uXG4gICAqXG4gICAqIEBwdWJsaWNcbiAgICogQG1ldGhvZCBleHBhbmRcbiAgICogQHBhcmFtIHtvYmplY3R9IHdvcmtzaG9wXG4gICAqIEByZXR1cm4ge3ZvaWR9XG4gICAqL1xuICBXb3Jrc2hvcC5wcm90b3R5cGUuZXhwYW5kID0gZnVuY3Rpb24od29ya3Nob3ApXG4gICAge1xuICAgICAgdmFyICRzdGF0ZSA9IHRoaXMuJGluamVjdG9yLmdldCgnJHN0YXRlJyk7XG4gICAgICB2YXIgZXhwYW5kID0gIXdvcmtzaG9wLiQkZXhwYW5kZWQgP1xuICAgICAgICB3b3Jrc2hvcC5pZCA6wqBcbiAgICAgICAgbnVsbDtcblxuICAgICAgJHN0YXRlLmdvKCdiYWNrZW5kLndvcmtzaG9wcycsIHtcbiAgICAgICAgZXhwYW5kOiBleHBhbmRcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgLyoqXG4gICAqIFNldHMgdXAgYW4gZXZlbnQgc291cmNlIGZvciBzdHJlYW1pbmcgdXNlciBjb3VudC5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICogQG1ldGhvZCBfYWRkVXNlcnNTdHJlYW1cbiAgICogQHBhcmFtIHtvYmplY3R9IHdvcmtzaG9wXG4gICAqIEByZXR1cm4ge3ZvaWR9XG4gICAqL1xuICBXb3Jrc2hvcC5wcm90b3R5cGUuX2FkZFVzZXJzU3RyZWFtID0gZnVuY3Rpb24od29ya3Nob3ApXG4gICAge1xuICAgICAgdmFyIEFQSV9VUkwgPSB0aGlzLiRpbmplY3Rvci5nZXQoJ0FQSV9VUkwnKTtcbiAgICAgIHZhciBzc2UgPSB0aGlzLiRpbmplY3Rvci5nZXQoJ3NzZScpO1xuXG4gICAgICB2YXIgbWUgPSB0aGlzO1xuXG4gICAgICB2YXIgX29uTWVzc2FnZSA9IGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgbWUuJHNjb3BlLiRldmFsQXN5bmMoZnVuY3Rpb24oKXtcbiAgICAgICAgICB3b3Jrc2hvcC4kJHVzZXJzID0gZGF0YTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuXG4gICAgICB2YXIgdXJsID0gQVBJX1VSTCArICcvc3NlL3dvcmtzaG9wLycgKyB3b3Jrc2hvcC5pZCArICcvdXNlcnMnO1xuICAgICAgdmFyIG9wdGlvbnMgPSB7IG9uTWVzc2FnZTogX29uTWVzc2FnZSwgc2xlZXA6IDEwIH07XG4gICAgICB2YXIgc291cmNlID0gc3NlLmFkZFNvdXJjZSh1cmwsIG9wdGlvbnMpO1xuICAgICAgdGhpcy5fdXNlclNvdXJjZXNbd29ya3Nob3AuaWRdID0gc291cmNlO1xuICAgIH07XG5cbiAgLyoqXG4gICAqIFJlbW92ZXMgYW4gZXZlbnQgc291cmNlIGZyb20gaW50ZXJuYWwgc3RhY2sgYW5kIHNlcnZpY2UuXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqIEBtZXRob2QgX3JlbW92ZVVzZXJzU3RyZWFtXG4gICAqIEBwYXJhbSB7b2JqZWN0fSB3b3Jrc2hvcFxuICAgKiBAcmV0dXJuIHt2b2lkfVxuICAgKi9cbiAgV29ya3Nob3AucHJvdG90eXBlLl9yZW1vdmVVc2Vyc1N0cmVhbSA9IGZ1bmN0aW9uKHdvcmtzaG9wKVxuICAgIHtcbiAgICAgIHZhciBzc2UgPSB0aGlzLiRpbmplY3Rvci5nZXQoJ3NzZScpO1xuXG4gICAgICB2YXIgc291cmNlID0gdGhpcy5fdXNlclNvdXJjZXNbd29ya3Nob3AuaWRdO1xuICAgICAgaWYgKCFzb3VyY2UpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBkZWxldGUgdGhpcy5fdXNlclNvdXJjZXNbd29ya3Nob3AuaWRdO1xuICAgICAgc3NlLnJlbW92ZVNvdXJjZShzb3VyY2UpO1xuICAgIH07XG5cbiAgLyoqXG4gICAqIFNldHMgdXAgZXZlbnQgc291cmNlcyBmb3IgdXBkYXRpbmcgcmVzdWx0IGNvdW50ZXJzLlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAbWV0aG9kIF9zdHJlYW1SZXN1bHRzXG4gICAqIEByZXR1cm4ge3ZvaWR9XG4gICAqL1xuICBXb3Jrc2hvcC5wcm90b3R5cGUuX3N0cmVhbVJlc3VsdHMgPSBmdW5jdGlvbigpXG4gICAge1xuICAgICAgdmFyIEFQSV9VUkwgPSB0aGlzLiRpbmplY3Rvci5nZXQoJ0FQSV9VUkwnKTtcbiAgICAgIHZhciBzc2UgPSB0aGlzLiRpbmplY3Rvci5nZXQoJ3NzZScpO1xuXG4gICAgICB2YXIgbWUgPSB0aGlzO1xuXG4gICAgICAvLyAtLS0gU1NFIC0tLVxuICAgICAgdmFyIF9vbk1lc3NhZ2UgPSBmdW5jdGlvbih3b3Jrc2hvcCwgZGF0YSkge1xuICAgICAgICBtZS4kc2NvcGUuJGV2YWxBc3luYyhmdW5jdGlvbigpe1xuICAgICAgICAgIC8vIHJlbW92ZSBldmVudCBzb3VyY2UgaWYgd29ya3Nob3AgaXMgbm90XG4gICAgICAgICAgLy8gYWN0aXZlIGF0IHRoZSBtb21lbnQgPT09IG9uZS1zaG90IG9ubHlcbiAgICAgICAgICBpZiAoIXdvcmtzaG9wLmlzQWN0aXZlKSB7XG4gICAgICAgICAgICBzc2UucmVtb3ZlU291cmNlKG1lLl9yZXN1bHRzU291cmNlKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBhbmd1bGFyLmZvckVhY2goZGF0YSwgZnVuY3Rpb24oaXRlbSl7XG4gICAgICAgICAgICB2YXIgdGFzayA9IG1lLl90YXNrc1tpdGVtLmlkXTtcbiAgICAgICAgICAgIHRhc2suJCRyZXN1bHRzID0gaXRlbS5yZXN1bHRzO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH07XG5cbiAgICAgIHZhciBfd2F0Y2hFeHByZXNzaW9uID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIC8vIHdvcmtzaG9wIG11c3QgYmUgb3BlbmVkLCBidXQgd2UgYWxzbyBuZWVkXG4gICAgICAgIC8vIHRvIHdhdGNoIGBpc0FjdGl2ZWAgc3RhdGUgdG8gY2F0Y2ggdG9nZ2xlXG4gICAgICAgIC8vIGZyb20gcHJvcGVydHkgdG8gcmVpbml0aWFsaXplIGV2ZW50IHNvdXJjZVxuICAgICAgICByZXR1cm4gbWUuX2V4cGFuZGVkICYmIG1lLl9leHBhbmRlZC5pc0FjdGl2ZTtcbiAgICAgIH07XG5cbiAgICAgIHZhciBfd2F0Y2hDYWxsYmFjayA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAobWUuX3Jlc3VsdHNTb3VyY2UpIHtcbiAgICAgICAgICBzc2UucmVtb3ZlU291cmNlKG1lLl9yZXN1bHRzU291cmNlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChtZS5fZXhwYW5kZWQpIHtcbiAgICAgICAgICB2YXIgdXJsID0gQVBJX1VSTCArICcvc3NlL3dvcmtzaG9wLycgKyBtZS5fZXhwYW5kZWQuaWQgKyAnL3Jlc3VsdHMnO1xuICAgICAgICAgIHZhciBvbk1lc3NhZ2UgPSBfb25NZXNzYWdlLmJpbmQobWUsIG1lLl9leHBhbmRlZCk7XG4gICAgICAgICAgdmFyIG9wdGlvbnMgPSB7IG9uTWVzc2FnZTogb25NZXNzYWdlLCBzbGVlcDrCoDUgfTtcbiAgICAgICAgICBtZS5fcmVzdWx0c1NvdXJjZSA9IHNzZS5hZGRTb3VyY2UodXJsLCBvcHRpb25zKTtcbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgdGhpcy5fdW53YXRjaCA9IHRoaXMuJHNjb3BlLiR3YXRjaChcbiAgICAgICAgX3dhdGNoRXhwcmVzc2lvbixcbiAgICAgICAgX3dhdGNoQ2FsbGJhY2tcbiAgICAgICk7XG4gICAgfTtcblxuICAvKipcbiAgICogTWFwcyBhbGwgd29ya3Nob3BzIHRvIGhhc2ggbWFwcywgc2V0cyB1cCBzdHJlYW1pbmcgYW5kIHF1ZXJ5IHBhcmFtcy5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICogQG1ldGhvZCBfaW5pdFdvcmtzaG9wc1xuICAgKiBAcmV0dXJuIHt2b2lkfVxuICAgKi9cbiAgV29ya3Nob3AucHJvdG90eXBlLl9pbml0V29ya3Nob3BzID0gZnVuY3Rpb24oKVxuICAgIHtcbiAgICAgIHZhciAkdWlSb3V0ZXJHbG9iYWxzID0gdGhpcy4kaW5qZWN0b3IuZ2V0KCckdWlSb3V0ZXJHbG9iYWxzJyk7XG5cbiAgICAgIC8vIGNyZWF0ZSBoYXNoIG1hcHMgZm9yIHdvcmtzaG9wcyBhbmQgdGFza3MgZm9yIGVhc2UgbG9va3Vwc1xuICAgICAgYW5ndWxhci5mb3JFYWNoKHRoaXMud29ya3Nob3BzLCB0aGlzLl9pbml0V29ya3Nob3AuYmluZCh0aGlzKSk7XG5cbiAgICAgIC8vIG5vdyBtYWtlIHRoZSBpbml0aWFsIGNhbGwgdG8gY2hhbmdlIGhhbmRsZXJcbiAgICAgIHRoaXMudWlPblBhcmFtc0NoYW5nZWQoJHVpUm91dGVyR2xvYmFscy5wYXJhbXMpO1xuXG4gICAgICAvLyBraWNrIG9mZiBnZW5lcmFsIHN0cmVhbWluZyBvZiB0YXNrIHJlc3VsdHNcbiAgICAgIHRoaXMuX3N0cmVhbVJlc3VsdHMoKTtcbiAgICB9O1xuXG4gIC8qKlxuICAgKiBBZGRzIHdvcmtzaG9wIGFuZCB0YXNrcyB0byBoYXNoIG1hcCBhbmQgaW5pdGlhbGl6ZXNcbiAgICogc3RyZWFtaW5nIGZvciB3b3Jrc2hvcCBkZXBlbmRpbmcgb24gYGlzQWN0aXZlYCBmbGFnLlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAbWV0aG9kIF9pbml0V29ya3Nob3BcbiAgICogQHBhcmFtIHtvYmplY3R9IHdvcmtzaG9wXG4gICAqIEByZXR1cm4ge3ZvaWR9XG4gICAqL1xuICBXb3Jrc2hvcC5wcm90b3R5cGUuX2luaXRXb3Jrc2hvcCA9IGZ1bmN0aW9uKHdvcmtzaG9wKVxuICAgIHtcbiAgICAgIC8vIG1hcCBhbGwgYHRhc2tzYCB0byBpbnRlcm5hbCBoYXNoIGFuZCBzZXQgYCQkcmVzdWx0c2BcbiAgICAgIHZhciBtZSA9IHRoaXM7XG4gICAgICBhbmd1bGFyLmZvckVhY2god29ya3Nob3AudGFza3MsIGZ1bmN0aW9uKHRhc2spe1xuICAgICAgICB2YXIgb2xkID0gbWUuX3Rhc2tzW3Rhc2suaWRdIHx8wqBudWxsO1xuICAgICAgICB0YXNrLiQkcmVzdWx0cyA9IG9sZCAhPT0gbnVsbCA/XG4gICAgICAgICAgb2xkLiQkcmVzdWx0c1xuICAgICAgICAgIDogMDtcblxuICAgICAgICBtZS5fdGFza3NbdGFzay5pZF0gPSB0YXNrO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIGNoZWNrIGAkJGV4cGFuZGVkYCBmbGFnIGZvciB0aGlzIHdvcmtzaG9wXG4gICAgICB2YXIgaWQgPSB0aGlzLl9leHBhbmRlZCAmJiB0aGlzLl9leHBhbmRlZC5pZDtcbiAgICAgIHdvcmtzaG9wLiQkZXhwYW5kZWQgPSB3b3Jrc2hvcC5pZCA9PT0gaWQ7XG5cbiAgICAgIC8vIGluaXRpYWxpemUgYCQkdXNlcnNgIGFuZCBzZXQgdXAgc3RyZWFtaW5nXG4gICAgICB3b3Jrc2hvcC4kJHVzZXJzID0gd29ya3Nob3AudXNlcnMubGVuZ3RoO1xuXG4gICAgICBpZiAoIXdvcmtzaG9wLmlzQWN0aXZlKSB7XG4gICAgICAgIHRoaXMuX3JlbW92ZVVzZXJzU3RyZWFtKHdvcmtzaG9wKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuX2FkZFVzZXJzU3RyZWFtKHdvcmtzaG9wKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5fd29ya3Nob3BzW3dvcmtzaG9wLmlkXSA9IHdvcmtzaG9wO1xuICAgIH07XG5cbiAgLyoqXG4gICAqIFJlbW92ZXMgYWxsIHdhdGNoZXMsIGxpc3RlbmVycyBhbmQgc291cmNlc1xuICAgKiBhcyBzb29uIGFzIGNvbnRyb2xsZXIncyAkc2NvcGUgaXMgZGVzdHJveWVkLlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAbWV0aG9kIF9pbml0TGlzdGVuZXJcbiAgICogQHJldHVybiB7dm9pZH1cbiAgICovXG4gIFdvcmtzaG9wLnByb3RvdHlwZS5faW5pdExpc3RlbmVyID0gZnVuY3Rpb24oKVxuICAgIHtcbiAgICAgIHZhciBzc2UgPSB0aGlzLiRpbmplY3Rvci5nZXQoJ3NzZScpO1xuXG4gICAgICB2YXIgbWUgPSB0aGlzO1xuXG4gICAgICB2YXIgX29uRGVzdHJveSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBmb3IgKHZhciBpZCBpbiBtZS5fdXNlclNvdXJjZXMpIHtcbiAgICAgICAgICBzc2UucmVtb3ZlU291cmNlKG1lLl91c2VyU291cmNlc1tpZF0pO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG1lLl9yZXN1bHRzU291cmNlKSB7XG4gICAgICAgICAgc3NlLnJlbW92ZVNvdXJjZShtZS5fcmVzdWx0c1NvdXJjZSk7XG4gICAgICAgIH1cblxuICAgICAgICBtZS5fcmVzdWx0c1NvdXJjZSA9IG51bGw7XG4gICAgICAgIG1lLl91c2VyU291cmNlcyA9IHt9O1xuXG4gICAgICAgIG1lLl91bmxpc3RlbigpO1xuICAgICAgICBtZS5fdW53YXRjaCgpO1xuICAgICAgfTtcblxuICAgICAgdGhpcy5fdW5saXN0ZW4gPSB0aGlzLiRzY29wZS4kb24oJyRkZXN0cm95JywgX29uRGVzdHJveSk7XG4gICAgfTtcblxuXG4gIGFuZ3VsYXIubW9kdWxlKG1vZHVsZSkuY29udHJvbGxlcignV29ya3Nob3BDb250cm9sbGVyJywgV29ya3Nob3ApO1xuXG59KShBTkdVTEFSX01PRFVMRSwgYW5ndWxhcik7XG4iXX0=
