/*!
 * eFit Website
 * An app for financial training in educational environments
 * http://www.e-fit.com
 * @author Armin Pfurtscheller
 * @version 1.0.0
 * Copyright 2017. MIT licensed.
 */
!function(t,e){"use strict";var n=function(t){this.$injector=t};n.$inject=["$injector"],n.prototype.signup=function(t,n,r){var o=this.$injector.get("$http");n=n||"frontend",r=r||{};var i=this,s=function(t){i._saveToken(t.data)},u=function(){},a=this._getSignupUrl(n),h=o.post(a,{_username:t.username,_password:t.password},e.extend(r||{}));return h.then(s,u),h},n.prototype.signin=function(t,n,r){var o=this.$injector.get("$http");n=n||"frontend",r=r||{};var i=this,s=function(t){i._saveToken(t.data)},u=function(){},a=this._getSigninUrl(n),h=o.post(a,{_username:t.username,_password:t.password},e.extend(r||{},{skipAuthorization:!0}));return h.then(s,u),h},n.prototype.signout=function(t){var e=this.$injector.get("$http"),n=this.$injector.get("user"),r=this.$injector.get("jwt"),o=function(){r.removeRefreshToken(),r.removeToken(),n.unload()},i=function(){};return e.get(this._getSignoutUrl(),t||{}).then(o,i)},n.prototype.refresh=function(t){var n=this.$injector.get("$http"),r=this.$injector.get("jwt"),o=this,i=function(t){return o._saveToken(t.data),t},s=function(t){return t},u=n.post(this._getRefereshUrl(),{refresh_token:r.getRefreshToken()},e.extend(t||{},{skipAuthorization:!0}));return u.then(i,s)},n.prototype.getUser=function(t){t=t||!1;var e=this.$injector.get("jwt"),n=e.getToken();return n?!t&&e.isExpired()?null:e.decode(n):null},n.prototype.hasRole=function(t){var n=this.$injector.get("jwt"),r=this.$injector.get("$q"),o=r.defer(),i=o.promise,s=e.isArray(t);if(s&&0===t.length)return o.reject(null),i;if(!t)return o.reject(null),i;var u=this.getUser(!0);if(null===u)return o.reject(null),i;var a=function(n){var r=n.roles||[];e.isString(t)&&(t=[t]);for(var i=!1,s=0;s<t.length;s++)if(r.indexOf(t[s])>=0){i=!0;break}return i?void o.resolve():void o.reject()};if(!n.isExpired())return a(u),i;var h=this,c=function(){u=h.getUser(),a(u)},f=function(){o.reject()};return this.refresh().then(c,f),i},n.prototype._saveToken=function(t){var e=this.$injector.get("jwt");e.setRefreshToken(t.refresh_token),e.setToken(t.token)},n.prototype._getSigninUrl=function(t){var e=this.$injector.get("API_URL");switch(t){case"backend":case"frontend":return e+"/auth/"+t+"/signin";default:throw new Error("Unknown firewall name: "+t)}},n.prototype._getSignupUrl=function(t){var e=this.$injector.get("API_URL");switch(t){case"frontend":return e+"/auth/"+t+"/signup";case"backend":throw new Error("Not implemented yet!");default:throw new Error("Unknown firewall name: "+t)}},n.prototype._getRefereshUrl=function(){var t=this.$injector.get("API_URL");return t+"/auth/refresh"},n.prototype._getSignoutUrl=function(){var t=this.$injector.get("API_URL");return t+"/signout"},e.module(t).service("auth",n)}(ANGULAR_MODULE,angular);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC9zZXJ2aWNlcy9hdXRoLmpzIl0sIm5hbWVzIjpbIm1vZHVsZSIsImFuZ3VsYXIiLCJBdXRoIiwiJGluamVjdG9yIiwidGhpcyIsIiRpbmplY3QiLCJwcm90b3R5cGUiLCJzaWdudXAiLCJkYXRhIiwiZmlyZXdhbGwiLCJjb25maWciLCIkaHR0cCIsImdldCIsIm1lIiwic3VjY2Vzc0NhbGxiYWNrIiwicmVzcG9uc2UiLCJfc2F2ZVRva2VuIiwiZmFpbHVyZUNhbGxiYWNrIiwidXJsIiwiX2dldFNpZ251cFVybCIsInByb21pc2UiLCJwb3N0IiwiX3VzZXJuYW1lIiwidXNlcm5hbWUiLCJfcGFzc3dvcmQiLCJwYXNzd29yZCIsImV4dGVuZCIsInRoZW4iLCJzaWduaW4iLCJfZ2V0U2lnbmluVXJsIiwic2tpcEF1dGhvcml6YXRpb24iLCJzaWdub3V0IiwidXNlciIsImp3dCIsInJlbW92ZVJlZnJlc2hUb2tlbiIsInJlbW92ZVRva2VuIiwidW5sb2FkIiwiX2dldFNpZ25vdXRVcmwiLCJyZWZyZXNoIiwicmVqZWN0aW9uIiwiX2dldFJlZmVyZXNoVXJsIiwicmVmcmVzaF90b2tlbiIsImdldFJlZnJlc2hUb2tlbiIsImdldFVzZXIiLCJhY2NlcHRFeHBpcmVkIiwidG9rZW4iLCJnZXRUb2tlbiIsImlzRXhwaXJlZCIsImRlY29kZSIsImhhc1JvbGUiLCJyb2xlIiwiJHEiLCJkZWZlciIsImlzQXJyYXkiLCJsZW5ndGgiLCJyZWplY3QiLCJyZXNvbHZlUm9sZSIsInJvbGVzIiwiaXNTdHJpbmciLCJpIiwiaW5kZXhPZiIsInJlc29sdmUiLCJzZXRSZWZyZXNoVG9rZW4iLCJzZXRUb2tlbiIsIkFQSV9VUkwiLCJFcnJvciIsInNlcnZpY2UiLCJBTkdVTEFSX01PRFVMRSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Q0FTQSxTQUFVQSxFQUFRQyxHQUNoQixZQVNBLElBQUlDLEdBQU8sU0FBU0MsR0FFaEJDLEtBQUtELFVBQVlBLEVBTXJCRCxHQUFLRyxTQUFX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LEtBQUtELFVBQVVTLElBQUksVUFFakMsT0FBT29ELEdBQVUsaUJBV25COUQsRUFBS0ksVUFBVStCLGVBQWlCLFdBQzlCLEdBQUkyQixHQUFVNUQsS0FBS0QsVUFBVVMsSUFBSSxVQUVqQyxPQUFPb0QsR0FBVSxZQU1uQi9ELEVBQVFELE9BQU9BLEdBQVFrRSxRQUFRLE9BQVFoRSxJQUV0Q2lFLGVBQWdCbEUiLCJmaWxlIjoiYXBwL3NlcnZpY2VzL2F1dGgubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyogZ2xvYmFsIEFOR1VMQVJfTU9EVUxFLCBhbmd1bGFyICovXG4oZnVuY3Rpb24obW9kdWxlLCBhbmd1bGFyKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICAvL1xuICAvLyBTRVJWSUNFXG4gIC8vXG5cbiAgLyoqXG4gICAqIEBjb25zdHJ1Y3RvclxuICAgKi9cbiAgdmFyIEF1dGggPSBmdW5jdGlvbigkaW5qZWN0b3IpXG4gICAge1xuICAgICAgdGhpcy4kaW5qZWN0b3IgPSAkaW5qZWN0b3I7XG4gICAgfTtcblxuICAvKipcbiAgICogQHByb3BlcnR5IHtBcnJheS48c3RyaW5nPn0gJGluamVjdFxuICAgKi9cbiAgQXV0aC4kaW5qZWN0ID0gWyckaW5qZWN0b3InXTtcblxuICAvL1xuICAvLyBNRVRIT0RTXG4gIC8vXG5cbiAgLyoqXG4gICAqIFNlbmRzIGEgUE9TVCByZXF1ZXN0IHRvIHJlZ2lzdGVyIHJvdXRlIGFuZFxuICAgKiBwZXJzaXN0cyByZXRyaWV2ZWQgSldUIHRva2VuIG9uIHN1Y2Nlc3MuXG4gICAqXG4gICAqIEBwdWJsaWNcbiAgICogQG1ldGhvZCBzaWduaW5cbiAgICogQHBhcmFtIHtPYmplY3R9IGRhdGEgRGF0YSB0byBzdWJtaXQuXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBbZmlyZXdhbGw9J2Zyb250ZW5kJ10gZmlyZXdhbGxcbiAgICogQHBhcmFtIHtPYmplY3R9IFtjb25maWc9e31dICRodHRwIGNvbmZpZy5cbiAgICogQHJldHVybiB7UHJvbWlzZX1cbiAgICovXG4gIEF1dGgucHJvdG90eXBlLnNpZ251cCA9IGZ1bmN0aW9uKGRhdGEsIGZpcmV3YWxsLCBjb25maWcpXG4gICAge1xuICAgICAgdmFyICRodHRwID0gdGhpcy4kaW5qZWN0b3IuZ2V0KCckaHR0cCcpO1xuXG4gICAgICBmaXJld2FsbCA9IGZpcmV3YWxsIHx8wqAnZnJvbnRlbmQnO1xuICAgICAgY29uZmlnID0gY29uZmlnIHx8wqB7fTtcblxuICAgICAgdmFyIG1lID0gdGhpcztcbiAgICAgIHZhciBzdWNjZXNzQ2FsbGJhY2sgPSBmdW5jdGlvbihyZXNwb25zZSlcbiAgICAgICAge1xuICAgICAgICAgIG1lLl9zYXZlVG9rZW4ocmVzcG9uc2UuZGF0YSk7XG4gICAgICAgIH07XG5cbiAgICAgIHZhciBmYWlsdXJlQ2FsbGJhY2sgPSBmdW5jdGlvbigpXG4gICAgICAgIHtcbiAgICAgICAgICAvLyBub29wXG4gICAgICAgIH07XG5cbiAgICAgIHZhciB1cmwgPSB0aGlzLl9nZXRTaWdudXBVcmwoZmlyZXdhbGwpO1xuXG4gICAgICB2YXIgcHJvbWlzZSA9ICRodHRwLnBvc3QoXG4gICAgICAgIHVybCxcbiAgICAgICAge1xuICAgICAgICAgIF91c2VybmFtZTogZGF0YS51c2VybmFtZSxcbiAgICAgICAgICBfcGFzc3dvcmQ6IGRhdGEucGFzc3dvcmRcbiAgICAgICAgfSxcbiAgICAgICAgYW5ndWxhci5leHRlbmQoY29uZmlnIHx8IHt9KVxuICAgICAgKTtcblxuICAgICAgcHJvbWlzZS50aGVuKFxuICAgICAgICBzdWNjZXNzQ2FsbGJhY2ssXG4gICAgICAgIGZhaWx1cmVDYWxsYmFja1xuICAgICAgKTtcblxuICAgICAgcmV0dXJuIHByb21pc2U7XG4gICAgfTtcblxuICAvKipcbiAgICogU2VuZHMgYSBQT1NUIHJlcXVlc3QgdG8gbG9naW4gcm91dGUgYW5kXG4gICAqIHBlcnNpc3RzIHJldHJpZXZlZCBKV1QgdG9rZW4gb24gc3VjY2Vzcy5cbiAgICpcbiAgICogQHB1YmxpY1xuICAgKiBAbWV0aG9kIHNpZ25pblxuICAgKiBAcGFyYW0ge09iamVjdH0gZGF0YSBEYXRhIHRvIHN1Ym1pdC5cbiAgICogQHBhcmFtIHtzdHJpbmd9IFtmaXJld2FsbD0nZnJvbnRlbmQnXSBmaXJld2FsbFxuICAgKiBAcGFyYW0ge09iamVjdH0gW2NvbmZpZz17fV0gJGh0dHAgY29uZmlnLlxuICAgKiBAcmV0dXJuIHtQcm9taXNlfVxuICAgKi9cbiAgQXV0aC5wcm90b3R5cGUuc2lnbmluID0gZnVuY3Rpb24oZGF0YSwgZmlyZXdhbGwsIGNvbmZpZylcbiAgICB7XG4gICAgICB2YXIgJGh0dHAgPSB0aGlzLiRpbmplY3Rvci5nZXQoJyRodHRwJyk7XG5cbiAgICAgIGZpcmV3YWxsID0gZmlyZXdhbGwgfHzCoCdmcm9udGVuZCc7XG4gICAgICBjb25maWcgPSBjb25maWcgfHzCoHt9O1xuXG4gICAgICB2YXIgbWUgPSB0aGlzO1xuICAgICAgdmFyIHN1Y2Nlc3NDYWxsYmFjayA9IGZ1bmN0aW9uKHJlc3BvbnNlKVxuICAgICAgICB7XG4gICAgICAgICAgbWUuX3NhdmVUb2tlbihyZXNwb25zZS5kYXRhKTtcbiAgICAgICAgfTtcblxuICAgICAgdmFyIGZhaWx1cmVDYWxsYmFjayA9IGZ1bmN0aW9uKClcbiAgICAgICAge1xuICAgICAgICAgIC8vIG5vb3BcbiAgICAgICAgfTtcblxuICAgICAgdmFyIHVybCA9IHRoaXMuX2dldFNpZ25pblVybChmaXJld2FsbCk7XG5cbiAgICAgIHZhciBwcm9taXNlID0gJGh0dHAucG9zdChcbiAgICAgICAgdXJsLFxuICAgICAgICB7XG4gICAgICAgICAgX3VzZXJuYW1lOiBkYXRhLnVzZXJuYW1lLFxuICAgICAgICAgIF9wYXNzd29yZDogZGF0YS5wYXNzd29yZFxuICAgICAgICB9LFxuICAgICAgICBhbmd1bGFyLmV4dGVuZChjb25maWcgfHwge30sIHtcbiAgICAgICAgICBza2lwQXV0aG9yaXphdGlvbjogdHJ1ZVxuICAgICAgICB9KVxuICAgICAgKTtcblxuICAgICAgcHJvbWlzZS50aGVuKFxuICAgICAgICBzdWNjZXNzQ2FsbGJhY2ssXG4gICAgICAgIGZhaWx1cmVDYWxsYmFja1xuICAgICAgKTtcblxuICAgICAgcmV0dXJuIHByb21pc2U7XG4gICAgfTtcblxuICAvKipcbiAgICogRGVzdHJveXMgSldUIHRva2VuIHJlcHJlc2VudGluZyB1c2VyLlxuICAgKlxuICAgKiBAcHVibGljXG4gICAqIEBtZXRob2QgbG9nb3V0XG4gICAqIEBwYXJhbSB7T2JqZWN0fSBbY29uZmlnXSAkaHR0cCBjb25maWcuXG4gICAqIEByZXR1cm4ge1ZvaWR9XG4gICAqL1xuICBBdXRoLnByb3RvdHlwZS5zaWdub3V0ID0gZnVuY3Rpb24oY29uZmlnKVxuICAgIHtcbiAgICAgIHZhciAkaHR0cCA9IHRoaXMuJGluamVjdG9yLmdldCgnJGh0dHAnKTtcbiAgICAgIHZhciB1c2VyID0gdGhpcy4kaW5qZWN0b3IuZ2V0KCd1c2VyJyk7XG4gICAgICB2YXIgand0ID0gdGhpcy4kaW5qZWN0b3IuZ2V0KCdqd3QnKTtcblxuICAgICAgdmFyIHN1Y2Nlc3NDYWxsYmFjayA9IGZ1bmN0aW9uKClcbiAgICAgICAge1xuICAgICAgICAgIGp3dC5yZW1vdmVSZWZyZXNoVG9rZW4oKTtcbiAgICAgICAgICBqd3QucmVtb3ZlVG9rZW4oKTtcbiAgICAgICAgICB1c2VyLnVubG9hZCgpO1xuICAgICAgICB9O1xuXG4gICAgICB2YXIgZmFpbHVyZUNhbGxiYWNrID0gZnVuY3Rpb24oKVxuICAgICAgICB7XG4gICAgICAgICAgLy8gbm9vcFxuICAgICAgICB9O1xuXG4gICAgICByZXR1cm4gJGh0dHAuZ2V0KFxuICAgICAgICB0aGlzLl9nZXRTaWdub3V0VXJsKCksXG4gICAgICAgIGNvbmZpZyB8fCB7fVxuICAgICAgKS50aGVuKFxuICAgICAgICBzdWNjZXNzQ2FsbGJhY2ssXG4gICAgICAgIGZhaWx1cmVDYWxsYmFja1xuICAgICAgKTtcbiAgICB9O1xuXG4gIC8qKlxuICAgKiBTZW5kcyBhIFBPU1QgcmVxdWVzdCB0byByZWZyZXNoIHJvdXRlXG4gICAqIHdpdGggc2F2ZWQgcmVmcmVzaCB0b2tlbiBmcm9tIGxvZ2luKCkuXG4gICAqXG4gICAqIEBwdWJsaWNcbiAgICogQG1ldGhvZCByZWZyZXNoXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBbY29uZmlnXSAkaHR0cCBjb25maWcuXG4gICAqIEByZXR1cm4ge1Byb21pc2V9XG4gICAqL1xuICBBdXRoLnByb3RvdHlwZS5yZWZyZXNoID0gZnVuY3Rpb24oY29uZmlnKVxuICAgIHtcbiAgICAgIHZhciAkaHR0cCA9IHRoaXMuJGluamVjdG9yLmdldCgnJGh0dHAnKTtcbiAgICAgIHZhciBqd3QgPSB0aGlzLiRpbmplY3Rvci5nZXQoJ2p3dCcpO1xuXG4gICAgICB2YXIgbWUgPSB0aGlzO1xuICAgICAgdmFyIHN1Y2Nlc3NDYWxsYmFjayA9IGZ1bmN0aW9uKHJlc3BvbnNlKVxuICAgICAgICB7XG4gICAgICAgICAgbWUuX3NhdmVUb2tlbihyZXNwb25zZS5kYXRhKTtcbiAgICAgICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgICAgIH07XG5cbiAgICAgIHZhciBmYWlsdXJlQ2FsbGJhY2sgPSBmdW5jdGlvbihyZWplY3Rpb24pXG4gICAgICAgIHtcbiAgICAgICAgICByZXR1cm4gcmVqZWN0aW9uO1xuICAgICAgICB9O1xuXG4gICAgICB2YXIgcHJvbWlzZSA9ICRodHRwLnBvc3QoXG4gICAgICAgIHRoaXMuX2dldFJlZmVyZXNoVXJsKCksXG4gICAgICAgIHtcbiAgICAgICAgICAvKiBqc2hpbnQgY2FtZWxjYXNlOiBmYWxzZSAqL1xuICAgICAgICAgIHJlZnJlc2hfdG9rZW46IGp3dC5nZXRSZWZyZXNoVG9rZW4oKVxuICAgICAgICAgIC8qIGpzaGludCBjYW1lbGNhc2U6IHRydWUgKi9cbiAgICAgICAgfSxcbiAgICAgICAgYW5ndWxhci5leHRlbmQoY29uZmlnIHx8IHt9LCB7XG4gICAgICAgICAgc2tpcEF1dGhvcml6YXRpb246IHRydWVcbiAgICAgICAgfSlcbiAgICAgICk7XG5cbiAgICAgIHJldHVybiBwcm9taXNlLnRoZW4oXG4gICAgICAgIHN1Y2Nlc3NDYWxsYmFjayxcbiAgICAgICAgZmFpbHVyZUNhbGxiYWNrXG4gICAgICApO1xuICAgIH07XG5cbiAgLyoqXG4gICAqIFJldHVybnMgZGVjb2RlZCBKV1QgdG9rZW4gY29udGFpbmluZ1xuICAgKiB1c2VyIGluZm9ybWF0aW9uIHN1Y2ggYXMgYHVzZXJuYW1lYC5cbiAgICogTm90ZTogQnkgZGVmYXVsdCBleHBpcmVkIHRva2VucyBhcmVcbiAgICogbm90IGFjY2VwdGVkLCBzZXQgcGFyYW1ldGVyIGlmIHlvdVxuICAgKiB3YW50IHRvIGFjY2VwdCBleHBpcmVkIHRva2VucyB0b28hXG4gICAqXG4gICAqIEBwdWJsaWNcbiAgICogQG1ldGhvZCBnZXRVc2VyXG4gICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2FjY2VwdEV4cGlyZWQ9ZmFsc2VdXG4gICAqIEByZXR1cm4ge09iamVjdHxudWxsfVxuICAgKi9cbiAgQXV0aC5wcm90b3R5cGUuZ2V0VXNlciA9IGZ1bmN0aW9uKGFjY2VwdEV4cGlyZWQpXG4gICAge1xuICAgICAgYWNjZXB0RXhwaXJlZCA9IGFjY2VwdEV4cGlyZWQgfHzCoGZhbHNlO1xuXG4gICAgICB2YXIgand0ID0gdGhpcy4kaW5qZWN0b3IuZ2V0KCdqd3QnKTtcblxuICAgICAgdmFyIHRva2VuID0gand0LmdldFRva2VuKCk7XG4gICAgICBpZiAoIXRva2VuKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuXG4gICAgICBpZiAoIWFjY2VwdEV4cGlyZWQpIHtcbiAgICAgICAgaWYgKGp3dC5pc0V4cGlyZWQoKSkge1xuICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBqd3QuZGVjb2RlKHRva2VuKTtcbiAgICB9O1xuXG4gIC8qKlxuICAgKiBDaGVja3MgaWYgdXNlciBoYXMgZ2l2ZW4gcm9sZSBwcm92aWRlZFxuICAgKiBpbiBgcm9sZXNgIHByb3BlcnR5IGVuY29kZWQgaW50byBKV1QuXG4gICAqXG4gICAqIEBwdWJsaWNcbiAgICogQG1ldGhvZCBoYXNSb2xlXG4gICAqIEBwYXJhbSB7c3RyaW5nfGFycmF5fSByb2xlXG4gICAqIEByZXR1cm4ge1Byb21pc2V9XG4gICAqL1xuICBBdXRoLnByb3RvdHlwZS5oYXNSb2xlID0gZnVuY3Rpb24ocm9sZSlcbiAgICB7XG4gICAgICB2YXIgand0ID0gdGhpcy4kaW5qZWN0b3IuZ2V0KCdqd3QnKTtcbiAgICAgIHZhciAkcSA9IHRoaXMuJGluamVjdG9yLmdldCgnJHEnKTtcbiAgICAgIHZhciBkZWZlciA9ICRxLmRlZmVyKCk7XG4gICAgICB2YXIgcHJvbWlzZSA9IGRlZmVyLnByb21pc2U7XG5cbiAgICAgIHZhciBpc0FycmF5ID0gYW5ndWxhci5pc0FycmF5KHJvbGUpO1xuICAgICAgaWYgKGlzQXJyYXkgJiYgcm9sZS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgZGVmZXIucmVqZWN0KG51bGwpO1xuICAgICAgICByZXR1cm4gcHJvbWlzZTtcbiAgICAgIH1cblxuICAgICAgaWYgKCFyb2xlKSB7XG4gICAgICAgIGRlZmVyLnJlamVjdChudWxsKTtcbiAgICAgICAgcmV0dXJuIHByb21pc2U7XG4gICAgICB9XG5cbiAgICAgIC8vIGFjY2VwdCBleHBpcmVkIHRva2VucyAtIHdlIHdpbGxcbiAgICAgIC8vIHVzZSByZWZyZXNoKCkgdG8gZ2V0IG5ldyB0b2tlblxuICAgICAgLy8gaWYgY3VycmVudCBvbmUgaXMgaW52YWxpZCBub3dcbiAgICAgIHZhciB1c2VyID0gdGhpcy5nZXRVc2VyKHRydWUpO1xuICAgICAgaWYgKHVzZXIgPT09IG51bGwpIHtcbiAgICAgICAgZGVmZXIucmVqZWN0KG51bGwpO1xuICAgICAgICByZXR1cm4gcHJvbWlzZTtcbiAgICAgIH1cblxuICAgICAgLy8gcHJpbWl0aXZlIG1ldGhvZCBmb3Igcm9sZSBjaGVja1xuICAgICAgdmFyIHJlc29sdmVSb2xlID0gZnVuY3Rpb24odXNlcikge1xuICAgICAgICB2YXIgcm9sZXMgPSB1c2VyLnJvbGVzIHx8wqBbXTtcbiAgICAgICAgaWYgKGFuZ3VsYXIuaXNTdHJpbmcocm9sZSkpIHtcbiAgICAgICAgICByb2xlID0gW3JvbGVdO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGhhc1JvbGUgPSBmYWxzZTtcbiAgICAgICAgZm9yICh2YXIgaT0wOyBpPHJvbGUubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICBpZiAocm9sZXMuaW5kZXhPZihyb2xlW2ldKSA+PSAwKSB7XG4gICAgICAgICAgICBoYXNSb2xlID0gdHJ1ZTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChoYXNSb2xlKSB7XG4gICAgICAgICAgZGVmZXIucmVzb2x2ZSgpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGRlZmVyLnJlamVjdCgpO1xuICAgICAgfTtcblxuICAgICAgLy8gaW1tZWRpYXRlbHkgcmVzb2x2ZSB2YWxpZCB0b2tlbnNcbiAgICAgIGlmICghand0LmlzRXhwaXJlZCgpKSB7XG4gICAgICAgIHJlc29sdmVSb2xlKHVzZXIpO1xuICAgICAgICByZXR1cm4gcHJvbWlzZTtcbiAgICAgIH1cblxuICAgICAgLy8gdHJ5IHRvIHJlZnJlc2ggaW52YWxpZCB0b2tlbnNcbiAgICAgIHZhciBtZSA9IHRoaXM7XG4gICAgICB2YXIgc3VjY2Vzc0NhbGxiYWNrID0gZnVuY3Rpb24oKVxuICAgICAgICB7XG4gICAgICAgICAgdXNlciA9IG1lLmdldFVzZXIoKTtcbiAgICAgICAgICByZXNvbHZlUm9sZSh1c2VyKTtcbiAgICAgICAgfTtcblxuICAgICAgdmFyIGZhaWx1cmVDYWxsYmFjayA9IGZ1bmN0aW9uKClcbiAgICAgICAge1xuICAgICAgICAgIGRlZmVyLnJlamVjdCgpO1xuICAgICAgICB9O1xuXG4gICAgICB0aGlzLnJlZnJlc2goKS50aGVuKFxuICAgICAgICBzdWNjZXNzQ2FsbGJhY2ssXG4gICAgICAgIGZhaWx1cmVDYWxsYmFja1xuICAgICAgKTtcblxuICAgICAgcmV0dXJuIHByb21pc2U7XG4gICAgfTtcblxuICAvKipcbiAgICogU2F2ZXMgc2VydmVyIHJlc3BvbnNlIGNvbnRhaW5pbmdcbiAgICogdGhlIGB0b2tlbmAgYW5kIGByZWZyZXNoX3Rva2VuYC5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICogQG1ldGhvZCBfc2F2ZVRva2VuXG4gICAqIEBwYXJhbSB7b2JqZWN0fSByZXNwb25zZVxuICAgKiBAcmV0dXJuIHt2b2lkfVxuICAgKi9cbiAgQXV0aC5wcm90b3R5cGUuX3NhdmVUb2tlbiA9IGZ1bmN0aW9uKGRhdGEpXG4gICAge1xuICAgICAgLyoganNoaW50IGNhbWVsY2FzZTogZmFsc2UgKi9cbiAgICAgIHZhciBqd3QgPSB0aGlzLiRpbmplY3Rvci5nZXQoJ2p3dCcpO1xuXG4gICAgICBqd3Quc2V0UmVmcmVzaFRva2VuKGRhdGEucmVmcmVzaF90b2tlbik7XG4gICAgICBqd3Quc2V0VG9rZW4oZGF0YS50b2tlbik7XG4gICAgICAvKiBqc2hpbnQgY2FtZWxjYXNlOiB0cnVlICovXG4gICAgfTtcblxuICAvKipcbiAgICogUmV0dXJucyBlbmRwb2ludCB0byBnYXRoZXIgSldUIGRlcGVuZGluZyBvbiBmaXJld2FsbC5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICogQG1ldGhvZCBfZ2V0U2lnbmluVXJsXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBmaXJld2FsbFxuICAgKiBAcmV0dXJuIHtzdHJpbmd9XG4gICAqL1xuICBBdXRoLnByb3RvdHlwZS5fZ2V0U2lnbmluVXJsID0gZnVuY3Rpb24oZmlyZXdhbGwpe1xuICAgIHZhciBBUElfVVJMID0gdGhpcy4kaW5qZWN0b3IuZ2V0KCdBUElfVVJMJyk7XG5cbiAgICBzd2l0Y2goZmlyZXdhbGwpIHtcbiAgICAgIGNhc2UgJ2JhY2tlbmQnOlxuICAgICAgY2FzZSAnZnJvbnRlbmQnOlxuICAgICAgICByZXR1cm4gQVBJX1VSTCArICcvYXV0aC8nICsgZmlyZXdhbGwgKyAnL3NpZ25pbic7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Vua25vd24gZmlyZXdhbGwgbmFtZTogJyArIGZpcmV3YWxsKTtcbiAgICB9XG4gIH07XG5cbiAgLyoqXG4gICAqIFJldHVybnMgZW5kcG9pbnQgdG8gcmVnaXN0ZXIgYXQgZ2l2ZW4gZmlyZXdhbGwuXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqIEBtZXRob2QgX2dldFNpZ251cFVybFxuICAgKiBAcGFyYW0ge3N0cmluZ30gZmlyZXdhbGxcbiAgICogQHJldHVybiB7c3RyaW5nfVxuICAgKi9cbiAgQXV0aC5wcm90b3R5cGUuX2dldFNpZ251cFVybCA9IGZ1bmN0aW9uKGZpcmV3YWxsKXtcbiAgICB2YXIgQVBJX1VSTCA9IHRoaXMuJGluamVjdG9yLmdldCgnQVBJX1VSTCcpO1xuXG4gICAgc3dpdGNoKGZpcmV3YWxsKSB7XG4gICAgICBjYXNlICdmcm9udGVuZCc6XG4gICAgICAgIHJldHVybiBBUElfVVJMICsgJy9hdXRoLycgKyBmaXJld2FsbCArICcvc2lnbnVwJztcbiAgICAgIGNhc2UgJ2JhY2tlbmQnOlxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vdCBpbXBsZW1lbnRlZCB5ZXQhJyk7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Vua25vd24gZmlyZXdhbGwgbmFtZTogJyArIGZpcmV3YWxsKTtcbiAgICB9XG4gIH07XG5cbiAgLyoqXG4gICAqIFJldHVybnMgZW5kcG9pbnQgdG8gcmVmcmVzaCB0aGUgSldULlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAbWV0aG9kIF9nZXRSZWZlcmVzaFVybFxuICAgKiBAcmV0dXJuIHtzdHJpbmd9XG4gICAqL1xuICBBdXRoLnByb3RvdHlwZS5fZ2V0UmVmZXJlc2hVcmwgPSBmdW5jdGlvbigpe1xuICAgIHZhciBBUElfVVJMID0gdGhpcy4kaW5qZWN0b3IuZ2V0KCdBUElfVVJMJyk7XG5cbiAgICByZXR1cm4gQVBJX1VSTCArICcvYXV0aC9yZWZyZXNoJztcbiAgfTtcblxuICAvKipcbiAgICogUmV0dXJucyBlbmRwb2ludCB0byByZXZva2UgdGhlIEpXVC5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICogQG1ldGhvZCBfZ2V0U2lnbm91dFVybFxuICAgKiBAcGFyYW0ge3N0cmluZ30gZmlyZXdhbGxcbiAgICogQHJldHVybiB7c3RyaW5nfVxuICAgKi9cbiAgQXV0aC5wcm90b3R5cGUuX2dldFNpZ25vdXRVcmwgPSBmdW5jdGlvbigpe1xuICAgIHZhciBBUElfVVJMID0gdGhpcy4kaW5qZWN0b3IuZ2V0KCdBUElfVVJMJyk7XG5cbiAgICByZXR1cm4gQVBJX1VSTCArICcvc2lnbm91dCc7XG4gIH07XG5cbiAgLy9cbiAgLy8gUkVHSVNUUllcbiAgLy9cbiAgYW5ndWxhci5tb2R1bGUobW9kdWxlKS5zZXJ2aWNlKCdhdXRoJywgQXV0aCk7XG5cbn0pKEFOR1VMQVJfTU9EVUxFLCBhbmd1bGFyKTtcbiJdfQ==
