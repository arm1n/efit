/*!
 * eFit Website
 * An app for financial training in educational environments
 * http://www.e-fit.com
 * @author Armin Pfurtscheller
 * @version 1.0.0
 * Copyright 2017. MIT licensed.
 */
!function(t,e){"use strict";var i=function(t){this.$injector=t,this._states=[t.get("STATE_BEGINNER"),t.get("STATE_AMATEUR"),t.get("STATE_ADVANCED"),t.get("STATE_EXPERT")],this._eventSource=null,this._results=[],this._payload={},this._pending={},this._tasks={}};i.$inject=["$injector"],i.prototype.state=null,i.prototype.group=null,i.prototype.tickets=null,i.prototype.load=function(){var t=this.$injector.get("User"),e=this,i=function(t){e._payload=t.toJSON(),e._initTickets(),e._initState(),e._initGroup(),e.isUser()&&(e._initWatches(),e._initTasks(),e._initPending(),e._initResults(),e._initSSE())},s=function(){},n=t.current();return n.$promise.then(i,s),n},i.prototype.unload=function(){var t=this.$injector.get("sse");this._eventSource&&t.removeSource(this._eventSource),this._unwatchTickets&&this._unwatchTickets(),this._unwatchState&&this._unwatchState(),this._eventSource=null,this._results=[],this._payload={},this._pending={},this._tasks={},this.tickets=null,this.state=null,this.group=null},i.prototype.update=function(t){this._payload=t.user,this._addResult(t),this._initTickets(),this._initState(),this._initGroup()},i.prototype.isUser=function(){return this.hasRole("ROLE_USER")},i.prototype.isAdmin=function(){return this.hasRole("ROLE_ADMIN")},i.prototype.isSuperAdmin=function(){return this.hasRole("ROLE_SUPER_ADMIN")},i.prototype.isInWorkshop=function(){return!this.isUser()||this._payload.workshop.isActive},i.prototype.hasRole=function(t){e.isArray(t)||(t=[t]);for(var i=this._payload.roles||[],s=0;s<t.length;s++)if(i.indexOf(t[s])>=0)return!0;return!1},i.prototype.getTasks=function(){return this._tasks},i.prototype.getTaskByType=function(t){return this._tasks[t]||null},i.prototype.getPendingByType=function(t){return this._pending[t]||null},i.prototype.getGroupAsString=function(){switch(this.group){case this.$injector.get("GROUP_A"):return"GROUP_A";case this.$injector.get("GROUP_B"):return"GROUP_B";default:return null}},i.prototype.getStateAsString=function(){switch(this.state){case this.$injector.get("STATE_AMATEUR"):return"STATE_AMATEUR";case this.$injector.get("STATE_ADVANCED"):return"STATE_ADVANCED";case this.$injector.get("STATE_EXPERT"):return"STATE_EXPERT";default:return"STATE_BEGINNER"}},i.prototype._initState=function(){var t=this.$injector.get("STATE_BEGINNER");this.state=this._payload.state||t},i.prototype._initGroup=function(){this.group=this._payload.group||null},i.prototype._initTickets=function(){var t=this._payload.tickets;this.tickets=t||[]},i.prototype._initWatches=function(){var t=this.$injector.get("notification"),e=this.$injector.get("$rootScope"),i=this.$injector.get("i18n"),s=this,n=function(){return s.state},o=function(e,n){e!==n&&t.success(i.get("Congratulations, you have reached the state %s!",i.get(s.getStateAsString())))},r=function(){return s.tickets},a=function(e,s){if(e!==s){var n=s&&s.length,o=e&&e.length,r=o-n;if(!(r<0)){var a=1===r?i.get("Congratulations, you have earned 1 new ticket!"):i.get("Congratulations, you have earned %s new tickets!",r);t.primary(a)}}};this._unwatchTickets=e.$watchCollection(r,a),this._unwatchState=e.$watch(n,o)},i.prototype._initSSE=function(){var t=this.$injector.get("$rootScope"),i=this.$injector.get("API_URL"),s=this.$injector.get("sse"),n=this._payload.workshop;if(n.isActive){var o=this,r=function(i){t.$evalAsync(function(){e.forEach(i,function(t){var e=Date.parse(t.updatedAt),i=o._tasks[t.type];i.isActive=!!t.isActive,isNaN(e)||(t.updatedAt=e)})})},a=i+"/sse/workshop/"+n.id+"/tasks",u={onMessage:r,sleep:1};this._eventSource=s.addSource(a,u)}},i.prototype._initTasks=function(){var t=this._payload.workshop;if(t){var i=this;e.forEach(t.tasks,function(t){i._tasks[t.type]=t})}},i.prototype._initPending=function(){var t=this._payload.pending;if(t){var i=this;e.forEach(t,function(t){i._pending[t.task.type]=t})}},i.prototype._initResults=function(){var t=this._addResult.bind(this),i=this._payload.results||[];e.forEach(i,t)},i.prototype._addResult=function(t){var e=this.getTaskByType(t.task.type);if(null!==e){var i=e.$$results||0;e.$$results=i+1}this._results.push(t)},e.module(t).service("user",i)}(ANGULAR_MODULE,angular);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC9zZXJ2aWNlcy91c2VyLmpzIl0sIm5hbWVzIjpbIm1vZHVsZSIsImFuZ3VsYXIiLCJVc2VyIiwiJGluamVjdG9yIiwidGhpcyIsIl9zdGF0ZXMiLCJnZXQiLCJfZXZlbnRTb3VyY2UiLCJfcmVzdWx0cyIsIl9wYXlsb2FkIiwiX3BlbmRpbmciLCJfdGFza3MiLCIkaW5qZWN0IiwicHJvdG90eXBlIiwic3RhdGUiLCJncm91cCIsInRpY2tldHMiLCJsb2FkIiwibWUiLCJzdWNjZXNzQ2FsbGJhY2siLCJ1c2VyIiwidG9KU09OIiwiX2luaXRUaWNrZXRzIiwiX2luaXRTdGF0ZSIsIl9pbml0R3JvdXAiLCJpc1VzZXIiLCJfaW5pdFdhdGNoZXMiLCJfaW5pdFRhc2tzIiwiX2luaXRQZW5kaW5nIiwiX2luaXRSZXN1bHRzIiwiX2luaXRTU0UiLCJmYWlsdXJlQ2FsbGJhY2siLCJjdXJyZW50IiwiJHByb21pc2UiLCJ0aGVuIiwidW5sb2FkIiwic3NlIiwicmVtb3ZlU291cmNlIiwiX3Vud2F0Y2hUaWNrZXRzIiwiX3Vud2F0Y2hTdGF0ZSIsInVwZGF0ZSIsInJlc3VsdCIsIl9hZGRSZXN1bHQiLCJoYXNSb2xlIiwiaXNBZG1pbiIsImlzU3VwZXJBZG1pbiIsImlzSW5Xb3Jrc2hvcCIsIndvcmtzaG9wIiwiaXNBY3RpdmUiLCJyb2xlIiwiaXNBcnJheSIsInJvbGVzIiwiaSIsImxlbmd0aCIsImluZGV4T2YiLCJnZXRUYXNrcyIsImdldFRhc2tCeVR5cGUiLCJ0eXBlIiwiZ2V0UGVuZGluZ0J5VHlwZSIsImdldEdyb3VwQXNTdHJpbmciLCJnZXRTdGF0ZUFzU3RyaW5nIiwiU1RBVEVfQkVHSU5ORVIiLCJub3RpZmljYXRpb24iLCIkcm9vdFNjb3BlIiwiaTE4biIsIl93YXRjaFN0YXRlRXhwcmVzc2lvbiIsIl93YXRjaFN0YXRlQ2FsbGJhY2siLCJuZXdTdGF0ZSIsIm9sZFN0YXRlIiwic3VjY2VzcyIsIl93YXRjaFRpY2tldHNFeHByZXNzaW9uIiwiX3dhdGNoVGlja2V0c0NhbGxiYWNrIiwibmV3VGlja2V0cyIsIm9sZFRpY2tldHMiLCJvbGRDb3VudCIsIm5ld0NvdW50IiwibWVzc2FnZSIsInByaW1hcnkiLCIkd2F0Y2hDb2xsZWN0aW9uIiwiJHdhdGNoIiwiQVBJX1VSTCIsIl9vbk1lc3NhZ2UiLCJkYXRhIiwiJGV2YWxBc3luYyIsImZvckVhY2giLCJpdGVtIiwidW5peCIsIkRhdGUiLCJwYXJzZSIsInVwZGF0ZWRBdCIsInRhc2siLCJpc05hTiIsInVybCIsImlkIiwib3B0aW9ucyIsIm9uTWVzc2FnZSIsInNsZWVwIiwiYWRkU291cmNlIiwidGFza3MiLCJwZW5kaW5nIiwiYmluZCIsInJlc3VsdHMiLCIkJHJlc3VsdHMiLCJwdXNoIiwic2VydmljZSIsIkFOR1VMQVJfTU9EVUxFIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztDQVNBLFNBQVVBLEVBQVFDLEdBQ2hCLFlBU0EsSUFBSUMsR0FBTyxTQUFTQyxHQUNsQkMsS0FBS0QsVUFBWUEsRUFFakJDLEtBQUtDLFNBQ0hGLEVBQVVHLElBQUksa0JBQ2RILEVBQVVHLElBQUksaUJBQ2RILEVBQVVHLElBQUksa0JBQ2RILEVBQVVHLElBQUksaUJBR2hCRixLQUFLRyxhQUFlLEtBQ3BCSCxLQUFLSSxZQUNMSixLQUFLSyxZQUNMTCxLQUFLTSxZQUNMTixLQUFLTyxVQUdQVCxHQUFLVSxTQUFXLGFBT2hCVixFQUFLVyxVQUFVQyxNQUFRLEtBR3ZCWixFQUFLVyxVQUFVRSxNQUFRLEtBR3ZCYixFQUFLVyxVQUFVRyxRQUFVLEtBYXpCZCxFQUFLVyxVQUFVSSxLQUFPLFdBQ3BCLEdBQUlmLEdBQU9FLEtBQUtELFVBQVVHLElBQUksUUFFMUJZLEVBQUtkLEtBQ0xlLEVBQWtCLFNBQVNDLEdBSTdCRixFQUFHVCxTQUFXVyxFQUFLQyxTQUduQkgsRUFBR0ksZUFDSEosRUFBR0ssYUFDSEwsRUFBR00sYUFJRU4sRUFBR08sV0FLUlAsRUFBR1EsZUFDSFIsRUFBR1MsYUFHSFQsRUFBR1UsZUFDSFYsRUFBR1csZUFD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R0FBWUMsVUFBV2QsRUFBWWUsTUFBTyxFQUM5QzVGLE1BQUtHLGFBQWU2QixFQUFJNkQsVUFBVUwsRUFBS0UsS0FXM0M1RixFQUFLVyxVQUFVYyxXQUFhLFdBQzFCLEdBQUlvQixHQUFXM0MsS0FBS0ssU0FBU3NDLFFBQzdCLElBQUtBLEVBQUwsQ0FJQSxHQUFJN0IsR0FBS2QsSUFDVEgsR0FBUW1GLFFBQVFyQyxFQUFTbUQsTUFBTSxTQUFTUixHQUN0Q3hFLEVBQUdQLE9BQU8rRSxFQUFLakMsTUFBUWlDLE1BWTNCeEYsRUFBS1csVUFBVWUsYUFBZSxXQUM1QixHQUFJdUUsR0FBVS9GLEtBQUtLLFNBQVMwRixPQUM1QixJQUFLQSxFQUFMLENBSUEsR0FBSWpGLEdBQUtkLElBQ1RILEdBQVFtRixRQUFRZSxFQUFRLFNBQVMxRCxHQUMvQnZCLEVBQUdSLFNBQVMrQixFQUFPaUQsS0FBS2pDLE1BQVFoQixNQVlwQ3ZDLEVBQUtXLFVBQVVnQixhQUFlLFdBQzVCLEdBQUlhLEdBQWF0QyxLQUFLc0MsV0FBVzBELEtBQUtoRyxNQUNsQ2lHLEVBQVVqRyxLQUFLSyxTQUFTNEYsV0FFNUJwRyxHQUFRbUYsUUFBUWlCLEVBQVMzRCxJQVczQnhDLEVBQUtXLFVBQVU2QixXQUFhLFNBQVNELEdBQ25DLEdBQUlpRCxHQUFPdEYsS0FBS29ELGNBQWNmLEVBQU9pRCxLQUFLakMsS0FDMUMsSUFBYSxPQUFUaUMsRUFBZSxDQUNqQixHQUFJMUQsR0FBVTBELEVBQUtZLFdBQWEsQ0FDaENaLEdBQUtZLFVBQVl0RSxFQUFVLEVBRzdCNUIsS0FBS0ksU0FBUytGLEtBQUs5RCxJQU1yQnhDLEVBQVFELE9BQU9BLEdBQVF3RyxRQUFRLE9BQVF0RyxJQUV0Q3VHLGVBQWdCeEciLCJmaWxlIjoiYXBwL3NlcnZpY2VzL3VzZXIubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyogZ2xvYmFsIEFOR1VMQVJfTU9EVUxFLCBhbmd1bGFyICovXG4oZnVuY3Rpb24obW9kdWxlLCBhbmd1bGFyKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICAvL1xuICAvLyBTRVJWSUNFXG4gIC8vXG5cbiAgLyoqXG4gICAqIEBjb25zdHJ1Y3RvclxuICAgKi9cbiAgdmFyIFVzZXIgPSBmdW5jdGlvbigkaW5qZWN0b3IpIHtcbiAgICB0aGlzLiRpbmplY3RvciA9ICRpbmplY3RvcjtcblxuICAgIHRoaXMuX3N0YXRlcyA9IFtcbiAgICAgICRpbmplY3Rvci5nZXQoJ1NUQVRFX0JFR0lOTkVSJyksXG4gICAgICAkaW5qZWN0b3IuZ2V0KCdTVEFURV9BTUFURVVSJyksXG4gICAgICAkaW5qZWN0b3IuZ2V0KCdTVEFURV9BRFZBTkNFRCcpLFxuICAgICAgJGluamVjdG9yLmdldCgnU1RBVEVfRVhQRVJUJylcbiAgICBdO1xuXG4gICAgdGhpcy5fZXZlbnRTb3VyY2UgPSBudWxsO1xuICAgIHRoaXMuX3Jlc3VsdHMgPSBbXTtcbiAgICB0aGlzLl9wYXlsb2FkID0ge307XG4gICAgdGhpcy5fcGVuZGluZyA9IHt9O1xuICAgIHRoaXMuX3Rhc2tzID0ge307XG4gIH07XG5cbiAgVXNlci4kaW5qZWN0ID0gWyckaW5qZWN0b3InXTtcblxuICAvL1xuICAvLyBQUk9QRVJUSUVTXG4gIC8vXG5cbiAgLyoqIEB2YXIge251bWJlcn0gc3RhdGUgQ3VycmVudCBzdGF0ZSBvZiB1c2VyLiAqL1xuICBVc2VyLnByb3RvdHlwZS5zdGF0ZSA9IG51bGw7XG5cbiAgLyoqIEB2YXIge251bWJlcn0gZ3JvdXAgUmFuZG9tIGdyb3VwIG9mIHVzZXIuICovXG4gIFVzZXIucHJvdG90eXBlLmdyb3VwID0gbnVsbDtcblxuICAvKiogQHZhciB7bnVtYmVyfSB0aWNrZXRzIEN1cnJlbnQgdGlja2V0IGNvdW50LiAqL1xuICBVc2VyLnByb3RvdHlwZS50aWNrZXRzID0gbnVsbDtcblxuICAvL1xuICAvLyBNRVRIT0RTXG4gIC8vXG5cbiAgLyoqXG4gICAqIEZldGNoZXMgY3VycmVudCB1c2VyIHRocm91Z2ggYFVzZXJgIHJlc291cmNlLlxuICAgKlxuICAgKiBAcHVibGljXG4gICAqIEBtZXRob2QgbG9hZFxuICAgKiBAcmV0dXJuIHt2b2lkfVxuICAgKi9cbiAgVXNlci5wcm90b3R5cGUubG9hZCA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBVc2VyID0gdGhpcy4kaW5qZWN0b3IuZ2V0KCdVc2VyJyk7XG5cbiAgICB2YXIgbWUgPSB0aGlzO1xuICAgIHZhciBzdWNjZXNzQ2FsbGJhY2sgPSBmdW5jdGlvbih1c2VyKSB7XG5cbiAgICAgIC8vIHNhdmUgb25seSBqc29uIHBheWxvYWQgZnJvbVxuICAgICAgLy8gbmctcmVzb3VyY2UncyBgdXNlcmAgb2JqZWN0XG4gICAgICBtZS5fcGF5bG9hZCA9IHVzZXIudG9KU09OKCk7XG5cbiAgICAgIC8vIGluaXRpYWxpemUgbWVtYmVyc1xuICAgICAgbWUuX2luaXRUaWNrZXRzKCk7XG4gICAgICBtZS5faW5pdFN0YXRlKCk7XG4gICAgICBtZS5faW5pdEdyb3VwKCk7XG5cbiAgICAgIC8vIGdhbWVwbGF5IHNldHVwIGNhbGxzXG4gICAgICAvLyBvbmx5IGZvciBgUk9MRV9VU0VSYCFcbiAgICAgIGlmICghbWUuaXNVc2VyKCkpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICAvLyBpbml0IHRhc2tzIGF0IGZpcnN0IVxuICAgICAgbWUuX2luaXRXYXRjaGVzKCk7XG4gICAgICBtZS5faW5pdFRhc2tzKCk7XG5cbiAgICAgIC8vIHRoZW4gcmVzdWx0cyAmIFNTRSFcbiAgICAgIG1lLl9pbml0UGVuZGluZygpO1xuICAgICAgbWUuX2luaXRSZXN1bHRzKCk7XG4gICAgICBtZS5faW5pdFNTRSgpO1xuICAgIH07XG5cbiAgICB2YXIgZmFpbHVyZUNhbGxiYWNrID0gZnVuY3Rpb24oKSB7XG4gICAgICAvLyBub29wXG4gICAgfTtcblxuICAgIHZhciBjdXJyZW50ID0gVXNlci5jdXJyZW50KCk7XG5cbiAgICBjdXJyZW50LiRwcm9taXNlLnRoZW4oXG4gICAgICBzdWNjZXNzQ2FsbGJhY2ssXG4gICAgICBmYWlsdXJlQ2FsbGJhY2tcbiAgICApO1xuXG4gICAgcmV0dXJuIGN1cnJlbnQ7XG4gIH07XG5cbiAgLyoqXG4gICAqIFJlc2V0cyBjdXJyZW50IHVzZXIgc2Vzc2lvbiBmcm9tIGFwcGxpY2F0aW9uLlxuICAgKlxuICAgKiBAcHVibGljXG4gICAqIEBtZXRob2QgcmVzZXRcbiAgICogQHJldHVybiB7dm9pZH1cbiAgICovXG4gIFVzZXIucHJvdG90eXBlLnVubG9hZCA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBzc2UgPSB0aGlzLiRpbmplY3Rvci5nZXQoJ3NzZScpO1xuXG4gICAgaWYgKHRoaXMuX2V2ZW50U291cmNlKSB7XG4gICAgICBzc2UucmVtb3ZlU291cmNlKHRoaXMuX2V2ZW50U291cmNlKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5fdW53YXRjaFRpY2tldHMpIHtcbiAgICAgIHRoaXMuX3Vud2F0Y2hUaWNrZXRzKCk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuX3Vud2F0Y2hTdGF0ZSkge1xuICAgICAgdGhpcy5fdW53YXRjaFN0YXRlKCk7XG4gICAgfVxuXG4gICAgdGhpcy5fZXZlbnRTb3VyY2UgPSBudWxsO1xuICAgIHRoaXMuX3Jlc3VsdHMgPSBbXTtcbiAgICB0aGlzLl9wYXlsb2FkID0ge307XG4gICAgdGhpcy5fcGVuZGluZyA9IHt9O1xuICAgIHRoaXMuX3Rhc2tzID0ge307XG5cbiAgICB0aGlzLnRpY2tldHMgPSBudWxsO1xuICAgIHRoaXMuc3RhdGUgPSBudWxsO1xuICAgIHRoaXMuZ3JvdXAgPSBudWxsO1xuICB9O1xuXG4gIC8qKlxuICAgKiBVcGRhdGVzIHVzZXIgZnJvbSBleHRlcm5hbCBzY29wZXMuXG4gICAqIFRoaXMgaXMgaGVscGZ1bCBmb3IgcmVmcmVzaGluZyBpdHNcbiAgICogc3RhdGUgd2l0aG91dCBpbnZva2luZyBhIHJlcXVlc3QgdG9cbiAgICogdGhlIHNlcnZlciB3aGVuIHVzZXIgd2FzIGVtYmVkZGVkIGluXG4gICAqIGFub3RoZXIgcmVxdWVzdCdzIHJlc3BvbnNlLlxuICAgKlxuICAgKiBAcHVibGljXG4gICAqIEBtZXRob2QgdXBkYXRlXG4gICAqIEBwYXJhbSB7b2JqZWN0fSByZXN1bHRcbiAgICogQHJldHVybiB7dm9pZH1cbiAgICpcbiAgICovXG4gIFVzZXIucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uKHJlc3VsdCkge1xuICAgIHRoaXMuX3BheWxvYWQgPSByZXN1bHQudXNlcjtcblxuICAgIHRoaXMuX2FkZFJlc3VsdChyZXN1bHQpO1xuICAgIHRoaXMuX2luaXRUaWNrZXRzKCk7XG4gICAgdGhpcy5faW5pdFN0YXRlKCk7XG4gICAgdGhpcy5faW5pdEdyb3VwKCk7XG4gIH07XG5cbiAgLyoqXG4gICAqIENoZWNrcyBpZiBjdXJyZW50IHVzZXIgaGFzIHJvbGUgYFJPTEVfVVNFUmAuXG4gICAqXG4gICAqIEBwdWJsaWNcbiAgICogQG1ldGhvZCBpc1VzZXJcbiAgICogQHJldHVybiB7Ym9vbGVhbn1cbiAgICovXG4gIFVzZXIucHJvdG90eXBlLmlzVXNlciA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLmhhc1JvbGUoJ1JPTEVfVVNFUicpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBDaGVja3MgaWYgY3VycmVudCB1c2VyIGhhcyByb2xlIGBST0xFX0FETUlOYC5cbiAgICpcbiAgICogQHB1YmxpY1xuICAgKiBAbWV0aG9kIGlzQWRtaW5cbiAgICogQHJldHVybiB7Ym9vbGVhbn1cbiAgICovXG4gIFVzZXIucHJvdG90eXBlLmlzQWRtaW4gPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5oYXNSb2xlKCdST0xFX0FETUlOJyk7XG4gIH07XG5cbiAgLyoqXG4gICAqIENoZWNrcyBpZiBjdXJyZW50IHVzZXIgaGFzIHJvbGUgYFJPTEVfU1VQRVJfQURNSU5gLlxuICAgKlxuICAgKiBAcHVibGljXG4gICAqIEBtZXRob2QgaXNTdXBlckFkbWluXG4gICAqIEByZXR1cm4ge2Jvb2xlYW59XG4gICAqL1xuICBVc2VyLnByb3RvdHlwZS5pc1N1cGVyQWRtaW4gPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5oYXNSb2xlKCdST0xFX1NVUEVSX0FETUlOJyk7XG4gIH07XG5cbiAgLyoqXG4gICAqIENoZWNrcyBpZiBjdXJyZW50IHVzZXIncyB3b3Jrc2hvcCBpcyBhY3RpdmUuXG4gICAqXG4gICAqIEBwdWJsaWNcbiAgICogQG1ldGhvZCBpc0luV29ya3Nob3BcbiAgICogQHJldHVybiB7Ym9vbGVhbn1cbiAgICovXG4gIFVzZXIucHJvdG90eXBlLmlzSW5Xb3Jrc2hvcCA9IGZ1bmN0aW9uKCkge1xuICAgIGlmICghdGhpcy5pc1VzZXIoKSkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMuX3BheWxvYWQud29ya3Nob3AuaXNBY3RpdmU7XG4gIH07XG5cbiAgLyoqXG4gICAqIENoZWNrcyBpZiBjdXJyZW50IHVzZXIgaGFzIGdpdmVuIHJvbGUuXG4gICAqXG4gICAqIEBwdWJsaWNcbiAgICogQG1ldGhvZCBoYXNSb2xlXG4gICAqIEBwYXJhbSB7c3RyaW5nfGFycmF5fSByb2xlXG4gICAqIEByZXR1cm4ge2Jvb2xlYW59XG4gICAqL1xuICBVc2VyLnByb3RvdHlwZS5oYXNSb2xlID0gZnVuY3Rpb24ocm9sZSkge1xuICAgIGlmICghYW5ndWxhci5pc0FycmF5KHJvbGUpKSB7XG4gICAgICByb2xlID0gW3JvbGVdO1xuICAgIH1cblxuICAgIHZhciByb2xlcyA9IHRoaXMuX3BheWxvYWQucm9sZXMgfHzCoFtdO1xuICAgIGZvciAodmFyIGk9MDsgaTxyb2xlLmxlbmd0aDsgaSsrKSB7XG4gICAgICBpZiAocm9sZXMuaW5kZXhPZihyb2xlW2ldKT49MCkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gZmFsc2U7XG4gIH07XG5cbiAgLyoqXG4gICAqIFByb3ZpZGVzIHVzZXIncyB0YXNrIGhhc2ggbWFwLlxuICAgKlxuICAgKiBAcHVibGljXG4gICAqIEBtZXRob2QgZ2V0VGFza3NcbiAgICogQHJldHVybiB7b2JqZWN0fVxuICAgKi9cbiAgVXNlci5wcm90b3R5cGUuZ2V0VGFza3MgPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5fdGFza3M7XG4gIH07XG5cbiAgLyoqXG4gICAqIEdldHMgYHRhc2tgIHJlc291cmNlIG9mIHVzZXIgYnkgdHlwZS5cbiAgICpcbiAgICogQHB1YmxpY1xuICAgKiBAbWV0aG9kIGdldFRhc2tCeVR5cGVcbiAgICogQHBhcmFtIHtzdHJpbmd9IHR5cGVcbiAgICogQHJldHVybiB7b2JqZWN0fG51bGx9XG4gICAqL1xuICBVc2VyLnByb3RvdHlwZS5nZXRUYXNrQnlUeXBlID0gZnVuY3Rpb24odHlwZSkge1xuICAgIHJldHVybiB0aGlzLl90YXNrc1t0eXBlXSB8fMKgbnVsbDtcbiAgfTtcblxuICAvKipcbiAgICogR2V0cyBwZW5kaW5nIGByZXN1bHRgIHJlc291cmNlIG9mIHVzZXIgYnkgdHlwZS5cbiAgICpcbiAgICogQHB1YmxpY1xuICAgKiBAbWV0aG9kIGdldFJlc3VsdEJ5VHlwZVxuICAgKiBAcGFyYW0ge3N0cmluZ30gdHlwZVxuICAgKiBAcmV0dXJuIHtvYmplY3R8bnVsbH1cbiAgICovXG4gIFVzZXIucHJvdG90eXBlLmdldFBlbmRpbmdCeVR5cGUgPSBmdW5jdGlvbih0eXBlKSB7XG4gICAgcmV0dXJuIHRoaXMuX3BlbmRpbmdbdHlwZV0gfHzCoG51bGw7XG4gIH07XG5cbiAgLyoqXG4gICAqIEdldHMgYHN0YXRlYCBtYXBwZWQgdG8gc3RyaW5nIHJlcHJlc2VudGF0aW9uLlxuICAgKlxuICAgKiBAcHVibGljXG4gICAqIEBtZXRob2QgZ2V0R3JvdXBBc1N0cmluZ1xuICAgKiBAcmV0dXJuIHtzdHJpbmd9XG4gICAqL1xuICBVc2VyLnByb3RvdHlwZS5nZXRHcm91cEFzU3RyaW5nID0gZnVuY3Rpb24oKSB7XG4gICAgc3dpdGNoKHRoaXMuZ3JvdXApIHtcbiAgICAgIGNhc2UgdGhpcy4kaW5qZWN0b3IuZ2V0KCdHUk9VUF9BJyk6XG4gICAgICAgIHJldHVybiAnR1JPVVBfQSc7XG4gICAgICBjYXNlIHRoaXMuJGluamVjdG9yLmdldCgnR1JPVVBfQicpOlxuICAgICAgICByZXR1cm4gJ0dST1VQX0InO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICB9O1xuXG4gIC8qKlxuICAgKiBHZXRzIGBzdGF0ZWAgbWFwcGVkIHRvIHN0cmluZyByZXByZXNlbnRhdGlvbi5cbiAgICpcbiAgICogQHB1YmxpY1xuICAgKiBAbWV0aG9kIGdldFN0YXRlQXNTdHJpbmdcbiAgICogQHJldHVybiB7c3RyaW5nfVxuICAgKi9cbiAgVXNlci5wcm90b3R5cGUuZ2V0U3RhdGVBc1N0cmluZyA9IGZ1bmN0aW9uKCkge1xuICAgIHN3aXRjaCh0aGlzLnN0YXRlKSB7XG4gICAgICBjYXNlIHRoaXMuJGluamVjdG9yLmdldCgnU1RBVEVfQU1BVEVVUicpOlxuICAgICAgICByZXR1cm4gJ1NUQVRFX0FNQVRFVVInO1xuICAgICAgY2FzZSB0aGlzLiRpbmplY3Rvci5nZXQoJ1NUQVRFX0FEVkFOQ0VEJyk6XG4gICAgICAgIHJldHVybiAnU1RBVEVfQURWQU5DRUQnO1xuICAgICAgY2FzZSB0aGlzLiRpbmplY3Rvci5nZXQoJ1NUQVRFX0VYUEVSVCcpOlxuICAgICAgICByZXR1cm4gJ1NUQVRFX0VYUEVSVCc7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICByZXR1cm4gJ1NUQVRFX0JFR0lOTkVSJztcbiAgICB9XG4gIH07XG5cbiAgLyoqXG4gICAqIEluaXRpYWxpemVzIGBzdGF0ZWAgbWVtYmVyLlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAbWV0aG9kIF9pbml0U3RhdGVcbiAgICogQHJldHVybiB7dm9pZH1cbiAgICovXG4gIFVzZXIucHJvdG90eXBlLl9pbml0U3RhdGUgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgU1RBVEVfQkVHSU5ORVIgPSB0aGlzLiRpbmplY3Rvci5nZXQoJ1NUQVRFX0JFR0lOTkVSJyk7XG4gICAgdGhpcy5zdGF0ZSA9IHRoaXMuX3BheWxvYWQuc3RhdGUgfHzCoFNUQVRFX0JFR0lOTkVSO1xuICB9O1xuXG4gIC8qKlxuICAgKiBJbml0aWFsaXplcyBgZ3JvdXBgIG1lbWJlci5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICogQG1ldGhvZCBfaW5pdEdyb3VwXG4gICAqIEByZXR1cm4ge3ZvaWR9XG4gICAqL1xuICBVc2VyLnByb3RvdHlwZS5faW5pdEdyb3VwID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5ncm91cCA9IHRoaXMuX3BheWxvYWQuZ3JvdXAgfHzCoG51bGw7XG4gIH07XG5cbiAgLyoqXG4gICAqIEluaXRpYWxpemVzIGB0aWNrZXRzYCBtZW1iZXIuXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqIEBtZXRob2QgaW5pdFxuICAgKiBAcmV0dXJuIHt2b2lkfVxuICAgKi9cbiAgVXNlci5wcm90b3R5cGUuX2luaXRUaWNrZXRzID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIHRpY2tldHMgPSB0aGlzLl9wYXlsb2FkLnRpY2tldHM7XG4gICAgdGhpcy50aWNrZXRzID0gdGlja2V0cyB8fMKgW107XG4gIH07XG5cbiAgLyoqXG4gICAqIFdhdGNoZXMgYHN0YXRlYCBhbmQgYHRpY2tldHNgIGZvciBjaGFuZ2VzIHRvXG4gICAqIHNob3cgdGhlIGNvcnJlc3BvbmRpbmcgdXNlciBub3RpZmljYXRpb25zLlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAbWV0aG9kIF9pbml0V2F0Y2hlc1xuICAgKiBAcmV0dXJuIHt2b2lkfVxuICAgKi9cbiAgVXNlci5wcm90b3R5cGUuX2luaXRXYXRjaGVzID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIG5vdGlmaWNhdGlvbiA9IHRoaXMuJGluamVjdG9yLmdldCgnbm90aWZpY2F0aW9uJyk7XG4gICAgdmFyICRyb290U2NvcGUgPSB0aGlzLiRpbmplY3Rvci5nZXQoJyRyb290U2NvcGUnKTtcbiAgICB2YXIgaTE4biA9IHRoaXMuJGluamVjdG9yLmdldCgnaTE4bicpO1xuICAgIHZhciBtZSA9IHRoaXM7XG5cbiAgICB2YXIgX3dhdGNoU3RhdGVFeHByZXNzaW9uID0gZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gbWUuc3RhdGU7XG4gICAgfTtcblxuICAgIHZhciBfd2F0Y2hTdGF0ZUNhbGxiYWNrID0gZnVuY3Rpb24obmV3U3RhdGUsIG9sZFN0YXRlKSB7XG4gICAgICBpZiAobmV3U3RhdGUgPT09IG9sZFN0YXRlKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgbm90aWZpY2F0aW9uLnN1Y2Nlc3MoXG4gICAgICAgIGkxOG4uZ2V0KFxuICAgICAgICAgICdDb25ncmF0dWxhdGlvbnMsIHlvdSBoYXZlIHJlYWNoZWQgdGhlIHN0YXRlICVzIScsXG4gICAgICAgICAgaTE4bi5nZXQobWUuZ2V0U3RhdGVBc1N0cmluZygpKVxuICAgICAgICApXG4gICAgICApO1xuICAgIH07XG5cbiAgICB2YXIgX3dhdGNoVGlja2V0c0V4cHJlc3Npb24gPSBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiBtZS50aWNrZXRzO1xuICAgIH07XG5cbiAgICB2YXIgX3dhdGNoVGlja2V0c0NhbGxiYWNrID0gZnVuY3Rpb24obmV3VGlja2V0cywgb2xkVGlja2V0cykge1xuICAgICAgaWYgKG5ld1RpY2tldHMgPT09IG9sZFRpY2tldHMpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICB2YXIgb2xkQ291bnQgPSBvbGRUaWNrZXRzICYmIG9sZFRpY2tldHMubGVuZ3RoO1xuICAgICAgdmFyIG5ld0NvdW50ID0gbmV3VGlja2V0cyAmJiBuZXdUaWNrZXRzLmxlbmd0aDtcblxuICAgICAgdmFyIHRpY2tldHMgPSBuZXdDb3VudCAtIG9sZENvdW50O1xuICAgICAgaWYgKHRpY2tldHMgPCAwKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgdmFyIG1lc3NhZ2UgPSB0aWNrZXRzID09PSAxID9cbiAgICAgICAgaTE4bi5nZXQoJ0NvbmdyYXR1bGF0aW9ucywgeW91IGhhdmUgZWFybmVkIDEgbmV3IHRpY2tldCEnKSA6XG4gICAgICAgIGkxOG4uZ2V0KCdDb25ncmF0dWxhdGlvbnMsIHlvdSBoYXZlIGVhcm5lZCAlcyBuZXcgdGlja2V0cyEnLCB0aWNrZXRzKTtcblxuICAgICAgbm90aWZpY2F0aW9uLnByaW1hcnkobWVzc2FnZSk7XG4gICAgfTtcblxuICAgIHRoaXMuX3Vud2F0Y2hUaWNrZXRzID0gJHJvb3RTY29wZS4kd2F0Y2hDb2xsZWN0aW9uKFxuICAgICAgX3dhdGNoVGlja2V0c0V4cHJlc3Npb24sXG4gICAgICBfd2F0Y2hUaWNrZXRzQ2FsbGJhY2tcbiAgICApO1xuXG4gICAgdGhpcy5fdW53YXRjaFN0YXRlID0gJHJvb3RTY29wZS4kd2F0Y2goXG4gICAgICBfd2F0Y2hTdGF0ZUV4cHJlc3Npb24sXG4gICAgICBfd2F0Y2hTdGF0ZUNhbGxiYWNrXG4gICAgKTtcbiAgfTtcblxuXG4gIC8qKlxuICAgKiBEZXN0cm95cyB1c2VyIHNlc3Npb24gYW5kIHJlZGlyZWN0cyB0byBsb2dpbi5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICogQG1ldGhvZCBfaW5pdFNTRVxuICAgKiBAcmV0dXJuIHtWb2lkfVxuICAgKi9cbiAgVXNlci5wcm90b3R5cGUuX2luaXRTU0UgPSBmdW5jdGlvbigpXG4gICAge1xuICAgICAgdmFyICRyb290U2NvcGUgPSB0aGlzLiRpbmplY3Rvci5nZXQoJyRyb290U2NvcGUnKTtcbiAgICAgIHZhciBBUElfVVJMID0gdGhpcy4kaW5qZWN0b3IuZ2V0KCdBUElfVVJMJyk7XG4gICAgICB2YXIgc3NlID0gdGhpcy4kaW5qZWN0b3IuZ2V0KCdzc2UnKTtcblxuICAgICAgLy8gZG9uJ3Qgc2V0dXAgU1NFIHdoZW4gcGxheWluZyByZW1vdGVcbiAgICAgIHZhciB3b3Jrc2hvcCA9IHRoaXMuX3BheWxvYWQud29ya3Nob3A7XG4gICAgICBpZiAoIXdvcmtzaG9wLmlzQWN0aXZlKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgdmFyIG1lID0gdGhpcztcblxuICAgICAgdmFyIF9vbk1lc3NhZ2UgPSBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICRyb290U2NvcGUuJGV2YWxBc3luYyhmdW5jdGlvbigpe1xuICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaChkYXRhLCBmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgICB2YXIgdW5peCA9IERhdGUucGFyc2UoaXRlbS51cGRhdGVkQXQpO1xuICAgICAgICAgICAgdmFyIHRhc2sgPSBtZS5fdGFza3NbaXRlbS50eXBlXTtcbiAgICAgICAgICAgIHRhc2suaXNBY3RpdmUgPSAhIWl0ZW0uaXNBY3RpdmU7XG5cbiAgICAgICAgICAgIGlmICghaXNOYU4odW5peCkpIHtcbiAgICAgICAgICAgICAgaXRlbS51cGRhdGVkQXQgPSB1bml4O1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH07XG5cbiAgICAgIHZhciB1cmwgPSBBUElfVVJMICsgJy9zc2Uvd29ya3Nob3AvJyArIHdvcmtzaG9wLmlkICsgJy90YXNrcyc7XG4gICAgICB2YXIgb3B0aW9ucyA9IHsgb25NZXNzYWdlOiBfb25NZXNzYWdlLCBzbGVlcDogMSB9O1xuICAgICAgdGhpcy5fZXZlbnRTb3VyY2UgPSBzc2UuYWRkU291cmNlKHVybCwgb3B0aW9ucyk7XG4gICAgfTtcblxuICAvKipcbiAgICogQ2FjaGVzIHRhc2sgaGFzaCBtYXAgZnJvbSB3b3Jrc2hvcFxuICAgKiBmb3IgbG9va3VwcyBmcm9tIGBnZXRUYXNrQnlUeXBlKClgLlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAbWV0aG9kIF9pbml0VGFza3NcbiAgICogQHJldHVybiB7dm9pZH1cbiAgICovXG4gIFVzZXIucHJvdG90eXBlLl9pbml0VGFza3MgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgd29ya3Nob3AgPSB0aGlzLl9wYXlsb2FkLndvcmtzaG9wO1xuICAgIGlmICghd29ya3Nob3ApIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB2YXIgbWUgPSB0aGlzO1xuICAgIGFuZ3VsYXIuZm9yRWFjaCh3b3Jrc2hvcC50YXNrcyxmdW5jdGlvbih0YXNrKSB7XG4gICAgICBtZS5fdGFza3NbdGFzay50eXBlXSA9IHRhc2s7XG4gICAgfSk7XG4gIH07XG5cbiAgLyoqXG4gICAqIENhY2hlcyBwZW5kaW5nIGhhc2ggbWFwIGZyb20gd29ya3Nob3BcbiAgICogZm9yIGxvb2t1cHMgZnJvbSBgZ2V0UGVuZGluZ0J5VHlwZSgpYC5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICogQG1ldGhvZCBfaW5pdFBlbmRpbmdcbiAgICogQHJldHVybiB7dm9pZH1cbiAgICovXG4gIFVzZXIucHJvdG90eXBlLl9pbml0UGVuZGluZyA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBwZW5kaW5nID0gdGhpcy5fcGF5bG9hZC5wZW5kaW5nO1xuICAgIGlmICghcGVuZGluZykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHZhciBtZSA9IHRoaXM7XG4gICAgYW5ndWxhci5mb3JFYWNoKHBlbmRpbmcsZnVuY3Rpb24ocmVzdWx0KSB7XG4gICAgICBtZS5fcGVuZGluZ1tyZXN1bHQudGFzay50eXBlXSA9IHJlc3VsdDtcbiAgICB9KTtcbiAgfTtcblxuICAvKipcbiAgICogQ2FjaGVzIHJlc3VsdHMgaGFzaCBtYXAgZnJvbSB3b3Jrc2hvcFxuICAgKiBmb3IgbG9va3VwcyBmcm9tIGBnZXRSZXN1bHRzQnlUeXBlKClgLlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAbWV0aG9kIF9pbml0UmVzdWx0c1xuICAgKiBAcmV0dXJuIHt2b2lkfVxuICAgKi9cbiAgVXNlci5wcm90b3R5cGUuX2luaXRSZXN1bHRzID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIF9hZGRSZXN1bHQgPSB0aGlzLl9hZGRSZXN1bHQuYmluZCh0aGlzKTtcbiAgICB2YXIgcmVzdWx0cyA9IHRoaXMuX3BheWxvYWQucmVzdWx0cyB8fCBbXTtcblxuICAgIGFuZ3VsYXIuZm9yRWFjaChyZXN1bHRzLCBfYWRkUmVzdWx0KTtcbiAgfTtcblxuICAvKipcbiAgICogQWRkcyByZXN1bHQgdG8gY29sbGVjdGlvbiBhbmQgc2V0cyBgJCRyZXN1bHRgXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqIEBtZXRob2QgX2FkZFJlc3VsdFxuICAgKiBAcGFyYW0ge29iamVjdH0gcmVzdWx0XG4gICAqIEByZXR1cm4ge3ZvaWR9XG4gICAqL1xuICBVc2VyLnByb3RvdHlwZS5fYWRkUmVzdWx0ID0gZnVuY3Rpb24ocmVzdWx0KSB7XG4gICAgdmFyIHRhc2sgPSB0aGlzLmdldFRhc2tCeVR5cGUocmVzdWx0LnRhc2sudHlwZSk7XG4gICAgaWYgKHRhc2sgIT09IG51bGwpIHtcbiAgICAgIHZhciBjdXJyZW50ID0gdGFzay4kJHJlc3VsdHMgfHzCoDA7XG4gICAgICB0YXNrLiQkcmVzdWx0cyA9IGN1cnJlbnQgKyAxO1xuICAgIH1cblxuICAgIHRoaXMuX3Jlc3VsdHMucHVzaChyZXN1bHQpO1xuICB9O1xuXG4gIC8vXG4gIC8vIFJFR0lTVFJZXG4gIC8vXG4gIGFuZ3VsYXIubW9kdWxlKG1vZHVsZSkuc2VydmljZSgndXNlcicsIFVzZXIpO1xuXG59KShBTkdVTEFSX01PRFVMRSwgYW5ndWxhcik7XG4iXX0=
