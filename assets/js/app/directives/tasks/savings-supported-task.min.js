/*!
 * eFit Website
 * An app for financial training in educational environments
 * http://www.e-fit.com
 * @author Armin Pfurtscheller
 * @version 1.0.0
 * Copyright 2017. MIT licensed.
 */
/* global ANGULAR_MODULE, angular, Scratchcard */
(function(module, angular) {
  'use strict';

  // --------------------------------------------------
  // SavingsSupportedTask
  // --------------------------------------------------

  //
  // CONTROLLER
  //

  /**
   * @constructor
   */
  var SavingsSupportedTask = function($scope, $element, $attrs, $injector) {
    var type = $injector.get('TYPE_SAVINGS_SUPPORTED');
    var user = $injector.get('user');

    this.$scope = $scope;
    this.$attrs = $attrs;
    this.$element = $element;
    this.$injector = $injector;

    this.task = user.getTaskByType(type);
    this.result = user.getPendingByType(type);
  };

  SavingsSupportedTask.$inject = ['$scope', '$element', '$attrs', '$injector'];

  //
  // PROPERTIES
  //

  // SERVER

  /** @var {object} task Task's resource from server. */
  SavingsSupportedTask.prototype.task = null;

  /** @var {object} result Task's pending result from server. */
  SavingsSupportedTask.prototype.result = null;

  // GAMEPLAY

  /** @var {boolean} resolved If player has resolved the game. */
  SavingsSupportedTask.prototype.resolved = false;

  // SETTINGS

  /** @var {number} amount Amount of total cards. */
  SavingsSupportedTask.prototype.total = 3;

  /** @var {array} cards Dummy collection of cards. */
  SavingsSupportedTask.prototype.cards = [];

  /** @var {number} count Number of revealed cards. */
  SavingsSupportedTask.prototype.count = 0;

  //
  // METHODS
  //

  /**
   * Proxies to `init()` if controller's ready.
   *
   * @public
   * @method $onInit
   * @return {Void}
   */
  SavingsSupportedTask.prototype.$onInit = function() {
    this.init();
  };

  /**
   * Retrieves result payload for server.
   *
   * @public
   * @method getPayload
   * @return {Void}
   */
  SavingsSupportedTask.prototype.getPayload = function() {
    var payload = {
      task: this.task,
      json: {
        count: this.count,
        total: this.total
      },
      isPending: this.count !== this.total
    };

    if (this.result !== null) {
      payload = angular.extend(
        this.result,
        payload
      );
    }

    return payload;
  };

  /**
   * Whether or not task is currently locked.
   *
   * @public
   * @method isLocked
   * @return {boolean}
   */
  SavingsSupportedTask.prototype.isLocked = function() {
    if (this.task === null) {
      return true;
    }

    return !this.task.isActive;
  };

  /**
   * Whether or not task can be sent to server.
   *
   * @public
   * @method canResolve
   * @return {boolean}
   */
  SavingsSupportedTask.prototype.canResolve = function() {
    var user = this.$injector.get('user');
    if (!user.isUser()) {
      return false;
    }

    if (this.isLocked()) {
      return false;
    }

    if (this.resolved) {
      return false;
    }

    return true;
  };

  /**
   * Sets up initial state.
   *
   * @public
   * @method init
   * @return {Void}
   */
  SavingsSupportedTask.prototype.init = function() {
    // try to initialize from pending result
    if (this.result !== null) {
      this.count = this.result.json.count;
    }

    this.cards = [];
    for (var i=1; i<=this.total; i++) {
      this.cards.push({
        complete: i <= this.count,
        number: i
      });
    }

    this.resolved = false;
  };

  /**
   * Resets initial state.
   *
   * @public
   * @method reset
   * @return {Void}
   */
  SavingsSupportedTask.prototype.reset = function(){
    this.resolved = false;
    this.result = null;
    this.count = 0;
    this.init();
  };

  /**
   * Increases `count` and invokes `resolve()`.
   *
   * @public
   * @method update
   * @param {object} card
   * @return {Void}
   */
  SavingsSupportedTask.prototype.update = function(card){
    var notification = this.$injector.get('notification');
    var i18n = this.$injector.get('i18n');

    // check for sequential resolving of cards
    var nextWeek = this.count + 1;
    if (card.number !== nextWeek) {
      var message = i18n.get("Please reveal week %s next!", nextWeek);
      notification.warning(message);
      card.complete = false;
      return;
    }

    // check if 1 week pasted since last result
    /*if (this.result !== null) {
      var updatedAt = new Date(this.result.updatedAt * 1000);
      var minDate = new Date(updatedAt.getTime());
      minDate.setDate(minDate.getDate()+7);

      var curTime = (new Date()).getTime();
      var minTime = minDate.getTime();

      if (curTime < minTime) {
        var message = i18n.get("Doesn't seem a week already elapsed!");
        notification.warning(message);
        card.complete = false;
        return;
      }
    }*/

    // check if resolve is possible
    if (!this.canResolve()) {
      return;
    }

    // now publish the change
    var me = this;
    var successCallback = function(){};
    var failureCallback = function(){
      card.complete = false;
      me.count--;
    };

    this.count = nextWeek;
    this.resolve().then(
      successCallback,
      failureCallback
    );
  };

  /**
   * Sets `resolved` flag. Calls `onResolve`
   * callback with JSON result for consumer.
   *
   * @public
   * @method resolve
   * @return {Void}
   */
  SavingsSupportedTask.prototype.resolve = function(){
    var notification = this.$injector.get('notification');
    var i18n = this.$injector.get('i18n');
    var $q = this.$injector.get('$q');

    var callback = this.result === null ?
      this.onResolve :
      this.onUpdate;

    var result = callback({
      payload: this.getPayload()
    });

    var me = this;
    var successCallback = function(result) {
      if (result.isPending) {
        var message = i18n.get('Super, keep it up!');
        notification.success(message);
        me.result = result;
        return;
      }

      me.resolved = true;
    };

    var failureCallback = function() {
    };

    var promise = $q.when(result).then(
      successCallback,
      failureCallback
    );

    return promise;
  };

  //
  // REGISTRY
  //
  angular.module(module).directive('savingsSupportedTask', function(){
    return {
      scope: {
        amount: '=?savingsSupportedTaskAmount',
        onUpdate: '&savingsSupportedTaskOnUpdate',
        onResolve: '&savingsSupportedTaskOnResolve'
      },
      restrict: 'A',
      transclude: true,
      controller: SavingsSupportedTask,
      bindToController: true,
      controllerAs: 'savingsSupportedTaskController',
      templateUrl: 'views/directives/tasks/savings-supported-task.html'
    };
  });

  // --------------------------------------------------
  // SavingsSupportedTask Card
  // --------------------------------------------------

  //
  // CONTROLLER
  //

  /**
   * @constructor
   */
  var SavingsSupportedTaskCard = function($scope,$element,$attrs, $injector) {
    this.$element = $element;
    this.$scope = $scope;
    this.$attrs = $attrs;

    this.$injector = $injector;

    this._scratchCard = null;
  };

  SavingsSupportedTaskCard.$inject = ['$scope','$element','$attrs', '$injector'];

  //
  // PROPERTIES
  //

  /** @var {boolean} complete If card has been revelead. */
  SavingsSupportedTaskCard.prototype.complete = false;

  /** @var {number} thickness Thickness of rubber in pixel. */
  SavingsSupportedTaskCard.prototype.thickness = 20;

  /** @var {number} treshold Treshold level when card revels. */
  SavingsSupportedTaskCard.prototype.threshold = 0.25;

  /** @var {string} color Color of card overlay. */
  SavingsSupportedTaskCard.prototype.color = '#e5e5e5';

  //
  // METHODS
  //

  /**
   * Initializes element with `Scratchcard` library.
   *
   * @public
   * @method $onInit
   * @return {Void}
   */
  SavingsSupportedTaskCard.prototype.$onInit = function() {
    this._scratchCard = new Scratchcard(
      this.$element.get(0),
      {
        painter: new Scratchcard.Painter({
          thickness: this.thickness,
          color: this.color
        })
      }
    );

    var me = this;
    this._unwatch = this.$scope.$watch(
      function() {
        return me.card.complete;
      },
      function(isComplete) {
        if (isComplete) {
          me._scratchCard.complete();
        } else {
          me._scratchCard.reset();
        }
      }
    );

    this._listener = this._onProgress.bind(this);
    this._scratchCard.addListener('progress', this._listener);
  };

  /**
   * Removes listeners and watches from directive.
   *
   * @public
   * @method $onDestroy
   * @return {Void}
   */
  SavingsSupportedTaskCard.prototype.$onDestroy = function() {
    this._scratchCard.removeListener('progress', this._listener);
    this._scratchCard = null;
    this._unwatch();
  };

  /**
   * Checks progress' treshold has been exceeded, but is still
   * below 100%. In this case, the card will be revelead and
   * the `onComplete` callback can be invoked.
   *
   * @public
   * @method _onProgress
   * @return {Void}
   */
  SavingsSupportedTaskCard.prototype._onProgress = function(progress) {
    var $timeout = this.$injector.get('$timeout');

    var me = this;
    var onProgress = function() {
      if (progress>me.threshold &&Â progress<1) {
        // call with $timeout() cause consumer
        // could also change `complete` flag!
        me.card.complete = true;
        $timeout(me.onComplete);
      }
    };

    this.$scope.$evalAsync(onProgress);
  };

  //
  // REGISTRY
  //
  angular.module(module).directive('savingsSupportedTaskCard', function(){
    return {
      scope: {
        card: '=?savingsSupportedTaskCard',
        color: '=?savingsSupportedTaskCardColor',
        thickness: '=?savingsSupportedTaskCardThickness',
        threshold: '=?savingsSupportedTaskCardThreshold',
        onComplete: '&savingsSupportedTaskCardOnComplete'
      },
      restrict: 'A',
      transclude: true,
      controller: SavingsSupportedTaskCard,
      bindToController: true,
      controllerAs: 'savingsSupportedTaskCardController',
      templateUrl: 'views/directives/tasks/savings-supported-task-card.html'
    };
  });

})(ANGULAR_MODULE, angular);

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC9kaXJlY3RpdmVzL3Rhc2tzL3NhdmluZ3Mtc3VwcG9ydGVkLXRhc2suanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiYXBwL2RpcmVjdGl2ZXMvdGFza3Mvc2F2aW5ncy1zdXBwb3J0ZWQtdGFzay5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBnbG9iYWwgQU5HVUxBUl9NT0RVTEUsIGFuZ3VsYXIsIFNjcmF0Y2hjYXJkICovXG4oZnVuY3Rpb24obW9kdWxlLCBhbmd1bGFyKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvLyBTYXZpbmdzU3VwcG9ydGVkVGFza1xuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG4gIC8vXG4gIC8vIENPTlRST0xMRVJcbiAgLy9cblxuICAvKipcbiAgICogQGNvbnN0cnVjdG9yXG4gICAqL1xuICB2YXIgU2F2aW5nc1N1cHBvcnRlZFRhc2sgPSBmdW5jdGlvbigkc2NvcGUsICRlbGVtZW50LCAkYXR0cnMsICRpbmplY3Rvcikge1xuICAgIHZhciB0eXBlID0gJGluamVjdG9yLmdldCgnVFlQRV9TQVZJTkdTX1NVUFBPUlRFRCcpO1xuICAgIHZhciB1c2VyID0gJGluamVjdG9yLmdldCgndXNlcicpO1xuXG4gICAgdGhpcy4kc2NvcGUgPSAkc2NvcGU7XG4gICAgdGhpcy4kYXR0cnMgPSAkYXR0cnM7XG4gICAgdGhpcy4kZWxlbWVudCA9ICRlbGVtZW50O1xuICAgIHRoaXMuJGluamVjdG9yID0gJGluamVjdG9yO1xuXG4gICAgdGhpcy50YXNrID0gdXNlci5nZXRUYXNrQnlUeXBlKHR5cGUpO1xuICAgIHRoaXMucmVzdWx0ID0gdXNlci5nZXRQZW5kaW5nQnlUeXBlKHR5cGUpO1xuICB9O1xuXG4gIFNhdmluZ3NTdXBwb3J0ZWRUYXNrLiRpbmplY3QgPSBbJyRzY29wZScsICckZWxlbWVudCcsICckYXR0cnMnLCAnJGluamVjdG9yJ107XG5cbiAgLy9cbiAgLy8gUFJPUEVSVElFU1xuICAvL1xuXG4gIC8vIFNFUlZFUlxuXG4gIC8qKiBAdmFyIHtvYmplY3R9IHRhc2sgVGFzaydzIHJlc291cmNlIGZyb20gc2VydmVyLiAqL1xuICBTYXZpbmdzU3VwcG9ydGVkVGFzay5wcm90b3R5cGUudGFzayA9IG51bGw7XG5cbiAgLyoqIEB2YXIge29iamVjdH0gcmVzdWx0IFRhc2sncyBwZW5kaW5nIHJlc3VsdCBmcm9tIHNlcnZlci4gKi9cbiAgU2F2aW5nc1N1cHBvcnRlZFRhc2sucHJvdG90eXBlLnJlc3VsdCA9IG51bGw7XG5cbiAgLy8gR0FNRVBMQVlcblxuICAvKiogQHZhciB7Ym9vbGVhbn0gcmVzb2x2ZWQgSWYgcGxheWVyIGhhcyByZXNvbHZlZCB0aGUgZ2FtZS4gKi9cbiAgU2F2aW5nc1N1cHBvcnRlZFRhc2sucHJvdG90eXBlLnJlc29sdmVkID0gZmFsc2U7XG5cbiAgLy8gU0VUVElOR1NcblxuICAvKiogQHZhciB7bnVtYmVyfSBhbW91bnQgQW1vdW50IG9mIHRvdGFsIGNhcmRzLiAqL1xuICBTYXZpbmdzU3VwcG9ydGVkVGFzay5wcm90b3R5cGUudG90YWwgPSAzO1xuXG4gIC8qKiBAdmFyIHthcnJheX0gY2FyZHMgRHVtbXkgY29sbGVjdGlvbiBvZiBjYXJkcy4gKi9cbiAgU2F2aW5nc1N1cHBvcnRlZFRhc2sucHJvdG90eXBlLmNhcmRzID0gW107XG5cbiAgLyoqIEB2YXIge251bWJlcn0gY291bnQgTnVtYmVyIG9mIHJldmVhbGVkIGNhcmRzLiAqL1xuICBTYXZpbmdzU3VwcG9ydGVkVGFzay5wcm90b3R5cGUuY291bnQgPSAwO1xuXG4gIC8vXG4gIC8vIE1FVEhPRFNcbiAgLy9cblxuICAvKipcbiAgICogUHJveGllcyB0byBgaW5pdCgpYCBpZiBjb250cm9sbGVyJ3MgcmVhZHkuXG4gICAqXG4gICAqIEBwdWJsaWNcbiAgICogQG1ldGhvZCAkb25Jbml0XG4gICAqIEByZXR1cm4ge1ZvaWR9XG4gICAqL1xuICBTYXZpbmdzU3VwcG9ydGVkVGFzay5wcm90b3R5cGUuJG9uSW5pdCA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuaW5pdCgpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBSZXRyaWV2ZXMgcmVzdWx0IHBheWxvYWQgZm9yIHNlcnZlci5cbiAgICpcbiAgICogQHB1YmxpY1xuICAgKiBAbWV0aG9kIGdldFBheWxvYWRcbiAgICogQHJldHVybiB7Vm9pZH1cbiAgICovXG4gIFNhdmluZ3NTdXBwb3J0ZWRUYXNrLnByb3RvdHlwZS5nZXRQYXlsb2FkID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIHBheWxvYWQgPSB7XG4gICAgICB0YXNrOiB0aGlzLnRhc2ssXG4gICAgICBqc29uOiB7XG4gICAgICAgIGNvdW50OiB0aGlzLmNvdW50LFxuICAgICAgICB0b3RhbDogdGhpcy50b3RhbFxuICAgICAgfSxcbiAgICAgIGlzUGVuZGluZzogdGhpcy5jb3VudCAhPT0gdGhpcy50b3RhbFxuICAgIH07XG5cbiAgICBpZiAodGhpcy5yZXN1bHQgIT09IG51bGwpIHtcbiAgICAgIHBheWxvYWQgPSBhbmd1bGFyLmV4dGVuZChcbiAgICAgICAgdGhpcy5yZXN1bHQsXG4gICAgICAgIHBheWxvYWRcbiAgICAgICk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHBheWxvYWQ7XG4gIH07XG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgb3Igbm90IHRhc2sgaXMgY3VycmVudGx5IGxvY2tlZC5cbiAgICpcbiAgICogQHB1YmxpY1xuICAgKiBAbWV0aG9kIGlzTG9ja2VkXG4gICAqIEByZXR1cm4ge2Jvb2xlYW59XG4gICAqL1xuICBTYXZpbmdzU3VwcG9ydGVkVGFzay5wcm90b3R5cGUuaXNMb2NrZWQgPSBmdW5jdGlvbigpIHtcbiAgICBpZiAodGhpcy50YXNrID09PSBudWxsKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICByZXR1cm4gIXRoaXMudGFzay5pc0FjdGl2ZTtcbiAgfTtcblxuICAvKipcbiAgICogV2hldGhlciBvciBub3QgdGFzayBjYW4gYmUgc2VudCB0byBzZXJ2ZXIuXG4gICAqXG4gICAqIEBwdWJsaWNcbiAgICogQG1ldGhvZCBjYW5SZXNvbHZlXG4gICAqIEByZXR1cm4ge2Jvb2xlYW59XG4gICAqL1xuICBTYXZpbmdzU3VwcG9ydGVkVGFzay5wcm90b3R5cGUuY2FuUmVzb2x2ZSA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciB1c2VyID0gdGhpcy4kaW5qZWN0b3IuZ2V0KCd1c2VyJyk7XG4gICAgaWYgKCF1c2VyLmlzVXNlcigpKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuaXNMb2NrZWQoKSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGlmICh0aGlzLnJlc29sdmVkKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRydWU7XG4gIH07XG5cbiAgLyoqXG4gICAqIFNldHMgdXAgaW5pdGlhbCBzdGF0ZS5cbiAgICpcbiAgICogQHB1YmxpY1xuICAgKiBAbWV0aG9kIGluaXRcbiAgICogQHJldHVybiB7Vm9pZH1cbiAgICovXG4gIFNhdmluZ3NTdXBwb3J0ZWRUYXNrLnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24oKSB7XG4gICAgLy8gdHJ5IHRvIGluaXRpYWxpemUgZnJvbSBwZW5kaW5nIHJlc3VsdFxuICAgIGlmICh0aGlzLnJlc3VsdCAhPT0gbnVsbCkge1xuICAgICAgdGhpcy5jb3VudCA9IHRoaXMucmVzdWx0Lmpzb24uY291bnQ7XG4gICAgfVxuXG4gICAgdGhpcy5jYXJkcyA9IFtdO1xuICAgIGZvciAodmFyIGk9MTsgaTw9dGhpcy50b3RhbDsgaSsrKSB7XG4gICAgICB0aGlzLmNhcmRzLnB1c2goe1xuICAgICAgICBjb21wbGV0ZTogaSA8PSB0aGlzLmNvdW50LFxuICAgICAgICBudW1iZXI6IGlcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIHRoaXMucmVzb2x2ZWQgPSBmYWxzZTtcbiAgfTtcblxuICAvKipcbiAgICogUmVzZXRzIGluaXRpYWwgc3RhdGUuXG4gICAqXG4gICAqIEBwdWJsaWNcbiAgICogQG1ldGhvZCByZXNldFxuICAgKiBAcmV0dXJuIHtWb2lkfVxuICAgKi9cbiAgU2F2aW5nc1N1cHBvcnRlZFRhc2sucHJvdG90eXBlLnJlc2V0ID0gZnVuY3Rpb24oKXtcbiAgICB0aGlzLnJlc29sdmVkID0gZmFsc2U7XG4gICAgdGhpcy5yZXN1bHQgPSBudWxsO1xuICAgIHRoaXMuY291bnQgPSAwO1xuICAgIHRoaXMuaW5pdCgpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBJbmNyZWFzZXMgYGNvdW50YCBhbmQgaW52b2tlcyBgcmVzb2x2ZSgpYC5cbiAgICpcbiAgICogQHB1YmxpY1xuICAgKiBAbWV0aG9kIHVwZGF0ZVxuICAgKiBAcGFyYW0ge29iamVjdH0gY2FyZFxuICAgKiBAcmV0dXJuIHtWb2lkfVxuICAgKi9cbiAgU2F2aW5nc1N1cHBvcnRlZFRhc2sucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uKGNhcmQpe1xuICAgIHZhciBub3RpZmljYXRpb24gPSB0aGlzLiRpbmplY3Rvci5nZXQoJ25vdGlmaWNhdGlvbicpO1xuICAgIHZhciBpMThuID0gdGhpcy4kaW5qZWN0b3IuZ2V0KCdpMThuJyk7XG5cbiAgICAvLyBjaGVjayBmb3Igc2VxdWVudGlhbCByZXNvbHZpbmcgb2YgY2FyZHNcbiAgICB2YXIgbmV4dFdlZWsgPSB0aGlzLmNvdW50ICsgMTtcbiAgICBpZiAoY2FyZC5udW1iZXIgIT09IG5leHRXZWVrKSB7XG4gICAgICB2YXIgbWVzc2FnZSA9IGkxOG4uZ2V0KFwiUGxlYXNlIHJldmVhbCB3ZWVrICVzIG5leHQhXCIsIG5leHRXZWVrKTtcbiAgICAgIG5vdGlmaWNhdGlvbi53YXJuaW5nKG1lc3NhZ2UpO1xuICAgICAgY2FyZC5jb21wbGV0ZSA9IGZhbHNlO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIGNoZWNrIGlmIDEgd2VlayBwYXN0ZWQgc2luY2UgbGFzdCByZXN1bHRcbiAgICAvKmlmICh0aGlzLnJlc3VsdCAhPT0gbnVsbCkge1xuICAgICAgdmFyIHVwZGF0ZWRBdCA9IG5ldyBEYXRlKHRoaXMucmVzdWx0LnVwZGF0ZWRBdCAqIDEwMDApO1xuICAgICAgdmFyIG1pbkRhdGUgPSBuZXcgRGF0ZSh1cGRhdGVkQXQuZ2V0VGltZSgpKTtcbiAgICAgIG1pbkRhdGUuc2V0RGF0ZShtaW5EYXRlLmdldERhdGUoKSs3KTtcblxuICAgICAgdmFyIGN1clRpbWUgPSAobmV3IERhdGUoKSkuZ2V0VGltZSgpO1xuICAgICAgdmFyIG1pblRpbWUgPSBtaW5EYXRlLmdldFRpbWUoKTtcblxuICAgICAgaWYgKGN1clRpbWUgPCBtaW5UaW1lKSB7XG4gICAgICAgIHZhciBtZXNzYWdlID0gaTE4bi5nZXQoXCJEb2Vzbid0IHNlZW0gYSB3ZWVrIGFscmVhZHkgZWxhcHNlZCFcIik7XG4gICAgICAgIG5vdGlmaWNhdGlvbi53YXJuaW5nKG1lc3NhZ2UpO1xuICAgICAgICBjYXJkLmNvbXBsZXRlID0gZmFsc2U7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICB9Ki9cblxuICAgIC8vIGNoZWNrIGlmIHJlc29sdmUgaXMgcG9zc2libGVcbiAgICBpZiAoIXRoaXMuY2FuUmVzb2x2ZSgpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gbm93IHB1Ymxpc2ggdGhlIGNoYW5nZVxuICAgIHZhciBtZSA9IHRoaXM7XG4gICAgdmFyIHN1Y2Nlc3NDYWxsYmFjayA9IGZ1bmN0aW9uKCl7fTtcbiAgICB2YXIgZmFpbHVyZUNhbGxiYWNrID0gZnVuY3Rpb24oKXtcbiAgICAgIGNhcmQuY29tcGxldGUgPSBmYWxzZTtcbiAgICAgIG1lLmNvdW50LS07XG4gICAgfTtcblxuICAgIHRoaXMuY291bnQgPSBuZXh0V2VlaztcbiAgICB0aGlzLnJlc29sdmUoKS50aGVuKFxuICAgICAgc3VjY2Vzc0NhbGxiYWNrLFxuICAgICAgZmFpbHVyZUNhbGxiYWNrXG4gICAgKTtcbiAgfTtcblxuICAvKipcbiAgICogU2V0cyBgcmVzb2x2ZWRgIGZsYWcuIENhbGxzIGBvblJlc29sdmVgXG4gICAqIGNhbGxiYWNrIHdpdGggSlNPTiByZXN1bHQgZm9yIGNvbnN1bWVyLlxuICAgKlxuICAgKiBAcHVibGljXG4gICAqIEBtZXRob2QgcmVzb2x2ZVxuICAgKiBAcmV0dXJuIHtWb2lkfVxuICAgKi9cbiAgU2F2aW5nc1N1cHBvcnRlZFRhc2sucHJvdG90eXBlLnJlc29sdmUgPSBmdW5jdGlvbigpe1xuICAgIHZhciBub3RpZmljYXRpb24gPSB0aGlzLiRpbmplY3Rvci5nZXQoJ25vdGlmaWNhdGlvbicpO1xuICAgIHZhciBpMThuID0gdGhpcy4kaW5qZWN0b3IuZ2V0KCdpMThuJyk7XG4gICAgdmFyICRxID0gdGhpcy4kaW5qZWN0b3IuZ2V0KCckcScpO1xuXG4gICAgdmFyIGNhbGxiYWNrID0gdGhpcy5yZXN1bHQgPT09IG51bGwgP1xuICAgICAgdGhpcy5vblJlc29sdmUgOlxuICAgICAgdGhpcy5vblVwZGF0ZTtcblxuICAgIHZhciByZXN1bHQgPSBjYWxsYmFjayh7XG4gICAgICBwYXlsb2FkOiB0aGlzLmdldFBheWxvYWQoKVxuICAgIH0pO1xuXG4gICAgdmFyIG1lID0gdGhpcztcbiAgICB2YXIgc3VjY2Vzc0NhbGxiYWNrID0gZnVuY3Rpb24ocmVzdWx0KSB7XG4gICAgICBpZiAocmVzdWx0LmlzUGVuZGluZykge1xuICAgICAgICB2YXIgbWVzc2FnZSA9IGkxOG4uZ2V0KCdTdXBlciwga2VlcCBpdCB1cCEnKTtcbiAgICAgICAgbm90aWZpY2F0aW9uLnN1Y2Nlc3MobWVzc2FnZSk7XG4gICAgICAgIG1lLnJlc3VsdCA9IHJlc3VsdDtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBtZS5yZXNvbHZlZCA9IHRydWU7XG4gICAgfTtcblxuICAgIHZhciBmYWlsdXJlQ2FsbGJhY2sgPSBmdW5jdGlvbigpIHtcbiAgICB9O1xuXG4gICAgdmFyIHByb21pc2UgPSAkcS53aGVuKHJlc3VsdCkudGhlbihcbiAgICAgIHN1Y2Nlc3NDYWxsYmFjayxcbiAgICAgIGZhaWx1cmVDYWxsYmFja1xuICAgICk7XG5cbiAgICByZXR1cm4gcHJvbWlzZTtcbiAgfTtcblxuICAvL1xuICAvLyBSRUdJU1RSWVxuICAvL1xuICBhbmd1bGFyLm1vZHVsZShtb2R1bGUpLmRpcmVjdGl2ZSgnc2F2aW5nc1N1cHBvcnRlZFRhc2snLCBmdW5jdGlvbigpe1xuICAgIHJldHVybiB7XG4gICAgICBzY29wZToge1xuICAgICAgICBhbW91bnQ6ICc9P3NhdmluZ3NTdXBwb3J0ZWRUYXNrQW1vdW50JyxcbiAgICAgICAgb25VcGRhdGU6ICcmc2F2aW5nc1N1cHBvcnRlZFRhc2tPblVwZGF0ZScsXG4gICAgICAgIG9uUmVzb2x2ZTogJyZzYXZpbmdzU3VwcG9ydGVkVGFza09uUmVzb2x2ZSdcbiAgICAgIH0sXG4gICAgICByZXN0cmljdDogJ0EnLFxuICAgICAgdHJhbnNjbHVkZTogdHJ1ZSxcbiAgICAgIGNvbnRyb2xsZXI6IFNhdmluZ3NTdXBwb3J0ZWRUYXNrLFxuICAgICAgYmluZFRvQ29udHJvbGxlcjogdHJ1ZSxcbiAgICAgIGNvbnRyb2xsZXJBczogJ3NhdmluZ3NTdXBwb3J0ZWRUYXNrQ29udHJvbGxlcicsXG4gICAgICB0ZW1wbGF0ZVVybDogJ3ZpZXdzL2RpcmVjdGl2ZXMvdGFza3Mvc2F2aW5ncy1zdXBwb3J0ZWQtdGFzay5odG1sJ1xuICAgIH07XG4gIH0pO1xuXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vIFNhdmluZ3NTdXBwb3J0ZWRUYXNrIENhcmRcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuICAvL1xuICAvLyBDT05UUk9MTEVSXG4gIC8vXG5cbiAgLyoqXG4gICAqIEBjb25zdHJ1Y3RvclxuICAgKi9cbiAgdmFyIFNhdmluZ3NTdXBwb3J0ZWRUYXNrQ2FyZCA9IGZ1bmN0aW9uKCRzY29wZSwkZWxlbWVudCwkYXR0cnMsICRpbmplY3Rvcikge1xuICAgIHRoaXMuJGVsZW1lbnQgPSAkZWxlbWVudDtcbiAgICB0aGlzLiRzY29wZSA9ICRzY29wZTtcbiAgICB0aGlzLiRhdHRycyA9ICRhdHRycztcblxuICAgIHRoaXMuJGluamVjdG9yID0gJGluamVjdG9yO1xuXG4gICAgdGhpcy5fc2NyYXRjaENhcmQgPSBudWxsO1xuICB9O1xuXG4gIFNhdmluZ3NTdXBwb3J0ZWRUYXNrQ2FyZC4kaW5qZWN0ID0gWyckc2NvcGUnLCckZWxlbWVudCcsJyRhdHRycycsICckaW5qZWN0b3InXTtcblxuICAvL1xuICAvLyBQUk9QRVJUSUVTXG4gIC8vXG5cbiAgLyoqIEB2YXIge2Jvb2xlYW59IGNvbXBsZXRlIElmIGNhcmQgaGFzIGJlZW4gcmV2ZWxlYWQuICovXG4gIFNhdmluZ3NTdXBwb3J0ZWRUYXNrQ2FyZC5wcm90b3R5cGUuY29tcGxldGUgPSBmYWxzZTtcblxuICAvKiogQHZhciB7bnVtYmVyfSB0aGlja25lc3MgVGhpY2tuZXNzIG9mIHJ1YmJlciBpbiBwaXhlbC4gKi9cbiAgU2F2aW5nc1N1cHBvcnRlZFRhc2tDYXJkLnByb3RvdHlwZS50aGlja25lc3MgPSAyMDtcblxuICAvKiogQHZhciB7bnVtYmVyfSB0cmVzaG9sZCBUcmVzaG9sZCBsZXZlbCB3aGVuIGNhcmQgcmV2ZWxzLiAqL1xuICBTYXZpbmdzU3VwcG9ydGVkVGFza0NhcmQucHJvdG90eXBlLnRocmVzaG9sZCA9IDAuMjU7XG5cbiAgLyoqIEB2YXIge3N0cmluZ30gY29sb3IgQ29sb3Igb2YgY2FyZCBvdmVybGF5LiAqL1xuICBTYXZpbmdzU3VwcG9ydGVkVGFza0NhcmQucHJvdG90eXBlLmNvbG9yID0gJyNlNWU1ZTUnO1xuXG4gIC8vXG4gIC8vIE1FVEhPRFNcbiAgLy9cblxuICAvKipcbiAgICogSW5pdGlhbGl6ZXMgZWxlbWVudCB3aXRoIGBTY3JhdGNoY2FyZGAgbGlicmFyeS5cbiAgICpcbiAgICogQHB1YmxpY1xuICAgKiBAbWV0aG9kICRvbkluaXRcbiAgICogQHJldHVybiB7Vm9pZH1cbiAgICovXG4gIFNhdmluZ3NTdXBwb3J0ZWRUYXNrQ2FyZC5wcm90b3R5cGUuJG9uSW5pdCA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuX3NjcmF0Y2hDYXJkID0gbmV3IFNjcmF0Y2hjYXJkKFxuICAgICAgdGhpcy4kZWxlbWVudC5nZXQoMCksXG4gICAgICB7XG4gICAgICAgIHBhaW50ZXI6IG5ldyBTY3JhdGNoY2FyZC5QYWludGVyKHtcbiAgICAgICAgICB0aGlja25lc3M6IHRoaXMudGhpY2tuZXNzLFxuICAgICAgICAgIGNvbG9yOiB0aGlzLmNvbG9yXG4gICAgICAgIH0pXG4gICAgICB9XG4gICAgKTtcblxuICAgIHZhciBtZSA9IHRoaXM7XG4gICAgdGhpcy5fdW53YXRjaCA9IHRoaXMuJHNjb3BlLiR3YXRjaChcbiAgICAgIGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gbWUuY2FyZC5jb21wbGV0ZTtcbiAgICAgIH0sXG4gICAgICBmdW5jdGlvbihpc0NvbXBsZXRlKSB7XG4gICAgICAgIGlmIChpc0NvbXBsZXRlKSB7XG4gICAgICAgICAgbWUuX3NjcmF0Y2hDYXJkLmNvbXBsZXRlKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgbWUuX3NjcmF0Y2hDYXJkLnJlc2V0KCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICApO1xuXG4gICAgdGhpcy5fbGlzdGVuZXIgPSB0aGlzLl9vblByb2dyZXNzLmJpbmQodGhpcyk7XG4gICAgdGhpcy5fc2NyYXRjaENhcmQuYWRkTGlzdGVuZXIoJ3Byb2dyZXNzJywgdGhpcy5fbGlzdGVuZXIpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBSZW1vdmVzIGxpc3RlbmVycyBhbmQgd2F0Y2hlcyBmcm9tIGRpcmVjdGl2ZS5cbiAgICpcbiAgICogQHB1YmxpY1xuICAgKiBAbWV0aG9kICRvbkRlc3Ryb3lcbiAgICogQHJldHVybiB7Vm9pZH1cbiAgICovXG4gIFNhdmluZ3NTdXBwb3J0ZWRUYXNrQ2FyZC5wcm90b3R5cGUuJG9uRGVzdHJveSA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuX3NjcmF0Y2hDYXJkLnJlbW92ZUxpc3RlbmVyKCdwcm9ncmVzcycsIHRoaXMuX2xpc3RlbmVyKTtcbiAgICB0aGlzLl9zY3JhdGNoQ2FyZCA9IG51bGw7XG4gICAgdGhpcy5fdW53YXRjaCgpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBDaGVja3MgcHJvZ3Jlc3MnIHRyZXNob2xkIGhhcyBiZWVuIGV4Y2VlZGVkLCBidXQgaXMgc3RpbGxcbiAgICogYmVsb3cgMTAwJS4gSW4gdGhpcyBjYXNlLCB0aGUgY2FyZCB3aWxsIGJlIHJldmVsZWFkIGFuZFxuICAgKiB0aGUgYG9uQ29tcGxldGVgIGNhbGxiYWNrIGNhbiBiZSBpbnZva2VkLlxuICAgKlxuICAgKiBAcHVibGljXG4gICAqIEBtZXRob2QgX29uUHJvZ3Jlc3NcbiAgICogQHJldHVybiB7Vm9pZH1cbiAgICovXG4gIFNhdmluZ3NTdXBwb3J0ZWRUYXNrQ2FyZC5wcm90b3R5cGUuX29uUHJvZ3Jlc3MgPSBmdW5jdGlvbihwcm9ncmVzcykge1xuICAgIHZhciAkdGltZW91dCA9IHRoaXMuJGluamVjdG9yLmdldCgnJHRpbWVvdXQnKTtcblxuICAgIHZhciBtZSA9IHRoaXM7XG4gICAgdmFyIG9uUHJvZ3Jlc3MgPSBmdW5jdGlvbigpIHtcbiAgICAgIGlmIChwcm9ncmVzcz5tZS50aHJlc2hvbGQgJibCoHByb2dyZXNzPDEpIHtcbiAgICAgICAgLy8gY2FsbCB3aXRoICR0aW1lb3V0KCkgY2F1c2UgY29uc3VtZXJcbiAgICAgICAgLy8gY291bGQgYWxzbyBjaGFuZ2UgYGNvbXBsZXRlYCBmbGFnIVxuICAgICAgICBtZS5jYXJkLmNvbXBsZXRlID0gdHJ1ZTtcbiAgICAgICAgJHRpbWVvdXQobWUub25Db21wbGV0ZSk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIHRoaXMuJHNjb3BlLiRldmFsQXN5bmMob25Qcm9ncmVzcyk7XG4gIH07XG5cbiAgLy9cbiAgLy8gUkVHSVNUUllcbiAgLy9cbiAgYW5ndWxhci5tb2R1bGUobW9kdWxlKS5kaXJlY3RpdmUoJ3NhdmluZ3NTdXBwb3J0ZWRUYXNrQ2FyZCcsIGZ1bmN0aW9uKCl7XG4gICAgcmV0dXJuIHtcbiAgICAgIHNjb3BlOiB7XG4gICAgICAgIGNhcmQ6ICc9P3NhdmluZ3NTdXBwb3J0ZWRUYXNrQ2FyZCcsXG4gICAgICAgIGNvbG9yOiAnPT9zYXZpbmdzU3VwcG9ydGVkVGFza0NhcmRDb2xvcicsXG4gICAgICAgIHRoaWNrbmVzczogJz0/c2F2aW5nc1N1cHBvcnRlZFRhc2tDYXJkVGhpY2tuZXNzJyxcbiAgICAgICAgdGhyZXNob2xkOiAnPT9zYXZpbmdzU3VwcG9ydGVkVGFza0NhcmRUaHJlc2hvbGQnLFxuICAgICAgICBvbkNvbXBsZXRlOiAnJnNhdmluZ3NTdXBwb3J0ZWRUYXNrQ2FyZE9uQ29tcGxldGUnXG4gICAgICB9LFxuICAgICAgcmVzdHJpY3Q6ICdBJyxcbiAgICAgIHRyYW5zY2x1ZGU6IHRydWUsXG4gICAgICBjb250cm9sbGVyOiBTYXZpbmdzU3VwcG9ydGVkVGFza0NhcmQsXG4gICAgICBiaW5kVG9Db250cm9sbGVyOiB0cnVlLFxuICAgICAgY29udHJvbGxlckFzOiAnc2F2aW5nc1N1cHBvcnRlZFRhc2tDYXJkQ29udHJvbGxlcicsXG4gICAgICB0ZW1wbGF0ZVVybDogJ3ZpZXdzL2RpcmVjdGl2ZXMvdGFza3Mvc2F2aW5ncy1zdXBwb3J0ZWQtdGFzay1jYXJkLmh0bWwnXG4gICAgfTtcbiAgfSk7XG5cbn0pKEFOR1VMQVJfTU9EVUxFLCBhbmd1bGFyKTtcbiJdfQ==
