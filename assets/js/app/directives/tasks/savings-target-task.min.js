/*!
 * eFit Website
 * An app for financial training in educational environments
 * http://www.e-fit.com
 * @author Armin Pfurtscheller
 * @version 1.0.0
 * Copyright 2017. MIT licensed.
 */
!function(t,e){"use strict";var s=function(t,e,s,o){var i=o.get("TYPE_SAVINGS_TARGET");this.$attrs=s,this.$scope=t,this.$element=e,this.$injector=o,this._flag=!1,this.user=this.$injector.get("user"),this.task=this.user.getTaskByType(i),this.result=this.user.getPendingByType(i),this.storage=this.$injector.get("storage").getProxy(),this._storageKey="__savings__target__task__updated__at__"};s.$inject=["$scope","$element","$attrs","$injector"],s.prototype.user=null,s.prototype.task=null,s.prototype.result=null,s.prototype.step=1,s.prototype.total=3,s.prototype.wish=null,s.prototype.amount=null,s.prototype.amountRepeated=null,s.prototype.resolved=!1,s.prototype.form=null,s.prototype.minAmount=1,s.prototype.maxAmount=999,s.prototype.$onInit=function(){this.init()},s.prototype.getPayload=function(){var t={task:this.task,json:{step:this.step,wish:this.wish,total:this.total,amount:this.amount,amountRepeated:this.amountRepeated},isPending:null===this.amountRepeated};return null!==this.result&&(t=e.extend(this.result,t)),t},s.prototype.isLocked=function(){return null===this.task||(this.task.isActive?this._flag:(this.storage.removeItem(this._storageKey),this._flag=!1,!0))},s.prototype.canResolve=function(){var t=this.$injector.get("user");return!!t.isUser()&&(!this.form.$invalid&&(!this.isLocked()&&!this.resolved))},s.prototype.init=function(){if(null!==this.result){var t=this.result.json,s=this.storage.getItem(this._storageKey);e.isNumber(s)&&(this._flag=s>=this.task.updatedAt),this.amount=t.amount,this.total=t.total,this.wish=t.wish,this.step=t.step}this.resolved=!1},s.prototype.reset=function(){this.init()},s.prototype.update=function(){if(this.step<this.total&&this.step++,this.canResolve()){var t=this,e=function(){},s=function(){t.step--};this.resolve().then(e,s)}},s.prototype.resolve=function(){var t=this.$injector.get("notification"),e=this.$injector.get("i18n"),s=this.$injector.get("$q"),o=null===this.result?this.onResolve:this.onUpdate,i=o({payload:this.getPayload()}),n=this,r=function(s){if(s.isPending){if(n.step<n.total){var o=e.get("Thank you for your input!");t.success(o)}return n.result=s,n.storage.setItem(n._storageKey,n.task.updatedAt),void(n._flag=!0)}n.resolved=!0},a=function(){},l=s.when(i);return l.then(r,a),l},s.prototype.getDifference=function(){return this.amountRepeated-this.amount},e.module(t).directive("savingsTargetTask",function(){return{scope:{onUpdate:"&savingsTargetTaskOnUpdate",onResolve:"&savingsTargetTaskOnResolve"},restrict:"A",transclude:!0,controller:s,bindToController:!0,controllerAs:"savingsTargetTaskController",templateUrl:"views/directives/tasks/savings-target-task.html"}})}(ANGULAR_MODULE,angular);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC9kaXJlY3RpdmVzL3Rhc2tzL3NhdmluZ3MtdGFyZ2V0LXRhc2suanMiXSwibmFtZXMiOlsibW9kdWxlIiwiYW5ndWxhciIsIlNhdmluZ3NUYXJnZXRUYXNrIiwiJHNjb3BlIiwiJGVsZW1lbnQiLCIkYXR0cnMiLCIkaW5qZWN0b3IiLCJ0eXBlIiwiZ2V0IiwidGhpcyIsIl9mbGFnIiwidXNlciIsInRhc2siLCJnZXRUYXNrQnlUeXBlIiwicmVzdWx0IiwiZ2V0UGVuZGluZ0J5VHlwZSIsInN0b3JhZ2UiLCJnZXRQcm94eSIsIl9zdG9yYWdlS2V5IiwiJGluamVjdCIsInByb3RvdHlwZSIsInN0ZXAiLCJ0b3RhbCIsIndpc2giLCJhbW91bnQiLCJhbW91bnRSZXBlYXRlZCIsInJlc29sdmVkIiwiZm9ybSIsIm1pbkFtb3VudCIsIm1heEFtb3VudCIsIiRvbkluaXQiLCJpbml0IiwiZ2V0UGF5bG9hZCIsInBheWxvYWQiLCJqc29uIiwiaXNQZW5kaW5nIiwiZXh0ZW5kIiwiaXNMb2NrZWQiLCJpc0FjdGl2ZSIsInJlbW92ZUl0ZW0iLCJjYW5SZXNvbHZlIiwiaXNVc2VyIiwiJGludmFsaWQiLCJ1cGRhdGVkQXQiLCJnZXRJdGVtIiwiaXNOdW1iZXIiLCJyZXNldCIsInVwZGF0ZSIsIm1lIiwic3VjY2Vzc0NhbGxiYWNrIiwiZmFpbHVyZUNhbGxiYWNrIiwicmVzb2x2ZSIsInRoZW4iLCJub3RpZmljYXRpb24iLCJpMThuIiwiJHEiLCJjYWxsYmFjayIsIm9uUmVzb2x2ZSIsIm9uVXBkYXRlIiwibWVzc2FnZSIsInN1Y2Nlc3MiLCJzZXRJdGVtIiwicHJvbWlzZSIsIndoZW4iLCJnZXREaWZmZXJlbmNlIiwiZGlyZWN0aXZlIiwic2NvcGUiLCJyZXN0cmljdCIsInRyYW5zY2x1ZGUiLCJjb250cm9sbGVyIiwiYmluZFRvQ29udHJvbGxlciIsImNvbnRyb2xsZXJBcyIsInRlbXBsYXRlVXJsIiwiQU5HVUxBUl9NT0RVTEUiXSwibWFwcGluZ3MiOiI7Ozs7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QUswQyxVQUFVQyxLQUNiSCxFQUNBQyxLQVlKaEQsRUFBa0JrQixVQUFVK0IsUUFBVSxXQUNwQyxHQUFJRSxHQUFlNUMsS0FBS0gsVUFBVUUsSUFBSSxnQkFDbEM4QyxFQUFPN0MsS0FBS0gsVUFBVUUsSUFBSSxRQUMxQitDLEVBQUs5QyxLQUFLSCxVQUFVRSxJQUFJLE1BRXhCZ0QsRUFBMkIsT0FBaEIvQyxLQUFLSyxPQUNsQkwsS0FBS2dELFVBQ0xoRCxLQUFLaUQsU0FFSDVDLEVBQVMwQyxHQUNYdkIsUUFBU3hCLEtBQUt1QixlQUdaZ0IsRUFBS3ZDLEtBQ0x3QyxFQUFrQixTQUFTbkMsR0FDN0IsR0FBSUEsRUFBT3FCLFVBQVcsQ0FDcEIsR0FBSWEsRUFBRzNCLEtBQU8yQixFQUFHMUIsTUFBTyxDQUN0QixHQUFJcUMsR0FBVUwsRUFBSzlDLElBQUksNEJBQ3ZCNkMsR0FBYU8sUUFBUUQsR0FTdkIsTUFOQVgsR0FBR2xDLE9BQVNBLEVBQ1prQyxFQUFHaEMsUUFBUTZDLFFBQ1RiLEVBQUc5QixZQUNIOEIsRUFBR3BDLEtBQUsrQixnQkFFVkssRUFBR3RDLE9BQVEsR0FJYnNDLEVBQUd0QixVQUFXLEdBR1p3QixFQUFrQixhQUdsQlksRUFBVVAsRUFBR1EsS0FBS2pELEVBTXRCLE9BTEFnRCxHQUFRVixLQUNOSCxFQUNBQyxHQUdLWSxHQVVUNUQsRUFBa0JrQixVQUFVNEMsY0FBZ0IsV0FDMUMsTUFBT3ZELE1BQUtnQixlQUFpQmhCLEtBQUtlLFFBTXBDdkIsRUFBUUQsT0FBT0EsR0FBUWlFLFVBQVUsb0JBQXFCLFdBQ3BELE9BQ0VDLE9BQ0VSLFNBQVUsNkJBQ1ZELFVBQVcsK0JBRWJVLFNBQVUsSUFDVkMsWUFBWSxFQUNaQyxXQUFZbkUsRUFDWm9FLGtCQUFrQixFQUNsQkMsYUFBYyw4QkFDZEMsWUFBYSxzREFJaEJDLGVBQWdCeEUiLCJmaWxlIjoiYXBwL2RpcmVjdGl2ZXMvdGFza3Mvc2F2aW5ncy10YXJnZXQtdGFzay5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBnbG9iYWwgQU5HVUxBUl9NT0RVTEUsIGFuZ3VsYXIgKi9cbihmdW5jdGlvbihtb2R1bGUsIGFuZ3VsYXIpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vIFNhdmluZ3NUYXJnZXRUYXNrXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbiAgLy9cbiAgLy8gQ09OVFJPTExFUlxuICAvL1xuXG4gIC8qKlxuICAgKiBAY29uc3RydWN0b3JcbiAgICovXG4gIHZhciBTYXZpbmdzVGFyZ2V0VGFzayA9IGZ1bmN0aW9uKCRzY29wZSwgJGVsZW1lbnQsICRhdHRycywgJGluamVjdG9yKSB7XG4gICAgdmFyIHR5cGUgPSAkaW5qZWN0b3IuZ2V0KCdUWVBFX1NBVklOR1NfVEFSR0VUJyk7XG5cbiAgICB0aGlzLiRhdHRycyA9ICRhdHRycztcbiAgICB0aGlzLiRzY29wZSA9ICRzY29wZTtcbiAgICB0aGlzLiRlbGVtZW50ID0gJGVsZW1lbnQ7XG4gICAgdGhpcy4kaW5qZWN0b3IgPSAkaW5qZWN0b3I7XG5cbiAgICB0aGlzLl9mbGFnID0gZmFsc2U7XG5cbiAgICB0aGlzLnVzZXIgPSB0aGlzLiRpbmplY3Rvci5nZXQoJ3VzZXInKTtcbiAgICB0aGlzLnRhc2sgPSB0aGlzLnVzZXIuZ2V0VGFza0J5VHlwZSh0eXBlKTtcbiAgICB0aGlzLnJlc3VsdCA9IHRoaXMudXNlci5nZXRQZW5kaW5nQnlUeXBlKHR5cGUpO1xuXG4gICAgdGhpcy5zdG9yYWdlID0gdGhpcy4kaW5qZWN0b3IuZ2V0KCdzdG9yYWdlJykuZ2V0UHJveHkoKTtcbiAgICB0aGlzLl9zdG9yYWdlS2V5ID0gJ19fc2F2aW5nc19fdGFyZ2V0X190YXNrX191cGRhdGVkX19hdF9fJztcbiAgfTtcblxuICBTYXZpbmdzVGFyZ2V0VGFzay4kaW5qZWN0ID0gWyckc2NvcGUnLCckZWxlbWVudCcsJyRhdHRycycsICckaW5qZWN0b3InXTtcblxuICAvLyBTRVJWRVJcblxuICAvKiogQHZhciB7b2JqZWN0fSB1c2VyIEFsaWFzIHRvIHVzZXIgc2VydmljZS4gKi9cbiAgU2F2aW5nc1RhcmdldFRhc2sucHJvdG90eXBlLnVzZXIgPSBudWxsO1xuXG4gIC8qKiBAdmFyIHtvYmplY3R9IHRhc2sgVGFzaydzIHJlc291cmNlIGZyb20gc2VydmVyLiAqL1xuICBTYXZpbmdzVGFyZ2V0VGFzay5wcm90b3R5cGUudGFzayA9IG51bGw7XG5cbiAgLyoqIEB2YXIge29iamVjdH0gcmVzdWx0IFRhc2sncyBwZW5kaW5nIHJlc3VsdCBmcm9tIHNlcnZlci4gKi9cbiAgU2F2aW5nc1RhcmdldFRhc2sucHJvdG90eXBlLnJlc3VsdCA9IG51bGw7XG5cbiAgLy8gR0FNRVBMQVlcblxuICAvKiogQHZhciB7bnVtYmVyfSBzdGVwIEN1cnJlbnQgc3RlcCAuICovXG4gIFNhdmluZ3NUYXJnZXRUYXNrLnByb3RvdHlwZS5zdGVwID0gMTtcblxuICAvKiogQHZhciB7bnVtYmVyfSB0b3RhbCBQbGF5ZXJzIHdpc2ggZm9yIHNhdmluZyB0YXJnZXQuICovXG4gIFNhdmluZ3NUYXJnZXRUYXNrLnByb3RvdHlwZS50b3RhbCA9IDM7XG5cbiAgLyoqIEB2YXIge3N0cmluZ30gd2lzaCBQbGF5ZXJzIHdpc2ggZm9yIHNhdmluZyB0YXJnZXQuICovXG4gIFNhdmluZ3NUYXJnZXRUYXNrLnByb3RvdHlwZS53aXNoID0gbnVsbDtcblxuICAvKiogQHZhciB7bnVtYmVyfSBhbW91bnQgUGxheWVycyBmaXJzdCBhbW91bnQgZm9yIHNhdmluZyB0YXJnZXQuICovXG4gIFNhdmluZ3NUYXJnZXRUYXNrLnByb3RvdHlwZS5hbW91bnQgPSBudWxsO1xuXG4gIC8qKiBAdmFyIHtudW1iZXJ9IGFtb3VudFJlcGVhdGVkIFBsYXllcnMgc2Vjb25kIGFtb3VudCBmb3Igc2F2aW5nIHRhcmdldC4gKi9cbiAgU2F2aW5nc1RhcmdldFRhc2sucHJvdG90eXBlLmFtb3VudFJlcGVhdGVkID0gbnVsbDtcblxuICAvKiogQHZhciB7Ym9vbGVhbn0gcmVzb2x2ZWQgSWYgcGxheWVyIGhhcyByZXNvbHZlZCB0aGUgZ2FtZS4gKi9cbiAgU2F2aW5nc1RhcmdldFRhc2sucHJvdG90eXBlLnJlc29sdmVkID0gZmFsc2U7XG5cbiAgLy8gTUlTQ1xuXG4gIC8qKiBAdmFyIHtvYmplY3R9IGZvcm0gRm9ybSBjb2xsZWN0aW5nIHVzZXIgaW5wdXQuICovXG4gIFNhdmluZ3NUYXJnZXRUYXNrLnByb3RvdHlwZS5mb3JtID0gbnVsbDtcblxuICAvKiogQHZhciB7bnVtYmVyfSBtaW5BbW91bnQgTWluaW11bSBhbW91bnQgZm9yIGBhbW91bnRgIGlucHV0LiAqL1xuICBTYXZpbmdzVGFyZ2V0VGFzay5wcm90b3R5cGUubWluQW1vdW50ID0gMTtcblxuICAvKiogQHZhciB7bnVtYmVyfSBtYXhBbW91bnQgTWF4aW11bSBhbW91bnQgZm9yIGBhbW91bnRgIGlucHV0LiAqL1xuICBTYXZpbmdzVGFyZ2V0VGFzay5wcm90b3R5cGUubWF4QW1vdW50ID0gOTk5O1xuXG4gIC8vXG4gIC8vIE1FVEhPRFNcbiAgLy9cblxuICAvKipcbiAgICogUHJveGllcyB0byBgaW5pdCgpYCBpZiBjb250cm9sbGVyJ3MgcmVhZHkuXG4gICAqXG4gICAqIEBwdWJsaWNcbiAgICogQG1ldGhvZCAkb25Jbml0XG4gICAqIEByZXR1cm4ge3ZvaWR9XG4gICAqL1xuICBTYXZpbmdzVGFyZ2V0VGFzay5wcm90b3R5cGUuJG9uSW5pdCA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuaW5pdCgpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBSZXRyaWV2ZXMgcmVzdWx0IHBheWxvYWQgZm9yIHNlcnZlci5cbiAgICpcbiAgICogQHB1YmxpY1xuICAgKiBAbWV0aG9kIGdldFBheWxvYWRcbiAgICogQHJldHVybiB7dm9pZH1cbiAgICovXG4gIFNhdmluZ3NUYXJnZXRUYXNrLnByb3RvdHlwZS5nZXRQYXlsb2FkID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIHBheWxvYWQgPSB7XG4gICAgICB0YXNrOiB0aGlzLnRhc2ssXG4gICAgICBqc29uOiB7XG4gICAgICAgIHN0ZXA6IHRoaXMuc3RlcCxcbiAgICAgICAgd2lzaDogdGhpcy53aXNoLFxuICAgICAgICB0b3RhbDogdGhpcy50b3RhbCxcbiAgICAgICAgYW1vdW50OiB0aGlzLmFtb3VudCxcbiAgICAgICAgYW1vdW50UmVwZWF0ZWQ6IHRoaXMuYW1vdW50UmVwZWF0ZWRcbiAgICAgIH0sXG4gICAgICBpc1BlbmRpbmc6IHRoaXMuYW1vdW50UmVwZWF0ZWQgPT09IG51bGxcbiAgICB9O1xuXG4gICAgaWYgKHRoaXMucmVzdWx0ICE9PSBudWxsKSB7XG4gICAgICBwYXlsb2FkID0gYW5ndWxhci5leHRlbmQoXG4gICAgICAgIHRoaXMucmVzdWx0LFxuICAgICAgICBwYXlsb2FkXG4gICAgICApO1xuICAgIH1cblxuICAgIHJldHVybiBwYXlsb2FkO1xuICB9O1xuXG4gIC8qKlxuICAgKiBXaGV0aGVyIG9yIG5vdCB0YXNrIGlzIGN1cnJlbnRseSBsb2NrZWQuXG4gICAqXG4gICAqIEBwdWJsaWNcbiAgICogQG1ldGhvZCBpc0xvY2tlZFxuICAgKiBAcmV0dXJuIHtib29sZWFufVxuICAgKi9cbiAgU2F2aW5nc1RhcmdldFRhc2sucHJvdG90eXBlLmlzTG9ja2VkID0gZnVuY3Rpb24oKSB7XG4gICAgaWYgKHRoaXMudGFzayA9PT0gbnVsbCkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgLy8gaWYgcmVzdWx0IHdhcyBjcmVhdGVkIGFuZFxuICAgIC8vIHdlIGFyZSB3YWl0aW5nIGZvciBwYXVzZWRcbiAgICAvLyBzdGF0ZSwgd2Ugc2tpcCB1bmxvY2tpbmdcbiAgICAvLyBieSB1c2luZyBpbnRlcm5hbCBgX2ZsYWdgXG4gICAgaWYgKHRoaXMudGFzay5pc0FjdGl2ZSkge1xuICAgICAgcmV0dXJuIHRoaXMuX2ZsYWc7XG4gICAgfVxuXG4gICAgLy8gcmVzZXQgYF9mbGFnYCBhcyBzb29uIGFzXG4gICAgLy8gYGlzQWN0aXZlYCBjaGFuZ2VkIGFnYWluXG4gICAgdGhpcy5zdG9yYWdlLnJlbW92ZUl0ZW0oXG4gICAgICB0aGlzLl9zdG9yYWdlS2V5XG4gICAgKTtcblxuICAgIHRoaXMuX2ZsYWcgPSBmYWxzZTtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfTtcblxuICAvKipcbiAgICogV2hldGhlciBvciBub3QgdGFzayBjYW4gYmUgc2VudCB0byBzZXJ2ZXIuXG4gICAqXG4gICAqIEBwdWJsaWNcbiAgICogQG1ldGhvZCBjYW5SZXNvbHZlXG4gICAqIEByZXR1cm4ge2Jvb2xlYW59XG4gICAqL1xuICBTYXZpbmdzVGFyZ2V0VGFzay5wcm90b3R5cGUuY2FuUmVzb2x2ZSA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciB1c2VyID0gdGhpcy4kaW5qZWN0b3IuZ2V0KCd1c2VyJyk7XG4gICAgaWYgKCF1c2VyLmlzVXNlcigpKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuZm9ybS4kaW52YWxpZCkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmlzTG9ja2VkKCkpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5yZXNvbHZlZCkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHJldHVybiB0cnVlO1xuICB9O1xuXG4gIC8qKlxuICAgKiBTZXRzIHVwIGluaXRpYWwgc3RhdGUuXG4gICAqXG4gICAqIEBwdWJsaWNcbiAgICogQG1ldGhvZCBpbml0XG4gICAqIEByZXR1cm4ge3ZvaWR9XG4gICAqL1xuICBTYXZpbmdzVGFyZ2V0VGFzay5wcm90b3R5cGUuaW5pdCA9IGZ1bmN0aW9uKCkge1xuICAgIGlmICh0aGlzLnJlc3VsdCAhPT0gbnVsbCkge1xuICAgICAgdmFyIGpzb24gPSB0aGlzLnJlc3VsdC5qc29uO1xuXG4gICAgICAvLyBzZXQgZmxhZyBvbmx5IGlmIHN0aWxsIHdhaXRpbmcgZm9yIGBpc0FjdGl2ZWAgY2hhbmdlXG4gICAgICB2YXIgdXBkYXRlZEF0ID0gdGhpcy5zdG9yYWdlLmdldEl0ZW0odGhpcy5fc3RvcmFnZUtleSk7XG4gICAgICBpZiAoYW5ndWxhci5pc051bWJlcih1cGRhdGVkQXQpKSB7XG4gICAgICAgIHRoaXMuX2ZsYWcgPSB1cGRhdGVkQXQgPj0gdGhpcy50YXNrLnVwZGF0ZWRBdDtcbiAgICAgIH1cblxuICAgICAgLy8gYW1vdW50IHJlcGVhdGVkIGNhbm5vdCBiZSBkZXNpc3RlZCBjYXVzZSBpdCdzIHRoZVxuICAgICAgLy8gY29uZGl0aW9uIGluIGxhc3Qgc3RlcCBiZWZvcmUgc2V0dGluZyBgaXNQZW5kaW5nYFxuICAgICAgdGhpcy5hbW91bnQgPSBqc29uLmFtb3VudDtcbiAgICAgIHRoaXMudG90YWwgPSBqc29uLnRvdGFsO1xuICAgICAgdGhpcy53aXNoID0ganNvbi53aXNoO1xuICAgICAgdGhpcy5zdGVwID0ganNvbi5zdGVwO1xuICAgIH1cblxuICAgIHRoaXMucmVzb2x2ZWQgPSBmYWxzZTtcbiAgfTtcblxuICAvKipcbiAgICogUmVzZXRzIGluaXRpYWwgc3RhdGUuXG4gICAqXG4gICAqIEBwdWJsaWNcbiAgICogQG1ldGhvZCByZXNldFxuICAgKiBAcmV0dXJuIHt2b2lkfVxuICAgKi9cbiAgU2F2aW5nc1RhcmdldFRhc2sucHJvdG90eXBlLnJlc2V0ID0gZnVuY3Rpb24oKXtcbiAgICB0aGlzLmluaXQoKTtcbiAgfTtcblxuICAvKipcbiAgICogSW5jcmVhc2VzIGBzdGVwYCBhbmQgaW52b2tlcyBgcmVzb2x2ZSgpYC5cbiAgICpcbiAgICogQHB1YmxpY1xuICAgKiBAbWV0aG9kIHVwZGF0ZVxuICAgKiBAcmV0dXJuIHt2b2lkfVxuICAgKi9cbiAgU2F2aW5nc1RhcmdldFRhc2sucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uKCl7XG4gICAgaWYgKHRoaXMuc3RlcCA8IHRoaXMudG90YWwpIHtcbiAgICAgIHRoaXMuc3RlcCsrO1xuICAgIH1cblxuICAgIGlmICghdGhpcy5jYW5SZXNvbHZlKCkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB2YXIgbWUgPSB0aGlzO1xuICAgIHZhciBzdWNjZXNzQ2FsbGJhY2sgPSBmdW5jdGlvbigpe307XG4gICAgdmFyIGZhaWx1cmVDYWxsYmFjayA9IGZ1bmN0aW9uKCl7XG4gICAgICBtZS5zdGVwLS07XG4gICAgfTtcblxuICAgIHRoaXMucmVzb2x2ZSgpLnRoZW4oXG4gICAgICBzdWNjZXNzQ2FsbGJhY2ssXG4gICAgICBmYWlsdXJlQ2FsbGJhY2tcbiAgICApO1xuICB9O1xuXG4gIC8qKlxuICAgKiBTZXRzIGByZXNvbHZlZGAgZmxhZy4gQ2FsbHMgYG9uUmVzb2x2ZWBcbiAgICogY2FsbGJhY2sgd2l0aCBKU09OIHJlc3VsdCBmb3IgY29uc3VtZXIuXG4gICAqXG4gICAqIEBwdWJsaWNcbiAgICogQG1ldGhvZCByZXNvbHZlXG4gICAqIEByZXR1cm4ge3ZvaWR9XG4gICAqL1xuICBTYXZpbmdzVGFyZ2V0VGFzay5wcm90b3R5cGUucmVzb2x2ZSA9IGZ1bmN0aW9uKCl7XG4gICAgdmFyIG5vdGlmaWNhdGlvbiA9IHRoaXMuJGluamVjdG9yLmdldCgnbm90aWZpY2F0aW9uJyk7XG4gICAgdmFyIGkxOG4gPSB0aGlzLiRpbmplY3Rvci5nZXQoJ2kxOG4nKTtcbiAgICB2YXIgJHEgPSB0aGlzLiRpbmplY3Rvci5nZXQoJyRxJyk7XG5cbiAgICB2YXIgY2FsbGJhY2sgPSB0aGlzLnJlc3VsdCA9PT0gbnVsbCA/XG4gICAgICB0aGlzLm9uUmVzb2x2ZSA6XG4gICAgICB0aGlzLm9uVXBkYXRlO1xuXG4gICAgdmFyIHJlc3VsdCA9IGNhbGxiYWNrKHtcbiAgICAgIHBheWxvYWQ6IHRoaXMuZ2V0UGF5bG9hZCgpXG4gICAgfSk7XG5cbiAgICB2YXIgbWUgPSB0aGlzO1xuICAgIHZhciBzdWNjZXNzQ2FsbGJhY2sgPSBmdW5jdGlvbihyZXN1bHQpIHtcbiAgICAgIGlmIChyZXN1bHQuaXNQZW5kaW5nKSB7XG4gICAgICAgIGlmIChtZS5zdGVwIDwgbWUudG90YWwpIHtcbiAgICAgICAgICB2YXIgbWVzc2FnZSA9IGkxOG4uZ2V0KCdUaGFuayB5b3UgZm9yIHlvdXIgaW5wdXQhJyk7XG4gICAgICAgICAgbm90aWZpY2F0aW9uLnN1Y2Nlc3MobWVzc2FnZSk7XG4gICAgICAgIH1cblxuICAgICAgICBtZS5yZXN1bHQgPSByZXN1bHQ7XG4gICAgICAgIG1lLnN0b3JhZ2Uuc2V0SXRlbShcbiAgICAgICAgICBtZS5fc3RvcmFnZUtleSxcbiAgICAgICAgICBtZS50YXNrLnVwZGF0ZWRBdFxuICAgICAgICApO1xuICAgICAgICBtZS5fZmxhZyA9IHRydWU7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgbWUucmVzb2x2ZWQgPSB0cnVlO1xuICAgIH07XG5cbiAgICB2YXIgZmFpbHVyZUNhbGxiYWNrID0gZnVuY3Rpb24oKSB7XG4gICAgfTtcblxuICAgIHZhciBwcm9taXNlID0gJHEud2hlbihyZXN1bHQpO1xuICAgIHByb21pc2UudGhlbihcbiAgICAgIHN1Y2Nlc3NDYWxsYmFjayxcbiAgICAgIGZhaWx1cmVDYWxsYmFja1xuICAgICk7XG5cbiAgICByZXR1cm4gcHJvbWlzZTtcbiAgfTtcblxuICAvKipcbiAgICogQ2FsY3VsYXRlcyBkaWZmZXJlbmNlIGJldHdlZW4gYGFtb3VudGAgYW5kIGBhbW91bnRSZXBlYXRlZGAuXG4gICAqXG4gICAqIEBwdWJsaWNcbiAgICogQG1ldGhvZCBnZXREaWZmZXJlbmNlXG4gICAqIEByZXR1cm4ge3ZvaWR9XG4gICAqL1xuICBTYXZpbmdzVGFyZ2V0VGFzay5wcm90b3R5cGUuZ2V0RGlmZmVyZW5jZSA9IGZ1bmN0aW9uKCl7XG4gICAgcmV0dXJuIHRoaXMuYW1vdW50UmVwZWF0ZWQgLSB0aGlzLmFtb3VudDtcbiAgfTtcblxuICAvL1xuICAvLyBSRUdJU1RSWVxuICAvL1xuICBhbmd1bGFyLm1vZHVsZShtb2R1bGUpLmRpcmVjdGl2ZSgnc2F2aW5nc1RhcmdldFRhc2snLCBmdW5jdGlvbigpe1xuICAgIHJldHVybiB7XG4gICAgICBzY29wZToge1xuICAgICAgICBvblVwZGF0ZTogJyZzYXZpbmdzVGFyZ2V0VGFza09uVXBkYXRlJyxcbiAgICAgICAgb25SZXNvbHZlOiAnJnNhdmluZ3NUYXJnZXRUYXNrT25SZXNvbHZlJ1xuICAgICAgfSxcbiAgICAgIHJlc3RyaWN0OiAnQScsXG4gICAgICB0cmFuc2NsdWRlOiB0cnVlLFxuICAgICAgY29udHJvbGxlcjogU2F2aW5nc1RhcmdldFRhc2ssXG4gICAgICBiaW5kVG9Db250cm9sbGVyOiB0cnVlLFxuICAgICAgY29udHJvbGxlckFzOiAnc2F2aW5nc1RhcmdldFRhc2tDb250cm9sbGVyJyxcbiAgICAgIHRlbXBsYXRlVXJsOiAndmlld3MvZGlyZWN0aXZlcy90YXNrcy9zYXZpbmdzLXRhcmdldC10YXNrLmh0bWwnXG4gICAgfTtcbiAgfSk7XG5cbn0pKEFOR1VMQVJfTU9EVUxFLCBhbmd1bGFyKTtcbiJdfQ==
