/*!
 * eFit Website
 * An app for financial training in educational environments
 * http://www.e-fit.com
 * @author Armin Pfurtscheller
 * @version 1.0.0
 * Copyright 2017. MIT licensed.
 */
/* global ANGULAR_MODULE, angular, Scratchcard */
(function(module, angular) {
  'use strict';

  // --------------------------------------------------
  // SaveCoinTask
  // --------------------------------------------------

  // controller
  var SaveCoinTask = function() {
    this.amount = 3;
    this.cards = [];
    this.count = 0;
  };

  SaveCoinTask.$inject = ['$scope','$element','$attrs'];

  SaveCoinTask.prototype.$onInit = function() {
    this.init();
  };

  SaveCoinTask.prototype.init = function() {
    this.cards = [];
    for (var i=1; i<=this.amount; i++) {
      this.cards.push(i);
    }

    this.resolved = false;
  };

  SaveCoinTask.prototype.reset = function(){
    this.init();
  };

  SaveCoinTask.prototype.update = function(){
    this.count++;
    this.resolve();
  };

  SaveCoinTask.prototype.resolve = function(){
    if (this.count<this.amount) {
      return;
    }

    this.resolved = true;
    this.onResolve();
  };

  // registry
  angular.module(module).directive('saveCoinTask', function(){
    return {
      scope: {
        amount: '=?saveCoinTaskAmount',
        onResolve: '&saveCoinTaskOnResolve'
      },
      restrict: 'A',
      transclude: true,
      controller: SaveCoinTask,
      bindToController: true,
      controllerAs: 'saveCoinTaskController',
      templateUrl: 'views/directives/save-coin-task.html'
    };
  });

  // --------------------------------------------------
  // SaveCoinTask Card
  // --------------------------------------------------

  // controller
  var SaveCoinTaskCard = function($scope,$element,$attrs) {
    this.$element = $element;
    this.$scope = $scope;
    this.$attrs = $attrs;

    this.thickness = 20;
    this.threshold = 0.75;
    this.color = '#e5e5e5';

    this.complete = false;
    this._scratchCard = null;
  };

  SaveCoinTaskCard.$inject = ['$scope','$element','$attrs'];

  SaveCoinTaskCard.prototype.$onInit = function() {
    this._scratchCard = new Scratchcard(
      this.$element.get(0),
      {
        painter: new Scratchcard.Painter({
          thickness: this.thickness,
          color: this.color
        })
      }
    );

    this._scratchCard.on('progress', this._onProgress.bind(this));
  };

  SaveCoinTaskCard.prototype._onProgress = function(progress) {
    if (progress>this.threshold &&Â progress<1) {
      var onComplete = this.onComplete.bind(this);
      this.$scope.$evalAsync(onComplete);
      this._scratchCard.complete();

      this.complete = true;
    }
  };

  // registry
  angular.module(module).directive('saveCoinTaskCard', function(){
    return {
      scope: {
        color: '=?saveCoinTaskColor',
        thickness: '=?saveCoinTaskCardThickness',
        threshold: '=?saveCoinTaskCardThreshold',
        onComplete: '&saveCoinTaskCardOnComplete'
      },
      restrict: 'A',
      transclude: true,
      controller: SaveCoinTaskCard,
      bindToController: true,
      controllerAs: 'saveCoinTaskCardController',
      templateUrl: 'views/directives/save-coin-task-card.html'
    };
  });




})(ANGULAR_MODULE, angular);

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC9kaXJlY3RpdmVzL3NhdmUtY29pbi10YXNrLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJhcHAvZGlyZWN0aXZlcy9zYXZlLWNvaW4tdGFzay5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBnbG9iYWwgQU5HVUxBUl9NT0RVTEUsIGFuZ3VsYXIsIFNjcmF0Y2hjYXJkICovXG4oZnVuY3Rpb24obW9kdWxlLCBhbmd1bGFyKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvLyBTYXZlQ29pblRhc2tcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuICAvLyBjb250cm9sbGVyXG4gIHZhciBTYXZlQ29pblRhc2sgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmFtb3VudCA9IDM7XG4gICAgdGhpcy5jYXJkcyA9IFtdO1xuICAgIHRoaXMuY291bnQgPSAwO1xuICB9O1xuXG4gIFNhdmVDb2luVGFzay4kaW5qZWN0ID0gWyckc2NvcGUnLCckZWxlbWVudCcsJyRhdHRycyddO1xuXG4gIFNhdmVDb2luVGFzay5wcm90b3R5cGUuJG9uSW5pdCA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuaW5pdCgpO1xuICB9O1xuXG4gIFNhdmVDb2luVGFzay5wcm90b3R5cGUuaW5pdCA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuY2FyZHMgPSBbXTtcbiAgICBmb3IgKHZhciBpPTE7IGk8PXRoaXMuYW1vdW50OyBpKyspIHtcbiAgICAgIHRoaXMuY2FyZHMucHVzaChpKTtcbiAgICB9XG5cbiAgICB0aGlzLnJlc29sdmVkID0gZmFsc2U7XG4gIH07XG5cbiAgU2F2ZUNvaW5UYXNrLnByb3RvdHlwZS5yZXNldCA9IGZ1bmN0aW9uKCl7XG4gICAgdGhpcy5pbml0KCk7XG4gIH07XG5cbiAgU2F2ZUNvaW5UYXNrLnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbigpe1xuICAgIHRoaXMuY291bnQrKztcbiAgICB0aGlzLnJlc29sdmUoKTtcbiAgfTtcblxuICBTYXZlQ29pblRhc2sucHJvdG90eXBlLnJlc29sdmUgPSBmdW5jdGlvbigpe1xuICAgIGlmICh0aGlzLmNvdW50PHRoaXMuYW1vdW50KSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5yZXNvbHZlZCA9IHRydWU7XG4gICAgdGhpcy5vblJlc29sdmUoKTtcbiAgfTtcblxuICAvLyByZWdpc3RyeVxuICBhbmd1bGFyLm1vZHVsZShtb2R1bGUpLmRpcmVjdGl2ZSgnc2F2ZUNvaW5UYXNrJywgZnVuY3Rpb24oKXtcbiAgICByZXR1cm4ge1xuICAgICAgc2NvcGU6IHtcbiAgICAgICAgYW1vdW50OiAnPT9zYXZlQ29pblRhc2tBbW91bnQnLFxuICAgICAgICBvblJlc29sdmU6ICcmc2F2ZUNvaW5UYXNrT25SZXNvbHZlJ1xuICAgICAgfSxcbiAgICAgIHJlc3RyaWN0OiAnQScsXG4gICAgICB0cmFuc2NsdWRlOiB0cnVlLFxuICAgICAgY29udHJvbGxlcjogU2F2ZUNvaW5UYXNrLFxuICAgICAgYmluZFRvQ29udHJvbGxlcjogdHJ1ZSxcbiAgICAgIGNvbnRyb2xsZXJBczogJ3NhdmVDb2luVGFza0NvbnRyb2xsZXInLFxuICAgICAgdGVtcGxhdGVVcmw6ICd2aWV3cy9kaXJlY3RpdmVzL3NhdmUtY29pbi10YXNrLmh0bWwnXG4gICAgfTtcbiAgfSk7XG5cbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy8gU2F2ZUNvaW5UYXNrIENhcmRcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuICAvLyBjb250cm9sbGVyXG4gIHZhciBTYXZlQ29pblRhc2tDYXJkID0gZnVuY3Rpb24oJHNjb3BlLCRlbGVtZW50LCRhdHRycykge1xuICAgIHRoaXMuJGVsZW1lbnQgPSAkZWxlbWVudDtcbiAgICB0aGlzLiRzY29wZSA9ICRzY29wZTtcbiAgICB0aGlzLiRhdHRycyA9ICRhdHRycztcblxuICAgIHRoaXMudGhpY2tuZXNzID0gMjA7XG4gICAgdGhpcy50aHJlc2hvbGQgPSAwLjc1O1xuICAgIHRoaXMuY29sb3IgPSAnI2U1ZTVlNSc7XG5cbiAgICB0aGlzLmNvbXBsZXRlID0gZmFsc2U7XG4gICAgdGhpcy5fc2NyYXRjaENhcmQgPSBudWxsO1xuICB9O1xuXG4gIFNhdmVDb2luVGFza0NhcmQuJGluamVjdCA9IFsnJHNjb3BlJywnJGVsZW1lbnQnLCckYXR0cnMnXTtcblxuICBTYXZlQ29pblRhc2tDYXJkLnByb3RvdHlwZS4kb25Jbml0ID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5fc2NyYXRjaENhcmQgPSBuZXcgU2NyYXRjaGNhcmQoXG4gICAgICB0aGlzLiRlbGVtZW50LmdldCgwKSxcbiAgICAgIHtcbiAgICAgICAgcGFpbnRlcjogbmV3IFNjcmF0Y2hjYXJkLlBhaW50ZXIoe1xuICAgICAgICAgIHRoaWNrbmVzczogdGhpcy50aGlja25lc3MsXG4gICAgICAgICAgY29sb3I6IHRoaXMuY29sb3JcbiAgICAgICAgfSlcbiAgICAgIH1cbiAgICApO1xuXG4gICAgdGhpcy5fc2NyYXRjaENhcmQub24oJ3Byb2dyZXNzJywgdGhpcy5fb25Qcm9ncmVzcy5iaW5kKHRoaXMpKTtcbiAgfTtcblxuICBTYXZlQ29pblRhc2tDYXJkLnByb3RvdHlwZS5fb25Qcm9ncmVzcyA9IGZ1bmN0aW9uKHByb2dyZXNzKSB7XG4gICAgaWYgKHByb2dyZXNzPnRoaXMudGhyZXNob2xkICYmwqBwcm9ncmVzczwxKSB7XG4gICAgICB2YXIgb25Db21wbGV0ZSA9IHRoaXMub25Db21wbGV0ZS5iaW5kKHRoaXMpO1xuICAgICAgdGhpcy4kc2NvcGUuJGV2YWxBc3luYyhvbkNvbXBsZXRlKTtcbiAgICAgIHRoaXMuX3NjcmF0Y2hDYXJkLmNvbXBsZXRlKCk7XG5cbiAgICAgIHRoaXMuY29tcGxldGUgPSB0cnVlO1xuICAgIH1cbiAgfTtcblxuICAvLyByZWdpc3RyeVxuICBhbmd1bGFyLm1vZHVsZShtb2R1bGUpLmRpcmVjdGl2ZSgnc2F2ZUNvaW5UYXNrQ2FyZCcsIGZ1bmN0aW9uKCl7XG4gICAgcmV0dXJuIHtcbiAgICAgIHNjb3BlOiB7XG4gICAgICAgIGNvbG9yOiAnPT9zYXZlQ29pblRhc2tDb2xvcicsXG4gICAgICAgIHRoaWNrbmVzczogJz0/c2F2ZUNvaW5UYXNrQ2FyZFRoaWNrbmVzcycsXG4gICAgICAgIHRocmVzaG9sZDogJz0/c2F2ZUNvaW5UYXNrQ2FyZFRocmVzaG9sZCcsXG4gICAgICAgIG9uQ29tcGxldGU6ICcmc2F2ZUNvaW5UYXNrQ2FyZE9uQ29tcGxldGUnXG4gICAgICB9LFxuICAgICAgcmVzdHJpY3Q6ICdBJyxcbiAgICAgIHRyYW5zY2x1ZGU6IHRydWUsXG4gICAgICBjb250cm9sbGVyOiBTYXZlQ29pblRhc2tDYXJkLFxuICAgICAgYmluZFRvQ29udHJvbGxlcjogdHJ1ZSxcbiAgICAgIGNvbnRyb2xsZXJBczogJ3NhdmVDb2luVGFza0NhcmRDb250cm9sbGVyJyxcbiAgICAgIHRlbXBsYXRlVXJsOiAndmlld3MvZGlyZWN0aXZlcy9zYXZlLWNvaW4tdGFzay1jYXJkLmh0bWwnXG4gICAgfTtcbiAgfSk7XG5cblxuXG5cbn0pKEFOR1VMQVJfTU9EVUxFLCBhbmd1bGFyKTtcbiJdfQ==
