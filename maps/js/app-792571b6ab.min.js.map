{"version":3,"sources":["js/app-792571b6ab.min.js"],"names":["global","angular","module","app","config","$locationProvider","$stateProvider","$urlRouterProvider","$httpProvider","$templateRequestProvider","$resourceProvider","$qProvider","VIEWS_PATH","html5Mode","hashPrefix","interceptors","push","errorOnUnhandledRejections","defaults","actions","get","method","list","isArray","update","create","delete","decorator","state","parent","newViewConfig","views","forEach","view","viewMatch","match","viewName","stateName","name","replace","templateUrl","join","httpOptions","skipAuthorization","url","abstract","resolve","translations","i18n","load","template","current","user","$state","$timeout","promise","$promise","go","data","role","navbar@frontend","home@frontend","topics@frontend","financial-knowledge@frontend","financial-knowledge/interest-task@frontend","financial-knowledge/diversification-task@frontend","consumer-behaviour@frontend","consumer-behaviour/bomb-task@frontend","consumer-behaviour/anchoring-task@frontend","consumer-behaviour/mental-bookkeeping-task@frontend","consumer-behaviour/framing-task@frontend","self-control@frontend","self-control/savings-target-task@frontend","self-control/savings-supported-task@frontend","self-control/self-commitment-task@frontend","self-control/procrastination-task@frontend","status@frontend","contact@frontend","controller","controllerAs","footer@frontend","offcanvas@","@","isSuperAdmin","auth","$q","defer","successCallback","failureCallback","hasRole","then","redirectTo","main@backend","navbar@backend","footer@backend","workshops","Workshop","params","expand","value","dynamic","redirects","ROLE_ADMIN","admins","Admin","code","CODE_STORAGE_KEY","storage","proxy","getProxy","getItem","ROLE_USER","transition","$injector","injector","getAsync","resolvePolicy","when","ROLE_SUPER_ADMIN","otherwise","run","$transitions","$rootScope","appState","getUser","onStart","routerBusy","to","roles","indexOf","target","onError","onSuccess","$watch","isBusy","httpBusy","ANGULAR_MODULE","window","HttpInterceptor","this","_urls","$inject","prototype","getLastSuccessResponse","_lastSuccessResponse","getLastErrorResponse","_lastErrorResponse","getLastResponse","_lastResponse","getUrls","request","_setUrl","headers","token","Authorization","jwtToken","_getJWTToken","requestError","rejection","reject","response","_setLastSuccessResponse","_setLastResponse","responseError","_showGlobalErrorMessage","_setLastErrorResponse","_checkJWT","$httpParamSerializer","responseOrRejection","notification","skipGlobalErrorMessage","message","error","jwt","status","invalidate","getToken","isExpired","refresh","factory","httpInterceptor","instantiate","Notification","notify","options","UIkit","success","primary","warning","closeAll","service","AppState","routeBusy","Animation","animationEndEvent","dummy","document","createElement","events","WebkitAnimation","MozTAnimation","animation","key","event","style","undefined","transitionEndEvent","OTransition","MozTransition","WebkitTransition","translate","x","y","z","string","isUndefined","sprintf","webkitTransform","mozTransform","msTransform","oTransform","transform","requestAnimationFrame","lastTime","vendors","i","length","cancelAnimationFrame","callback","currTime","Date","getTime","timeToCall","Math","max","timeout","id","setTimeout","bind","clearTimeout","Random","_spareRandomCache","between","min","fact","rand","random","floor","gaussian","mean","stdDev","spare","u","v","s","m","sqrt","log","pick","array","shuffle","temp","String","input","variables","slice","call","arguments","truncate","maxLength","substring","trim","toCamel","part","toUpperCase","toSpinal","toLowerCase","toSnake","Storage","MODE_COOKIES","MODE_STORAGE","mode","_getCookieProxy","_getLocalStorageProxy","supportsLocalStorage","$window","storageProxy","localStorage","val","setItem","removeItem","e","_encode","JSON","stringify","encodeURIComponent","_decode","decoded","decodeURIComponent","parse","documentProxy","me","_getAll","items","cookies","cookie","split","setCookie","expires","domain","path","secure","date","isNaN","Error","toUTCString","getCookie","hasOwnProperty","getAllCookies","removeCookie","removeAllCookies","getAllItems","removeAllItems","clear","Auth","signup","firewall","$http","_saveToken","_getSignupUrl","post","_username","username","_password","password","extend","signin","_getSigninUrl","signout","unload","_getSignoutUrl","_getRefereshUrl","refresh_token","getRefreshToken","acceptExpired","decode","resolveRole","isString","setRefreshToken","setToken","API_URL","I18N","setLocale","_detectLocale","locales","de","defaultLocale","locale","getLocale","$log","_getJSONUrl","text","language","navigator","android","userAgent","userLanguage","systemLanguage","browserLanguage","substr","JWT","tokenKey","refreshKey","removeRefreshToken","removeToken","refreshToken","getExpirationDate","exp","setUTCSeconds","offset","now","valueOf","parts","_base64Decode","fromJson","output","atob","escaped","escape","User","_states","_eventSource","_results","_payload","_pending","_tasks","group","tickets","toJSON","_initTickets","_initState","_initGroup","isUser","_initWatches","_initTasks","_initPending","_initResults","_initSSE","sse","removeSource","_unwatchTickets","_unwatchState","result","_addResult","isAdmin","isInWorkshop","workshop","isActive","getTasks","getTaskByType","type","getPendingByType","getGroupAsString","getStateAsString","STATE_BEGINNER","_watchStateExpression","_watchStateCallback","newState","oldState","_watchTicketsExpression","_watchTicketsCallback","newTickets","oldTickets","console","_onMessage","$evalAsync","item","unix","updatedAt","task","onMessage","sleep","addSource","tasks","pending","results","$$results","Mail","send","_getPostUrl","_name","_mail","email","_subject","subject","_message","SSE","_sources","retry","_buildUrl","source","EventSource","onmessage","onerror","close","CardContainer","cards","canToggle","add","card","set","selected","directive","scope","restrict","bindToController","Card","$scope","$element","$attrs","$transclude","$id","hasIcon","isSlotFilled","disabled","isCheckbox","$onInit","cardContainer","click","$event","stopPropagation","preventDefault","changed","onClick","transclude","title","icon","buttons","require","Chart","_chart","_getOptions","labels","_getLabels","series","_getData","_render","$onDestroy","detach","mapResults","GROUP_A","GROUP_B","map","choice1","choice2","count","json","num","choice","groupA","groupB","choice3","choice4","SPLIT","ALL","failure","all","seriesBarDistance","chartPadding","top","left","right","bottom","axisY","labelInterpolationFnc","ticks","Chartist","FixedScaleAxis","high","low","plugins","legend","legendNames","addClass","element","render","Bar","Modal","_element","_modal","_scope","isVisible","_onShow","onShow","_onShown","onShown","_onBeforeShow","onBeforeShow","_onHide","onHide","_onHidden","onHidden","_onBeforeHide","onBeforeHide","_unwatch","destroy","clone","on","append","modal","show","off","remove","$destroy","hide","Video","_player","find","_onReady","_onStateChange","width","height","videoId","_watchAPIExpression","YOUTUBE_API_LOADED","_watchAPICallback","isReady","_unwatchAPI","getStyle","padding-bottom","YT","Player","onStateChange","PlayerState","PLAYING","onPlaying","PAUSED","onPaused","ENDED","onEnded","CUED","onCued","onBuffering","Status","iconRatio","isCompact","iconColor","tasksVisible","ticketsVisible","$watchCollection","_watchTasksExpression","_watchTasksCallback","_unwatchTasks","toggleTasks","toggleTickets","StatusIcons","ratio","color","isBeginner","isAmateuer","isAdvanced","isExpert","isProfi","STATE_AMATEUR","STATE_ADVANCED","STATE_EXPERT","_watchExpression","_watchCallback","isAmateur","StatusLabel","StatusTickets","Tabber","domId","hasExercise","activeTab","setActive","tab","exercise","description","Draggable","_body","_clone","_coordinates","_interactable","_activeClass","_itemClass","_disabledClass","removeClass","draggable","enabled","_onResize","restriction","body","interact","inertia","autoScroll","onend","_onEndItem","onmove","_onMoveItem","onstart","_onStartItem","snap","targets","interaction","_origin","startCoords","page","dropTarget","endOnly","manualStart","_onMove","getData","_window","_resize","unset","_trigger","$data","dx","dy","_translate","dropped","interactable","currentTarget","pointerIsDown","interacting","offsetY","clientHeight","offsetX","clientWidth","pageY","touches","pageX","css","position","start","args","onDragStart","onDragMove","onDragEnd","onDrop","Dropable","_enterClass","_acceptClass","accept","dropzone","ondrop","_onDrop","ondragenter","_onDragEnter","ondragleave","_onDragLeave","ondropactivate","_onDropActivate","ondropdeactivate","_onDropDeactivate","onDropDeactivate","onDropActivate","onDragEnter","onDragLeave","Accordion","_accordion","_collapsibles","_init","_onCollapsibleClicked","_unlistenCollapsible","addCollapsible","collapsible","$on","accordion","evt","sender","iterate","index","senderId","itemId","open","toggle","Collapsible","defaultId","$broadcast","content","ScrollTo","_source","_target","_scroller","_onClick","_onScrolled","delay","jQuery","charAt","warn","href","easing","isNumber","duration","scroll","onDelay","scrollTo","isFunction","Evaluation","customButtons","defaultButtons","LockedState","isLocked","userText","adminText","superAdminText","FormField","_transcludeElements","_transcludeScopes","_cloneDefault","_cloneLabel","_unlisten","label","ngModel","resetEmpty","showMessages","labelClass","failureClass","successClass","_addWatches","_transclude","unlisten","unwatch","setModel","_update","$valid","$invalid","_reset","$setUntouched","unwatchModel","newModel","oldModel","$touched","$pending","$viewValue","transcludeDefault","attr","replaceWith","transcludeLabel","messageMin","messageMax","messageUrl","messageEmail","messageNumber","messagePattern","messageRequired","messageMinlength","messageMaxlength","messagesCustom","FormFieldModel","autoFocus","formField","focus","RandomNumber","_timer","_shuffle","numbers","finished","_stop","maximum","cancel","ValidatorWorkshopExists","keyLocked","$asyncValidators","validatorWorkshopExists","validate","modelValue","$setValidity","validateWorkshopFrontend","ValidatorWorkshopUnique","validatorWorkshopUnique","validateWorkshopBackend","ValidatorAdminUnique","validatorAdminUnique","validateAdmin","InterestTask","resolved","currentExercise","correctAnswers","exercise1Answer","exercise2Answer","exercise1Correct","exercise2Correct","exercise1Result","exercise2Result","amount","rate","years","init","getPayload","payload","exercise1","currentResult","actualResult","isValid","exercise2","isPending","_isPending","canResolve","_calculateResult","_setCorrectAnswers","reset","onResolve","onUpdate","setResult","pow","InterestTaskExercise","stack","sum","notes","coins","revert","pop","DiversificationTask","$elemnt","heads","tails","companies","sides","one","company","two","throws","toss","ticketCount","getTicketCount","image","ticket","action","factorA","factorB","ticketsA","ticketsB","DiversificationTaskCoin","flip","animate","back","front","startSide","startValue","class","_toss","_getToss","_timeoutCallback","_iterateSides","side","_watchFlipCallback","newFlip","_watchFlipExpression","_watchTossCallback","newToss","oldToss","_watchTossExpression","_evalAsyncCallback","onFinish","_animationEndCallback","onInit","_unwatchFlip","_unwatchToss","$filter","picked","filtered","BombTask","started","stopped","hasBomb","totalBoxes","remainingBoxes","collectedBoxes","avg","rows","cols","interval","_initMembers","_initMatrix","_initBomb","$interval","_intIndex","iterator","_intervalId","stop","resolveCard","$$resolved","collection","column","active","$$active","splice","isBomb","total","collected","trackId","row","col","equals","bomb","matrix","columns","j","BombTaskCard","model","isDisabled","isClickable","onToggle","AnchoringTask","MentalBookkeepingTask","FramingTask","lotteryA","lotteryB","lottery","SavingsTargetTask","_isLocked","step","wish","amountRepeated","form","minAmount","maxAmount","timestampTask","timestampResult","getDifference","SavingsSupportedTask","SelfCommitmentTask","videos","canWatch","ProcrastinationTask","_onInterval","rounds","openRounds","minCatched","maxEscaped","invalidAt","hasWarmup","warmupMaxEscaped","warmupMinCatched","hasSuccess","setWarmup","setMode","setState","moment","warmup","isInvalid","_now","getCurrentRound","getRemainingTime","keys","difference","diff","seconds","asSeconds","minutes","asMinutes","hours","asHours","days","asDays","unit","ProcrastinationTaskGame","bubbles","viewport","_nextId","_tapped","_rounds","_retries","_timeout","_requestId","_loop","_viewport","catched","accuracy","expired","maxRounds","maxRetries","Number","POSITIVE_INFINITY","bubbleDelay","expire","_unloop","_getViewport","quit","_getResult","onGameOver","done","onGameDone","_setAccuracy","canRetry","canRestart","addBubble","bubble","removeBubble","resize","scrollTop","scrollLeft","ProcrastinationTaskBubble","themes","theme","radius","speed","wave","game","gameController","xOffset","_originalR","_originalX","sin","offscreenY","move","_resizeId","evalAsync","onAnimationEnd","LoginFrontend","codeMinLength","codePattern","userpattern","loginForm","next","reload","LoginBackend","usernameMinLength","passwordMinLength","passwordMaxLength","Contact","messageMinLength","submit","mail","contactForm","Frontend","confirmLogout","createResult","Result","$create","updateResult","logout","goTo","markConfirmLogout","_resultsSource","_userSources","_workshops","_initWorkshops","_initListener","nameMinLength","deleteWorkshop","drawingWorkshop","drawingTickets","drawingTicketsOne","drawingTicketsTwo","drawingAmount","chartResults","chartTask","uiOnParamsChanged","_expanded","$$expanded","unshift","_initWorkshop","_removeUsersStream","$delete","markWorkshopForDrawing","Ticket","ticketHash","rightSide","halfSize","ceil","leftSide","concat","indexOne","indexTwo","ticketOne","ticketTwo","drawingUserOne","drawingUserTwo","resource","getByWorkshop","workshopId","makeWorkshopDrawing","$$shuffleOne","$$shuffleTwo","resetWorkshopDrawing","$$finishedOne","$$finishedTwo","markWorkshopForDeletion","toggleWorkshop","$update","toggleCode","$$code","markTaskForChart","getByTask","taskId","toggleTask","Task","_addUsersStream","$$users","_streamResults","$uiRouterGlobals","old","users","_onDestroy","editAdmin","deleteAdmin","admin","markAdminForDeletion","markAdminForEdit","Backend","Factory","$resource","paramDefaults","validateUsernameFrontend","filter","apply","$stateful","fraction","toFixed","component","props","computed","offcanvas","$offcanvas","$el","methods","_dummyScroll","trigger"],"mappings":"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","file":"../../js/app-792571b6ab.min.js","sourcesContent":["/*!\n * efit-frontend\n * eFit Frontend\n * http://www.finanz-training.at\n * @author Armin Pfurtscheller\n * @version 1.0.0\n * Copyright 2017. MIT licensed.\n */\n/* global angular */\n(function(global, angular){\n  'use strict';\n\n  //\n  // MODULE\n  //\n  var module = 'eFit';\n\n  //\n  // APP\n  //\n  var app = angular.module(module, [\n    'ngSanitize',\n    'ngMessages',\n    'ngResource',\n    'ui.router',\n    'eFit.views',\n    'eFit.config'\n  ]);\n\n  //\n  // CONSTANTS\n  //\n\n  // @see: config.js\n\n  //\n  // CONFIG\n  //\n  app.config([\n    '$locationProvider', '$stateProvider', '$urlRouterProvider', '$httpProvider',\n    '$templateRequestProvider', '$resourceProvider', '$qProvider', 'VIEWS_PATH',\n    function(\n      $locationProvider, $stateProvider, $urlRouterProvider, $httpProvider,\n      $templateRequestProvider, $resourceProvider, $qProvider, VIEWS_PATH) {\n\n      // -------------------------\n      // LOCATION\n      // -------------------------\n      $locationProvider.html5Mode(false);\n      $locationProvider.hashPrefix('!');\n\n      // -------------------------\n      // INTERCEPTORS\n      // -------------------------\n      $httpProvider.interceptors.push('httpInterceptor');\n\n      // -------------------------\n      // PROMISES\n      // -------------------------\n      $qProvider.errorOnUnhandledRejections(false);\n\n      // -------------------------\n      // RESOURCES\n      // -------------------------\n      $resourceProvider.defaults.actions = {\n        get:    { method: 'GET' },\n        list:   { method: 'GET', isArray:true },\n        update: { method: 'PATCH' },\n        create: { method: 'POST'},\n        delete: { method: 'DELETE'}\n      };\n\n      // -------------------------\n      // TEMPLATES\n      // -------------------------\n\n      // assign default `templateUrl` for states\n      $stateProvider.decorator('views', function(state, parent) {\n        //\n        // Assigns default template URL:\n        // ./path/to/state/[view/][/name].html\n        //\n        var newViewConfig = {}, views = parent(state);\n        angular.forEach(views, function(config, view){\n          var viewMatch = view.match(/([^@]+)\\@/); // [parentView/]view@state.name\n          var viewName = viewMatch ? '/' + viewMatch[1] : '';\n\n          var stateName = state.name.replace(/\\./g, '/');\n\n          var templateUrl = config.templateUrl || [\n            VIEWS_PATH,\n            stateName,\n            viewName,\n            '.html'\n          ].join('');\n\n          config.templateUrl = templateUrl;\n          newViewConfig[view] = config;\n        });\n\n        return newViewConfig;\n      });\n\n      // ignore JWT authorization on template requests\n      $templateRequestProvider.httpOptions({\n        skipAuthorization: true\n      });\n\n      // -------------------------\n      // STATES\n      // -------------------------\n\n      // main (i18n)\n      $stateProvider.state('main', {\n        url: '',\n        abstract: true,\n        resolve: {\n          translations: ['i18n', function(i18n){\n            return i18n.load('de', {\n              skipAuthorization: true\n            });\n          }],\n        },\n        template: '<div id=\"main\" data-ui-view=\"\"></div>'\n      });\n\n      // frontend\n      $stateProvider.state('frontend', {\n        parent: 'main',\n        url: '/',\n        resolve: {\n          current: [\n            'user', '$state', '$timeout',\n            function(user, $state, $timeout){\n              var promise = user.load().$promise;\n              return promise.catch(function(){\n                $timeout(function(){\n                  $state.go('login.frontend');\n                });\n              });\n            }\n          ]\n        },\n        data: {\n          role: [\n            'ROLE_USER',\n            'ROLE_ADMIN',\n            'ROLE_SUPER_ADMIN'\n          ]\n        },\n        views: {\n          'navbar@frontend': {},\n          'home@frontend': {},\n          'topics@frontend': {},\n\n          'financial-knowledge@frontend':{},\n          'financial-knowledge/interest-task@frontend':{},\n          'financial-knowledge/diversification-task@frontend':{},\n\n          'consumer-behaviour@frontend':{},\n          'consumer-behaviour/bomb-task@frontend':{},\n          'consumer-behaviour/anchoring-task@frontend':{},\n          'consumer-behaviour/mental-bookkeeping-task@frontend':{},\n          'consumer-behaviour/framing-task@frontend':{},\n\n          'self-control@frontend':{},\n          'self-control/savings-target-task@frontend':{},\n          'self-control/savings-supported-task@frontend':{},\n          'self-control/self-commitment-task@frontend':{},\n          'self-control/procrastination-task@frontend':{},\n\n          'status@frontend': {},\n          'contact@frontend': {\n            controller: 'ContactController',\n            controllerAs: 'contactController'\n          },\n          'footer@frontend': {},\n          'offcanvas@': {\n            controller: 'FrontendController',\n            controllerAs: 'frontendController'\n          },\n          '@': {\n            controller: 'FrontendController',\n            controllerAs: 'frontendController'\n          }\n        }\n      });\n\n      // backend\n      $stateProvider.state('backend', {\n        parent: 'main',\n        url: '/admin',\n        data: {\n          role: [\n            'ROLE_ADMIN',\n            'ROLE_SUPER_ADMIN'\n          ]\n        },\n        resolve: {\n          isSuperAdmin: [\n            'auth', '$state', '$q',\n            function(auth, $state, $q){\n              var defer = $q.defer();\n\n              var successCallback = function() {\n                defer.resolve(true);\n              };\n              var failureCallback = function() {\n                defer.resolve(false);\n              };\n\n              auth.hasRole(\n                'ROLE_SUPER_ADMIN'\n              ).then(\n                successCallback,\n                failureCallback\n              );\n\n              return defer.promise;\n            }\n          ]\n        },\n        redirectTo: 'backend.workshops',\n        views: {\n          'main@backend': {},\n          'navbar@backend': {},\n          'footer@backend': {},\n          'offcanvas@': {\n            controller: 'BackendController',\n            controllerAs: 'backendController'\n          },\n          '@': {\n            controller: 'BackendController',\n            controllerAs: 'backendController'\n          }\n        },\n\n      });\n\n      $stateProvider.state('backend.workshops', {\n        url: '?{expand:int}',\n        data: {\n          role: [\n            'ROLE_ADMIN',\n            'ROLE_SUPER_ADMIN'\n          ]\n        },\n        resolve: {\n          workshops: ['Workshop', function(Workshop){\n            return Workshop.list().$promise;\n          }]\n        },\n        params: {\n          expand: {\n            value: null,\n            dynamic: true\n          }\n        },\n        controller: 'WorkshopController',\n        controllerAs: 'workshopController'\n      });\n\n      $stateProvider.state('backend.admins', {\n        url: '/trainer',\n        data: {\n          role: 'ROLE_SUPER_ADMIN',\n          redirects: {\n            ROLE_ADMIN: 'backend'\n          }\n        },\n        resolve: {\n          admins: ['Admin', function(Admin){\n            return Admin.list().$promise;\n          }]\n        },\n        controller: 'AdminController',\n        controllerAs: 'adminController'\n      });\n\n      // login\n      $stateProvider.state('login', {\n        url: '/login',\n        parent: 'main',\n        abstract: true,\n        redirectTo: 'login.frontend.index'\n      });\n\n      $stateProvider.state('login.frontend', {\n        url: '/app',\n        resolve: {\n          code: [\n            'CODE_STORAGE_KEY', 'storage',\n            function(CODE_STORAGE_KEY, storage){\n              var proxy = storage.getProxy();\n              return proxy.getItem(\n                CODE_STORAGE_KEY\n              );\n            }\n          ]\n        },\n        data: {\n          redirects: {\n            ROLE_USER: 'frontend'\n          }\n        },\n        redirectTo: 'login.frontend.index',\n        controller: 'LoginFrontendController',\n        controllerAs: 'loginFrontendController'\n      });\n\n      $stateProvider.state('login.frontend.index', {\n        url: ''\n      });\n\n      $stateProvider.state('login.frontend.signup', {\n        url: '/schule',\n        redirectTo: 'login.frontend.signup.step1'\n      });\n\n      $stateProvider.state('login.frontend.signup.step1', {\n        url: '/schritt-1',\n        redirectTo: function(transition){\n          var redirectTo = function(code) {\n            if (code) {\n              return 'login.frontend.signup.step2';\n            }\n          };\n\n          var $injector = transition.injector();\n          var code = $injector.getAsync('code');\n          return code.then(redirectTo);\n        }\n      });\n\n      $stateProvider.state('login.frontend.signup.step2', {\n        url: '/schritt-2',\n        resolvePolicy: { when: 'EAGER' },\n        redirectTo: function(transition){\n          var redirectTo = function(code) {\n            if (!code) {\n              return 'login.frontend.signup.step1';\n            }\n          };\n\n          var $injector = transition.injector();\n          var code = $injector.getAsync('code');\n          return code.then(redirectTo);\n        }\n      });\n\n      $stateProvider.state('login.frontend.signin', {\n        url: '/zuhause'\n      });\n\n      $stateProvider.state('login.backend', {\n        url: '/admin',\n        data: {\n          redirects: {\n            ROLE_ADMIN: 'backend',\n            ROLE_SUPER_ADMIN: 'backend'\n          }\n        },\n        controller: 'LoginBackendController',\n        controllerAs: 'loginBackendController'\n      });\n\n      $urlRouterProvider.otherwise('/');\n    }\n  ]);\n\n  //\n  // RUN\n  //\n  app.run(['$injector', function($injector) {\n      var $transitions = $injector.get('$transitions');\n      var $rootScope = $injector.get('$rootScope');\n      var appState = $injector.get('appState');\n      var $state = $injector.get('$state');\n      var auth = $injector.get('auth');\n      var user = auth.getUser();\n\n      var onStart = function(transition) {\n        appState.routerBusy = true;\n\n        var state = transition.to();\n        var data = state.data || {};\n        var role = data.role || null;\n        var redirects = data.redirects || {};\n\n        // no authentication check for states\n        // without any authorization settings\n        if (role === null) {\n\n          // try to redirect authenticated users\n          // with auth roles to configured route\n          if (user === null) {\n            return true;\n          }\n\n          var roles = user.roles || [];\n          for (role in redirects) {\n            if (roles.indexOf(role)>=0) {\n              var target = redirects[role];\n              return $state.target(target);\n            }\n          }\n\n          return true;\n        }\n\n        // assert role an array for callbacks\n        if (!angular.isArray(role)) {\n          role = [role];\n        }\n\n        var successCallback = function()\n          {\n            return true;\n          };\n\n        var failureCallback = function()\n          {\n            // redirect to login page depending on\n            // given role with unsufficient rights\n            // or possibly failed refresh process!\n            switch(role[0])\n            {\n              case 'ROLE_ADMIN':\n              case 'ROLE_SUPER_ADMIN':\n                return $state.target('login.backend');\n              default:\n                return $state.target('login.frontend');\n            }\n          };\n\n        return auth.hasRole(role).then(\n          successCallback,\n          failureCallback\n        );\n      };\n\n      var onError = function(/*transition*/) {\n        appState.routerBusy = false;\n\n        // no initial user before transition\n        if (user === null) {\n          return;\n        }\n\n        // get initial user's role and see if\n        // there was an invalidation ($http)!\n        var role = user.roles[0];\n        user = auth.getUser();\n        if (user !== null) {\n          return;\n        }\n\n        // user's jwt was destroyed, redirect\n        // user according to its initial role\n        switch(role)\n        {\n          case 'ROLE_ADMIN':\n          case 'ROLE_SUPER_ADMIN':\n            $state.go('login.backend');\n            break;\n          default:\n            $state.go('login.frontend');\n        }\n      };\n\n      var onSuccess = function(transition) {\n        $rootScope.state = transition.to();\n        appState.routerBusy = false;\n      };\n\n      $rootScope.$watch(\n        function() {\n          return appState.isBusy();\n        },\n        function(isBusy) {\n          $rootScope.isBusy = isBusy;\n          $rootScope.httpBusy = appState.httpBusy;\n          $rootScope.routerBusy = appState.routerBusy;\n        }\n      );\n\n      $transitions.onError({}, onError);\n      $transitions.onStart({}, onStart);\n      $transitions.onSuccess({}, onSuccess);\n    }\n  ]);\n\n  //\n  // EXPOSE\n  //\n  global.ANGULAR_MODULE = module;\n\n})(window, angular);\n\n/* global ANGULAR_MODULE, angular */\n(function(module, angular) {\n  'use strict';\n\n  var HttpInterceptor = function($injector)\n    {\n      this.$injector = $injector;\n      this._urls = {};\n    };\n\n  /** @var {Array.<string>} $inject Dependencies to be injected by Angular. */\n  HttpInterceptor.$inject = ['$injector'];\n\n  /**\n   * Gets latest response from $http.\n   */\n  HttpInterceptor.prototype.getLastSuccessResponse = function()\n    {\n      return this._lastSuccessResponse;\n    };\n\n  /**\n   * Gets latest error from $http.\n   */\n  HttpInterceptor.prototype.getLastErrorResponse = function()\n    {\n      return this._lastErrorResponse;\n    };\n\n  /**\n   * Gets latest response from $http.\n   */\n  HttpInterceptor.prototype.getLastResponse = function()\n    {\n      return this._lastResponse;\n    };\n\n  /**\n   * Returns a hash of all requested urls.\n   */\n  HttpInterceptor.prototype.getUrls = function()\n    {\n      return this._urls;\n    };\n\n  /**\n   * Intercepts $http request's config before invocation.\n   * @param {object} config\n   * @return {object} config\n   */\n  HttpInterceptor.prototype.request = function(config)\n    {\n      var appState = this.$injector.get('appState');\n\n      // set app state to busy\n      appState.httpBusy = true;\n\n      // save url in internal cache\n      this._setUrl(config);\n\n      // set common headers\n      config.headers['X-Requested-With'] = 'XMLHttpRequest';\n\n      // JWT authorization\n      var successCallback = function(token) {\n        if (token) {\n          config.headers.Authorization = 'Bearer ' + token;\n        }\n\n        return config;\n      };\n\n      var failureCallback = function() {\n        return config;\n      };\n\n      if (config.skipAuthorization) {\n        return config;\n      }\n\n      var jwtToken = this._getJWTToken(config);\n      var $q = this.$injector.get('$q');\n      return $q.when(jwtToken).then(\n        successCallback,\n        failureCallback\n      );\n    };\n\n  /**\n   * Intercepts $http request error's config before invocation.\n   * @param {object} config\n   * @return {object} config\n   */\n  HttpInterceptor.prototype.requestError = function(rejection)\n    {\n      var appState = this.$injector.get('appState');\n      var $q = this.$injector.get('$q');\n\n      appState.httpBusy = false;\n\n      return $q.reject(rejection);\n    };\n\n  /**\n   * Intercepts $http response before forwarding.\n   * @param {object} config\n   * @return {object} config\n   */\n  HttpInterceptor.prototype.response = function(response)\n    {\n      var appState = this.$injector.get('appState');\n\n      this._setLastSuccessResponse(response);\n      this._setLastResponse(response);\n\n      appState.httpBusy = false;\n\n      return response;\n    };\n\n  /**\n   * Intercepts $http error response before forwarding.\n   * @param {object} config\n   * @return {object} config\n   */\n  HttpInterceptor.prototype.responseError = function(rejection)\n    {\n      var appState = this.$injector.get('appState');\n      var $q = this.$injector.get('$q');\n\n      this._showGlobalErrorMessage(rejection);\n      this._setLastErrorResponse(rejection);\n      this._setLastResponse(rejection);\n      this._checkJWT(rejection);\n\n      appState.httpBusy = false;\n\n      return $q.reject(rejection);\n    };\n\n  /**\n   * Sets fully qualified url with query string for a request.\n   * This is useful to manage Angular's $cacheFactory for $http.\n   * @param {object} config\n   */\n  HttpInterceptor.prototype._setUrl = function(config)\n    {\n      var $httpParamSerializer = this.$injector.get('$httpParamSerializer');\n      var params = $httpParamSerializer(config.params);\n      var url = config.url + (\n        params ?\n          '?' + params :\n          ''\n      );\n\n      this._urls[url] = true;\n    };\n\n  /**\n   * @ignore\n   */\n  HttpInterceptor.prototype._setLastResponse = function(responseOrRejection)\n    {\n      this._lastResponse = responseOrRejection;\n    };\n\n  /**\n   * @ignore\n   */\n  HttpInterceptor.prototype._setLastErrorResponse = function(rejection)\n    {\n      this._lastErrorResponse = rejection;\n    };\n\n  /**\n   * @ignore\n   */\n  HttpInterceptor.prototype._setLastSuccessResponse = function(response)\n    {\n      this._lastSuccessResponse = response;\n    };\n\n  /**\n   * @ignore\n   */\n  HttpInterceptor.prototype._showGlobalErrorMessage = function(rejection)\n  {\n    var notification = this.$injector.get('notification');\n    var i18n = this.$injector.get('i18n');\n\n    var config = rejection.config || {};\n    if (config.skipGlobalErrorMessage) {\n      return;\n    }\n\n    var data = rejection.data || {};\n    if (!data.message) {\n      return;\n    }\n\n    notification.error(i18n.get(data.message));\n  };\n\n  /**\n   * @ignore\n   */\n  HttpInterceptor.prototype._checkJWT = function(rejection)\n  {\n    var jwt = this.$injector.get('jwt');\n\n    switch (rejection.status) {\n      case 403:\n        // invalidate user on 403 message\n        // to redirect to the login pages\n        jwt.invalidate();\n        break;\n      default:\n    }\n  };\n\n  /**\n   * @ignore\n   */\n  HttpInterceptor.prototype._getJWTToken = function() {\n    var auth = this.$injector.get('auth');\n    var jwt = this.$injector.get('jwt');\n\n    // a) no token available in storage\n    var token = jwt.getToken();\n    if (!token) {\n      return null;\n    }\n\n    // b) token is still valid, check for\n    // refresh if it expires in 5 minutes\n    if (jwt.isExpired(token, 600)) {\n      var successCallback = function() {\n        return jwt.getToken();\n      };\n\n      var failureCallback = function() {\n        return null;\n      };\n\n      return auth.refresh().then(\n        successCallback,\n        failureCallback\n      );\n    }\n\n    // c) use current token\n    return jwt.getToken();\n  };\n\n  //\n  // REGISTRY\n  //\n  angular.module(module).factory('httpInterceptor',['$injector',function($injector){\n\n      var httpInterceptor = $injector.instantiate(HttpInterceptor);\n\n      return { // important: $http service invokes this methods with global scope!\n        getUrls: function(){ return httpInterceptor.getUrls(); },\n        getLastResponse: function(){ return httpInterceptor.getLastResponse(); },\n        getLastErrorResponse: function(){ return httpInterceptor.getLastErrorResponse(); },\n        getLastSuccessResponse: function(){ return httpInterceptor.getLastSuccessResponse(); },\n        request: function(config){ return httpInterceptor.request(config); },\n        response: function(response){ return httpInterceptor.response(response); },\n        requestError: function(rejection){ return httpInterceptor.responseError(rejection); },\n        responseError: function(rejection){ return httpInterceptor.responseError(rejection); }\n      };\n    }]);\n\n})(ANGULAR_MODULE, angular);\n\n/* global ANGULAR_MODULE, angular, UIkit */\n(function(module, angular) {\n  'use strict';\n\n  //\n  // SERVICE\n  //\n\n  /**\n   * @constructor\n   */\n  var Notification = function() {\n  };\n\n  Notification.$inject = [];\n\n  //\n  // METHODS\n  //\n\n  /**\n   * Shows user notification in a toast message.\n   *\n   * @public\n   * @method notify\n   * @param {string} message\n   * @param {string} status One of `danger`, `warning`, `success` or `primary`.\n   * @param {object} options Additional options like `timeout` and `pos`.\n   * @return {object} Notification object\n   */\n  Notification.prototype.notify = function(message, status, options) {\n    status = status || 'default';\n    options = options || {};\n\n    options.message = message;\n    options.status = status;\n\n    return UIkit.notification(options);\n  };\n\n  /**\n   * Shows user success notification.\n   *\n   * @public\n   * @method success\n   * @param {string} message\n   * @return {void}\n   */\n  Notification.prototype.success = function(message, options) {\n    this.notify(message, 'success', options);\n  };\n\n  /**\n   * Shows user primary notification.\n   *\n   * @public\n   * @method success\n   * @param {string} message\n   * @return {void}\n   */\n  Notification.prototype.primary = function(message, options) {\n    this.notify(message, 'primary', options);\n  };\n\n  /**\n   * Shows user error notification.\n   *\n   * @public\n   * @method error\n   * @param {string} message\n   * @return {void}\n   */\n  Notification.prototype.error = function(message, options) {\n    this.notify(message, 'danger', options);\n  };\n\n  /**\n   * Shows user warning notification.\n   *\n   * @public\n   * @method warning\n   * @param {string} message\n   * @return {void}\n   */\n  Notification.prototype.warning = function(message, options) {\n    this.notify(message, 'warning', options);\n  };\n\n  /**\n   * Closes all open notifications.\n   *\n   * @public\n   * @method closeAll\n   * @return {void}\n   */\n  Notification.prototype.closeAll = function() {\n    UIkit.notification.closeAll();\n  };\n\n  //\n  // REGISTRY\n  //\n  angular.module(module).service('notification', Notification);\n\n})(ANGULAR_MODULE, angular);\n\n/* global ANGULAR_MODULE, angular */\n(function(module, angular) {\n  'use strict';\n\n  //\n  // SERVICE\n  //\n\n  /**\n   * @constructor\n   */\n  var AppState = function($injector)\n    {\n      this.$injector = $injector;\n    };\n\n  AppState.$inject = ['$injector'];\n\n  //\n  // PROPERTIES\n  //\n\n  /** @var {boolean} httpBusy If $http is currently doing work. */\n  AppState.prototype.httpBusy = false;\n\n  /** @var {boolean} routerBusy If router is currently doing work. */\n  AppState.prototype.routerBusy = false;\n\n  //\n  // METHODS\n  //\n\n  /**\n   * Returns true if `httpBusy` or `routeBusy` is true.\n   *\n   * @public\n   * @method isBusy\n   * @return {void}\n   */\n  AppState.prototype.isBusy = function() {\n    return this.httpBusy || this.routeBusy;\n  };\n\n  //\n  // REGISTRY\n  //\n  angular.module(module).service('appState', AppState);\n\n})(ANGULAR_MODULE, angular);\n\n/* global ANGULAR_MODULE, angular */\n(function(module, angular) {\n\n  'use strict';\n\n  //\n  // SERVICE\n  //\n\n  /**\n   * @constructor\n   */\n  var Animation = function($injector)\n    {\n      this.$injector = $injector;\n    };\n\n  Animation.$inject = ['$injector'];\n\n  /**\n   * Gets correctly prefixed animation end event.\n   *\n   * @private\n   * @property animationEndEvent\n   * @return {void}\n   */\n  Animation.prototype.animationEndEvent = (function() {\n    var dummy = document.createElement('div');\n    var events = {\n      'WebkitAnimation': 'webkitAnimationEnd',\n      'MozTAnimation': 'animationend',\n      'animation': 'animationend'\n    };\n\n    for(var key in events){\n        var event = dummy.style[key];\n        if( event !== undefined ){\n          return events[key];\n        }\n    }\n\n    return null;\n  })();\n\n  /**\n   * Gets correctly prefixed transition end event.\n   *\n   * @private\n   * @property transitionEndEvent\n   * @return {void}\n   */\n  Animation.prototype.transitionEndEvent = (function() {\n    var dummy = document.createElement('div');\n    var events = {\n      'transition':'transitionend',\n      'OTransition':'oTransitionEnd',\n      'MozTransition':'transitionend',\n      'WebkitTransition':'webkitTransitionEnd'\n    };\n\n    for(var key in events){\n        var event = dummy.style[key];\n        if( event !== undefined ){\n          return events[key];\n        }\n    }\n\n    return null;\n  })();\n\n  /**\n   * Prepares cross-browser compatible tranlsate hash for ng-style.\n   *\n   * @public\n   * @method translate\n   * @param {number} x\n   * @param {number} y\n   * @param {number} [z]\n   * @return {object}\n   */\n  Animation.prototype.translate = function(x, y, z) {\n    var string = this.$injector.get('string');\n\n    var translate = angular.isUndefined(z) ?\n      string.sprintf('translate(%spx,%spx)', x, y) :\n      string.sprintf('translate3d(%spx,%spx,%spx)', x, y, z);\n\n    return {\n      'webkitTransform': translate,\n      'mozTransform': translate,\n      'msTransform': translate,\n      'oTransform': translate,\n      'transform': translate\n    };\n  };\n\n  /**\n   * Polyfills potentially missing `requestAnimationFrame`.\n   *\n   * @private\n   * @method requestAnimationFrame\n   * @return {void}\n   */\n  Animation.prototype.requestAnimationFrame = (function(){\n      var lastTime = 0;\n      var vendors = ['ms', 'moz', 'webkit', 'o'];\n      for(var i = 0; i < vendors.length && !window.requestAnimationFrame; i++) {\n          window.requestAnimationFrame = window[vendors[i]+'RequestAnimationFrame'];\n          window.cancelAnimationFrame = (\n            window[vendors[i]+'CancelAnimationFrame'] ||\n            window[vendors[i]+'CancelRequestAnimationFrame']\n          );\n      }\n\n      if (!window.requestAnimationFrame) {\n        window.requestAnimationFrame = function(callback) {\n            var currTime = new Date().getTime();\n            var timeToCall = Math.max(0, 16 - (currTime - lastTime));\n            var timeout = function() { callback(currTime + timeToCall); };\n            var id = window.setTimeout(timeout, timeToCall);\n            lastTime = currTime + timeToCall;\n            return id;\n        };\n      }\n\n      return window.requestAnimationFrame.bind(window);\n  }());\n\n  /**\n   * Polyfills potentially missing `cancelAnimationFrame`.\n   *\n   * @private\n   * @method cancelAnimationFrame\n   * @return {void}\n   */\n  Animation.prototype.cancelAnimationFrame = (function(){\n    if (!window.cancelAnimationFrame) {\n      window.cancelAnimationFrame = function(id) { clearTimeout(id); };\n    }\n\n    return window.cancelAnimationFrame.bind(window);\n  })();\n\n  //\n  // REGISTRY\n  //\n  angular.module(module).service('animation', Animation);\n\n})(ANGULAR_MODULE, angular);\n\n/* global ANGULAR_MODULE, angular */\n(function(module, angular) {\n  'use strict';\n\n  var Random = function() {\n    this._spareRandomCache = null;\n  };\n\n  Random.$inject = [];\n\n  Random.prototype.between = function(min, max) {\n    min = typeof min !== 'undefined' ? min : 0;\n    max = typeof max !== 'undefined' ? max : 1;\n\n    var fact = (max - min + 1);\n    var rand = Math.random();\n\n    return Math.floor(rand * fact + min);\n  };\n\n  Random.prototype.gaussian = function(mean, stdDev) {\n    stdDev = typeof stdDev !== 'undefined' ? stdDev : 1;\n    mean = typeof mean !== 'undefined' ? mean : 0;\n\n    var spare = this._spareRandomCache;\n    if (this._spareRandomCache !== null) {\n      this._spareRandomCache = null;\n      return mean + stdDev * spare;\n    }\n\n    var u, v, s;\n\n    do {\n      u = 2 * Math.random() - 1;\n      v = 2 * Math.random() - 1;\n      s = u*u + v*v;\n    } while (s >= 1 || s===0);\n\n    var m = Math.sqrt(-2 * Math.log(s) / s);\n    this._spareRandomCache = v * m;\n    return mean + stdDev * u * m;\n  };\n\n  Random.prototype.pick = function(array) {\n    return array[this.between(0, array.length - 1)];\n  };\n\n  Random.prototype.push = function(array, value) {\n    var rand = this.between(0, array.length - 1);\n    array.push(array[rand]);\n    array[rand] = value;\n\n    return array.length;\n  };\n\n  Random.prototype.shuffle = function(array) {\n    for( var i=array.length-1; i>0; i-- ) {\n      var rand = this.between(0, i);\n      var temp = array[i];\n\n      array[i] = array[rand];\n      array[rand] = temp;\n    }\n\n    return array;\n  };\n\n  //\n  // REGISTRY\n  //\n  angular.module(module).service('random', Random);\n\n})(ANGULAR_MODULE, angular);\n\n/* global ANGULAR_MODULE, angular */\n(function(module, angular) {\n\n  'use strict';\n\n  //\n  // SERVICE\n  //\n\n  /**\n   * @constructor\n   */\n  var String = function()\n    {\n    };\n\n  String.$inject = [];\n\n  /**\n   * Replaces placeholders (= '%s') from a string with variables.\n   *\n   * @public\n   * @method sprintf\n   * @param {string} input String to replace placeholders.\n   * @param {object} variables Object holding replacements.\n   * @return {string}\n   */\n  String.prototype.sprintf = function(input,variables)\n    {\n        if (!angular.isArray(variables)) {\n          variables = [].slice.call(arguments, 1);\n        }\n\n        for (var i=0; i<variables.length; i++) {\n          input = input.replace(/%s/,variables[i]);\n        }\n\n        return input;\n    };\n\n  /**\n   * Truncates a string by given params.\n   *\n   * @public\n   * @method truncate\n   * @param {string} input String to be truncated.\n   * @param {number} [maxLength=20] Maximum number of chars.\n   * @return {string}\n   */\n  String.prototype.truncate = function(input,maxLength)\n    {\n        maxLength = maxLength || 20;\n        if (input.length <= maxLength) {\n          return input;\n        }\n\n        return input.substring(0,maxLength) + '...';\n    };\n\n  /**\n   * Trims a string.\n   *\n   * @public\n   * @method trim\n   * @param {string} input String to trim.\n   * @return {string}\n   */\n  String.prototype.trim = function(input)\n    {\n        return input.replace(/^\\s+|\\s+$/g, '');\n    };\n\n  /**\n   * Transforms a string to camel case.\n   *\n   * @public\n   * @method toCamel\n   * @param {string} input String to convert.\n   * @return {string}\n   */\n  String.prototype.toCamel = function(input)\n    {\n        return input.replace(/([-_][a-z])/g, function(part){\n            return part.toUpperCase().replace(/[-_]/,'');\n        });\n    };\n\n  /**\n   * Transforms a string to spinal case.\n   *\n   * @public\n   * @method toSpinal\n   * @param {string} input String to convert.\n   * @return {string}\n   */\n  String.prototype.toSpinal = function(input)\n    {\n        return input.replace(/([A-Z]|_[a-z])/g, function(part){\n            return '-' + part.toLowerCase().replace(/_/,'');\n        });\n    };\n\n  /**\n   * Transforms a string to snake case.\n   *\n   * @public\n   * @method toSnake\n   * @param {string} input String to convert.\n   * @return {string}\n   */\n  String.prototype.toSnake = function(input)\n    {\n        return input.replace(/([A-Z]|-[a-z])/g, function(part){\n            return '_' + part.toLowerCase().replace(/-/,'');\n        });\n    };\n\n  //\n  // REGISTRY\n  //\n  angular.module(module).service('string', String);\n\n})(ANGULAR_MODULE, angular);\n\n/* global ANGULAR_MODULE, angular */\n(function(module, angular) {\n  'use strict';\n\n  /**\n   * @varructor\n   */\n  var Storage = function($injector) {\n    this.$injector = $injector;\n  };\n\n  Storage.MODE_COOKIES = 'COOKIES';\n  Storage.MODE_STORAGE = 'STORAGE';\n  Storage.$inject = ['$injector'];\n\n  /**\n   * Gets the current storage interface of the service.\n   * Can be one of modes `COOKIES` or `STORAGE`. If no\n   * one is given will default to local storage if it's\n   * supported, otherwise falls back to cookies.\n   *\n   * @public\n   * @method getProxy\n   * @param {String} mode\n   * @return {Object}\n   */\n  Storage.prototype.getProxy = function(mode) {\n    switch (mode) {\n      case Storage.MODE_COOKIES:\n       return this._getCookieProxy();\n\n      case Storage.MODE_STORAGE:\n       return this._getLocalStorageProxy();\n\n     default:\n      if (this.supportsLocalStorage()) {\n        return this._getLocalStorageProxy();\n      }\n\n      return this._getCookieProxy();\n    }\n  };\n\n  /**\n   * Checks if browser supports local storage.\n   *\n   * @public\n   * @method supportsLocalStorage\n   * @return {Boolean}\n   */\n  Storage.prototype.supportsLocalStorage = function() {\n    var $window = this.$injector.get('$window');\n    var storageProxy = $window.localStorage;\n    var key = '__local__storage__feature__test';\n    var val = '__local__storage__feature__test';\n\n    try {\n     storageProxy.setItem(key, val);\n     storageProxy.removeItem(key);\n    } catch (e) {\n     return false;\n    }\n\n    return true;\n  };\n\n  /**\n   * Stringifies and uri encodes a value.\n   *\n   * @private\n   * @param {Mixed} value\n   * @method _encode\n   *\n   * @return {String}\n   */\n  Storage.prototype._encode = function(value) {\n    try {\n     value = JSON.stringify(value);\n    } catch (e) {\n     value = undefined;\n    }\n\n    return encodeURIComponent(value);\n  };\n\n  /**\n   * Decodes a stringified and uri encoded value.\n   *\n   * @private\n   * @param {Mixed}\n   * @method _decodeValue\n   *\n   * @return {Mixed}\n   */\n  Storage.prototype._decode = function(value) {\n    var decoded;\n    switch (typeof value) {\n     case 'string':\n       decoded = decodeURIComponent(value);\n       try {\n         decoded = JSON.parse(decoded);\n       } catch (e) {\n         /* noop */\n       }\n       break;\n     default:\n       decoded = undefined;\n    }\n\n    if (decoded === 'undefined') {\n     decoded = undefined;\n    }\n\n    if (decoded === undefined) {\n     decoded = null;\n    }\n\n    return decoded;\n  };\n\n  /**\n   * Provides cookie storage proxy layer.\n   *\n   * @private\n   * @method _getCookieProxy\n   *\n   * @return {Object}\n   */\n  Storage.prototype._getCookieProxy = function() {\n    var documentProxy = this.$injector.get('$document');\n\n    var me = this;\n    var _getAll = function(parse) {\n     var items = {};\n\n     var cookies = documentProxy.cookie.split('; ');\n     if (cookies.length === 1 && cookies[0] === '') {\n       return items;\n     }\n\n     for (var i = 0; i < cookies.length; i++) {\n       var cookie = cookies[i].split('=');\n       if (!parse) {\n         items[cookie[0]] = cookie[1];\n         continue;\n       }\n\n       items[cookie[0]] = me._decode(cookie[1]);\n     }\n\n     return items;\n    };\n\n    var setCookie = function(key, value, expires, domain, path, secure) {\n     value = me._encode(value);\n\n     try {\n       var date = new Date(expires);\n       if (isNaN(date)) {\n         var input = expires;\n         expires = undefined;\n         throw new Error('storage.js: \"' + input + '\" cannot be converted to date string!');\n       }\n\n       expires = date.toUTCString();\n     } catch (e) {\n       /* noop */\n     }\n\n     expires = expires ? expires : false;\n\n     var cookie = key + '=' + value;\n     cookie += expires ? ';expires='+expires : '';\n     cookie += domain ? ';domain='+domain : '';\n     cookie += path ? ';path='+path : '';\n     cookie += secure ? ';secure' : '';\n\n     documentProxy.cookie = cookie;\n    };\n\n    var getCookie = function(key) {\n     var cookies = _getAll(false);\n     if (cookies.hasOwnProperty(key)) {\n       return me._decode(cookies[key]);\n     }\n\n     return null;\n    };\n\n    var getAllCookies = function() {\n     return _getAll(true);\n    };\n\n    var removeCookie = function(key) {\n     setCookie(key, '', -1);\n    };\n\n    var removeAllCookies = function() {\n     for (var key in getAllCookies()) {\n       removeCookie(key);\n     }\n    };\n\n    return {\n     getItem: getCookie,\n     getAllItems: getAllCookies,\n     setItem: setCookie,\n     removeItem: removeCookie,\n     removeAllItems: removeAllCookies\n    };\n  };\n\n  /**\n   * Provides local storage proxy layer.\n   *\n   * @private\n   * @method _getLocalStorageProxy\n   *\n   * @return {Object}\n   */\n  Storage.prototype._getLocalStorageProxy = function() {\n    var $window = this.$injector.get('$window');\n    var storageProxy = $window.localStorage;\n\n    var me = this;\n    var setItem = function(key, value) {\n     value = me._encode(value);\n     storageProxy.setItem(key, value);\n    };\n\n    var getItem = function(key) {\n     var value = storageProxy.getItem(key);\n     return me._decode(value);\n    };\n\n    var getAllItems = function() {\n     var items = {};\n\n     for (var i = 0; i < storageProxy.length; i++) {\n       var key = storageProxy.key(i);\n       items[key] = getItem(key);\n     }\n\n     return items;\n    };\n\n    var removeItem = function(key) {\n     storageProxy.removeItem(key);\n    };\n\n    var removeAllItems = function() {\n     storageProxy.clear();\n    };\n\n    return {\n     getItem: getItem,\n     getAllItems: getAllItems,\n     setItem: setItem,\n     removeItem: removeItem,\n     removeAllItems: removeAllItems\n    };\n  };\n\n  //\n  // REGISTRY\n  //\n  angular.module(module).service('storage', Storage);\n\n})(ANGULAR_MODULE, angular);\n\n/* global ANGULAR_MODULE, angular */\n(function(module, angular) {\n  'use strict';\n\n  //\n  // SERVICE\n  //\n\n  /**\n   * @constructor\n   */\n  var Auth = function($injector)\n    {\n      this.$injector = $injector;\n    };\n\n  /**\n   * @property {Array.<string>} $inject\n   */\n  Auth.$inject = ['$injector'];\n\n  //\n  // METHODS\n  //\n\n  /**\n   * Sends a POST request to register route and\n   * persists retrieved JWT token on success.\n   *\n   * @public\n   * @method signin\n   * @param {Object} data Data to submit.\n   * @param {string} [firewall='frontend'] firewall\n   * @param {Object} [config={}] $http config.\n   * @return {Promise}\n   */\n  Auth.prototype.signup = function(data, firewall, config)\n    {\n      var $http = this.$injector.get('$http');\n\n      firewall = firewall || 'frontend';\n      config = config || {};\n\n      var me = this;\n      var successCallback = function(response)\n        {\n          me._saveToken(response.data);\n        };\n\n      var failureCallback = function()\n        {\n          // noop\n        };\n\n      var url = this._getSignupUrl(firewall);\n\n      var promise = $http.post(\n        url,\n        {\n          _username: data.username,\n          _password: data.password\n        },\n        angular.extend(config || {})\n      );\n\n      promise.then(\n        successCallback,\n        failureCallback\n      );\n\n      return promise;\n    };\n\n  /**\n   * Sends a POST request to login route and\n   * persists retrieved JWT token on success.\n   *\n   * @public\n   * @method signin\n   * @param {Object} data Data to submit.\n   * @param {string} [firewall='frontend'] firewall\n   * @param {Object} [config={}] $http config.\n   * @return {Promise}\n   */\n  Auth.prototype.signin = function(data, firewall, config)\n    {\n      var $http = this.$injector.get('$http');\n\n      firewall = firewall || 'frontend';\n      config = config || {};\n\n      var me = this;\n      var successCallback = function(response)\n        {\n          me._saveToken(response.data);\n        };\n\n      var failureCallback = function()\n        {\n          // noop\n        };\n\n      var url = this._getSigninUrl(firewall);\n\n      var promise = $http.post(\n        url,\n        {\n          _username: data.username,\n          _password: data.password\n        },\n        angular.extend(config || {}, {\n          skipAuthorization: true\n        })\n      );\n\n      promise.then(\n        successCallback,\n        failureCallback\n      );\n\n      return promise;\n    };\n\n  /**\n   * Destroys JWT token representing user.\n   *\n   * @public\n   * @method logout\n   * @param {Object} [config] $http config.\n   * @return {Void}\n   */\n  Auth.prototype.signout = function(config)\n    {\n      var $http = this.$injector.get('$http');\n      var user = this.$injector.get('user');\n      var jwt = this.$injector.get('jwt');\n\n      var successCallback = function()\n        {\n          user.unload();\n          jwt.invalidate();\n        };\n\n      var failureCallback = function()\n        {\n          // noop\n        };\n\n      return $http.get(\n        this._getSignoutUrl(),\n        config || {}\n      ).then(\n        successCallback,\n        failureCallback\n      );\n    };\n\n  /**\n   * Sends a POST request to refresh route\n   * with saved refresh token from login().\n   *\n   * @public\n   * @method refresh\n   * @param {Object} [config] $http config.\n   * @return {Promise}\n   */\n  Auth.prototype.refresh = function(config)\n    {\n      var $http = this.$injector.get('$http');\n      var jwt = this.$injector.get('jwt');\n\n      var me = this;\n      var successCallback = function(response)\n        {\n          me._saveToken(response.data);\n        };\n\n      var failureCallback = function(/*rejection*/)\n        {\n        };\n\n      var promise = $http.post(\n        this._getRefereshUrl(),\n        {\n          /* jshint camelcase: false */\n          refresh_token: jwt.getRefreshToken()\n          /* jshint camelcase: true */\n        },\n        angular.extend(config || {}, {\n          skipGlobalErrorMessage: true,\n          skipAuthorization: true\n        })\n      );\n\n      promise.then(\n        successCallback,\n        failureCallback\n      );\n\n      return promise;\n    };\n\n  /**\n   * Returns decoded JWT token containing\n   * user information such as `username`.\n   * Note: By default expired tokens are\n   * not accepted, set parameter if you\n   * want to accept expired tokens too!\n   *\n   * @public\n   * @method getUser\n   * @param {boolean} [acceptExpired=false]\n   * @return {Object|null}\n   */\n  Auth.prototype.getUser = function(acceptExpired)\n    {\n      acceptExpired = acceptExpired || false;\n\n      var jwt = this.$injector.get('jwt');\n\n      var token = jwt.getToken();\n      if (!token) {\n        return null;\n      }\n\n      if (!acceptExpired) {\n        if (jwt.isExpired()) {\n          return null;\n        }\n      }\n\n      return jwt.decode(token);\n    };\n\n  /**\n   * Checks if user has given role provided\n   * in `roles` property encoded into JWT.\n   *\n   * @public\n   * @method hasRole\n   * @param {string|array} role\n   * @return {Promise}\n   */\n  Auth.prototype.hasRole = function(role)\n    {\n      var jwt = this.$injector.get('jwt');\n      var $q = this.$injector.get('$q');\n\n      var defer = $q.defer();\n      var promise = defer.promise;\n\n      var isArray = angular.isArray(role);\n      if (isArray && role.length === 0) {\n        defer.reject(null);\n        return promise;\n      }\n\n      if (!role) {\n        defer.reject(null);\n        return promise;\n      }\n\n      // accept expired tokens - we will\n      // use refresh() to get new token\n      // if current one is invalid now\n      var user = this.getUser(true);\n      if (user === null) {\n        defer.reject(null);\n        return promise;\n      }\n\n      // primitive method for role check\n      var resolveRole = function(user) {\n        var roles = user.roles || [];\n        if (angular.isString(role)) {\n          role = [role];\n        }\n\n        var hasRole = false;\n        for (var i=0; i<role.length; i++) {\n          if (roles.indexOf(role[i]) >= 0) {\n            hasRole = true;\n            break;\n          }\n        }\n\n        if (hasRole) {\n          defer.resolve();\n        } else {\n          defer.reject();\n        }\n      };\n\n      // immediately resolve valid tokens\n      if (!jwt.isExpired()) {\n        resolveRole(user);\n        return promise;\n      }\n\n      // try to refresh invalid tokens\n      var me = this;\n      var successCallback = function()\n        {\n          user = me.getUser();\n          resolveRole(user);\n        };\n\n      var failureCallback = function()\n        {\n          defer.reject();\n        };\n\n      this.refresh().then(\n        successCallback,\n        failureCallback\n      );\n\n      return promise;\n    };\n\n  /**\n   * Saves server response containing\n   * the `token` and `refresh_token`.\n   *\n   * @private\n   * @method _saveToken\n   * @param {object} response\n   * @return {void}\n   */\n  Auth.prototype._saveToken = function(data)\n    {\n      /* jshint camelcase: false */\n      var jwt = this.$injector.get('jwt');\n\n      jwt.setRefreshToken(data.refresh_token);\n      jwt.setToken(data.token);\n      /* jshint camelcase: true */\n    };\n\n  /**\n   * Returns endpoint to gather JWT depending on firewall.\n   *\n   * @private\n   * @method _getSigninUrl\n   * @param {string} firewall\n   * @return {string}\n   */\n  Auth.prototype._getSigninUrl = function(firewall){\n    var API_URL = this.$injector.get('API_URL');\n\n    switch(firewall) {\n      case 'backend':\n      case 'frontend':\n        return API_URL + '/auth/' + firewall + '/signin';\n      default:\n        throw new Error('Unknown firewall name: ' + firewall);\n    }\n  };\n\n  /**\n   * Returns endpoint to register at given firewall.\n   *\n   * @private\n   * @method _getSignupUrl\n   * @param {string} firewall\n   * @return {string}\n   */\n  Auth.prototype._getSignupUrl = function(firewall){\n    var API_URL = this.$injector.get('API_URL');\n\n    switch(firewall) {\n      case 'frontend':\n        return API_URL + '/auth/' + firewall + '/signup';\n      case 'backend':\n        throw new Error('Not implemented yet!');\n      default:\n        throw new Error('Unknown firewall name: ' + firewall);\n    }\n  };\n\n  /**\n   * Returns endpoint to refresh the JWT.\n   *\n   * @private\n   * @method _getRefereshUrl\n   * @return {string}\n   */\n  Auth.prototype._getRefereshUrl = function(){\n    var API_URL = this.$injector.get('API_URL');\n\n    return API_URL + '/auth/refresh';\n  };\n\n  /**\n   * Returns endpoint to revoke the JWT.\n   *\n   * @private\n   * @method _getSignoutUrl\n   * @param {string} firewall\n   * @return {string}\n   */\n  Auth.prototype._getSignoutUrl = function(){\n    var API_URL = this.$injector.get('API_URL');\n\n    return API_URL + '/signout';\n  };\n\n  //\n  // REGISTRY\n  //\n  angular.module(module).service('auth', Auth);\n\n})(ANGULAR_MODULE, angular);\n\n/* global ANGULAR_MODULE, angular */\n(function(module, angular) {\n\n  'use strict';\n\n  //\n  // SERVICE\n  //\n\n  /**\n   * @constructor\n   */\n  var I18N = function($injector)\n    {\n      this.translations = {};\n      this.$injector = $injector;\n\n      this.setLocale(this._detectLocale());\n    };\n\n  I18N.$inject = ['$injector'];\n\n  //\n  // PROPERTIES\n  //\n\n  /** @var {object} locales Currently supported locales. */\n  I18N.prototype.locales = {\n    'de': true\n  };\n\n  /** @var {string} defaultLocale Default locale to use. */\n  I18N.prototype.defaultLocale = 'de';\n\n  /**\n   * Loads translations according to current locale if not available.\n   *\n   * @public\n   * @method load\n   * @param {locale} [locale] Two letter language code.\n   * @param {Object} [config] Additional config for $http\n   * @return {Promise|void}\n   */\n  I18N.prototype.load = function(locale, config)\n    {\n      locale = locale || this.getLocale();\n      config = config || {};\n\n      if (this.translations[locale]) {\n        return;\n      }\n\n      var $http = this.$injector.get('$http');\n      var $log = this.$injector.get('$log');\n\n      var me = this;\n      var url = this._getJSONUrl(locale);\n      var successCallback = function(response)\n        {\n          me.translations[locale] = response.data;\n        };\n\n      var failureCallback = function()\n        {\n          $log.error('Could not load translations!');\n        };\n\n      return $http.get(url, config).then(\n        successCallback,\n        failureCallback\n      );\n    };\n\n  /**\n   * Sets locale to given paraemter if it's a valid one.\n   * Falls back to `defaultLocale` if it's an invalid one.\n   *\n   * @public\n   * @method setLocale\n   * @param {string} locale\n   * @return {void}\n   */\n  I18N.prototype.setLocale = function(locale)\n    {\n      if (this.locales[locale]) {\n        this.locale = locale;\n        return;\n      }\n\n      this.locale = this.defaultLocale;\n    };\n\n  /**\n   * Delivers the currently used locale for translations.\n   *\n   * @public\n   * @method setLocale\n   * @param {string} locale\n   * @return {void}\n   */\n  I18N.prototype.getLocale = function()\n    {\n      return this.locale;\n    };\n\n  /**\n   * Makes a lookup within current translation dictionary.\n   *\n   * @param {string} key The i18n key.\n   * @param {string} ... Parameters to be replaced.\n   * @return {string}\n   */\n  I18N.prototype.get = function(key)\n    {\n      var string = this.$injector.get('string');\n      var params = [].slice.call(arguments,1);\n      var locale = this.getLocale();\n\n      var text;\n      try {\n        text = this.translations[locale][key];\n      } catch(e) {}\n\n      return string.sprintf(text || key, params);\n    };\n\n  /**\n   * Returns endpoint to gather JSON translations.\n   *\n   * @private\n   * @method _getTranslationsUrl\n   * @param {string} locale\n   * @return {string}\n   */\n  I18N.prototype._getJSONUrl = function(locale)\n    {\n      return 'json/' + locale + '.json';\n    };\n\n  /**\n   * @ignore\n   */\n  I18N.prototype._detectLocale = function()\n    {\n      var navigator = this.$injector.get('$window').navigator;\n      var android = /android.*\\W(\\w\\w)-(\\w\\w)\\W/i;\n      var language;\n\n      // try to find locale on android devices!\n      if( navigator && navigator.userAgent &&\n          (language = navigator.userAgent.match(android)) ) {\n          language = language[1];\n      }\n\n      // for all other browsers\n      if (!language && navigator) {\n        if( navigator.language ) {\n          language = navigator.language;\n        } else if( navigator.userLanguage ) {\n          language = navigator.userLanguage;\n        } else if( navigator.systemLanguage ) {\n          language = navigator.systemLanguage;\n        } else if( navigator.browserLanguage ) {\n          language = navigator.browserLanguage;\n        }\n      }\n\n      // now we can get iso code\n      if (language) {\n        return language.substr(0,2);\n      }\n\n      // use `defaultLocale` as fallback\n      return this.defaultLocale;\n    };\n\n  //\n  // REGISTRY\n  //\n  angular.module(module).service('i18n', I18N);\n\n})(ANGULAR_MODULE, angular);\n\n/* global ANGULAR_MODULE, angular */\n(function(module, angular) {\n  'use strict';\n\n  /**\n  * @constructor\n  */\n  var JWT = function($injector, storage) {\n    this.$injector = $injector;\n    this.storage = storage.getProxy();\n  };\n\n  JWT.$inject = ['$injector', 'storage'];\n\n  //\n  // PROPERTIES\n  //\n\n  /** @var {string} tokenKey Token key for local storage. */\n  JWT.prototype.tokenKey = 'NAksNyshI3';\n\n  /** @var {string} refreshKey Refresh key for local storage. */\n  JWT.prototype.refreshKey = 'i08BFNG9t5';\n\n  //\n  // METHODS\n  //\n\n  /**\n   * Resets JWT token / refresh token in local storage.\n   *\n   * @public\n   * @method invalidate\n   * @return {void}\n   */\n  JWT.prototype.invalidate = function()\n    {\n      this.removeRefreshToken();\n      this.removeToken();\n    };\n\n  /**\n   * Gets JWT token from local storage.\n   *\n   * @public\n   * @method getToken\n   * @return {string|null}\n   */\n  JWT.prototype.getToken = function()\n    {\n      return this.storage.getItem(this.tokenKey);\n    };\n\n  /**\n   * Sets JWT token in local storage.\n   *\n   * @public\n   * @method setToken\n   * @param {string} token\n   * @return {void}\n   */\n  JWT.prototype.setToken = function(token)\n    {\n      this.storage.setItem(this.tokenKey,token);\n    };\n\n  /**\n   * Removes JWT token from local storage.\n   *\n   * @public\n   * @method removeToken\n   * @return {void}\n   */\n  JWT.prototype.removeToken = function()\n    {\n      this.storage.removeItem(this.tokenKey);\n    };\n\n  /**\n   * Gets JWT refresh token from local storage.\n   *\n   * @public\n   * @method getRefreshToken\n   * @return {string|null}\n   */\n  JWT.prototype.getRefreshToken = function()\n    {\n      return this.storage.getItem(this.refreshKey);\n    };\n\n  /**\n   * Sets JWT refresh token in local storage.\n   *\n   * @public\n   * @method setRefreshToken\n   * @param {string} refreshToken\n   * @return {void}\n   */\n  JWT.prototype.setRefreshToken = function(refreshToken)\n    {\n      this.storage.setItem(this.refreshKey, refreshToken);\n    };\n\n  /**\n   * Removes JWT refresh token from local storage.\n   *\n   * @public\n   * @method removeToken\n   * @return {void}\n   */\n  JWT.prototype.removeRefreshToken = function()\n    {\n      this.storage.removeItem(this.refreshKey);\n    };\n\n  /**\n   * Converts timestamp into date object.\n   *\n   * @public\n   * @method getExpirationDate\n   * @param {string} token\n   * @return {date}\n   */\n  JWT.prototype.getExpirationDate = function(token)\n    {\n      var $log = this.$injector.get('$log');\n\n      token = token || this.getToken();\n      if (!token) {\n        $log.error('No token given or available!');\n        return null;\n      }\n\n      var decoded = this.decode(token);\n      if (typeof decoded.exp==='undefined') {\n        $log.error('No `exp` property available!');\n        return null;\n      }\n\n      var date = new Date(0);\n      date.setUTCSeconds(decoded.exp);\n\n      return date;\n    };\n\n  /**\n   * Determines if given token is expired.\n   *\n   * @public\n   * @method isExpired\n   * @param {string} token\n   * @param {number} offset In seconds.\n   * @return {boolean}\n   */\n  JWT.prototype.isExpired = function(token, offset)\n    {\n      offset = offset || 0;\n      token = token || this.getToken();\n\n      var date = this.getExpirationDate(token);\n      if (date === null) {\n        return true;\n      }\n\n      var now = new Date().valueOf();\n      offset = now + offset * 1000;\n      date = date.valueOf();\n\n      return date <= offset;\n    };\n\n  /**\n   * Tries to decode a JWT token.\n   *\n   * @public\n   * @method decode\n   * @param {string} token\n   * @return {object|null}\n   */\n  JWT.prototype.decode = function(token)\n    {\n      var $log = this.$injector.get('$log');\n\n      try {\n        var parts = token.split('.');\n        if (parts.length !== 3) {\n          throw new Error('JWT must have 3 parts!');\n        }\n\n        var decoded = this._base64Decode(parts[1]);\n        if (!decoded) {\n          throw new Error('Cannot decode the token!');\n        }\n\n        return angular.fromJson(decoded);\n      } catch(e) {\n        $log.error(e);\n        return null;\n      }\n    };\n\n  /**\n   * Validates and decodes a base64 url.\n   *\n   * @private\n   * @method _base64Decode\n   * @param {string} input\n   * @return {string}\n   */\n  JWT.prototype._base64Decode = function(input)\n    {\n      var $window = this.$injector.get('$window');\n      var $log = this.$injector.get('$log');\n\n      var output = input\n        .replace(/-/g, '+')\n        .replace(/_/g, '/');\n\n      try{\n        switch (output.length % 4) {\n          case 0: {\n            break;\n          }\n\n          case 2: {\n            output += '=='; break;\n          }\n\n          case 3: {\n            output += '='; break;\n          }\n\n          default: {\n            throw new Error('Illegal base64url code!');\n          }\n        }\n      } catch(e) {\n        $log.error(e);\n        return '';\n      }\n\n      var decoded = $window.atob(output);\n      var escaped = $window.escape(decoded);\n\n      return $window.decodeURIComponent(escaped);\n    };\n\n  //\n  // REGISTRY\n  //\n  angular.module(module).service('jwt', JWT);\n\n})(ANGULAR_MODULE, angular);\n\n/* global ANGULAR_MODULE, angular */\n(function(module, angular) {\n  'use strict';\n\n  //\n  // SERVICE\n  //\n\n  /**\n   * @constructor\n   */\n  var User = function($injector) {\n    this.$injector = $injector;\n\n    this._states = [\n      $injector.get('STATE_BEGINNER'),\n      $injector.get('STATE_AMATEUR'),\n      $injector.get('STATE_ADVANCED'),\n      $injector.get('STATE_EXPERT')\n    ];\n\n    this._eventSource = null;\n    this._results = [];\n    this._payload = {};\n    this._pending = {};\n    this._tasks = {};\n  };\n\n  User.$inject = ['$injector'];\n\n  //\n  // PROPERTIES\n  //\n\n  /** @var {number} state Current state of user. */\n  User.prototype.state = null;\n\n  /** @var {number} group Random group of user. */\n  User.prototype.group = null;\n\n  /** @var {number} tickets Current ticket count. */\n  User.prototype.tickets = null;\n\n  //\n  // METHODS\n  //\n\n  /**\n   * Fetches current user through `User` resource.\n   *\n   * @public\n   * @method load\n   * @return {void}\n   */\n  User.prototype.load = function() {\n    var User = this.$injector.get('User');\n\n    var me = this;\n    var successCallback = function(user) {\n\n      // save only json payload from\n      // ng-resource's `user` object\n      me._payload = user.toJSON();\n\n      // initialize members\n      me._initTickets();\n      me._initState();\n      me._initGroup();\n\n      // gameplay setup calls\n      // only for `ROLE_USER`!\n      if (!me.isUser()) {\n        return;\n      }\n\n      // init tasks at first!\n      me._initWatches();\n      me._initTasks();\n\n      // then results & SSE!\n      me._initPending();\n      me._initResults();\n      me._initSSE();\n    };\n\n    var failureCallback = function(/*rejection*/) {\n\n    };\n\n    var current = User.current();\n\n    current.$promise.then(\n      successCallback,\n      failureCallback\n    );\n\n    return current;\n  };\n\n  /**\n   * Resets current user session from application.\n   *\n   * @public\n   * @method reset\n   * @return {void}\n   */\n  User.prototype.unload = function() {\n    var sse = this.$injector.get('sse');\n\n    if (this._eventSource) {\n      sse.removeSource(this._eventSource);\n    }\n\n    if (this._unwatchTickets) {\n      this._unwatchTickets();\n    }\n\n    if (this._unwatchState) {\n      this._unwatchState();\n    }\n\n    this._eventSource = null;\n    this._results = [];\n    this._payload = {};\n    this._pending = {};\n    this._tasks = {};\n\n    this.tickets = null;\n    this.state = null;\n    this.group = null;\n  };\n\n  /**\n   * Updates user from external scopes.\n   * This is helpful for refreshing its\n   * state without invoking a request to\n   * the server when user was embedded in\n   * another request's response.\n   *\n   * @public\n   * @method update\n   * @param {object} result\n   * @return {void}\n   *\n   */\n  User.prototype.update = function(result) {\n    this._payload = result.user;\n\n    this._addResult(result);\n    this._initTickets();\n    this._initState();\n    this._initGroup();\n  };\n\n  /**\n   * Checks if current user has role `ROLE_USER`.\n   *\n   * @public\n   * @method isUser\n   * @return {boolean}\n   */\n  User.prototype.isUser = function() {\n    return this.hasRole('ROLE_USER');\n  };\n\n  /**\n   * Checks if current user has role `ROLE_ADMIN`.\n   *\n   * @public\n   * @method isAdmin\n   * @return {boolean}\n   */\n  User.prototype.isAdmin = function() {\n    return this.hasRole('ROLE_ADMIN');\n  };\n\n  /**\n   * Checks if current user has role `ROLE_SUPER_ADMIN`.\n   *\n   * @public\n   * @method isSuperAdmin\n   * @return {boolean}\n   */\n  User.prototype.isSuperAdmin = function() {\n    return this.hasRole('ROLE_SUPER_ADMIN');\n  };\n\n  /**\n   * Checks if current user's workshop is active.\n   *\n   * @public\n   * @method isInWorkshop\n   * @return {boolean}\n   */\n  User.prototype.isInWorkshop = function() {\n    if (!this.isUser()) {\n      return true;\n    }\n\n    return this._payload.workshop.isActive;\n  };\n\n  /**\n   * Checks if current user has given role.\n   *\n   * @public\n   * @method hasRole\n   * @param {string|array} role\n   * @return {boolean}\n   */\n  User.prototype.hasRole = function(role) {\n    if (!angular.isArray(role)) {\n      role = [role];\n    }\n\n    var roles = this._payload.roles || [];\n    for (var i=0; i<role.length; i++) {\n      if (roles.indexOf(role[i])>=0) {\n        return true;\n      }\n    }\n\n    return false;\n  };\n\n  /**\n   * Provides user's task hash map.\n   *\n   * @public\n   * @method getTasks\n   * @return {object}\n   */\n  User.prototype.getTasks = function() {\n    return this._tasks;\n  };\n\n  /**\n   * Gets `task` resource of user by type.\n   *\n   * @public\n   * @method getTaskByType\n   * @param {string} type\n   * @return {object|null}\n   */\n  User.prototype.getTaskByType = function(type) {\n    return this._tasks[type] || null;\n  };\n\n  /**\n   * Gets pending `result` resource of user by type.\n   *\n   * @public\n   * @method getResultByType\n   * @param {string} type\n   * @return {object|null}\n   */\n  User.prototype.getPendingByType = function(type) {\n    return this._pending[type] || null;\n  };\n\n  /**\n   * Gets `state` mapped to string representation.\n   *\n   * @public\n   * @method getGroupAsString\n   * @return {string}\n   */\n  User.prototype.getGroupAsString = function() {\n    var random = this.$injector.get('random');\n\n    switch(this.group) {\n      case this.$injector.get('GROUP_A'):\n        return 'GROUP_A';\n      case this.$injector.get('GROUP_B'):\n        return 'GROUP_B';\n      default:\n        // assign random group for admins\n        // so that UI doesn't stay empty!\n        return random.pick([\n          'GROUP_A',\n          'GROUP_B'\n        ]);\n    }\n  };\n\n  /**\n   * Gets `state` mapped to string representation.\n   *\n   * @public\n   * @method getStateAsString\n   * @return {string}\n   */\n  User.prototype.getStateAsString = function() {\n    switch(this.state) {\n      case this.$injector.get('STATE_AMATEUR'):\n        return 'STATE_AMATEUR';\n      case this.$injector.get('STATE_ADVANCED'):\n        return 'STATE_ADVANCED';\n      case this.$injector.get('STATE_EXPERT'):\n        return 'STATE_EXPERT';\n      default:\n        return 'STATE_BEGINNER';\n    }\n  };\n\n  /**\n   * Initializes `state` member.\n   *\n   * @private\n   * @method _initState\n   * @return {void}\n   */\n  User.prototype._initState = function() {\n    var STATE_BEGINNER = this.$injector.get('STATE_BEGINNER');\n    this.state = this._payload.state || STATE_BEGINNER;\n  };\n\n  /**\n   * Initializes `group` member.\n   *\n   * @private\n   * @method _initGroup\n   * @return {void}\n   */\n  User.prototype._initGroup = function() {\n    this.group = this._payload.group || null;\n  };\n\n  /**\n   * Initializes `tickets` member.\n   *\n   * @private\n   * @method init\n   * @return {void}\n   */\n  User.prototype._initTickets = function() {\n    var tickets = this._payload.tickets;\n    this.tickets = tickets || [];\n  };\n\n  /**\n   * Watches `state` and `tickets` for changes to\n   * show the corresponding user notifications.\n   *\n   * @private\n   * @method _initWatches\n   * @return {void}\n   */\n  User.prototype._initWatches = function() {\n    var notification = this.$injector.get('notification');\n    var $rootScope = this.$injector.get('$rootScope');\n    var i18n = this.$injector.get('i18n');\n    var me = this;\n\n    var _watchStateExpression = function() {\n      return me.state;\n    };\n\n    var _watchStateCallback = function(newState, oldState) {\n      if (newState === oldState) {\n        return;\n      }\n\n      notification.success(\n        i18n.get(\n          'Congratulations, you have reached the state %s!',\n          i18n.get(me.getStateAsString())\n        )\n      );\n    };\n\n    var _watchTicketsExpression = function() {\n      return me.tickets.length;\n    };\n\n    var _watchTicketsCallback = function(newTickets, oldTickets) {\n      if (newTickets === oldTickets) {\n        return;\n      }\n\n      var tickets = newTickets - oldTickets;\n      console.log(newTickets,oldTickets);\n      if (tickets <= 0) {\n        return;\n      }\n\n      var message = tickets === 1 ?\n        i18n.get('Congratulations, you have earned 1 new ticket!') :\n        i18n.get('Congratulations, you have earned %s new tickets!', tickets);\n\n      notification.primary(message);\n    };\n\n    this._unwatchTickets = $rootScope.$watch(\n      _watchTicketsExpression,\n      _watchTicketsCallback\n    );\n\n    this._unwatchState = $rootScope.$watch(\n      _watchStateExpression,\n      _watchStateCallback\n    );\n  };\n\n\n  /**\n   * Destroys user session and redirects to login.\n   *\n   * @private\n   * @method _initSSE\n   * @return {Void}\n   */\n  User.prototype._initSSE = function()\n    {\n      var $rootScope = this.$injector.get('$rootScope');\n      var API_URL = this.$injector.get('API_URL');\n      var sse = this.$injector.get('sse');\n\n      // don't setup SSE when playing remote\n      var workshop = this._payload.workshop;\n      if (!workshop.isActive) {\n        return;\n      }\n\n      var me = this;\n\n      var _onMessage = function(data) {\n        $rootScope.$evalAsync(function(){\n          angular.forEach(data, function(item) {\n            var unix = Date.parse(item.updatedAt);\n            var task = me._tasks[item.type];\n            task.isActive = !!item.isActive;\n\n            if (!isNaN(unix)) {\n              item.updatedAt = unix;\n            }\n          });\n        });\n      };\n\n      var url = API_URL + '/sse/workshop/' + workshop.id + '/tasks';\n      var options = { onMessage: _onMessage, sleep: 1 };\n      this._eventSource = sse.addSource(url, options);\n    };\n\n  /**\n   * Caches task hash map from workshop\n   * for lookups from `getTaskByType()`.\n   *\n   * @private\n   * @method _initTasks\n   * @return {void}\n   */\n  User.prototype._initTasks = function() {\n    var workshop = this._payload.workshop;\n    if (!workshop) {\n      return;\n    }\n\n    var me = this;\n    angular.forEach(workshop.tasks,function(task) {\n      me._tasks[task.type] = task;\n    });\n  };\n\n  /**\n   * Caches pending hash map from workshop\n   * for lookups from `getPendingByType()`.\n   *\n   * @private\n   * @method _initPending\n   * @return {void}\n   */\n  User.prototype._initPending = function() {\n    var pending = this._payload.pending;\n    if (!pending) {\n      return;\n    }\n\n    var me = this;\n    angular.forEach(pending,function(result) {\n      me._pending[result.task.type] = result;\n    });\n  };\n\n  /**\n   * Caches results hash map from workshop\n   * for lookups from `getResultsByType()`.\n   *\n   * @private\n   * @method _initResults\n   * @return {void}\n   */\n  User.prototype._initResults = function() {\n    var _addResult = this._addResult.bind(this);\n    var results = this._payload.results || [];\n\n    angular.forEach(results, _addResult);\n  };\n\n  /**\n   * Adds result to collection and sets `$$result`\n   *\n   * @private\n   * @method _addResult\n   * @param {object} result\n   * @return {void}\n   */\n  User.prototype._addResult = function(result) {\n    var task = this.getTaskByType(result.task.type);\n    if (task !== null) {\n      var current = task.$$results || 0;\n      task.$$results = current + 1;\n    }\n\n    this._results.push(result);\n  };\n\n  //\n  // REGISTRY\n  //\n  angular.module(module).service('user', User);\n\n})(ANGULAR_MODULE, angular);\n\n/* global ANGULAR_MODULE, angular */\n(function(module, angular) {\n  'use strict';\n\n  //\n  // SERVICE\n  //\n\n  /**\n   * @constructor\n   */\n  var Mail = function($injector)\n    {\n      this.$injector = $injector;\n    };\n\n  Mail.$inject = ['$injector'];\n\n  //\n  // METHODS\n  //\n\n  /**\n   * Sends a POST request to send mail.\n   *\n   * @public\n   * @method send\n   * @param {Object} data\n   * @param {Object} [config] $http config.\n   * @return {Promise}\n   */\n  Mail.prototype.send = function(data, config) {\n    var notification = this.$injector.get('notification');\n    var $http = this.$injector.get('$http');\n    var i18n = this.$injector.get('i18n');\n\n    var successCallback = function(/*response*/)\n      {\n        notification.success(\n          i18n.get(\n            'Your email has been sent!'\n          )\n        );\n      };\n\n    var failureCallback = function(/*rejection*/)\n      {\n      };\n\n    var promise = $http.post(\n      this._getPostUrl(),\n      {\n        _name: data.name,\n        _mail: data.email,\n        _subject: data.subject,\n        _message: data.message\n      },\n      config || {}\n    );\n\n    promise.then(\n      successCallback,\n      failureCallback\n    );\n\n    return promise;\n  };\n\n  /**\n   * Returns endpoint to send the email.\n   *\n   * @private\n   * @method _getPostUrl\n   * @return {string}\n   */\n  Mail.prototype._getPostUrl = function(){\n    var API_URL = this.$injector.get('API_URL');\n\n    return API_URL + '/mail';\n  };\n\n  //\n  // REGISTRY\n  //\n  angular.module(module).service('mail', Mail);\n\n})(ANGULAR_MODULE, angular);\n\n/* global ANGULAR_MODULE, angular, EventSource */\n(function(module, angular) {\n  'use strict';\n\n  //\n  // SERVICE\n  //\n\n  /**\n   * @constructor\n   */\n  var SSE = function($injector)\n    {\n      this.$injector = $injector;\n      this._sources = {};\n    };\n\n  SSE.$inject = ['$injector'];\n\n  //\n  // METHODS\n  //\n\n  /**\n   * Adds a new event source to listen to.\n   *\n   * @public\n   * @method add\n   * @param string url\n   * @param string event\n   * @param function callback\n   * @return {void}\n   */\n  SSE.prototype.addSource = function(url, config) {\n    config = config || {};\n\n    config.retry = config.retry || null;\n    config.event = config.event || null;\n    config.sleep = config.sleep || null;\n    config.onError = config.onError || function(){};\n    config.onMessage = config.onMessage || function(){};\n\n    url = this._buildUrl(url, config);\n    var source = new EventSource(url);\n\n    source.onmessage = function(event) {\n      var data = angular.fromJson(event.data);\n      config.onMessage.call(this, data, event);\n    };\n\n    source.onerror = function(event) {\n      config.onError.call(this, event);\n    };\n\n    this._sources[url] = source;\n    return source;\n  };\n\n  /**\n   * Adds a new event source to listen to.\n   *\n   * @public\n   * @method removeSource\n   * @param object source\n   * @return {void}\n   */\n  SSE.prototype.removeSource = function(source) {\n    delete this._sources[source.url];\n    source.close();\n  };\n\n  /**\n   * Appends JWT token as query string to url.\n   * Adds optional config options if available.\n   *\n   * @private\n   * @method _getUrl\n   * @param string url\n   * @param object config\n   * @return {string}\n   */\n  SSE.prototype._buildUrl = function(url, config){\n    var jwt = this.$injector.get('jwt');\n    var token = jwt.getToken();\n\n    url = url + '?bearer=' + token;\n\n    if (config.event) {\n      url += '&event=' + config.event;\n    }\n\n    if (config.sleep) {\n      url += '&sleep=' + config.sleep;\n    }\n\n    if (config.retry) {\n      url += '&retry=' + config.retry;\n    }\n\n    return url;\n  };\n\n  //\n  // REGISTRY\n  //\n  angular.module(module).service('sse', SSE);\n\n})(ANGULAR_MODULE, angular);\n\n/* global ANGULAR_MODULE, angular */\n(function(module, angular) {\n  'use strict';\n\n  // --------------------------------------------------\n  // Card\n  // --------------------------------------------------\n\n  //\n  // CONTROLLER\n  //\n\n  /**\n   * @constructor\n   */\n  var CardContainer = function() {\n  };\n\n  CardContainer.$inject = ['$scope', '$element', '$attrs'];\n\n  //\n  // PROPERTIES\n  //\n\n  /** @var {array} cards Stack of registered cards. */\n  CardContainer.prototype.cards = [];\n\n  /** @var {boolean} canToggle If cards can be toggled. */\n  CardContainer.prototype.canToggle = false;\n\n  //\n  // METHODS\n  //\n\n  /**\n   * Adds a `card` directive to stack.\n   *\n   * @public\n   * @method click\n   * @return {Void}\n   */\n  CardContainer.prototype.add = function(card) {\n    this.cards.push(card);\n  };\n\n  /**\n   * Toggles card state if `canToggle` is true.\n   *\n   * @public\n   * @method set\n   * @return {boolean}\n   */\n  CardContainer.prototype.set = function(card) {\n    if (card.selected && !this.canToggle) {\n      return false;\n    }\n\n    // toggle current card's state\n    var selected = !!card.selected;\n    card.selected = selected ? null : true;\n\n    // reset all other card states\n    angular.forEach(this.cards, function(current) {\n      if (current.id === card.id) {\n        return;\n      }\n\n      current.selected = card.selected ? false : null;\n    });\n\n    return true;\n  };\n\n  //\n  // REGISTRY\n  //\n  angular.module(module).directive('cardContainer', function(){\n    return {\n      scope: {\n        canToggle: '=?cardContainerCanToggle'\n      },\n      restrict: 'A',\n      controller: CardContainer,\n      bindToController: true,\n      controllerAs: 'cardContainerController'\n    };\n  });\n\n  // --------------------------------------------------\n  // Card\n  // --------------------------------------------------\n\n  //\n  // CONTROLLER\n  //\n\n  /**\n   * @constructor\n   */\n  var Card = function($scope, $element, $attrs, $transclude) {\n    this.$scope = $scope;\n    this.$attrs = $attrs;\n    this.$element = $element;\n\n    this.id = this.$scope.$id;\n    this.hasIcon = $transclude.isSlotFilled('icon');\n  };\n\n  Card.$inject = ['$scope', '$element', '$attrs', '$transclude'];\n\n  //\n  // PROPERTIES\n  //\n\n  /** @var {number} id Unique id of card. */\n  Card.prototype.id = null;\n\n  /** @var {mixed} data Passthrough data of card. */\n  Card.prototype.data = null;\n\n  /** @var {boolean} selected If card is selected. */\n  Card.prototype.selected = null;\n\n  /** @var {boolean} disabled If card is disabled. */\n  Card.prototype.disabled = null;\n\n  /** @var {boolean} hasIcon If card has `icon` slot filled. */\n  Card.prototype.hasIcon = null;\n\n  /** @var {boolean} isCheckbox If card should behave as checkbox. */\n  Card.prototype.isCheckbox = false;\n\n  //\n  // METHODS\n  //\n\n  /**\n   * Invokes the `cardOnClick` callback.\n   *\n   * @public\n   * @method $onInit\n   * @return {Void}\n   */\n  Card.prototype.$onInit = function() {\n    if (!this.cardContainer) {\n      return;\n    }\n\n    this.cardContainer.add(this);\n  };\n\n  /**\n   * Invokes the `cardOnClick` callback.\n   *\n   * @public\n   * @method click\n   * @return {Void}\n   */\n  Card.prototype.click = function($event) {\n    if (this.disabled) {\n      return;\n    }\n\n    $event.stopPropagation();\n    $event.preventDefault();\n\n    if (this.cardContainer) {\n      var changed = this.cardContainer.set(this);\n      if (!changed) {\n        return;\n      }\n    }\n\n    this.onClick({\n      data: this.data,\n      selected: this.selected,\n      disabled: this.disabled\n    });\n  };\n\n  //\n  // REGISTRY\n  //\n  angular.module(module).directive('card', function(){\n    return {\n      scope: {\n        data: '=?cardData',\n        onClick: '&cardOnClick',\n        selected: '=?cardSelected',\n        disabled: '=?cardDisabled',\n        isCheckbox: '=?cardIsCheckbox'\n      },\n      restrict: 'A',\n      transclude: {\n        text: 'cardText',\n        title: 'cardTitle',\n        icon: '?cardIcon',\n        buttons: '?cardButtons'\n      },\n      controller: Card,\n      bindToController: true,\n      controllerAs: 'cardController',\n      require:{\n        cardContainer: '^?cardContainer',\n      },\n      templateUrl: 'views/directives/card.html'\n    };\n  });\n\n})(ANGULAR_MODULE, angular);\n\n/* global ANGULAR_MODULE, angular, Chartist */\n(function(module, angular) {\n  'use strict';\n\n  //\n  // CONTROLLER\n  //\n\n  /**\n   * @constructor\n   */\n  var Chart = function($scope, $attrs, $element, $injector) {\n    this.$scope = $scope;\n    this.$attrs = $attrs;\n    this.$element = $element;\n    this.$injector = $injector;\n\n    this._chart = null;\n  };\n\n  Chart.$inject = ['$scope', '$attrs', '$element', '$injector'];\n\n  //\n  // PROPERTIES\n  //\n\n  /** @var {array} data Chart data for series. */\n  Chart.prototype.data = [];\n\n  //\n  // METHODS\n  //\n\n  /**\n   * Inits chart with options and data\n   * and renders it with these settings.\n   *\n   * @public\n   * @method $onInit\n   * @return {Void}\n   */\n  Chart.prototype.$onInit = function()\n    {\n      var options = this._getOptions();\n\n      var data = {\n        labels: this._getLabels(),\n        series: this._getData()\n      };\n\n      this._render(data, options);\n    };\n\n  /**\n   * Cleans up everything on destruction.\n   *\n   * @public\n   * @method $onDestroy\n   * @return {Void}\n   */\n  Chart.prototype.$onDestroy = function()\n    {\n      if (this._chart !== null) {\n        this._chart.detach();\n        this._chart = null;\n      }\n    };\n\n  /**\n   * Gets data depending on current `task`.\n   *\n   * @public\n   * @method _getData\n   * @param {array} data\n   * @return int\n   */\n  Chart.prototype._getData = function() {\n    var GROUP_A = this.$injector.get('GROUP_A');\n    var GROUP_B = this.$injector.get('GROUP_B');\n\n    var me = this;\n\n    var map = {};\n    var data = [];\n    var mapResults;\n\n    switch(me.task.type) {\n      //case me.$injector.get('TYPE_INTEREST'):\n      //case me.$injector.get('TYPE_INFLATION'):\n      //case me.$injector.get('TYPE_DIVERSIFICATION'):\n      //case me.$injector.get('TYPE_RISK'):\n      case me.$injector.get('TYPE_ANCHORING'):\n      case me.$injector.get('TYPE_MENTAL_BOOKKEEPING'): {\n        map[GROUP_A] = { choice1: 0, choice2: 0, count:0 };\n        map[GROUP_B] = { choice1: 0, choice2: 0, count:0 };\n\n        mapResults = function(result) {\n          var group = result.json.group;\n          var num = result.json.choice;\n\n          map[group]['choice'+num]++;\n          map[group].count++;\n        };\n\n        angular.forEach(this.results, mapResults);\n\n        var groupA = map[GROUP_A];\n        var groupB = map[GROUP_B];\n\n        // series 1\n        data.push([\n          groupA.choice1 / groupA.count,\n          groupB.choice1 / groupB.count\n        ]);\n\n        // series 2\n        data.push([\n          groupA.choice2 / groupA.count,\n          groupB.choice2 / groupB.count\n        ]);\n\n        break;\n      }\n\n      //case me.$injector.get('TYPE_FRAMING'):\n      //case me.$injector.get('TYPE_SAVINGS_TARGET'):\n      case me.$injector.get('TYPE_SAVINGS_SUPPORTED'): {\n\n        map.count = 0;\n        map.choice1 = 0;\n        map.choice2 = 0;\n        map.choice3 = 0;\n        map.choice4 = 0;\n\n        mapResults = function(result) {\n          var num = result.json.choice;\n\n          map['choice'+num]++;\n          map.count++;\n        };\n\n        angular.forEach(this.results, mapResults);\n\n        data.push([\n          map.choice1 / map.count,\n          map.choice2 / map.count,\n          map.choice3 / map.count,\n          map.choice4 / map.count\n        ]);\n\n        break;\n      }\n\n      //case me.$injector.get('TYPE_SELF_COMMITMENT'):\n      case me.$injector.get('TYPE_PROCRASTINATION'): {\n        var SPLIT = 'SPLIT';\n        var ALL = 'ALL';\n\n        map[SPLIT] = { success: 0, failure: 0, count:0 };\n        map[ALL] = { success: 0, failure: 0, count:0 };\n\n        mapResults = function(result) {\n          var mode = result.json.mode;\n\n          if (result.json.success) {\n            map[mode].success++;\n          } else {\n            map[mode].failure++;\n          }\n\n          map[mode].count++;\n        };\n\n        angular.forEach(this.results, mapResults);\n\n        var split = map[SPLIT];\n        var all = map[ALL];\n\n        // series 1\n        data.push([\n          split.success / split.count,\n          all.success / all.count\n        ]);\n\n        // series 2\n        data.push([\n          split.failure / split.count,\n          all.failure / all.count\n        ]);\n\n        break;\n      }\n\n      default:\n    }\n\n    return data;\n  };\n\n  /**\n   * Gets labels depending on current `task`.\n   *\n   * @private\n   * @method _getLabels\n   * @return array\n   */\n  Chart.prototype._getLabels = function() {\n    var i18n = this.$injector.get('i18n');\n\n    switch(this.task.type) {\n      case this.$injector.get('TYPE_ANCHORING'):\n        return [\n          i18n.get('WITH_ANCHOR'),\n          i18n.get('WITHOUT_ANCHOR')\n        ];\n      case this.$injector.get('TYPE_MENTAL_BOOKKEEPING'):\n        return [\n          i18n.get('MONEY_LOST'),\n          i18n.get('TICKET_LOST')\n        ];\n      case this.$injector.get('TYPE_SAVINGS_SUPPORTED'):\n        return [\n          i18n.get('REMINDER_SMS'),\n          i18n.get('CHILDREN_SMS'),\n          i18n.get('PREMIUM_SAVINGS'),\n          i18n.get('SAVINGS_COIN')\n        ];\n      case this.$injector.get('TYPE_PROCRASTINATION'):\n        return [\n          i18n.get('ALL'),\n          i18n.get('SPLIT')\n        ];\n      default:\n        return [];\n    }\n  };\n\n  /**\n   * Gets options depending on current `task`.\n   *\n   * @private\n   * @method _getOptions\n   * @return array\n   */\n  Chart.prototype._getOptions = function() {\n    var i18n = this.$injector.get('i18n');\n    var options = {\n      seriesBarDistance: 70,\n      chartPadding: {\n        top: 50,\n        left: 0,\n        right: 0,\n        bottom: 0\n      },\n      axisY:{\n        labelInterpolationFnc: function(value) {\n          return (value * 100) + '%';\n        },\n        ticks: [0, 0.2, 0.4, 0.6, 0.8, 1],\n        type: Chartist.FixedScaleAxis,\n        high: 1,\n        low: 0\n      }\n    };\n\n    switch(this.task.type) {\n      case this.$injector.get('TYPE_ANCHORING'):\n      case this.$injector.get('TYPE_MENTAL_BOOKKEEPING'): {\n        options.plugins = [\n          Chartist.plugins.legend({\n            legendNames: [\n              i18n.get('BUYING'),\n              i18n.get('NOT_BUYING')\n            ]\n          })\n        ];\n\n        break;\n      }\n      case this.$injector.get('TYPE_PROCRASTINATION'): {\n        options.plugins = [\n          Chartist.plugins.legend({\n            legendNames: [\n              i18n.get('Target reached'),\n              i18n.get('Target dismissed')\n            ]\n          })\n        ];\n\n        break;\n      }\n      default:\n    }\n\n    return options;\n  };\n\n  /**\n   * Renders chart depending on current `task`.\n   *\n   * @private\n   * @method _render\n   * @return array\n   */\n  Chart.prototype._render = function(data, options) {\n    var $timeout = this.$injector.get('$timeout');\n\n    this.$element.addClass('ct-chart');\n    var element = this.$element.get(0);\n\n    var me = this;\n    var render = function() {\n      switch(me.task.type) {\n        case me.$injector.get('TYPE_ANCHORING'):\n        case me.$injector.get('TYPE_MENTAL_BOOKKEEPING'):\n        case me.$injector.get('TYPE_SAVINGS_SUPPORTED'):\n        case me.$injector.get('TYPE_PROCRASTINATION'):\n          me._chart = new Chartist.Bar(element, data, options);\n          break;\n        default:\n      }\n    };\n\n    $timeout(render, 100);\n  };\n\n  //\n  // REGISTRY\n  //\n  angular.module(module).directive('chart', function(){\n    return {\n      scope: {\n        task: '=?chartTask',\n        results: '=?chartResults'\n      },\n      restrict: 'A',\n      controller: Chart,\n      bindToController: true,\n      controllerAs: 'chartController'\n    };\n  });\n\n})(ANGULAR_MODULE, angular);\n\n/* global ANGULAR_MODULE, angular, UIkit */\n(function(module, angular) {\n  'use strict';\n\n  // --------------------------------------------------\n  // Modal\n  // --------------------------------------------------\n\n  //\n  // CONTROLLER\n  //\n\n  /**\n   * @constructor\n   */\n  var Modal = function($scope, $attrs, $element, $transclude) {\n    this.$scope = $scope;\n    this.$attrs = $attrs;\n    this.$element = $element;\n    this.$transclude = $transclude;\n\n    this._element = null;\n    this._modal = null;\n    this._scope = null;\n  };\n\n  Modal.$inject = ['$scope', '$attrs', '$element', '$transclude'];\n\n  //\n  // PROPERTIES\n  //\n\n  /** @var {boolean} isVisible Flag for modal visibility. */\n  Modal.prototype.isVisible = false;\n\n  //\n  // METHODS\n  //\n\n  /**\n   * Registers UIkit callbacks and watches.\n   *\n   * @public\n   * @method $onInit\n   * @return {Void}\n   */\n  Modal.prototype.$onInit = function()\n    {\n      var me = this;\n\n      // listeners\n      this._onShow = function() {\n        me.$scope.$evalAsync(me.onShow);\n      };\n\n      this._onShown = function() {\n        me.$scope.$evalAsync(me.onShown);\n      };\n\n      this._onBeforeShow = function() {\n        me.$scope.$evalAsync(me.onBeforeShow);\n      };\n\n      this._onHide = function() {\n        me.$scope.$evalAsync(me.onHide);\n      };\n\n      this._onHidden = function() {\n        me.$scope.$evalAsync(function(){\n          me.onHidden();\n          me.isVisible = false;\n        });\n      };\n\n      this._onBeforeHide = function() {\n        me.$scope.$evalAsync(me.onBeforeHide);\n      };\n\n      // watches\n      this._unwatch = this.$scope.$watch(\n        'modalController.isVisible',\n        function(isVisible) {\n          if (isVisible) {\n            me.transclude();\n            return;\n          }\n\n          me.destroy();\n        }\n      );\n    };\n\n  /**\n   * Cleans up everything on destruction.\n   *\n   * @public\n   * @method $onDestroy\n   * @return {Void}\n   */\n  Modal.prototype.$onDestroy = function()\n    {\n      this._unwatch();\n      this.destroy();\n    };\n\n  /**\n   * Transcludes contents and shows modal.\n   *\n   * @public\n   * @method render\n   * @return {Void}\n   */\n  Modal.prototype.transclude = function() {\n    var me = this;\n\n    var transclude = function(clone, scope) {\n      // save element and scope\n      me._element = clone;\n      me._scope = scope;\n\n      // register UIKit listeners\n      me._element.on('show', me._onShow);\n      me._element.on('shown', me._onShown);\n      me._element.on('beforeshow', me._onBeforeShow);\n\n      me._element.on('hide', me._onHide);\n      me._element.on('hidden', me._onHidden);\n      me._element.on('beforehide', me._onBeforeHide);\n\n      // replace with actual element\n      me.$element.append(clone);\n\n      // create and show the modal\n      me._modal = UIkit.modal(clone);\n      me._modal.show();\n    };\n\n    this.$transclude(transclude);\n  };\n\n  /**\n   * Destructs current modal transclusion from DOM.\n   *\n   * @public\n   * @method destroy\n   * @return {Void}\n   */\n  Modal.prototype.destroy = function() {\n    if (this._element !== null) {\n      this._element.off('show', this._onShow);\n      this._element.off('shown', this._onShown);\n      this._element.off('beforeshow', this._onBeforeShow);\n\n      this._element.off('hide', this._onHide);\n      this._element.off('hidden', this._onHidden);\n      this._element.off('beforeHide', this._onBeforeHide);\n\n      this._element.remove();\n      this._element = null;\n    }\n\n    if (this._scope !== null) {\n      this._scope.$destroy();\n      this._scope = null;\n    }\n\n    if (this._modal !== null) {\n      this._modal.hide();\n      this._modal = null;\n    }\n  };\n\n  //\n  // REGISTRY\n  //\n  angular.module(module).directive('modal', function(){\n    return {\n      scope: {\n        isVisible: '=?modal',\n        onShow:'&modalOnShow',\n        onHide:'&modalOnHide',\n        onShown:'&modalOnShown',\n        onHidden:'&modalOnHidden',\n        onBeforeShow:'&modalOnBeforeShow',\n        onBeforeHide:'&modalOnBeforeHide'\n      },\n      restrict: 'A',\n      controller: Modal,\n      transclude: 'element',\n      bindToController: true,\n      controllerAs: 'modalController'\n    };\n  });\n\n})(ANGULAR_MODULE, angular);\n\n/* global ANGULAR_MODULE, angular, YT */\n(function(module, angular) {\n  'use strict';\n\n  // --------------------------------------------------\n  // Video\n  // --------------------------------------------------\n\n  //\n  // CONTROLLER\n  //\n\n  /**\n   * @constructor\n   */\n  var Video = function($scope, $element, $attrs, $injector) {\n    this.$scope = $scope;\n    this.$attrs = $attrs;\n    this.$element = $element;\n    this.$injector = $injector;\n\n    this._player = null;\n    this._element = this.$element.find('.player');\n\n    this._onReady = this._onReady.bind(this);\n    this._onStateChange = this._onStateChange.bind(this);\n  };\n\n  Video.$inject = ['$scope', '$element', '$attrs', '$injector'];\n\n  //\n  // PROPERTIES\n  //\n\n  /** @var {number} width Width of player. */\n  Video.prototype.width = 640;\n\n  /** @var {number} height Height of player. */\n  Video.prototype.height = 360;\n\n  /** @var {string} videoId ID of the YouTube video. */\n  Video.prototype.videoId = null;\n\n  //\n  // METHODS\n  //\n\n  /**\n   * Waits for YOUTUBE_API_LOADED flag and initializes\n   * player afterwards including all relevant events.\n   *\n   * @public\n   * @method $onInit\n   * @return {Void}\n   */\n  Video.prototype.$onInit = function()\n    {\n      var $window = this.$injector.get('$window');\n\n      var me = this;\n      var _watchAPIExpression = function() {\n        return $window.YOUTUBE_API_LOADED;\n      };\n\n      var _watchAPICallback = function(isReady) {\n        if (isReady) {\n          me._unwatchAPI();\n          me._onReady();\n        }\n      };\n\n      this._unwatchAPI = this.$scope.$watch(\n        _watchAPIExpression,\n        _watchAPICallback\n      );\n    };\n\n  /**\n   * Removes event listener and watches.\n   *\n   * @public\n   * @method $onDestroy\n   * @return {void}\n   */\n  Video.prototype.$onDestroy = function() {\n    if (this._player) {\n      this._player.destroy();\n    }\n  };\n\n  /**\n   * Provides `padding-bottom` with correct\n   * aspect ratio for a responsive viewport.\n   *\n   * @public\n   * @method $onDestroy\n   * @return {void}\n   */\n  Video.prototype.getStyle = function() {\n    return {\n      'padding-bottom': (\n        this.height /\n        this.width *\n        100\n      ) + '%',\n    };\n  };\n\n  /**\n   * Invoked by YouTube API when player's ready.\n   *\n   * @private\n   * @method _onReady\n   * @return {Void}\n   */\n  Video.prototype._onReady = function()\n    {\n      var element = this._element.get(0);\n\n      this._player = new YT.Player(\n        element,\n        {\n          width: this.width,\n          height: this.height,\n          videoId: this.videoId,\n          events: {\n            'onStateChange': this._onStateChange\n          }\n      });\n    };\n\n  /**\n   * Invoked by YouTube API when player's ready.\n   *\n   * @private\n   * @method _onReady\n   * @return {Void}\n   */\n  Video.prototype._onStateChange = function(event)\n    {\n      switch (event.data) {\n        case YT.PlayerState.PLAYING:\n          this.onPlaying();\n          break;\n        case YT.PlayerState.PAUSED:\n          this.onPaused();\n          break;\n        case YT.PlayerState.ENDED:\n          this.onEnded();\n          break;\n        case YT.PlayerState.CUED:\n          this.onCued();\n          break;\n        default:\n      }\n    };\n\n  //\n  // REGISTRY\n  //\n  angular.module(module).directive('video', function(){\n    return {\n      scope: {\n        videoId:'=videoId',\n        width:'=?videoWidth',\n        height:'=?videoHeight',\n        onCued: '&videoOnCued',\n        onEnded: '&videoOnEnded',\n        onPaused: '&videoOnPaused',\n        onPlaying: '&videoOnPlaying',\n        onBuffering: '&videoOnBuffering'\n      },\n      restrict: 'A',\n      transclude: true,\n      controller: Video,\n      bindToController: true,\n      controllerAs: 'videoController',\n      templateUrl: 'views/directives/video.html'\n    };\n  });\n\n})(ANGULAR_MODULE, angular, this);\n\n/* global ANGULAR_MODULE, angular */\n(function(module, angular) {\n  'use strict';\n\n  // --------------------------------------------------\n  // Status\n  // --------------------------------------------------\n\n  //\n  // CONTROLLER\n  //\n\n  /**\n   * @constructor\n   */\n  var Status = function($scope, $element, $attrs, $injector) {\n    this.$scope = $scope;\n    this.$attrs = $attrs;\n    this.$element = $element;\n    this.$injector = $injector;\n\n    this.iconRatio = 1;\n    this.isCompact = false;\n    this.iconColor = 'currentcolor';\n  };\n\n  Status.$inject = ['$scope', '$element', '$attrs', '$injector'];\n\n  //\n  // PROPERTIES\n  //\n\n  /** @var {object} tasks User's task hash map. */\n  Status.prototype.tasks = {};\n\n  /** @var {array} tickets User's ticket collection. */\n  Status.prototype.tickets = [];\n\n  /** @var {boolean} tasksVisible If task overview is visible. */\n  Status.prototype.tasksVisible = false;\n\n  /** @var {boolean} ticketsVisible If tickets overview is visible. */\n  Status.prototype.ticketsVisible = false;\n\n  //\n  // METHODS\n  //\n\n  /**\n   * Watches user's `tasks` and `tickets` properties and maps them for view.\n   *\n   * @public\n   * @method $onInit\n   * @return {Void}\n   */\n  Status.prototype.$onInit = function()\n    {\n      var user = this.$injector.get('user');\n\n      var me = this;\n\n      var _watchTicketsExpression = function(){\n        return user.tickets;\n      };\n\n      var _watchTicketsCallback = function(tickets) {\n        me.tickets = tickets;\n      };\n\n      this._unwatchTickets = this.$scope.$watchCollection(\n        _watchTicketsExpression,\n        _watchTicketsCallback\n      );\n\n      var _watchTasksExpression = function(){\n        return user.getTasks();\n      };\n\n      var _watchTasksCallback = function(tasks) {\n        me.tasks = tasks;\n      };\n\n      this._unwatchTasks = this.$scope.$watch(\n        _watchTasksExpression,\n        _watchTasksCallback\n      );\n    };\n\n  /**\n   * Removes event listener and watches.\n   *\n   * @public\n   * @method $onDestroy\n   * @return {void}\n   */\n  Status.prototype.$onDestroy = function() {\n    this._unwatchTickets();\n    this._unwatchTasks();\n  };\n\n  /**\n   * Toggles `tasksVisible` property.\n   *\n   * @public\n   * @method toggleTasks\n   * @return {Void}\n   */\n  Status.prototype.toggleTasks = function()\n    {\n      this.tasksVisible = !this.tasksVisible;\n    };\n\n  /**\n   * Toggles `ticketsVisible` property.\n   *\n   * @public\n   * @method toggleTickets\n   * @return {Void}\n   */\n  Status.prototype.toggleTickets = function()\n    {\n      this.ticketsVisible = !this.ticketsVisible;\n    };\n\n  //\n  // REGISTRY\n  //\n  angular.module(module).directive('status', function(){\n    return {\n      scope: {\n        iconRatio:'=?statusIconRatio',\n        iconColor:'=?statusIconColor',\n        isCompact:'=?statusIsCompact'\n      },\n      restrict: 'A',\n      transclude: true,\n      controller: Status,\n      bindToController: true,\n      controllerAs: 'statusController',\n      templateUrl: 'views/directives/status.html'\n    };\n  });\n\n  // --------------------------------------------------\n  // Status Icons\n  // --------------------------------------------------\n\n  //\n  // CONTROLLER\n  //\n\n  /**\n   * @constructor\n   */\n  var StatusIcons = function($scope, $attrs, $element, $injector) {\n    this.$scope = $scope;\n    this.$attrs = $attrs;\n    this.$element = $element;\n    this.$injector = $injector;\n\n    this.ratio = 1;\n    this.color = 'currentcolor';\n  };\n\n  StatusIcons.$inject = ['$scope', '$attrs', '$element', '$injector'];\n\n  //\n  // PROPERTIES\n  //\n\n  /** @var {boolean} isBeginner If user has state `STATE_BEGINNER` or higher. */\n  StatusIcons.prototype.isBeginner = false;\n\n  /** @var {boolean} isAmateuer If user has state `STATE_AMATEUR` or higher. */\n  StatusIcons.prototype.isAmateuer = false;\n\n  /** @var {boolean} isAdvanced If user has state `STATE_ADVANCED` or higher. */\n  StatusIcons.prototype.isAdvanced = false;\n\n  /** @var {boolean} isExpert If user has state `STATE_EXPERT` or higher. */\n  StatusIcons.prototype.isExpert = false;\n\n  /** @var {boolean} isProfi If user has state `STATE_PROFI` or higher. */\n  StatusIcons.prototype.isProfi = false;\n\n  //\n  // METHODS\n  //\n\n  /**\n   * Watches user's `state` property and maps them for view.\n   *\n   * @public\n   * @method $onInit\n   * @return {Void}\n   */\n  StatusIcons.prototype.$onInit = function()\n    {\n      var STATE_BEGINNER = this.$injector.get('STATE_BEGINNER');\n      var STATE_AMATEUR = this.$injector.get('STATE_AMATEUR');\n      var STATE_ADVANCED = this.$injector.get('STATE_ADVANCED');\n      var STATE_EXPERT = this.$injector.get('STATE_EXPERT');\n      var user = this.$injector.get('user');\n\n      var me = this;\n\n      var _watchExpression = function(){\n        return user.state;\n      };\n\n      var _watchCallback = function(state) {\n        me.isBeginner = state >= STATE_BEGINNER;\n        me.isAmateur = state >= STATE_AMATEUR;\n        me.isAdvanced = state >= STATE_ADVANCED;\n        me.isExpert = state >= STATE_EXPERT;\n      };\n\n      this._unwatch = this.$scope.$watch(\n        _watchExpression,\n        _watchCallback\n      );\n    };\n\n  /**\n   * Removes event listener and watches.\n   *\n   * @public\n   * @method $onDestroy\n   * @return {void}\n   */\n  StatusIcons.prototype.$onDestroy = function() {\n    this._unwatch();\n  };\n\n  //\n  // REGISTRY\n  //\n  angular.module(module).directive('statusIcons', function() {\n    return {\n      scope: {\n        ratio:'=?statusIconsRatio',\n        color:'=?statusIconsColor',\n      },\n      restrict: 'A',\n      transclude: true,\n      controller: StatusIcons,\n      bindToController: true,\n      controllerAs: 'statusIconsController',\n      templateUrl: 'views/directives/status-icons.html'\n    };\n  });\n\n  // --------------------------------------------------\n  // Status Label\n  // --------------------------------------------------\n\n  //\n  // CONTROLLER\n  //\n\n  /**\n   * @constructor\n   */\n  var StatusLabel = function($scope, $attrs, $element, $injector) {\n    this.$scope = $scope;\n    this.$attrs = $attrs;\n    this.$element = $element;\n    this.$injector = $injector;\n  };\n\n  StatusLabel.$inject = ['$scope', '$attrs', '$element', '$injector'];\n\n  //\n  // PROPERTIES\n  //\n\n  /** @var {string} state String represenation of user's `state`. */\n  StatusLabel.prototype.state = null;\n\n  /** @var {boolean} isCompact If presentation is in compact format. */\n  StatusLabel.prototype.isCompact = false;\n\n  //\n  // METHODS\n  //\n\n  /**\n   * Watches user's `state` property and maps them for view.\n   *\n   * @public\n   * @method $onInit\n   * @return {Void}\n   */\n  StatusLabel.prototype.$onInit = function()\n    {\n      var user = this.$injector.get('user');\n\n      var me = this;\n\n      var _watchExpression = function() {\n        return user.state;\n      };\n\n      var _watchCallback = function() {\n        me.state = user.getStateAsString();\n      };\n\n      this._unwatch = this.$scope.$watch(\n        _watchExpression,\n        _watchCallback\n      );\n    };\n\n  /**\n   * Removes event listener and watches.\n   *\n   * @public\n   * @method $onDestroy\n   * @return {void}\n   */\n  StatusLabel.prototype.$onDestroy = function() {\n    this._unwatch();\n  };\n\n  //\n  // REGISTRY\n  //\n  angular.module(module).directive('statusLabel', function(){\n    return {\n      scope: {\n        isCompact: '=?statusLabelIsCompact'\n      },\n      restrict: 'A',\n      transclude: true,\n      controller: StatusLabel,\n      bindToController: true,\n      controllerAs: 'statusLabelController',\n      templateUrl: 'views/directives/status-label.html'\n    };\n  });\n\n  // --------------------------------------------------\n  // Status Label\n  // --------------------------------------------------\n\n  //\n  // CONTROLLER\n  //\n\n  /**\n   * @constructor\n   */\n  var StatusTickets = function($scope, $attrs, $element, $injector) {\n    this.$scope = $scope;\n    this.$attrs = $attrs;\n    this.$element = $element;\n    this.$injector = $injector;\n  };\n\n  StatusTickets.$inject = ['$scope', '$attrs', '$element', '$injector'];\n\n  //\n  // PROPERTIES\n  //\n\n  /** @var {number} tickets Current user ticket count. */\n  StatusTickets.prototype.tickets = 0;\n\n  /** @var {boolean} isCompact If presentation is in compact format. */\n  StatusTickets.prototype.isCompact = false;\n\n  //\n  // METHODS\n  //\n\n  /**\n   * Watches user's `state` property and maps them for view.\n   *\n   * @public\n   * @method $onInit\n   * @return {Void}\n   */\n  StatusTickets.prototype.$onInit = function()\n    {\n      var user = this.$injector.get('user');\n\n      var me = this;\n\n      var _watchExpression = function() {\n        return user.tickets;\n      };\n\n      var _watchCallback = function(tickets) {\n        me.tickets = tickets ? tickets.length : 0;\n      };\n\n      this._unwatch = this.$scope.$watchCollection(\n        _watchExpression,\n        _watchCallback\n      );\n    };\n\n  /**\n   * Removes event listener and watches.\n   *\n   * @public\n   * @method $onDestroy\n   * @return {void}\n   */\n  StatusTickets.prototype.$onDestroy = function() {\n    this._unwatch();\n  };\n\n  //\n  // REGISTRY\n  //\n  angular.module(module).directive('statusTickets', function(){\n    return {\n      scope: {\n        isCompact: '=?statusTicketsIsCompact'\n      },\n      restrict: 'A',\n      transclude: true,\n      controller: StatusTickets,\n      bindToController: true,\n      controllerAs: 'statusTicketsController',\n      templateUrl: 'views/directives/status-tickets.html'\n    };\n  });\n\n})(ANGULAR_MODULE, angular);\n\n/* global ANGULAR_MODULE, angular */\n(function(module, angular) {\n  'use strict';\n\n  // --------------------------------------------------\n  // Tabber\n  // --------------------------------------------------\n\n  //\n  // CONTROLLER\n  //\n\n  /**\n   * @constructor\n   */\n  var Tabber = function($scope, $element, $attrs, $transclude) {\n    this.$scope = $scope;\n    this.$attrs = $attrs;\n    this.$element = $element;\n    this.$transclude = $transclude;\n\n    this.domId = 'tabber-' + $scope.$id;\n\n    this.hasExercise = $transclude.isSlotFilled('exercise');\n  };\n\n  Tabber.$inject = ['$scope','$element','$attrs', '$transclude'];\n\n  //\n  // PROPERTIES\n  //\n\n  /** @var {array} hasExercise If slot `exercise` has contents. */\n  Tabber.prototype.hasExercise = false;\n\n  /** @var {string} activeTab Currently activated tab by name. */\n  Tabber.prototype.activeTab = 'DESCRIPTION';\n\n  //\n  // METHODS\n  //\n\n  /**\n   * Sets `activeTab` property by name.\n   *\n   * @public\n   * @method setActive\n   * @param {string} tab\n   * @return {Void}\n   */\n  Tabber.prototype.setActive = function(tab) {\n    switch (tab) {\n      case 'DESCRIPTION':\n      case 'EXERCISE': {\n        this.activeTab = tab;\n        break;\n      }\n      default:\n    }\n  };\n\n  //\n  // REGISTRY\n  //\n  angular.module(module).directive('tabber', function(){\n    return {\n      scope: {\n        icon: '=?tabberIcon',\n        activeTab: '=?tabberActiveTab'\n      },\n      restrict: 'A',\n      transclude: {\n        exercise: '?tabberExercise',\n        description: 'tabberDescription'\n      },\n      controller: Tabber,\n      bindToController: true,\n      controllerAs: 'tabberController',\n      templateUrl: 'views/directives/tabber.html'\n    };\n  });\n\n})(ANGULAR_MODULE, angular);\n\n/* global ANGULAR_MODULE, angular, interact */\n(function(module, angular) {\n  'use strict';\n\n  // --------------------------------------------------\n  // Draggable\n  // --------------------------------------------------\n\n  //\n  // CONTROLLER\n  //\n\n  /**\n   * @constructor\n   */\n  var Draggable = function($scope, $element, $attrs, $injector) {\n    this.$element = $element;\n    this.$scope = $scope;\n    this.$attrs = $attrs;\n    this.$injector = $injector;\n\n    this._body = null;\n    this._clone = null;\n    this._coordinates = {};\n    this._interactable = null;\n    this._activeClass = 'active';\n    this._itemClass = 'draggable';\n    this._disabledClass = 'disabled';\n\n    var me = this;\n    this._unwatch = $scope.$watch(\n      function(){ return me.disabled; },\n      function(disabled) {\n        if (disabled) {\n          me.$element.addClass(me._disabledClass);\n        } else {\n          me.$element.removeClass(me._disabledClass);\n        }\n\n        me._interactable.draggable({enabled: !disabled});\n      }\n    );\n\n    this._onResize = this._onResize.bind(this);\n  };\n\n  Draggable.$inject = ['$scope','$element','$attrs','$injector'];\n\n  //\n  // PROPERTIES\n  //\n\n  /** @var {object} data Connected data for draggable. */\n  Draggable.prototype.data = null;\n\n  /** @type {boolean} clone If clone item should be used. */\n  Draggable.prototype.clone = false;\n\n  /** @var {boolean} disabled If draggable is disabled. */\n  Draggable.prototype.disabled = false;\n\n  /** @type {boolean} clone If clone item should be used. */\n  Draggable.prototype.restriction = 'parent';\n\n  //\n  // METHODS\n  //\n\n  /**\n   * Initializes `interact` library on element\n   * with all available callbacks for dragging.\n   *\n   * @public\n   * @method $onInit\n   * @return {Void}\n   */\n  Draggable.prototype.$onInit = function() {\n    var $window = this.$injector.get('$window');\n\n    this._body = angular.element(document.body);\n    this.$element.addClass(this._itemClass);\n    var element = this.$element.get(0);\n\n    this._interactable = interact(element);\n\n    var me = this;\n    var options = {\n      inertia: true,\n      autoScroll: true,\n      enabled: !this.disabled,\n      onend: this._onEndItem.bind(this),\n      onmove: this._onMoveItem.bind(this),\n      onstart: this._onStartItem.bind(this),\n      snap: {\n          targets:[function(x,y,interaction) {\n            // 'startCoords' doesn't work here, so\n            // we catch initial position once from\n            // interaction element and this values\n            if (!me._origin) {\n              me._origin = {\n                x: interaction.startCoords.page.x,\n                y: interaction.startCoords.page.y\n              };\n            }\n\n            // if not dropped, move draggable\n            // smoothly back to origin point\n            if (!interaction.dropTarget) {\n              return {\n                x: me._origin.x, // instead of 0\n                y: me._origin.y  // instead of 0\n              };\n            }\n          }],\n          //offset: 'startCoords',\n          endOnly: true\n      }\n    };\n\n    if (this.clone) {\n      angular.extend(options, { manualStart: true });\n      this._interactable.on('move', this._onMove.bind(this));\n    }\n\n    this._interactable.draggable(options);\n    this._interactable.getData = this._getData.bind(this);\n\n    this._window = angular.element($window);\n    this._window.on('resize', this._resize);\n  };\n\n  /**\n   * Removes event listener and watches.\n   *\n   * @public\n   * @method $onDestroy\n   * @return {void}\n   */\n  Draggable.prototype.$onDestroy = function() {\n    this._window.off('resize', this._onResize);\n    this._interactable.unset();\n    this._unwatch();\n  };\n\n  /**\n   * Resets `origin` info for snapping.\n   *\n   * @public\n   * @method $onDestroy\n   * @return {void}\n   */\n  Draggable.prototype._onResize = function() {\n    this._origin = null;\n  };\n\n  /**\n   * Adds `activeClass` to clone and invokes `onDragStart`.\n   *\n   * @private\n   * @method _onStartItem\n   * @return {Void}\n   */\n  Draggable.prototype._onStartItem = function(event) {\n    var target = !this.clone ?\n      angular.element(event.target) :\n      this._clone;\n\n    target.addClass(this._activeClass);\n\n    this._trigger('onDragStart', {\n      $event: event,\n      $data: this.data\n    });\n  };\n\n  /**\n   * This performs actual dragging logic with CSS.\n   * The method triggers the `onDragMove` callback.\n   *\n   * @private\n   * @method _onMoveItem\n   * @return {Void}\n   */\n  Draggable.prototype._onMoveItem = function(event) {\n    var target = !this.clone ?\n      angular.element(event.target) :\n      this._clone;\n\n    var x = (this._coordinates.x || 0) + event.dx;\n    var y = (this._coordinates.y || 0) + event.dy;\n\n    this._translate(target,x,y);\n\n    this._trigger('onDragMove', {\n      $event: event,\n      $data: this.data\n    });\n  };\n\n  /**\n   * This performs resetting work by removing clone.\n   * It invokes always the `onDragEnd` and the `onDrop`\n   * callbacks - if dropped on target element.\n   *\n   * @private\n   * @method _onEndItem\n   * @return {Void}\n   */\n  Draggable.prototype._onEndItem = function(event) {\n    var dropped = !!event.interaction.dropTarget;\n\n    if (!this.clone) {\n      var target = angular.element(event.target);\n      target.removeClass(this._activeClass);\n\n      // remove translate for snapping if\n      // animating back to origin coords!\n      if (!dropped) {\n        this._translate(target,0,0);\n      }\n\n    } else {\n      this._coordinates = {};\n      this._clone.remove();\n      this._clone = null;\n    }\n\n    this._trigger('onDragEnd', {\n      $event: event,\n      $data: this.data\n    });\n\n    if (dropped) {\n      this._trigger('onDrop', {\n        $event: event,\n        $data: this.data\n      });\n    }\n  };\n\n  /**\n   * Creates the clone and triggers manual kick-off for `interact`.\n   * This is necessary because we want:\n   *\n   * 1) being able to show clone object\n   * 2) being able to have disable control\n   *\n   * @private\n   * @method _onMove\n   * @return {Void}\n   */\n  Draggable.prototype._onMove = function(event) {\n    var interactable = event.interactable;\n    var interaction = event.interaction;\n    var element = event.currentTarget;\n\n    // we've to control `enabled` by our own as we are using the\n    // `manualStart` option to create clone - noop if `disabled`\n    if (this.disabled) {\n      return;\n    }\n\n    // create clone if user holds mouse/finger and no interaction\n    // is currently started - position absolutely at end of body!\n    if (interaction.pointerIsDown && !interaction.interacting()) {\n      this._clone = angular.element(element).clone();\n\n      var offsetY = element.clientHeight / 2;\n      var offsetX = element.clientWidth / 2;\n\n      var pageY = !!event.touches ?\n        event.touches[0].pageY :\n        event.pageY;\n      var pageX = !!event.touches ?\n        event.touches[0].pageX :\n        event.pageX;\n\n      this._clone.css({\n        left: (pageX - offsetX) + 'px',\n        top: (pageY - offsetY) + 'px',\n        position: 'absolute'\n      });\n\n      this._body.append(this._clone);\n      element = this._clone.get(0);\n    }\n\n    // invoke 'drag' interaction manually with the target/clone\n    interaction.start({ name: 'drag' }, interactable, element);\n  };\n\n  /**\n   * Retrieves the connected drag object data.\n   *\n   * @private\n   * @method _getData\n   * @return {object}\n   */\n  Draggable.prototype._getData = function() {\n    return this.data;\n  };\n\n  /**\n   * Translates DOM node to given coordinates.\n   *\n   * @private\n   * @method _translate\n   * @param object element\n   * @param number x\n   * @param number y\n   * @return {void}\n   */\n  Draggable.prototype._translate = function(element, x, y) {\n    var translate = 'translate('+x+'px,'+y+'px)';\n\n    element.css({\n      'webkitTransform': translate,\n      'mozTransform': translate,\n      'msTransform': translate,\n      'oTransform': translate,\n      'transform': translate\n    });\n\n    this._coordinates.x = x;\n    this._coordinates.y = y;\n  };\n\n  /**\n   * Primitive method for invoking callbacks.\n   *\n   * @private\n   * @method _trigger\n   * @return {void}\n   */\n  Draggable.prototype._trigger = function(method, args) {\n    this.$scope.$evalAsync(this[method].bind(this,args));\n  };\n\n  //\n  // REGISTRY\n  //\n  angular.module(module).directive('draggable', function(){\n    return {\n      scope: {\n        data: '=?draggableData',\n        clone: '=?draggableClone',\n        disabled: '=?draggableDisabled',\n        onDragStart: '&draggableOnDragStart',\n        onDragMove: '&draggableOnDragMove',\n        onDragEnd: '&draggableOnDragEnd',\n        onDrop: '&draggableOnDrop'\n      },\n      restrict: 'A',\n      controller: Draggable,\n      bindToController: true,\n      controllerAs: 'draggableController'\n    };\n  });\n\n  // --------------------------------------------------\n  // Dropable\n  // --------------------------------------------------\n\n  //\n  // CONTROLLER\n  //\n\n  /**\n   * @constructor\n   */\n  var Dropable = function($scope, $element, $attrs) {\n    this.$element = $element;\n    this.$scope = $scope;\n    this.$attrs = $attrs;\n\n    this._interactable = null;\n    this._enterClass = 'enter';\n    this._activeClass = 'active';\n    this._itemClass = 'dropable';\n    this._acceptClass = 'draggable';\n    this._disabledClass = 'disabled';\n\n    var me = this;\n    this._unwatch = $scope.$watch(\n      function(){ return me.disabled; },\n      function(disabled) {\n        if (disabled) {\n          me.$element.addClass(me._disabledClass);\n        } else {\n          me.$element.removeClass(me._disabledClass);\n        }\n      }\n    );\n  };\n\n  Dropable.$inject = ['$scope','$element','$attrs'];\n\n  //\n  // PROPERTIES\n  //\n\n  /** @var {boolean} disabled If draggable is disabled. */\n  Dropable.prototype.disabled = false;\n\n  //\n  // METHODS\n  //\n\n  /**\n   * Initializes `interact` library on element\n   * with all available callbacks for dragging.\n   *\n   * @public\n   * @method $onInit\n   * @return {Void}\n   */\n  Dropable.prototype.$onInit = function() {\n    this._body = angular.element(document.body);\n    this.$element.addClass(this._itemClass);\n    var accept = '.' + this._acceptClass;\n    var element = this.$element.get(0);\n\n    this._interactable = interact(element)\n      .dropzone({\n        accept: accept,\n        enabled: !this.disabled,\n        ondrop: this._onDrop.bind(this),\n        ondragenter: this._onDragEnter.bind(this),\n        ondragleave: this._onDragLeave.bind(this),\n        ondropactivate: this._onDropActivate.bind(this),\n        ondropdeactivate: this._onDropDeactivate.bind(this)\n      });\n  };\n\n  /**\n   * Removes event listener and watches.\n   *\n   * @public\n   * @method $onDestroy\n   * @return {void}\n   */\n  Dropable.prototype.$onDestroy = function() {\n    this._interactable.unset();\n    this._unwatch();\n  };\n\n  /**\n   * Removes the active class from element and\n   * triggers the `onDropDeactivate` callback.\n   *\n   * @private\n   * @method _onDropDeactivate\n   * @return {Void}\n   */\n  Dropable.prototype._onDropDeactivate = function(event) {\n    this.$element.removeClass(this._activeClass);\n    var data = event.draggable.getData();\n\n    this._trigger('onDropDeactivate', {\n      $event: event,\n      $data: data\n    });\n  };\n\n  /**\n   * Applies the active class from element and\n   * triggers the `onDropActivate` callback.\n   *\n   * @private\n   * @method _onDropDeactivate\n   * @return {Void}\n   */\n  Dropable.prototype._onDropActivate = function(event) {\n    this.$element.addClass(this._activeClass);\n    var data = event.draggable.getData();\n\n    this._trigger('onDropActivate', {\n      $event: event,\n      $data: data\n    });\n  };\n\n  /**\n   * Applies the enter class from element and\n   * triggers the `onDragEnter` callback.\n   *\n   * @private\n   * @method _onDropDeactivate\n   * @return {Void}\n   */\n  Dropable.prototype._onDragEnter = function(event) {\n    this.$element.addClass(this._enterClass);\n    var data = event.draggable.getData();\n\n    this._trigger('onDragEnter', {\n      $event: event,\n      $data: data\n    });\n  };\n\n  /**\n   * Removes the enter class from element and\n   * triggers the `onDragLeave` callback.\n   *\n   * @private\n   * @method _onDropDeactivate\n   * @return {Void}\n   */\n  Dropable.prototype._onDragLeave = function(event) {\n    this.$element.removeClass(this._enterClass);\n    var data = event.draggable.getData();\n\n    this._trigger('onDragLeave', {\n      $event: event,\n      $data: data\n    });\n  };\n\n  /**\n   * Removes the enter class from element and\n   * triggers the `onDrop` callback with data\n   * from the draggable element.\n   *\n   * @private\n   * @method _onDropDeactivate\n   * @return {Void}\n   */\n  Dropable.prototype._onDrop = function(event) {\n    this.$element.removeClass(this._enterClass);\n    var data = event.draggable.getData();\n\n    this._trigger('onDrop',{\n      $event: event,\n      $data: data\n    });\n  };\n\n  /**\n   * Primitive method for invoking callbacks.\n   *\n   * @private\n   * @method _trigger\n   * @return {void}\n   */\n  Dropable.prototype._trigger = function(method, args) {\n    this.$scope.$evalAsync(this[method].bind(this,args));\n  };\n\n  //\n  // REGISTRY\n  //\n  angular.module(module).directive('dropable', function(){\n    return {\n      scope: {\n        disabled: '=?dropableDisabled',\n        onDropDeactivate: '&dropableOnDropDeactivate',\n        onDropActivate: '&dropableOnDropActivate',\n        onDragEnter: '&dropableOnDragEnter',\n        onDragLeave: '&dropableOnDragLeave',\n        onDrop: '&dropableOnDrop'\n      },\n      restrict: 'A',\n      controller: Dropable,\n      bindToController: true,\n      controllerAs: 'droppableController'\n    };\n  });\n\n})(ANGULAR_MODULE, angular);\n\n/* global ANGULAR_MODULE, angular, UIkit */\n(function(module, angular) {\n  'use strict';\n\n  // --------------------------------------------------\n  // Accordion\n  // --------------------------------------------------\n\n  //\n  // CONTROLLER\n  //\n\n  /**\n   * @constructor\n   */\n  var Accordion = function($scope, $element, $attrs, $injector) {\n    this.$scope = $scope;\n    this.$attrs = $attrs;\n    this.$element = $element;\n    this.$injector = $injector;\n\n    this._accordion = null;\n    this._collapsibles = [];\n    this._init = this._init.bind(this);\n    this._onCollapsibleClicked = this._onCollapsibleClicked.bind(this);\n  };\n\n  Accordion.$inject = ['$scope','$element','$attrs', '$injector'];\n\n  //\n  // PROPERTIES\n  //\n\n  /** @var {object} options Options for accordion. */\n  Accordion.prototype.options = null;\n\n  //\n  // METHODS\n  //\n\n  /**\n   * Initializes accordion after rendering.\n   *\n   * @public\n   * @method $onInit\n   * @return {Void}\n   */\n  Accordion.prototype.$onInit = function() {\n    var $timeout = this.$injector.get('$timeout');\n\n    // wait for being rendered\n    $timeout(this._init, 1);\n  };\n\n  /**\n   * Tears down accordion on desctruction.\n   *\n   * @public\n   * @method $onDestroy\n   * @return {Void}\n   */\n  Accordion.prototype.$onDestroy = function() {\n    if (this._accordion) {\n      this._accordion.$destroy();\n    }\n\n    this._unlistenCollapsible();\n  };\n\n  /**\n   * Sets `activeTab` property by name.\n   *\n   * @public\n   * @method addCollapsible\n   * @param {Object} collapsible\n   * @return {Void}\n   */\n  Accordion.prototype.addCollapsible = function(collapsible) {\n    this._collapsibles.push(collapsible);\n  };\n\n  /**\n   * Initializes UIKit accordion and event listeners.\n   *\n   * @private\n   * @method _init\n   * @return {Void}\n   */\n  Accordion.prototype._init = function() {\n    var $rootScope = this.$injector.get('$rootScope');\n    var element = this.$element.get(0);\n\n    var options = angular.extend(\n      {\n        targets: '.collapsible',\n        animation: false\n      },\n      this.options || {}\n    );\n\n    this._unlistenCollapsible = $rootScope.$on(\n      'collapsible_clicked',\n      this._onCollapsibleClicked\n    );\n\n    this._accordion = UIkit.accordion(element, options);\n  };\n\n  /**\n   * Initializes UIKit accordion and event listeners.\n   *\n   * @private\n   * @method _onCollapsibleClicked\n   * @return {Void}\n   */\n  Accordion.prototype._onCollapsibleClicked = function(evt, sender) {\n    var iterate = function(item, index) {\n      var senderId = sender.$scope.$id;\n      var itemId = item.$scope.$id;\n\n      // ignore sender collapsible\n      if (senderId === itemId) {\n        return;\n      }\n\n      // ignore closing sender\n      if (!sender.open) {\n        return;\n      }\n\n      // ignore closed items\n      if (!item.open) {\n        return;\n      }\n\n      // toggle open items\n      this._accordion.toggle(index);\n      item.open = false;\n    };\n\n    angular.forEach(\n      this._collapsibles,\n      iterate.bind(this)\n    );\n  };\n\n  //\n  // REGISTRY\n  //\n  angular.module(module).directive('accordion', function(){\n    return {\n      scope: {\n        options: '=?accordionOptions'\n      },\n      restrict: 'A',\n      transclude: true,\n      controller: Accordion,\n      bindToController: true,\n      controllerAs: 'accordionController',\n      templateUrl: 'views/directives/accordion.html'\n    };\n  });\n\n  // --------------------------------------------------\n  // Accordion Item\n  // --------------------------------------------------\n\n  //\n  // CONTROLLER\n  //\n\n  /**\n   * @constructor\n   */\n  var Collapsible = function($scope, $element, $attrs, $injector) {\n    this.$scope = $scope;\n    this.$attrs = $attrs;\n    this.$element = $element;\n    this.$injector = $injector;\n  };\n\n  Collapsible.$inject = ['$scope','$element','$attrs', '$injector'];\n\n  //\n  // PROPERTIES\n  //\n\n  /** @var {string} id Unique dom id for this collapsible. */\n  Collapsible.prototype.id = null;\n\n  /** @var {boolean} open If collapsible is currently open. */\n  Collapsible.prototype.open = false;\n\n  //\n  // METHODS\n  //\n\n  /**\n   * Sets `activeTab` property by name.\n   *\n   * @public\n   * @method setActive\n   * @param {string} tab\n   * @return {Void}\n   */\n  Collapsible.prototype.$onInit = function() {\n    var defaultId = 'collapsible-' + this.$scope.$id;\n\n    this.accordion.addCollapsible(this);\n    this.domId = this.id || defaultId;\n  };\n\n  /**\n   * Sets `activeTab` property by name.\n   *\n   * @public\n   * @method setActive\n   * @param {string} tab\n   * @return {Void}\n   */\n  Collapsible.prototype.onClick = function() {\n    this.open = !this.open;\n\n    var $rootScope = this.$injector.get('$rootScope');\n    $rootScope.$broadcast('collapsible_clicked', this);\n  };\n\n  //\n  // REGISTRY\n  //\n  angular.module(module).directive('collapsible', function(){\n    return {\n      scope: {\n        id: '=?collapsible',\n        open: '=?collapsibleOpen'\n      },\n      restrict: 'A',\n      transclude: {\n        title: '?collapsibleTitle',\n        content: 'collapsibleContent'\n      },\n      require: {\n        accordion: '^accordion'\n      },\n      controller: Collapsible,\n      bindToController: true,\n      controllerAs: 'collapsibleController',\n      templateUrl: 'views/directives/collapsible.html'\n    };\n  });\n\n})(ANGULAR_MODULE, angular);\n\n/* global ANGULAR_MODULE, angular, UIkit, jQuery */\n(function(module, angular) {\n  'use strict';\n\n  // --------------------------------------------------\n  // ScrollTo\n  // --------------------------------------------------\n\n  //\n  // CONTROLLER\n  //\n\n  /**\n   * @constructor\n   */\n  var ScrollTo = function($scope, $element, $attrs, $injector) {\n    this.$scope = $scope;\n    this.$attrs = $attrs;\n    this.$element = $element;\n    this.$injector = $injector;\n\n    this.options = {};\n\n    this._source = null;\n    this._target = null;\n    this._scroller = null;\n    this._init = this._init.bind(this);\n    this._onClick = this._onClick.bind(this);\n    this._onScrolled = this._onScrolled.bind(this);\n  };\n\n  ScrollTo.$inject = ['$scope','$element','$attrs', '$injector'];\n\n  //\n  // PROPERTIES\n  //\n\n  /** @var {number} delay Delayed invokation in ms. */\n  ScrollTo.prototype.delay = null;\n\n  /** @var {object} options Options for `scroll` service. */\n  ScrollTo.prototype.options = null;\n\n  /** @var {function} callback Callback for scroll finished. */\n  ScrollTo.prototype.callback = null;\n\n  /** @var {boolean} disabled Flag indicating disabled state. */\n  ScrollTo.prototype.disabled = null;\n\n  //\n  // METHODS\n  //\n\n  /**\n   * Waits for rendering and invokes `_init()`.\n   *\n   * @public\n   * @method $onInit\n   * @return {Void}\n   */\n  ScrollTo.prototype.$onInit = function() {\n    var $timeout = this.$injector.get('$timeout');\n\n    // wait for being rendered\n    $timeout(this._init, 1);\n  };\n\n  /**\n   * Removes event listener and watches.\n   *\n   * @public\n   * @method $onDestroy\n   * @return {void}\n   */\n  ScrollTo.prototype.$onDestroy = function() {\n    this._source.off('scrolled', this._onScrolled);\n    this.$element.off('click', this._onClick);\n\n    this._scroller.$destroy(true);\n  };\n\n  /**\n   * Extracts dom element and sets up scroller.\n   *\n   * @private\n   * @method _init\n   * @return {void}\n   */\n  ScrollTo.prototype._init = function() {\n    // try to grab target from - can be either\n    // a jquery element or a string id / hash\n    if (this.element instanceof jQuery) {\n      this._target = this.element;\n    } else {\n      if (angular.isString(this.element)) {\n        if (this.element.charAt(0) !== '#') {\n          this._target = '#' + this.element;\n        }\n\n        this._target = jQuery(this._target);\n      }\n    }\n\n    if (this._target.length === 0) {\n      console.warn('scroll-to.js: Invalid target element!');\n      return;\n    }\n\n    // need to create a dummy `<a href='#hash'></a>`\n    // element to set it as source object for UIkit\n    var href = '#' + this._target.id;\n    this._source = jQuery('<a href=\"'+href+'\"></a>');\n\n    this.options = this.options || {};\n    this.options.easing = angular.isString(this.options.easing) ?\n      this.options.easing :\n      'easeOutExpo';\n    this.options.offset = angular.isNumber(this.options.offset) ?\n      this.options.offset :\n      100;\n    this.options.duration = angular.isNumber(this.options.duration) ?\n      this.options.duration :\n      500;\n\n    this.$element.on('click', this._onClick);\n    this._source.on('scrolled', this._onScrolled);\n\n    this._scroller = UIkit.scroll(this._source, this.options);\n  };\n\n  /**\n   * Invokes scrolling to target element.\n   *\n   * @private\n   * @method _onClick\n   * @return {void}\n   */\n  ScrollTo.prototype._onClick = function() {\n    var $timeout = this.$injector.get('$timeout');\n\n    var onDelay = function() {\n      if (this.disabled) {\n        return;\n      }\n\n      this._scroller.scrollTo(this._target);\n    };\n\n    $timeout(onDelay.bind(this), this.delay);\n  };\n\n  /**\n   * Tries to invoke callback after scrolling.\n   *\n   * @private\n   * @method _onScrolled\n   * @return {void}\n   */\n  ScrollTo.prototype._onScrolled = function() {\n    if (!angular.isFunction(this.callback)) {\n      return;\n    }\n\n    this.$scope.$evalAsync(this.callback);\n  };\n\n  //\n  // REGISTRY\n  //\n  angular.module(module).directive('scrollTo', function(){\n    return {\n      scope: {\n        element: '=scrollTo',\n        delay: '=?scrollToDelay',\n        options: '=?scrollToOptions',\n        callback: '=?scrollToCallback',\n        disabled: '=?scrollToDisabled'\n      },\n      restrict: 'A',\n      controller: ScrollTo,\n      bindToController: true\n    };\n  });\n\n})(ANGULAR_MODULE, angular);\n\n/* global ANGULAR_MODULE, angular */\n(function(module, angular) {\n  'use strict';\n\n  // --------------------------------------------------\n  // Evaluation\n  // --------------------------------------------------\n\n  //\n  // CONTROLLER\n  //\n\n  /**\n   * @constructor\n   */\n  var Evaluation = function($scope, $element, $attrs, $injector) {\n    this.$scope = $scope;\n    this.$attrs = $attrs;\n    this.$element = $element;\n    this.$injector = $injector;\n\n    this.user = $injector.get('user');\n    this.domId = 'evaluation-' + $scope.$id;\n  };\n\n  Evaluation.$inject = ['$scope','$element','$attrs', '$injector'];\n\n  //\n  // PROPERTIES\n  //\n\n  /** @var {string} domId Unique dom id for scrolling. */\n  Evaluation.prototype.domId = null;\n\n  //\n  // REGISTRY\n  //\n  angular.module(module).directive('evaluation', function(){\n    return {\n      scope: {\n        parent: '=evaluation'\n      },\n      restrict: 'A',\n      transclude: {\n        text: 'evaluationText',\n        customButtons: '?evaluationCustomButtons',\n        defaultButtons: '?evaluationDefaultButtons'\n      },\n      controller: Evaluation,\n      bindToController: true,\n      controllerAs: 'evaluationController',\n      templateUrl: 'views/directives/evaluation.html'\n    };\n  });\n\n})(ANGULAR_MODULE, angular);\n\n/* global ANGULAR_MODULE, angular */\n(function(module, angular) {\n  'use strict';\n\n  // --------------------------------------------------\n  // Locked State\n  // --------------------------------------------------\n\n  //\n  // CONTROLLER\n  //\n\n  /**\n   * @constructor\n   */\n  var LockedState = function($scope, $element, $attrs, $injector) {\n    this.$scope = $scope;\n    this.$attrs = $attrs;\n    this.$element = $element;\n\n    this.user = $injector.get('user');\n  };\n\n  LockedState.$inject = ['$scope','$element','$attrs', '$injector'];\n\n  //\n  // REGISTRY\n  //\n  angular.module(module).directive('lockedState', function(){\n    return {\n      scope: {\n        isLocked: '=?lockedState'\n      },\n      restrict: 'A',\n      transclude: {\n        userText: '?userText',\n        adminText: '?adminText',\n        superAdminText: '?superAdminText'\n      },\n      controller: LockedState,\n      bindToController: true,\n      controllerAs: 'lockedStateController',\n      templateUrl: 'views/directives/locked-state.html'\n    };\n  });\n\n})(ANGULAR_MODULE, angular);\n\n/* global ANGULAR_MODULE, angular */\n(function(module, angular) {\n  'use strict';\n\n  // --------------------------------------------------\n  // Form Field\n  // --------------------------------------------------\n\n  //\n  // CONTROLLER\n  //\n\n  /**\n   * @constructor\n   */\n  var FormField = function($scope, $element, $attrs, $transclude, $timeout)\n    {\n      this.$scope = $scope;\n      this.$attrs = $attrs;\n      this.$element = $element;\n      this.$timeout = $timeout;\n      this.$transclude = $transclude;\n\n      this._transcludeElements = [];\n      this._transcludeScopes = [];\n      this._cloneDefault = null;\n      this._cloneLabel = null;\n      this._unlisten = [];\n      this._unwatch = [];\n    };\n\n  FormField.$inject = ['$scope', '$element', '$attrs', '$transclude', '$timeout'];\n\n  //\n  // PROPERTIES\n  //\n\n  /** @var {string} id Dom id form element. */\n  FormField.prototype.id = '';\n\n  /** @var {string} label Label of form element. */\n  FormField.prototype.label = '';\n\n  /** @var {ngModelController} model Added `ngModel` controller. */\n  FormField.prototype.ngModel = null;\n\n  /** @var {boolean} resetEmpty If validation resets on empty model. */\n  FormField.prototype.resetEmpty = true;\n\n  /** @var {boolean} showMessages True if `ngMessages` are visible. */\n  FormField.prototype.showMessages = false;\n\n  /** @var {string} labelClass Class to append to label. */\n  FormField.prototype.labelClass = 'uk-form-label';\n\n  /** @var {string} failureClass Class to append on failure. */\n  FormField.prototype.failureClass = 'uk-form-danger';\n\n  /** @var {string} successClass Class to append on success. */\n  FormField.prototype.successClass = 'uk-form-success';\n\n  //\n  // METHODS\n  //\n\n  /**\n   * Renders custom transclusion (form element) and\n   * sets up watchers as well as clean up methods.\n   *\n   * @public\n   * @method $onInit\n   * @return {Void}\n   */\n  FormField.prototype.$onInit = function()\n    {\n      // create dom id from `name` and $scope id\n      // controller properties are only available\n      // in $onInit() callback from Angular 1.5.x\n      this.id = 'form-field-' + this.$scope.$id;\n\n      // add watch properties\n      this._addWatches();\n\n      // transclude contents\n      this._transclude();\n    };\n\n  /**\n   * Removes transcluded elements, scope and watches.\n   *\n   * @public\n   * @method $onDestroy\n   * @return {void}\n   */\n  FormField.prototype.$onDestroy = function()\n    {\n      angular.forEach(this._transcludeElements, function(element){\n        element.remove();\n      });\n\n      angular.forEach(this._transcludeScopes, function(scope){\n        scope.$destroy();\n      });\n\n      angular.forEach(this._unlisten, function(unlisten){\n        unlisten();\n      });\n\n      angular.forEach(this._unwatch, function(unwatch){\n        unwatch();\n      });\n    };\n\n  /**\n   * Sets model controller from transcluded form\n   * element using the `ng-model` attribute and\n   * the `form-field-model` helper component.\n   *\n   * @public\n   * @method setModel\n   * @param {NgModelController} ngModel\n   * @return {void}\n   */\n  FormField.prototype.setModel = function(ngModel)\n    {\n      this.ngModel = ngModel;\n    };\n\n  /**\n   * Updates validation depending on `ngModel.$valid`.\n   *\n   * @private\n   * @method _update\n   * @return {void}\n   */\n  FormField.prototype._update = function()\n    {\n      if (this.ngModel.$valid) {\n        this._cloneDefault.removeClass(this.failureClass);\n        this._cloneDefault.addClass(this.successClass);\n      } else {\n        this._cloneDefault.removeClass(this.successClass);\n        this._cloneDefault.addClass(this.failureClass);\n      }\n\n      this.showMessages = this.ngModel.$invalid;\n    };\n\n  /**\n   * Resets corresponding validation properties.\n   *\n   * @private\n   * @method _reset\n   * @return {boolean}\n   */\n  FormField.prototype._reset = function()\n    {\n      this._cloneDefault.removeClass(this.failureClass);\n      this._cloneDefault.removeClass(this.successClass);\n      this.ngModel.$setUntouched();\n      this.showMessages = false;\n    };\n\n  /**\n   * Adds scope watches for `isValid()` and `isInvalid()`.\n   *\n   * @private\n   * @method _addWatches\n   * @return {void}\n   */\n  FormField.prototype._addWatches = function()\n    {\n      var me = this;\n\n      // observes `ngModel` controller for changing any\n      // of its validation properties such as `$valid`\n      var unwatchModel = this.$scope.$watchCollection(\n        'formFieldController.ngModel',\n        function(newModel, oldModel)\n        {\n          // ignore initial invocation\n          if (newModel === oldModel) {\n            return;\n          }\n\n          // as long as model hasn't been\n          // touched no validation's made\n          if (!newModel.$touched) {\n              return;\n          }\n\n          // wait for async validators\n          if (newModel.$pending) {\n            return;\n          }\n\n          // if no view value is present\n          // reset all validation props!\n          if (!newModel.$viewValue) {\n            if (me.resetEmpty) {\n              me._reset();\n              return;\n            }\n          }\n\n          me._update();\n        }\n      );\n\n      this._unwatch.push(unwatchModel);\n    };\n\n  /**\n   * Transcludes `default` and `label` slot programmatically\n   * to append custom attributes and events to dom elements.\n   *\n   * @private\n   * @method _transclude\n   * @return {void}\n   */\n  FormField.prototype._transclude = function()\n    {\n      var me = this;\n\n      // adds `id` attribute to be focues by <label>\n      var transcludeDefault = function(clone, scope)\n      {\n        var domId = '#default-' + me.id;\n        var template = angular.element(domId);\n\n        clone.attr('id', me.id);\n\n        template.replaceWith(clone);\n\n        me._cloneDefault = clone;\n\n        me._transcludeScopes.push(scope);\n        me._transcludeElements.push(clone);\n      };\n\n      // adds `labelClass` and sets `for` attribute\n      // for <label> in order to auto focus element\n      var transcludeLabel = function(clone, scope)\n      {\n        var domId = '#label-' + me.id;\n        var template = angular.element(domId);\n\n        clone.attr('for', me.id);\n        clone.addClass(me.labelClass);\n\n        template.replaceWith(clone);\n\n        me._cloneLabel = clone;\n\n        me._transcludeScopes.push(scope);\n        me._transcludeElements.push(clone);\n      };\n\n      // wait for dom to be ready before transclude\n      var timeout = function()\n      {\n        me.$transclude(transcludeDefault, null, null);\n        me.$transclude(transcludeLabel, null, 'label');\n      };\n\n      this.$timeout(timeout);\n    };\n\n  //\n  // REGISTRY\n  //\n  angular.module(ANGULAR_MODULE).directive('formField',function() {\n    return {\n      scope: {\n          name: '=formField',\n          resetEmpty: '=?formFieldResetEmpty',\n          labelClass: '=?formFieldLabelClass',\n          failureClass: '=?formFieldFailureClass',\n          successClass: '=?formFieldSuccessClass'\n      },\n      transclude: {\n        label: '?label',\n        messageMin: '?messageMin',\n        messageMax: '?messageMax',\n        messageUrl: '?messageUrl',\n        messageEmail: '?messageEmail',\n        messageNumber: '?messageNumber',\n        messagePattern: '?messagePattern',\n        messageRequired: '?messageRequired',\n        messageMinlength: '?messageMinlength',\n        messageMaxlength: '?messageMaxlength',\n        messagesCustom: '?messagesCustom'\n      },\n      restrict: 'A',\n      controller: FormField,\n      bindToController: true,\n      controllerAs: 'formFieldController',\n      templateUrl: 'views/directives/form-field.html'\n    };\n  });\n\n  // --------------------------------------------------\n  // Form Field Model\n  // --------------------------------------------------\n\n  /**\n   * @constructor\n   */\n  var FormFieldModel = function($scope, $attrs, $element, $injector) {\n    this.$scope = $scope;\n    this.$attrs = $attrs;\n    this.$element = $element;\n    this.$injector = $injector;\n  };\n\n  FormFieldModel.$inject = ['$scope', '$attrs', '$element', '$injector'];\n\n  //\n  // PROPERTIES\n  //\n\n  /** @var {boolean} autoFocus If true element receives focus on init. */\n  FormFieldModel.prototype.autoFocus = false;\n\n  //\n  // METHODS\n  //\n\n  /**\n   * Registers `ngModel` on `formField` controller.\n   *\n   * @public\n   * @method $onInit\n   * @return {Void}\n   */\n  FormFieldModel.prototype.$onInit = function()\n    {\n      var $timeout = this.$injector.get('$timeout');\n      var $log = this.$injector.get('$log');\n\n      if (!this.formField) {\n        $log.warn('formFieldModel: No form field controller found!');\n        return;\n      }\n\n      if (this.autoFocus) {\n        var element = this.$element.get(0);\n        var focus = function() {\n          element.focus();\n        };\n\n        $timeout(focus, 1);\n      }\n\n      this.formField.setModel(this.ngModel);\n    };\n\n  //\n  // REGISTRY\n  //\n  angular.module(module).directive('formFieldModel', function(){\n    return {\n      scope: {\n        'autoFocus': '=?formFieldModelAutoFocus'\n      },\n      restrict: 'A',\n      require: {\n        'ngModel': 'ngModel',\n        'formField': '^?formField',\n      },\n      bindToController: true,\n      controller: FormFieldModel\n    };\n  });\n\n})(ANGULAR_MODULE, angular);\n\n/* global ANGULAR_MODULE, angular */\n(function(module, angular) {\n  'use strict';\n\n  // --------------------------------------------------\n  // RandomNumber\n  // --------------------------------------------------\n\n  //\n  // CONTROLLER\n  //\n\n  /**\n   * @constructor\n   */\n  var RandomNumber = function($scope, $attrs, $element, $injector) {\n    this.$scope = $scope;\n    this.$attrs = $attrs;\n    this.$element = $element;\n    this.$injector = $injector;\n\n    this._timer = null;\n    this._shuffle = this._shuffle.bind(this);\n  };\n\n  RandomNumber.$inject = ['$scope', '$attrs', '$element', '$injector'];\n\n  //\n  // PROPERTIES\n  //\n\n  /** @var {array} collection Array of random items. */\n  RandomNumber.prototype.numbers = [];\n\n  /** @var {boolean} shuffle Flag to kick off shuffling. */\n  RandomNumber.prototype.shuffle = true;\n\n  /** @var {boolean} finished Flag truthy after iteration. */\n  RandomNumber.prototype.finished = false;\n\n  /** @var {string} value Current display value of component. */\n  RandomNumber.prototype.value = '?';\n\n  //\n  // METHODS\n  //\n\n  /**\n   * Registers watch for `shuffle` flag.\n   *\n   * @public\n   * @method $onInit\n   * @return {Void}\n   */\n  RandomNumber.prototype.$onInit = function()\n    {\n      var me = this;\n\n      this._unwatch = this.$scope.$watch(\n        function(){ return me.shuffle; },\n        function(shuffle) {\n          if (shuffle) {\n            me.finished = false;\n            me._shuffle(0);\n            return;\n          }\n\n          me._stop();\n        }\n      );\n    };\n\n  /**\n   * Cleans up everything on destruction.\n   *\n   * @public\n   * @method $onDestroy\n   * @return {Void}\n   */\n  RandomNumber.prototype.$onDestroy = function()\n    {\n      this._unwatch();\n      this._stop();\n    };\n\n  /**\n   * Shows next display value from shuffled values.\n   *\n   * @private\n   * @method _shuffle\n   * @param {number} index\n   * @return {Void}\n   */\n  RandomNumber.prototype._shuffle = function(index) {\n    var $timeout = this.$injector.get('$timeout');\n    var maximum = this.numbers.length - 1;\n\n    this.value = this.numbers[index];\n\n    if (index >= maximum) {\n      this.finished = true;\n      this._stop();\n      return;\n    }\n\n    this._timer = $timeout(this._shuffle, 100, true, ++index);\n  };\n\n  /**\n   * Cancels timers and resets shuffle flag.\n   *\n   * @private\n   * @method _stop\n   * @return {Void}\n   */\n  RandomNumber.prototype._stop = function() {\n    var $timeout = this.$injector.get('$timeout');\n\n    $timeout.cancel(this._timer);\n    this.shuffle = false;\n    this._timer = null;\n  };\n\n  //\n  // REGISTRY\n  //\n  angular.module(module).directive('randomNumber', function(){\n    return {\n      scope: {\n        numbers: '=randomNumber',\n        shuffle: '=?randomNumberShuffle',\n        finished: '=?randomNumberFinished'\n      },\n      restrict: 'A',\n      transclude: true,\n      bindToController: true,\n      controller: RandomNumber,\n      controllerAs: 'randomNumberController',\n      templateUrl: 'views/directives/random-number.html'\n    };\n  });\n\n})(ANGULAR_MODULE, angular);\n\n/* global ANGULAR_MODULE, angular */\n(function(module, angular) {\n  'use strict';\n\n  // --------------------------------------------------\n  // Asynchronous Validators\n  // --------------------------------------------------\n\n  //\n  // CONTROLLER\n  //\n\n  /**\n   * @constructor\n   */\n  var ValidatorWorkshopExists = function($scope, $element, $attrs, $q, Workshop)\n    {\n      this.$q = $q;\n      this.$scope = $scope;\n      this.$attrs = $attrs;\n      this.$element = $element;\n\n      this.Workshop = Workshop;\n\n      this.keyLocked = 'validatorWorkshopLocked';\n    };\n\n  ValidatorWorkshopExists.$inject = ['$scope', '$element', '$attrs', '$q', 'Workshop'];\n\n  //\n  // METHODS\n  //\n\n  /**\n   * Applies `validatorWorkshopExists` to $asyncValidators.\n   *\n   * @public\n   * @method $onInit\n   * @return {Void}\n   */\n  ValidatorWorkshopExists.prototype.$onInit = function()\n    {\n      this.ngModel.$asyncValidators.validatorWorkshopExists = this.validate.bind(this);\n    };\n\n  /**\n   * Queries server to see if the workshop exists. It sets implicitly `validatorWorkshopLocked`\n   * to avoid multiple server queries and sets to invalid if `isActive` is not true (= locked).\n   *\n   * @public\n   * @method validate\n   * @return {Void}\n   */\n  ValidatorWorkshopExists.prototype.validate = function(modelValue/*, newValue*/)\n    {\n      var defer = this.$q.defer();\n\n      var me = this;\n      var successCallback = function(workshop)\n      {\n        if (!workshop.isActive) {\n          me.ngModel.$setValidity(me.keyLocked, false);\n          defer.reject();\n          return;\n        }\n\n        me.ngModel.$setValidity(me.keyLocked, true);\n        defer.resolve();\n      };\n\n      var failureCallback = function()\n      {\n        defer.reject();\n      };\n\n      this.Workshop.validateWorkshopFrontend(\n        {\n          code: modelValue\n        },\n        successCallback,\n        failureCallback\n      );\n\n      return defer.promise;\n    };\n\n  //\n  // REGISTRY\n  //\n  angular.module(ANGULAR_MODULE).directive('validatorWorkshopExists',function() {\n      return {\n        restrict: 'A',\n        require: {\n          ngModel: 'ngModel'\n        },\n        bindToController: true,\n        controller: ValidatorWorkshopExists\n      };\n  });\n\n  //\n  // CONTROLLER\n  //\n\n  /**\n   * @constructor\n   */\n  var ValidatorWorkshopUnique = function($scope, $element, $attrs, $q, Workshop)\n    {\n      this.$q = $q;\n      this.$scope = $scope;\n      this.$attrs = $attrs;\n      this.$element = $element;\n\n      this.Workshop = Workshop;\n    };\n\n  ValidatorWorkshopUnique.$inject = ['$scope', '$element', '$attrs', '$q', 'Workshop'];\n\n  //\n  // METHODS\n  //\n\n  /**\n   * Applies `validatorWorkshopUnique` to $asyncValidators.\n   *\n   * @public\n   * @method $onInit\n   * @return {Void}\n   */\n  ValidatorWorkshopUnique.prototype.$onInit = function()\n    {\n      this.ngModel.$asyncValidators.validatorWorkshopUnique = this.validate.bind(this);\n    };\n\n  /**\n   * Queries server to see if the workshop exists.\n   *\n   * @public\n   * @method validate\n   * @return {Void}\n   */\n  ValidatorWorkshopUnique.prototype.validate = function(modelValue/*, newValue*/)\n    {\n      var defer = this.$q.defer();\n\n      var successCallback = function()\n      {\n        defer.reject();\n      };\n\n      var failureCallback = function()\n      {\n        defer.resolve();\n      };\n\n      this.Workshop.validateWorkshopBackend(\n        {\n          code: modelValue\n        },\n        successCallback,\n        failureCallback\n      );\n\n      return defer.promise;\n    };\n\n  //\n  // REGISTRY\n  //\n  angular.module(ANGULAR_MODULE).directive('validatorWorkshopUnique',function() {\n      return {\n        restrict: 'A',\n        require: {\n          ngModel: 'ngModel'\n        },\n        bindToController: true,\n        controller: ValidatorWorkshopUnique\n      };\n  });\n\n  //\n  // CONTROLLER\n  //\n\n  /**\n   * @constructor\n   */\n  var ValidatorAdminUnique = function($scope, $element, $attrs, $q, Admin)\n    {\n      this.$q = $q;\n      this.$scope = $scope;\n      this.$attrs = $attrs;\n      this.$element = $element;\n\n      this.Admin = Admin;\n    };\n\n  ValidatorAdminUnique.$inject = ['$scope', '$element', '$attrs', '$q', 'Admin'];\n\n  //\n  // METHODS\n  //\n\n  /**\n   * Applies `validatorAdminUnique` to $asyncValidators.\n   *\n   * @public\n   * @method $onInit\n   * @return {Void}\n   */\n  ValidatorAdminUnique.prototype.$onInit = function()\n    {\n      this.ngModel.$asyncValidators.validatorAdminUnique = this.validate.bind(this);\n    };\n\n  /**\n   * Queries server to see if the admin exists.\n   *\n   * @public\n   * @method validate\n   * @return {Void}\n   */\n  ValidatorAdminUnique.prototype.validate = function(modelValue/*, newValue*/)\n    {\n      var defer = this.$q.defer();\n\n      var successCallback = function()\n      {\n        defer.reject();\n      };\n\n      var failureCallback = function()\n      {\n        defer.resolve();\n      };\n\n      this.Admin.validateAdmin(\n        {\n          username: modelValue\n        },\n        successCallback,\n        failureCallback\n      );\n\n      return defer.promise;\n    };\n\n  //\n  // REGISTRY\n  //\n  angular.module(ANGULAR_MODULE).directive('validatorAdminUnique',function() {\n      return {\n        restrict: 'A',\n        require: {\n          ngModel: 'ngModel'\n        },\n        bindToController: true,\n        controller: ValidatorAdminUnique\n      };\n  });\n\n})(ANGULAR_MODULE, angular);\n\n/* global ANGULAR_MODULE, angular */\n(function(module, angular) {\n  'use strict';\n\n  // --------------------------------------------------\n  // InterestTask\n  // --------------------------------------------------\n\n  //\n  // CONTROLLER\n  //\n\n  /**\n   * @constructor\n   */\n  var InterestTask = function($scope, $element, $attrs, $injector) {\n    var type = $injector.get('TYPE_INTEREST');\n\n    this.$scope = $scope;\n    this.$attrs = $attrs;\n    this.$element = $element;\n    this.$injector = $injector;\n\n    this.domId = 'interest-task-' + $scope.$id;\n\n    this.user = this.$injector.get('user');\n    this.task = this.user.getTaskByType(type);\n    this.result = this.user.getPendingByType(type);\n  };\n\n  InterestTask.$inject = ['$scope', '$element', '$attrs', '$injector'];\n\n  //\n  // PROPERTIES\n  //\n\n  // SERVER\n\n  /** @var {object} user Alias to user service. */\n  InterestTask.prototype.user = null;\n\n  /** @var {object} task Task's resource from server. */\n  InterestTask.prototype.task = null;\n\n  /** @var {object} result Task's pending result from server. */\n  InterestTask.prototype.result = null;\n\n  // GAMEPLAY\n\n  /** @var {boolean} resolved If player has resolved the game. */\n  InterestTask.prototype.resolved = false;\n\n  /** @var {number} currentExercise Count of correct answers. */\n  InterestTask.prototype.currentExercise = 1;\n\n  /** @var {number} correctAnswers Count of correct answers. */\n  InterestTask.prototype.correctAnswers = null;\n\n  /** @var {number} exercise1Answer Answer for first exercise. */\n  InterestTask.prototype.exercise1Answer = null;\n\n  /** @var {number} exercise2Answer Answer for second exercise. */\n  InterestTask.prototype.exercise2Answer = null;\n\n  /** @var {boolean} exercise1Correct Resolution state of first exercise. */\n  InterestTask.prototype.exercise1Correct = false;\n\n  /** @var {boolean} exercise2Correct Resolution state of second exercise. */\n  InterestTask.prototype.exercise2Correct = false;\n\n  /** @var {number} exercise1Result Correct result for first exercise. */\n  InterestTask.prototype.exercise1Result = null;\n\n  /** @var {number} exercise2Result Correct result for second exercise. */\n  InterestTask.prototype.exercise2Result = null;\n\n  // SETTINGS\n\n  /** @var {number} amount Amount of money. */\n  InterestTask.prototype.amount = 1000;\n\n  /** @var {number} rate Interest rate. */\n  InterestTask.prototype.rate = 0.01;\n\n  /** @var {number} years Number of years. */\n  InterestTask.prototype.years = 1;\n\n  // MISC\n\n  /** @var {string} domId Unique dom id for this task for scrolling purposes. */\n  InterestTask.prototype.domId = null;\n\n  //\n  // METHODS\n  //\n\n  /**\n   * Proxies to `init()` if controller's ready.\n   *\n   * @public\n   * @method $onInit\n   * @return {Void}\n   */\n  InterestTask.prototype.$onInit = function() {\n    this.init();\n  };\n\n  /**\n   * Retrieves result payload for server.\n   *\n   * @public\n   * @method getPayload\n   * @return {Void}\n   */\n  InterestTask.prototype.getPayload = function() {\n    var payload = {\n      task: this.task,\n      json: {\n        exercise1: {\n          currentResult: this.exercise1Result,\n          actualResult: this.exercise1Answer,\n          isValid: this.exercise1Correct\n        },\n        exercise2: {\n          currentResult: this.exercise2Result,\n          actualResult: this.exercise2Answer,\n          isValid: this.exercise2Correct\n        },\n        currentExercise: this.currentExercise+1\n      },\n      isPending: this._isPending()\n    };\n\n    if (this.result !== null) {\n      payload = angular.extend(\n        this.result,\n        payload\n      );\n    }\n\n    return payload;\n  };\n\n  /**\n   * Whether or not task is currently locked.\n   *\n   * @public\n   * @method isLocked\n   * @return {boolean}\n   */\n  InterestTask.prototype.isLocked = function() {\n    if (this.task === null) {\n      return false;\n    }\n\n    return !this.task.isActive;\n  };\n\n  /**\n   * Whether or not task can be sent to server.\n   *\n   * @public\n   * @method canResolve\n   * @return {boolean}\n   */\n  InterestTask.prototype.canResolve = function() {\n    var user = this.$injector.get('user');\n    if (!user.isUser()) {\n      return false;\n    }\n\n    if (this.isLocked()) {\n      return false;\n    }\n\n    if (this.resolved) {\n      return false;\n    }\n\n    if (this.currentExercise === 1) {\n      if (!this.exercise1Answer) {\n        return false;\n      }\n    }\n\n    if (this.currentExercise === 2) {\n      if (!this.exercise2Answer) {\n        return false;\n      }\n    }\n\n    return true;\n  };\n\n  /**\n   * Sets up initial state.\n   *\n   * @public\n   * @method init\n   * @return {Void}\n   */\n  InterestTask.prototype.init = function() {\n    if (this.result !== null) {\n      var json = this.result.json;\n\n      // `exercise2Answer` cannot be desisted cause it's the\n      // condition in last step before setting `isPending`\n      this.exercise1Answer = json.exercise1.actualResult;\n      this.currentExercise = json.currentExercise;\n    }\n\n    this.resolved = false;\n    this.exercise1Result = this._calculateResult(1);\n    this.exercise2Result = this._calculateResult(1 + this.years);\n\n    this._setCorrectAnswers();\n  };\n\n  /**\n   * Resets initial state.\n   *\n   * @public\n   * @method reset\n   * @return {Void}\n   */\n  InterestTask.prototype.reset = function(){\n    this.init();\n  };\n\n  /**\n   * Updates answers, state and counters\n   * for given exercise for evaluation.\n   *\n   * @public\n   * @method update\n   * @param {number} value\n   * @param {string} exercise\n   * @return {Void}\n   */\n  InterestTask.prototype.update = function(){\n    var me = this;\n    var successCallback = function(){\n      // updated after resolve cause\n      // we need current exercise in\n      // `canResolve()` for checking\n      me.currentExercise++;\n    };\n    var failureCallback = function(){};\n\n    this.resolve().then(\n      successCallback,\n      failureCallback\n    );\n  };\n\n  /**\n   * Sets `resolved` flag. Calls `onResolve`\n   * callback with JSON result for consumer.\n   *\n   * @public\n   * @method resolve\n   * @return {Void}\n   */\n  InterestTask.prototype.resolve = function(){\n    var $q = this.$injector.get('$q');\n\n    if (!this.canResolve()) {\n      var defer = $q.defer();\n      defer.reject();\n\n      return defer.promise;\n    }\n\n    var callback = this.result === null ?\n      this.onResolve :\n      this.onUpdate;\n\n    var payload = this.getPayload();\n    var result = callback({\n      payload: payload\n    });\n\n    var me = this;\n    var successCallback = function(result) {\n      if (result.isPending) {\n\n        me.result = result;\n        return;\n      }\n\n      me.resolved = true;\n    };\n    var failureCallback = function() {\n\n    };\n\n    var promise = $q.when(result);\n    promise.then(\n      successCallback,\n      failureCallback\n    );\n\n    return promise;\n  };\n\n  /**\n   * Updates answers for given exercise with sum.\n   *\n   * @public\n   * @method setResult\n   * @param {number} value\n   * @param {string} exercise\n   * @return {boolean}\n   */\n  InterestTask.prototype.setResult = function(value, exercise){\n    switch(exercise) {\n      case 'exercise1':\n        this.exercise1Answer = value || null;\n        break;\n      case 'exercise2':\n        this.exercise2Answer = value || null;\n        break;\n      default:\n    }\n\n    this._setCorrectAnswers();\n  };\n\n  /**\n   * Checks if `exercise2Answer` is already set.\n   *\n   * @private\n   * @method _isPending\n   * @return {boolean}\n   */\n  InterestTask.prototype._isPending = function(){\n    return this.exercise2Answer === null;\n  };\n\n  /**\n   * Updates the poroperty belonging to correctness.\n   *\n   * @private\n   * @method _setCorrectAnswers\n   * @return {void}\n   */\n  InterestTask.prototype._setCorrectAnswers = function() {\n    this.exercise1Correct = this.exercise1Answer === this.exercise1Result;\n    this.exercise2Correct = this.exercise2Answer === this.exercise2Result;\n\n    if (this.exercise1Correct && this.exercise2Correct) {\n      this.correctAnswers = 2;\n    } else if (this.exercise1Correct) {\n      this.correctAnswers = 1;\n    } else if (this.exercise2Correct) {\n      this.correctAnswers = 1;\n    } else {\n      this.correctAnswers = 0;\n    }\n  };\n\n  /**\n   * Calculates result for given years.\n   *\n   * @private\n   * @method _calculateResult\n   * @param {number} years\n   * @return {number}\n   */\n  InterestTask.prototype._calculateResult = function(years) {\n    return this.amount * Math.pow(1 + this.rate, years || 1);\n  };\n\n  //\n  // REGISTRY\n  //\n  angular.module(module).directive('interestTask', function(){\n    return {\n      scope: {\n        rate: '=?interestTaskRate',\n        years: '=?interestTaskYears',\n        amount: '=?interestTaskAmount',\n        onUpdate: '&interestTaskOnUpdate',\n        onResolve: '&interestTaskOnResolve'\n      },\n      restrict: 'A',\n      transclude: true,\n      bindToController: true,\n      controller: InterestTask,\n      controllerAs: 'interestTaskController',\n      templateUrl: 'views/directives/tasks/interest-task.html'\n    };\n  });\n\n  // --------------------------------------------------\n  // InterestTask Exercise\n  // --------------------------------------------------\n\n  //\n  // CONTROLLER\n  //\n\n  /**\n   * @constructor\n   */\n  var InterestTaskExercise = function($scope,$element,$attrs) {\n    this.$element = $element;\n    this.$scope = $scope;\n    this.$attrs = $attrs;\n\n    this.disabled = false;\n    this.stack = [];\n    this.sum = 0;\n\n    var me = this;\n    this._unwatch = $scope.$watch(\n      function(){ return me.sum; },\n      function(sum) {\n        if (!sum) {\n          me.sum = 0;\n          me.stack = [];\n        }\n      }\n    );\n  };\n\n  InterestTaskExercise.$inject = ['$scope','$element','$attrs'];\n\n  //\n  // PROPERTIES\n  //\n\n  /** @var {boolean} disabled If exercise is currently disabled. */\n  InterestTaskExercise.prototype.disabled = false;\n\n  /** @var {array} stack Stack collection all notes and coins. */\n  InterestTaskExercise.prototype.stack = [];\n\n  /** @var {number} sum Total sum of all values from `stack`. */\n  InterestTaskExercise.prototype.sum = 0;\n\n  /** @var {array} notes All selectable notes for exercise. */\n  InterestTaskExercise.prototype.notes = [500,200,100,50,20,10,5];\n\n  /** @var {array} notes All selectable coins for exercise. */\n  InterestTaskExercise.prototype.coins = [2,1,0.5,0.2,0.1,0.05,0.02,0.01];\n\n  //\n  // METHODS\n  //\n\n  /**\n   * Removes event listener and watches.\n   *\n   * @public\n   * @method $onDestroy\n   * @return {void}\n   */\n  InterestTaskExercise.prototype.$onDestroy = function() {\n    this._unwatch();\n  };\n\n  /**\n   * Adds value to `stack`, increases `sum`\n   * and invokes the `onUpdate` callback.\n   *\n   * @public\n   * @method onDrop\n   * @return {Void}\n   */\n  InterestTaskExercise.prototype.onDrop = function(value){\n    this.stack.push(value);\n    this.sum += value;\n\n    this.onUpdate({\n      sum: this.sum\n    });\n  };\n\n  /**\n   * Removes last item from `stack`, decreases\n   * `sum` and invokes the `onUpdate` callback.\n   *\n   * @public\n   * @method revert\n   * @return {Void}\n   */\n  InterestTaskExercise.prototype.revert = function() {\n    this.sum -= this.stack.pop();\n\n    this.onUpdate({\n      sum: this.sum\n    });\n  };\n\n  //\n  // REGISTRY\n  //\n  angular.module(module).directive('interestTaskExercise', function(){\n    return {\n      scope: {\n        sum: '=?interestTaskExerciseSum',\n        onUpdate: '&interestTaskExerciseOnUpdate',\n        disabled: '=?interestTaskExerciseDisabled'\n      },\n      restrict: 'A',\n      transclude: true,\n      bindToController: true,\n      controller: InterestTaskExercise,\n      controllerAs: 'interestTaskExerciseController',\n      templateUrl: 'views/directives/tasks/interest-task-exercise.html'\n    };\n  });\n\n})(ANGULAR_MODULE, angular);\n\n/* global ANGULAR_MODULE, angular */\n(function(module, angular) {\n  'use strict';\n\n  // --------------------------------------------------\n  // DiversificationTask\n  // --------------------------------------------------\n\n  //\n  // CONTROLLER\n  //\n\n  /**\n   * @constructor\n   */\n  var DiversificationTask = function($scope, $elemnt, $attrs, $injector) {\n    var type = $injector.get('TYPE_DIVERSIFICATION');\n    var user = $injector.get('user');\n\n    this.$injector = $injector;\n    this.task = user.getTaskByType(type);\n  };\n\n  DiversificationTask.$inject = ['$scope','$element','$attrs', '$injector'];\n\n  // SERVER\n\n  /** @var {object} task Task's resource from server. */\n  DiversificationTask.prototype.task = null;\n\n  // GAMEPLAY\n\n  /** @var {boolean} resolved If player has resolved the game. */\n  DiversificationTask.prototype.resolved = false;\n\n  /** @var {string} heads Current class of heads side. */\n  DiversificationTask.prototype.heads = 'K';\n\n  /** @var {string} tails Current class of tails side. */\n  DiversificationTask.prototype.tails = 'Z';\n\n  /** @var {array} companies Data for companies. */\n  DiversificationTask.prototype.companies = {};\n\n  /** @var {array} tickets Data for tickets. */\n  DiversificationTask.prototype.tickets = {};\n\n  /** @var {array} sides Two values for coin. */\n  DiversificationTask.prototype.sides = [];\n\n  //\n  // METHODS\n  //\n\n  /**\n   * Proxies to `init()` if controller's ready.\n   *\n   * @public\n   * @method $onInit\n   * @return {void}\n   */\n  DiversificationTask.prototype.$onInit = function() {\n    this.init();\n  };\n\n  /**\n   * Retrieves result payload for server.\n   *\n   * @public\n   * @method getPayload\n   * @return {void}\n   */\n  DiversificationTask.prototype.getPayload = function() {\n    return {\n      task: this.task,\n      json: {\n        tickets: {\n          one: this.tickets.one.company,\n          two: this.tickets.two.company\n        },\n        throws: {\n          one: this.throws.one.toss,\n          two: this.throws.two.toss\n        }\n      },\n      ticketCount: this.getTicketCount()\n    };\n  };\n\n  /**\n   * Whether or not task is currently locked.\n   *\n   * @public\n   * @method isLocked\n   * @return {boolean}\n   */\n  DiversificationTask.prototype.isLocked = function() {\n    if (this.task === null) {\n      return false;\n    }\n\n    return !this.task.isActive;\n  };\n\n  /**\n   * Whether or not task can be sent to server.\n   *\n   * @public\n   * @method canResolve\n   * @return {boolean}\n   */\n  DiversificationTask.prototype.canResolve = function() {\n    var user = this.$injector.get('user');\n    if (!user.isUser()) {\n      return false;\n    }\n\n    if (this.isLocked()) {\n      return false;\n    }\n\n    if (this.resolved) {\n      return false;\n    }\n\n    if (!this.tickets.one.company) {\n      return false;\n    }\n\n    if (!this.tickets.two.company) {\n      return false;\n    }\n\n    return true;\n  };\n\n  /**\n   * Sets up initial state.\n   *\n   * @public\n   * @method init\n   * @return {void}\n   */\n  DiversificationTask.prototype.init = function() {\n    var random = this.$injector.get('random');\n\n    this.sides = [\n      this.heads,\n      this.tails\n    ];\n\n    this.throws = {\n      one: {\n        id: 1,\n        toss: random.pick(this.sides)\n      },\n      two: {\n        id: 2,\n        toss: random.pick(this.sides)\n      }\n    };\n\n    this.tickets = {\n      one: {\n        id: 1,\n        company: null\n      },\n      two: {\n        id: 2,\n        company: null\n      }\n    };\n\n    this.companies = {\n      one: {\n        id: 1,\n        count: 0,\n        tickets: {},\n        name: 'Smart',\n        image: 'company-a.svg'\n      },\n      two: {\n        id: 2,\n        count: 0,\n        tickets: {},\n        name: 'Phone',\n        image: 'company-b.svg'\n      }\n    };\n\n    this.resolved = false;\n  };\n\n  /**\n   * Resets initial state.\n   *\n   * @public\n   * @method reset\n   * @return {void}\n   */\n  DiversificationTask.prototype.reset = function(){\n    this.init();\n  };\n\n  /**\n   * Adds or removes a ticket from given company.\n   *\n   * @public\n   * @method update\n   * @param ticket\n   * @param company\n   * @param action\n   * @return {void}\n   */\n  DiversificationTask.prototype.update = function(ticket, company, action){\n    switch (action) {\n      case 'add':\n        if (!company.tickets[ticket.id]) {\n          company.tickets[ticket.id] = ticket;\n          ticket.company = company.name;\n          company.count++;\n        }\n        break;\n      case 'remove':\n        if (company.tickets[ticket.id]) {\n          delete company.tickets[ticket.id];\n          ticket.company = null;\n          company.count--;\n        }\n        break;\n      default:\n    }\n  };\n\n  /**\n   * Sets `resolved` flag. Calls `onResolve`\n   * callback with JSON result for consumer.\n   *\n   * @public\n   * @method resolve\n   * @return {void}\n   */\n  DiversificationTask.prototype.resolve = function(){\n    var $q = this.$injector.get('$q');\n\n    if (!this.canResolve()) {\n      var defer = $q.defer();\n      defer.reject();\n\n      return defer.promise;\n    }\n\n    var result = this.onResolve({\n      payload: this.getPayload()\n    });\n\n    var me = this;\n    var successCallback = function() {\n      me.resolved = true;\n    };\n    var failureCallback = function() {\n\n    };\n\n    var promise = $q.when(result);\n    promise.then(\n      successCallback,\n      failureCallback\n    );\n\n    return promise;\n  };\n\n  /**\n   * Calculates total ticket amount by predefined formula.\n   *\n   * @public\n   * @method getTotalTickets\n   * @return {number}\n   */\n  DiversificationTask.prototype.getTicketCount = function(){\n    var factorA = this.throws.one.toss === this.heads ? 2 : 1;\n    var factorB = this.throws.two.toss === this.heads ? 2 : 1;\n\n    var ticketsA = this.companies.one.count * factorA;\n    var ticketsB = this.companies.two.count * factorB;\n\n    return ticketsA + ticketsB;\n  };\n\n  //\n  // REGISTRY\n  //\n  angular.module(module).directive('diversificationTask', function(){\n    return {\n      scope: {\n        onResolve: '&diversificationTaskOnResolve'\n      },\n      restrict: 'A',\n      transclude: true,\n      bindToController: true,\n      controller: DiversificationTask,\n      controllerAs: 'diversificationTaskController',\n      templateUrl: 'views/directives/tasks/diversification-task.html'\n    };\n  });\n\n  // --------------------------------------------------\n  // DiversificationTask Coin\n  // --------------------------------------------------\n\n  //\n  // CONTROLLER\n  //\n\n  /**\n   * @constructor\n   */\n  var DiversificationTaskCoin = function($scope,$element,$attrs,$injector) {\n    this.$scope = $scope;\n    this.$attrs = $attrs;\n    this.$element = $element;\n    this.$injector = $injector;\n\n    this._element = this.$element.find('.coin');\n  };\n\n  DiversificationTaskCoin.$inject = ['$scope','$element','$attrs','$injector'];\n\n  //\n  // PROPERTIES\n  //\n\n  /** @var {string} toss One of `heads` or `tails`. */\n  DiversificationTaskCoin.prototype.toss = null;\n\n  /** @var {string} heads Current class of heads side. */\n  DiversificationTaskCoin.prototype.sides = [];\n\n  /** @var {string} heads Current class of heads side. */\n  DiversificationTaskCoin.prototype.heads = 'K';\n\n  /** @var {string} tails Current class of tails side. */\n  DiversificationTaskCoin.prototype.tails = 'Z';\n\n  /** @var {boolean} flip Flag to invoke a new toss. */\n  DiversificationTaskCoin.prototype.flip = false;\n\n  /** @var {boolean} flip Flag to apply CSS classes. */\n  DiversificationTaskCoin.prototype.animate = false;\n\n  /** @var {string} backClass CSS class for back side. */\n  DiversificationTaskCoin.prototype.back = 'back';\n\n  /** @var {string} frontClass CSS class for front side. */\n  DiversificationTaskCoin.prototype.front = 'front';\n\n  /** @var {string} startSide Initially displayed side of coin. */\n  DiversificationTaskCoin.prototype.startSide = 'K';\n\n  /** @var {string} startValue Initially displayed side of coin. */\n  DiversificationTaskCoin.prototype.startValue = null;\n\n  //\n  // METHODS\n  //\n\n  /**\n   * Sets up\n   *\n   * @public\n   * @method $onDestroy\n   * @return {void}\n   */\n  DiversificationTaskCoin.prototype.$onInit = function() {\n    var animation = this.$injector.get('animation');\n    var $timeout = this.$injector.get('$timeout');\n\n    var me = this;\n\n    this.sides = [\n      {\n        value: this.heads,\n        class: this.front,\n        text: this.heads,\n      },\n      {\n        value: this.tails,\n        class: this.back,\n        text: this.tails\n      }\n    ];\n\n    if (this.startSide !== this.heads) {\n      this.sides[0].class = this.back;\n      this.sides[1].class = this.front;\n    }\n\n    if (this.startValue !== null) {\n      this.sides[0].text = this.startValue;\n      this.sides[1].text = this.startValue;\n    }\n\n    me._toss = me._getToss();\n\n    var _timeoutCallback = function() {\n      var _iterateSides = function(side) {\n        if (side.value === me._toss.value) {\n          side.class = me.front;\n          return;\n        }\n\n        side.class = me.back;\n      };\n\n      angular.forEach(me.sides, _iterateSides);\n    };\n\n    var _watchFlipCallback = function(newFlip/*,oldFlip*/) {\n      if (newFlip) {\n        me.onStart({toss: me._toss.value});\n        $timeout(_timeoutCallback, 100);\n        me.sides[0].text = me.heads;\n        me.sides[1].text = me.tails;\n        me.animate = true;\n      }\n    };\n\n    var _watchFlipExpression = function() {\n      return me.flip;\n    };\n\n    var _watchTossCallback = function(newToss, oldToss) {\n      if (newToss !== oldToss) {\n        me._toss = me._getToss();\n      }\n    };\n\n    var _watchTossExpression = function() {\n      return me.toss;\n    };\n\n    var _evalAsyncCallback = function() {\n      me.onFinish({toss: me._toss.value});\n      me.animate = false;\n    };\n\n    var _animationEndCallback = function() {\n      me.$scope.$evalAsync(_evalAsyncCallback);\n    };\n\n    this.onInit({toss: me._toss.value});\n\n    if (animation.animationEndEvent) {\n      this._element.on(\n        animation.animationEndEvent,\n        _animationEndCallback\n      );\n    }\n\n    this._unwatchFlip = this.$scope.$watch(_watchFlipExpression, _watchFlipCallback);\n    this._unwatchToss = this.$scope.$watch(_watchTossExpression, _watchTossCallback);\n  };\n\n  /**\n   * Removes event listener and watches.\n   *\n   * @public\n   * @method $onDestroy\n   * @return {void}\n   */\n  DiversificationTaskCoin.prototype.$onDestroy = function() {\n    var animation = this.$injector.get('animation');\n\n    this._element.off(animation.animationEndEvent);\n    this._unwatchToss();\n    this._unwatchFlip();\n  };\n\n  /**\n   * Transforms `toss` to one side either\n   * by random or by given consumer input.\n   *\n   * @private\n   * @method _getToss\n   * @return {void}\n   */\n  DiversificationTaskCoin.prototype._getToss = function() {\n    var $filter = this.$injector.get('$filter');\n    var random = this.$injector.get('random');\n    var picked = random.pick(this.sides);\n\n    if (this.toss === null) {\n      return picked;\n    }\n\n    var filtered = $filter('filter')(\n      this.sides,\n      {\n        value: this.toss\n      }\n    );\n\n    if (filtered.length === 0) {\n      console.warn('Invalid value for `toss` - using random value!');\n      return picked;\n    }\n\n    return filtered[0];\n  };\n\n  //\n  // REGISTRY\n  //\n  angular.module(module).directive('diversificationTaskCoin', function(){\n    return {\n      scope: {\n        toss: '=?diversificationTaskCoinToss',\n        flip: '=?diversificationTaskCoinFlip',\n        onInit: '&diversificationTaskCoinOnInit',\n        onStart: '&diversificationTaskCoinOnStart',\n        onFinish: '&diversificationTaskCoinOnFinish',\n        startSide: '=?diversificationTaskCoinStartSide',\n        startValue: '=?diversificationTaskCoinStartValue'\n      },\n      restrict: 'A',\n      transclude: true,\n      bindToController: true,\n      controller: DiversificationTaskCoin,\n      controllerAs: 'diversificationTaskCoinController',\n      templateUrl: 'views/directives/tasks/diversification-task-coin.html'\n    };\n  });\n\n})(ANGULAR_MODULE, angular);\n\n/* global ANGULAR_MODULE, angular */\n(function(module, angular) {\n  'use strict';\n\n  // --------------------------------------------------\n  // BombTask\n  // --------------------------------------------------\n\n  //\n  // CONTROLLER\n  //\n\n  /**\n   * @constructor\n   */\n  var BombTask = function($scope, $attrs, $element, $injector) {\n    var type = $injector.get('TYPE_RISK');\n    var user = $injector.get('user');\n\n    this.$scope = $scope;\n    this.$attrs = $attrs;\n    this.$element = $element;\n    this.$injector = $injector;\n\n    this.task = user.getTaskByType(type);\n  };\n\n  BombTask.$inject = ['$scope', '$attrs', '$element', '$injector'];\n\n  //\n  // PROPERTIES\n  //\n\n  // SERVER\n\n  /** @var {object} task Task's resource from server. */\n  BombTask.prototype.task = null;\n\n  // GAMEPLAY\n\n  /** @var {boolean} started If the task has started. */\n  BombTask.prototype.started = false;\n\n  /** @var {boolean} stopped If the task has stopped. */\n  BombTask.prototype.stopped = false;\n\n  /** @var {boolean} hasBomb If bomb is in current collection. */\n  BombTask.prototype.hasBomb = false;\n\n  /** @var {boolean} resolved If player has resolved the game. */\n  BombTask.prototype.resolved = false;\n\n  /** @var {number} totalBoxes Total boxes of current game. */\n  BombTask.prototype.totalBoxes = 0;\n\n  /** @var {number} remainingBoxes Remaining boxes of current game. */\n  BombTask.prototype.remainingBoxes = 0;\n\n  /** @var {number} collectedBoxes Collected boxes of current game. */\n  BombTask.prototype.collectedBoxes = 0;\n\n  // SETTINGS\n\n  /** @var {number} avg Average of collected boxes from statistics. */\n  BombTask.prototype.avg = 12;\n\n  /** @var {number} rows Amount of rows for bomb task. */\n  BombTask.prototype.rows = 5;\n\n  /** @var {number} cols Amount of cols for bomb task. */\n  BombTask.prototype.cols = 5;\n\n  /** @var {number} interval Timeout for interval in seconds. */\n  BombTask.prototype.interval = 1;\n\n  /** @var {boolean} random\n   * - If `random` = false, boxes are collected row-wise one-by-one, starting in the top-left corner\n   * - If `random` = true, boxes are collected randomly (Fisher-Yates Algorithm)\n   * Note that this affects game play independently of `dynamic` property\n   */\n  BombTask.prototype.random = false;\n\n  /** @var {boolean} dynamic\n   * - If `dynamic` = true, one box per time interval is collected automatically\n   * - In case of `dynamic` = true, game play is affected by the variables `interval` and `random`\n   * - If `dynamic` = false, subjects collect as many boxes as they want by clicking or entering the respective number\n   * - In case of `dynamic` = false, game play is affected by the variables `random`\n   */\n  BombTask.prototype.dynamic = false;\n\n  //\n  // METHODS\n  //\n\n  /**\n   * Proxies to `init()` if controller's ready.\n   *\n   * @public\n   * @method $onInit\n   * @return {Void}\n   */\n  BombTask.prototype.$onInit = function() {\n    this.init();\n  };\n\n  /**\n   * Retrieves result payload for server.\n   *\n   * @public\n   * @method getPayload\n   * @return {Void}\n   */\n  BombTask.prototype.getPayload = function() {\n    return {\n      task: this.task,\n      json: {\n        hasBomb: this.hasBomb,\n        collectedBoxes: this.collectedBoxes\n      },\n      ticketCount: this.getTicketCount()\n    };\n  };\n\n  /**\n   * Whether or not task is currently locked.\n   *\n   * @public\n   * @method isLocked\n   * @return {boolean}\n   */\n  BombTask.prototype.isLocked = function() {\n    if (this.task === null) {\n      return false;\n    }\n\n    return !this.task.isActive;\n  };\n\n  /**\n   * Whether or not task can be sent to server.\n   *\n   * @public\n   * @method canResolve\n   * @return {boolean}\n   */\n  BombTask.prototype.canResolve = function() {\n    var user = this.$injector.get('user');\n    if (!user.isUser()) {\n      return false;\n    }\n\n    if (this.isLocked()) {\n      return false;\n    }\n\n    if (this.resolved) {\n      return false;\n    }\n\n    if (this.dynamic) {\n      return this.stopped;\n    }\n\n    if (!this.collectedBoxes) {\n      return false;\n    }\n\n    return true;\n  };\n\n  /**\n   * Sets up initial state.\n   *\n   * @public\n   * @method init\n   * @return {Void}\n   */\n  BombTask.prototype.init = function() {\n    this._initMembers();\n    this._initMatrix();\n    this._initBomb();\n\n    if (!this.dynamic) {\n      this.start();\n    }\n  };\n\n  /**\n   * Resets initial state.\n   *\n   * @public\n   * @method reset\n   * @return {Void}\n   */\n  BombTask.prototype.reset = function() {\n    this.init();\n  };\n\n  /**\n   * Sets `started` flag. If `dynamic` is true,\n   * the interval will start to reveal cards.\n   *\n   * @public\n   * @method start\n   * @return {Void}\n   */\n  BombTask.prototype.start = function(index) {\n    if (this.dynamic) {\n      var $interval = this.$injector.get('$interval');\n\n      this._intIndex = index || 0;\n\n      var me = this;\n      var max = this.iterator.length;\n      this._intervalId = $interval(\n        function(){\n\n          var item = me.iterator[me._intIndex];\n          me.update(item,true);\n\n          me._intIndex++;\n          if (me._intIndex===max) {\n            me.stop();\n          }\n\n        },\n        this.interval*1000, // = from seconds\n        max - this._intIndex // = max iterations\n      );\n    }\n\n    this.started = true;\n  };\n\n  /**\n   * Sets `stopped` flag. If `dynamic` is true,\n   * the interval will be stopped in addition.\n   *\n   * @public\n   * @method start\n   * @return {Void}\n   */\n  BombTask.prototype.stop = function() {\n    if (this.dynamic && this._intervalId) {\n      var $interval = this.$injector.get('$interval');\n      $interval.cancel(this._intervalId);\n    }\n\n    this.stopped = true;\n  };\n\n  /**\n   * Sets `resolved` flag. Calls `onResolve`\n   * callback with JSON result for consumer.\n   *\n   * @public\n   * @method resolve\n   * @return {Void}\n   */\n  BombTask.prototype.resolve = function() {\n    var $q = this.$injector.get('$q');\n\n    if (!this.canResolve()) {\n      var defer = $q.defer();\n      defer.reject();\n\n      return defer.promise;\n    }\n\n    var result = this.onResolve({\n      payload: this.getPayload()\n    });\n\n    var resolveCard = function(card) {\n      card.$$resolved = true;\n    };\n\n    var me = this;\n    var successCallback = function() {\n      angular.forEach(me.collection, resolveCard);\n      me.resolved = true;\n    };\n    var failureCallback = function() {\n\n    };\n\n    var promise = $q.when(result);\n    promise.then(\n      successCallback,\n      failureCallback\n    );\n\n    return promise;\n  };\n\n  /**\n   * Calculates final ticket amount by predefined formula.\n   *\n   * @public\n   * @method getTicketCount\n   * @return {number}\n   */\n  BombTask.prototype.getTicketCount = function(){\n    if (this.hasBomb) {\n      return 1;\n    }\n\n    return this.collectedBoxes;\n  };\n\n  /**\n   * Callback for card click. Updates all\n   * related properties for final result.\n   *\n   * @public\n   * @method toggle\n   * @param {object} column\n   * @param {boolean} active\n   * @return {Void}\n   */\n  BombTask.prototype.toggle = function(column, active) {\n    var index = this.collection.indexOf(column);\n\n    if (active) {\n      if (index<0) {\n        this.collection.push(column);\n        this.collectedBoxes++;\n      }\n\n      column.$$active = true;\n    } else {\n      if (index>=0) {\n        this.collection.splice(index,1);\n        column.$$active = false;\n        this.collectedBoxes--;\n      }\n    }\n\n    if (this.isBomb(column)) {\n      this.hasBomb = true;\n    }\n\n    var total = this.totalBoxes;\n    var collected = this.collectedBoxes;\n    this.remainingBoxes = total - collected;\n  };\n\n  /**\n   * Provides indiviual tracking id for column.\n   *\n   * @public\n   * @method trackId\n   * @param {object} column\n   * @return {Void}\n   */\n  BombTask.prototype.trackId = function(column) {\n    return column.row + '_' + column.col;\n  };\n\n  /**\n   * Determines if column is actual bomb.\n   *\n   * @public\n   * @method isBomb\n   * @param {object} column\n   * @return {Void}\n   */\n  BombTask.prototype.isBomb = function(column) {\n    return angular.equals(this.bomb,column);\n  };\n\n  /**\n   * Initialzes internal properties.\n   *\n   * @private\n   * @method _initMembers\n   * @return {Void}\n   */\n  BombTask.prototype._initMembers = function() {\n    this.collection = [];\n\n    this.hasBomb = false;\n    this.started = false;\n    this.stopped = false;\n    this.resolved = false;\n\n    this.collectedBoxes = 0;\n    this.remainingBoxes = 0;\n    this.totalBoxes = this.rows * this.cols;\n  };\n\n  /**\n   * Calculates the actual matrix.\n   *\n   * @private\n   * @method _initMatrix\n   * @return {Void}\n   */\n  BombTask.prototype._initMatrix = function() {\n    this.matrix = [];\n    this.iterator = [];\n\n    for (var i=0; i<this.rows; i++) {\n\n      var columns = [];\n      for( var j=0; j<this.cols; j++ ) {\n        var data = {\n          row: i+1,\n          col: j+1\n        };\n\n        columns.push(data);\n\n        if (this.dynamic) {\n          if (!this.random) {\n            this.iterator.push(data);\n          } else {\n            var random = this.$injector.get('random');\n            random.push(this.iterator,data);\n          }\n        }\n      }\n\n      this.matrix.push(columns);\n    }\n  };\n\n  /**\n   * Initializes bomb's actual location.\n   *\n   * @private\n   * @method _initBomb\n   * @return {Void}\n   */\n  BombTask.prototype._initBomb = function() {\n    var random = this.$injector.get('random');\n\n    var row = random.between(0,this.rows-1);\n    var col = random.between(0,this.cols-1);\n\n    this.bomb = this.matrix[row][col];\n  };\n\n  //\n  // REGISTRY\n  //\n  angular.module(module).directive('bombTask',function(){\n    return {\n      scope: {\n        avg: '=?bombTaskAvg',\n        rows: '=?bombTaskRows',\n        cols: '=?bombTaskCols',\n        random: '=?bombTaskRandom',\n        dynamic: '=?bombTaskDynamic',\n        interval: '=?bombTaskInterval',\n        onResolve: '&bombTaskOnResolve'\n      },\n      restrict: 'A',\n      transclude: true,\n      controller: BombTask,\n      bindToController: true,\n      controllerAs: 'bombTaskController',\n      templateUrl: 'views/directives/tasks/bomb-task.html'\n    };\n  });\n\n  // --------------------------------------------------\n  // BombTask Card\n  // --------------------------------------------------\n\n  //\n  // CONTROLLER\n  //\n\n  /**\n   * @constructor\n   */\n  var BombTaskCard = function(){\n  };\n\n  //\n  // PROPERTIES\n  //\n\n  /** @var {string} id Card's accociated model. */\n  BombTaskCard.prototype.model = null;\n\n  /** @var {string} isActive If card is active. */\n  BombTaskCard.prototype.isActive = false;\n\n  /** @var {string} isDisabled If card is disabled. */\n  BombTaskCard.prototype.isDisabled = false;\n\n  /** @var {string} isClickable If card is clickable. */\n  BombTaskCard.prototype.isClickable = true;\n\n  //\n  // METHODS\n  //\n\n  /**\n   * Toggles `isActive` if `isDisabled` and\n   * `isClickable` allow the action. Invokes\n   * `onToggle` callback for consumer.\n   *\n   * @public\n   * @method toggle\n   * @return {Void}\n   */\n  BombTaskCard.prototype.toggle = function() {\n    if (this.isDisabled || !this.isClickable) {\n      return;\n    }\n\n    this.isActive = !this.isActive;\n\n    this.onToggle({\n      model:this.model,\n      state:this.isActive\n    });\n  };\n\n  // registry\n  angular.module(module).directive('bombTaskCard', function(){\n    return {\n      scope: {\n        model:'=bombTaskCard',\n        onToggle:'&bombTaskCardOnToggle',\n        isActive:'=?bombTaskCardIsActive',\n        isDisabled:'=?bombTaskCardIsDisabled',\n        isClickable:'=?bombTaskCardIsClickable'\n      },\n      restrict: 'A',\n      transclude: true,\n      controller: BombTaskCard,\n      bindToController: true,\n      controllerAs: 'bombTaskCardController',\n      templateUrl: 'views/directives/tasks/bomb-task-card.html'\n    };\n  });\n\n})(ANGULAR_MODULE, angular);\n\n/* global ANGULAR_MODULE, angular */\n(function(module, angular) {\n  'use strict';\n\n  // --------------------------------------------------\n  // AnchoringTask\n  // --------------------------------------------------\n\n  //\n  // CONTROLLER\n  //\n\n  /**\n   * @constructor\n   */\n  var AnchoringTask = function($scope, $element, $attrs, $injector) {\n    var type = $injector.get('TYPE_ANCHORING');\n    var user = $injector.get('user');\n\n    this.$scope = $scope;\n    this.$attrs = $attrs;\n    this.$element = $element;\n    this.$injector = $injector;\n\n    this.task = user.getTaskByType(type);\n    this.group = user.getGroupAsString();\n  };\n\n  AnchoringTask.$inject = ['$scope','$element','$attrs', '$injector'];\n\n  //\n  // PROPERTIES\n  //\n\n  // SERVER\n\n  /** @var {object} task Task's resource from server. */\n  AnchoringTask.prototype.task = null;\n\n  // GAMEPLAY\n\n  /** @var {number} choice Currently selected user answer. */\n  AnchoringTask.prototype.choice = null;\n\n  /** @var {string} group Current user's group assignment. */\n  AnchoringTask.prototype.group = false;\n\n  /** @var {boolean} resolved If player has resolved the game. */\n  AnchoringTask.prototype.resolved = false;\n\n  //\n  // METHODS\n  //\n\n  /**\n   * Proxies to `init()` if controller's ready.\n   * Sets up event source for listening to\n   *\n   * @public\n   * @method $onInit\n   * @return {void}\n   */\n  AnchoringTask.prototype.$onInit = function() {\n    this.init();\n  };\n\n  /**\n   * Retrieves result payload for server.\n   *\n   * @public\n   * @method getPayload\n   * @return {object}\n   */\n  AnchoringTask.prototype.getPayload = function() {\n    var user = this.$injector.get('user');\n\n    return {\n      task: this.task,\n      json: {\n        group: user.group,\n        choice: this.choice\n      }\n    };\n  };\n\n  /**\n   * Whether or not task is currently locked.\n   *\n   * @public\n   * @method isLocked\n   * @return {boolean}\n   */\n  AnchoringTask.prototype.isLocked = function() {\n    if (this.task === null) {\n      return false;\n    }\n\n    return !this.task.isActive;\n  };\n\n  /**\n   * Whether or not task can be sent to server.\n   *\n   * @public\n   * @method canResolve\n   * @return {boolean}\n   */\n  AnchoringTask.prototype.canResolve = function() {\n    var user = this.$injector.get('user');\n    if (!user.isUser()) {\n      return false;\n    }\n\n    if (this.isLocked()) {\n      return false;\n    }\n\n    if (this.resolved) {\n      return false;\n    }\n\n    if (!this.choice) {\n      return false;\n    }\n\n    return true;\n  };\n\n  /**\n   * Sets up initial state.\n   *\n   * @public\n   * @method init\n   * @return {void}\n   */\n  AnchoringTask.prototype.init = function() {\n    this.resolved = false;\n  };\n\n  /**\n   * Resets initial state.\n   *\n   * @public\n   * @method reset\n   * @return {void}\n   */\n  AnchoringTask.prototype.reset = function(){\n    this.init();\n  };\n\n  /**\n   * Sets current selection on `choice`.\n   *\n   * @public\n   * @method update\n   * @param {number} choice\n   * @param {number} selected\n   * @return {void}\n   */\n  AnchoringTask.prototype.update = function(choice, selected){\n    this.choice = selected ? choice : null;\n  };\n\n  /**\n   * Sets `resolved` flag. Calls `onResolve`\n   * callback with JSON result for consumer.\n   *\n   * @public\n   * @method resolve\n   * @return {void}\n   */\n  AnchoringTask.prototype.resolve = function(){\n    var $q = this.$injector.get('$q');\n\n    if (!this.canResolve()) {\n      var defer = $q.defer();\n      defer.reject();\n\n      return defer.promise;\n    }\n\n    var result = this.onResolve({\n      payload: this.getPayload()\n    });\n\n    var me = this;\n    var successCallback = function() {\n      me.resolved = true;\n    };\n    var failureCallback = function() {\n\n    };\n\n    var promise = $q.when(result);\n    promise.then(\n      successCallback,\n      failureCallback\n    );\n\n    return promise;\n  };\n\n  //\n  // REGISTRY\n  //\n  angular.module(module).directive('anchoringTask', function(){\n    return {\n      scope: {\n        onResolve: '&anchoringTaskOnResolve'\n      },\n      restrict: 'A',\n      transclude: true,\n      bindToController: true,\n      controller: AnchoringTask,\n      controllerAs: 'anchoringTaskController',\n      templateUrl: 'views/directives/tasks/anchoring-task.html'\n    };\n  });\n\n})(ANGULAR_MODULE, angular);\n\n/* global ANGULAR_MODULE, angular */\n(function(module, angular) {\n  'use strict';\n\n  // --------------------------------------------------\n  // MentalBookkeepingTask\n  // --------------------------------------------------\n\n  //\n  // CONTROLLER\n  //\n\n  /**\n   * @constructor\n   */\n  var MentalBookkeepingTask = function($scope, $element, $attrs, $injector) {\n    var type = $injector.get('TYPE_MENTAL_BOOKKEEPING');\n    var user = $injector.get('user');\n\n    this.$scope = $scope;\n    this.$attrs = $attrs;\n    this.$element = $element;\n    this.$injector = $injector;\n\n    this.task = user.getTaskByType(type);\n    this.group = user.getGroupAsString();\n  };\n\n  MentalBookkeepingTask.$inject = ['$scope','$element','$attrs', '$injector'];\n\n  //\n  // PROPERTIES\n  //\n\n  // SERVER\n\n  /** @var {object} task Task's resource from server. */\n  MentalBookkeepingTask.prototype.task = null;\n\n  // GAMEPLAY\n\n  /** @var {number} choice Currently selected user answer. */\n  MentalBookkeepingTask.prototype.choice = null;\n\n  /** @var {string} group Current user's group assignment. */\n  MentalBookkeepingTask.prototype.group = false;\n\n  /** @var {boolean} resolved If player has resolved the game. */\n  MentalBookkeepingTask.prototype.resolved = false;\n\n  //\n  // METHODS\n  //\n\n  /**\n   * Proxies to `init()` if controller's ready.\n   * Sets up event source for listening to\n   *\n   * @public\n   * @method $onInit\n   * @return {void}\n   */\n  MentalBookkeepingTask.prototype.$onInit = function() {\n    this.init();\n  };\n\n  /**\n   * Retrieves result payload for server.\n   *\n   * @public\n   * @method getPayload\n   * @return {object}\n   */\n  MentalBookkeepingTask.prototype.getPayload = function() {\n    var user = this.$injector.get('user');\n\n    return {\n      task: this.task,\n      json: {\n        group: user.group,\n        choice: this.choice\n      }\n    };\n  };\n\n  /**\n   * Whether or not task is currently locked.\n   *\n   * @public\n   * @method isLocked\n   * @return {boolean}\n   */\n  MentalBookkeepingTask.prototype.isLocked = function() {\n    if (this.task === null) {\n      return false;\n    }\n\n    return !this.task.isActive;\n  };\n\n  /**\n   * Whether or not task can be sent to server.\n   *\n   * @public\n   * @method canResolve\n   * @return {boolean}\n   */\n  MentalBookkeepingTask.prototype.canResolve = function() {\n    var user = this.$injector.get('user');\n    if (!user.isUser()) {\n      return false;\n    }\n\n    if (this.isLocked()) {\n      return false;\n    }\n\n    if (this.resolved) {\n      return false;\n    }\n\n    if (!this.choice) {\n      return false;\n    }\n\n    return true;\n  };\n\n  /**\n   * Sets up initial state.\n   *\n   * @public\n   * @method init\n   * @return {void}\n   */\n  MentalBookkeepingTask.prototype.init = function() {\n    this.resolved = false;\n  };\n\n  /**\n   * Resets initial state.\n   *\n   * @public\n   * @method reset\n   * @return {void}\n   */\n  MentalBookkeepingTask.prototype.reset = function(){\n    this.init();\n  };\n\n  /**\n   * Description.\n   *\n   * @public\n   * @method update\n   * @param {number} choice\n   * @param {number} selected\n   * @return {void}\n   */\n  MentalBookkeepingTask.prototype.update = function(choice, selected){\n    this.choice = selected ? choice : null;\n  };\n\n  /**\n   * Sets `resolved` flag. Calls `onResolve`\n   * callback with JSON result for consumer.\n   *\n   * @public\n   * @method resolve\n   * @return {void}\n   */\n  MentalBookkeepingTask.prototype.resolve = function(){\n    var $q = this.$injector.get('$q');\n\n    if (!this.canResolve()) {\n      var defer = $q.defer();\n      defer.reject();\n\n      return defer.promise;\n    }\n\n    var result = this.onResolve({\n      payload: this.getPayload()\n    });\n\n    var me = this;\n    var successCallback = function() {\n      me.resolved = true;\n    };\n    var failureCallback = function() {\n\n    };\n\n    var promise = $q.when(result);\n    promise.then(\n      successCallback,\n      failureCallback\n    );\n\n    return promise;\n  };\n\n  //\n  // REGISTRY\n  //\n  angular.module(module).directive('mentalBookkeepingTask', function(){\n    return {\n      scope: {\n        onResolve: '&mentalBookkeepingTaskOnResolve'\n      },\n      restrict: 'A',\n      transclude: true,\n      bindToController: true,\n      controller: MentalBookkeepingTask,\n      controllerAs: 'mentalBookkeepingTaskController',\n      templateUrl: 'views/directives/tasks/mental-bookkeeping-task.html'\n    };\n  });\n\n})(ANGULAR_MODULE, angular);\n\n/* global ANGULAR_MODULE, angular */\n(function(module, angular) {\n  'use strict';\n\n  // --------------------------------------------------\n  // FramingTask\n  // --------------------------------------------------\n\n  //\n  // CONTROLLER\n  //\n\n  /**\n   * @constructor\n   */\n  var FramingTask = function($scope, $elemnt, $attrs, $injector) {\n    var type = $injector.get('TYPE_FRAMING');\n    var user = $injector.get('user');\n\n    this.$injector = $injector;\n    this.task = user.getTaskByType(type);\n  };\n\n  FramingTask.$inject = ['$scope','$element','$attrs', '$injector'];\n\n  // SERVER\n\n  /** @var {object} task Task's resource from server. */\n  FramingTask.prototype.task = null;\n\n  // GAMEPLAY\n\n  /** @var {boolean} resolved If player has resolved the game. */\n  FramingTask.prototype.resolved = false;\n\n  /** @var {boolean} lotteryA If player opts in for lottery A. */\n  FramingTask.prototype.lotteryA = null;\n\n  /** @var {boolean} lotteryB If player opts in for lottery A. */\n  FramingTask.prototype.lotteryB = null;\n\n  //\n  // METHODS\n  //\n\n  /**\n   * Proxies to `init()` if controller's ready.\n   *\n   * @public\n   * @method $onInit\n   * @return {void}\n   */\n  FramingTask.prototype.$onInit = function() {\n    this.init();\n  };\n\n  /**\n   * Retrieves result payload for server.\n   *\n   * @public\n   * @method getPayload\n   * @return {void}\n   */\n  FramingTask.prototype.getPayload = function() {\n    return {\n      task: this.task,\n      json: {\n        lotteryA: this.lotteryA,\n        lotteryB: this.lotteryB\n      }\n    };\n  };\n\n  /**\n   * Whether or not task is currently locked.\n   *\n   * @public\n   * @method isLocked\n   * @return {boolean}\n   */\n  FramingTask.prototype.isLocked = function() {\n    if (this.task === null) {\n      return false;\n    }\n\n    return !this.task.isActive;\n  };\n\n  /**\n   * Whether or not task can be sent to server.\n   *\n   * @public\n   * @method canResolve\n   * @return {boolean}\n   */\n  FramingTask.prototype.canResolve = function() {\n    var user = this.$injector.get('user');\n    if (!user.isUser()) {\n      return false;\n    }\n\n    if (this.isLocked()) {\n      return false;\n    }\n\n    if (this.resolved) {\n      return false;\n    }\n\n    if (this.lotteryA === null) {\n      return false;\n    }\n\n    if (this.lotteryB === null) {\n      return false;\n    }\n\n    return true;\n  };\n\n  /**\n   * Sets up initial state.\n   *\n   * @public\n   * @method init\n   * @return {void}\n   */\n  FramingTask.prototype.init = function() {\n    this.lotteryA = null;\n    this.lotteryB = null;\n    this.resolved = false;\n  };\n\n  /**\n   * Resets initial state.\n   *\n   * @public\n   * @method reset\n   * @return {void}\n   */\n  FramingTask.prototype.reset = function(){\n    this.init();\n  };\n\n  /**\n   * Updates provided lottery with given state.\n   *\n   * @public\n   * @method update\n   * @param {string} lottery\n   * @param {boolean} state\n   * @return {void}\n   */\n  FramingTask.prototype.update = function(lottery, state){\n    this[lottery] = state;\n  };\n\n  /**\n   * Sets `resolved` flag. Calls `onResolve`\n   * callback with JSON result for consumer.\n   *\n   * @public\n   * @method resolve\n   * @return {void}\n   */\n  FramingTask.prototype.resolve = function(){\n    var $q = this.$injector.get('$q');\n\n    if (!this.canResolve()) {\n      var defer = $q.defer();\n      defer.reject();\n\n      return defer.promise;\n    }\n\n    var result = this.onResolve({\n      payload: this.getPayload()\n    });\n\n    var me = this;\n    var successCallback = function() {\n      me.resolved = true;\n    };\n    var failureCallback = function() {\n\n    };\n\n    var promise = $q.when(result);\n    promise.then(\n      successCallback,\n      failureCallback\n    );\n\n    return promise;\n  };\n\n  //\n  // REGISTRY\n  //\n  angular.module(module).directive('framingTask', function(){\n    return {\n      scope: {\n        onResolve: '&framingTaskOnResolve'\n      },\n      restrict: 'A',\n      transclude: true,\n      bindToController: true,\n      controller: FramingTask,\n      controllerAs: 'framingTaskController',\n      templateUrl: 'views/directives/tasks/framing-task.html'\n    };\n  });\n\n})(ANGULAR_MODULE, angular);\n\n/* global ANGULAR_MODULE, angular */\n(function(module, angular) {\n  'use strict';\n\n  // --------------------------------------------------\n  // SavingsTargetTask\n  // --------------------------------------------------\n\n  //\n  // CONTROLLER\n  //\n\n  /**\n   * @constructor\n   */\n  var SavingsTargetTask = function($scope, $element, $attrs, $injector) {\n    var type = $injector.get('TYPE_SAVINGS_TARGET');\n\n    this.$attrs = $attrs;\n    this.$scope = $scope;\n    this.$element = $element;\n    this.$injector = $injector;\n\n    this.user = this.$injector.get('user');\n    this.task = this.user.getTaskByType(type);\n    this.result = this.user.getPendingByType(type);\n\n    this._isLocked = null;\n  };\n\n  SavingsTargetTask.$inject = ['$scope','$element','$attrs', '$injector'];\n\n  // SERVER\n\n  /** @var {object} user Alias to user service. */\n  SavingsTargetTask.prototype.user = null;\n\n  /** @var {object} task Task's resource from server. */\n  SavingsTargetTask.prototype.task = null;\n\n  /** @var {object} result Task's pending result from server. */\n  SavingsTargetTask.prototype.result = null;\n\n  // GAMEPLAY\n\n  /** @var {number} step Current step . */\n  SavingsTargetTask.prototype.step = 1;\n\n  /** @var {number} total Players wish for saving target. */\n  SavingsTargetTask.prototype.total = 3;\n\n  /** @var {string} wish Players wish for saving target. */\n  SavingsTargetTask.prototype.wish = null;\n\n  /** @var {number} amount Players first amount for saving target. */\n  SavingsTargetTask.prototype.amount = null;\n\n  /** @var {number} amountRepeated Players second amount for saving target. */\n  SavingsTargetTask.prototype.amountRepeated = null;\n\n  /** @var {boolean} resolved If player has resolved the game. */\n  SavingsTargetTask.prototype.resolved = false;\n\n  // MISC\n\n  /** @var {object} form Form collecting user input. */\n  SavingsTargetTask.prototype.form = null;\n\n  /** @var {number} minAmount Minimum amount for `amount` input. */\n  SavingsTargetTask.prototype.minAmount = 1;\n\n  /** @var {number} maxAmount Maximum amount for `amount` input. */\n  SavingsTargetTask.prototype.maxAmount = 999;\n\n  //\n  // METHODS\n  //\n\n  /**\n   * Proxies to `init()` if controller's ready.\n   *\n   * @public\n   * @method $onInit\n   * @return {void}\n   */\n  SavingsTargetTask.prototype.$onInit = function() {\n    this.init();\n  };\n\n  /**\n   * Retrieves result payload for server.\n   *\n   * @public\n   * @method getPayload\n   * @return {void}\n   */\n  SavingsTargetTask.prototype.getPayload = function() {\n    var payload = {\n      task: this.task,\n      json: {\n        step: this.step,\n        wish: this.wish,\n        total: this.total,\n        amount: this.amount,\n        amountRepeated: this.amountRepeated\n      },\n      isPending: this._isPending()\n    };\n\n    if (this.result !== null) {\n      payload = angular.extend(\n        this.result,\n        payload\n      );\n    }\n\n    return payload;\n  };\n\n  /**\n   * Whether or not task is currently locked.\n   *\n   * @public\n   * @method isLocked\n   * @return {boolean}\n   */\n  SavingsTargetTask.prototype.isLocked = function() {\n    if (this.task === null) {\n      return false;\n    }\n\n    // if result was created and\n    // we are waiting for paused\n    // state, we skip unlocking\n    // with internal `_isLocked`\n    if (this.task.isActive) {\n      return this._isLocked;\n    }\n\n    // reset `_isLocked` flag if\n    // `isActive` changed again\n    this._isLocked = null;\n\n    // inactive\n    return true;\n  };\n\n  /**\n   * Whether or not task can be sent to server.\n   *\n   * @public\n   * @method canResolve\n   * @return {boolean}\n   */\n  SavingsTargetTask.prototype.canResolve = function() {\n    var user = this.$injector.get('user');\n    if (!user.isUser()) {\n      return false;\n    }\n\n    if (this.form.$invalid) {\n      return false;\n    }\n\n    if (this.isLocked()) {\n      return false;\n    }\n\n    if (this.resolved) {\n      return false;\n    }\n\n    return true;\n  };\n\n  /**\n   * Sets up initial state.\n   *\n   * @public\n   * @method init\n   * @return {void}\n   */\n  SavingsTargetTask.prototype.init = function() {\n    if (this.result !== null) {\n      var json = this.result.json;\n\n      // `amountRepeated` cannot be desisted cause it's the\n      // condition in last step before setting `isPending`\n      this.amount = json.amount;\n      this.total = json.total;\n      this.wish = json.wish;\n      this.step = json.step;\n\n      // set `_isLocked` only until last step cause the step\n      // before last one gets manually updated AFTER unlock!\n      var timestampTask = this.task.updatedAt;\n      var timestampResult = this.result.updatedAt;\n      this._isLocked = timestampResult > timestampTask;\n    }\n\n    this.resolved = false;\n  };\n\n  /**\n   * Resets initial state.\n   *\n   * @public\n   * @method reset\n   * @return {void}\n   */\n  SavingsTargetTask.prototype.reset = function(){\n    this.init();\n  };\n\n  /**\n   * Increases `step` and invokes `resolve()`.\n   *\n   * @public\n   * @method update\n   * @return {void}\n   */\n  SavingsTargetTask.prototype.update = function(){\n    if (this.step < this.total) {\n      this.step++;\n    }\n\n    var me = this;\n    var successCallback = function(){};\n    var failureCallback = function(){\n      me.step--;\n    };\n\n    this.resolve().then(\n      successCallback,\n      failureCallback\n    );\n  };\n\n  /**\n   * Sets `resolved` flag. Calls `onResolve`\n   * callback with JSON result for consumer.\n   *\n   * @public\n   * @method resolve\n   * @return {void}\n   */\n  SavingsTargetTask.prototype.resolve = function(){\n    var notification = this.$injector.get('notification');\n    var i18n = this.$injector.get('i18n');\n    var $q = this.$injector.get('$q');\n\n    if (!this.canResolve()) {\n      var defer = $q.defer();\n      defer.reject();\n\n      return defer.promise;\n    }\n\n    var callback = this.result === null ?\n      this.onResolve :\n      this.onUpdate;\n\n    var payload = this.getPayload();\n    var result = callback({\n      payload: payload\n    });\n\n    // switch UI immediately\n    if (payload.isPending) {\n      this._isLocked = true;\n    }\n\n    var me = this;\n    var successCallback = function(result) {\n      if (result.isPending) {\n        if (me.step < me.total) {\n          var message = i18n.get('Thank you for your input!');\n          notification.success(message);\n        }\n\n        me.result = result;\n        return;\n      }\n\n      me.resolved = true;\n    };\n\n    var failureCallback = function() {\n      me._isLocked = null;\n    };\n\n    var promise = $q.when(result);\n    promise.then(\n      successCallback,\n      failureCallback\n    );\n\n    return promise;\n  };\n\n  /**\n   * Calculates difference between `amount` and `amountRepeated`.\n   *\n   * @public\n   * @method getDifference\n   * @return {void}\n   */\n  SavingsTargetTask.prototype.getDifference = function(){\n    return this.amountRepeated - this.amount;\n  };\n\n  /**\n   * Checks if `amountRepeated` is already set.\n   *\n   * @private\n   * @method _isPending\n   * @return {boolean}\n   */\n  SavingsTargetTask.prototype._isPending = function(){\n    return this.amountRepeated === null;\n  };\n\n  //\n  // REGISTRY\n  //\n  angular.module(module).directive('savingsTargetTask', function(){\n    return {\n      scope: {\n        onUpdate: '&savingsTargetTaskOnUpdate',\n        onResolve: '&savingsTargetTaskOnResolve'\n      },\n      restrict: 'A',\n      transclude: true,\n      bindToController: true,\n      controller: SavingsTargetTask,\n      controllerAs: 'savingsTargetTaskController',\n      templateUrl: 'views/directives/tasks/savings-target-task.html'\n    };\n  });\n\n})(ANGULAR_MODULE, angular);\n\n/* global ANGULAR_MODULE, angular */\n(function(module, angular) {\n  'use strict';\n\n  // --------------------------------------------------\n  // SavingsSupportedTask\n  // --------------------------------------------------\n\n  //\n  // CONTROLLER\n  //\n\n  /**\n   * @constructor\n   */\n  var SavingsSupportedTask = function($scope, $element, $attrs, $injector) {\n    var type = $injector.get('TYPE_SAVINGS_SUPPORTED');\n    var user = $injector.get('user');\n\n    this.$scope = $scope;\n    this.$attrs = $attrs;\n    this.$element = $element;\n    this.$injector = $injector;\n\n    this.task = user.getTaskByType(type);\n  };\n\n  SavingsSupportedTask.$inject = ['$scope', '$element', '$attrs', '$injector'];\n\n  //\n  // PROPERTIES\n  //\n\n  // SERVER\n\n  /** @var {object} task Task's resource from server. */\n  SavingsSupportedTask.prototype.task = null;\n\n  // GAMEPLAY\n\n  /** @var {number} choice Currently selected user answer. */\n  SavingsSupportedTask.prototype.choice = null;\n\n  /** @var {boolean} resolved If player has resolved the game. */\n  SavingsSupportedTask.prototype.resolved = false;\n\n  //\n  // METHODS\n  //\n\n  /**\n   * Proxies to `init()` if controller's ready.\n   *\n   * @public\n   * @method $onInit\n   * @return {Void}\n   */\n  SavingsSupportedTask.prototype.$onInit = function() {\n    this.init();\n  };\n\n  /**\n   * Retrieves result payload for server.\n   *\n   * @public\n   * @method getPayload\n   * @return {Void}\n   */\n  SavingsSupportedTask.prototype.getPayload = function() {\n    return {\n      task: this.task,\n      json: {\n        choice: this.choice\n      }\n    };\n  };\n\n  /**\n   * Whether or not task is currently locked.\n   *\n   * @public\n   * @method isLocked\n   * @return {boolean}\n   */\n  SavingsSupportedTask.prototype.isLocked = function() {\n    if (this.task === null) {\n      return false;\n    }\n\n    return !this.task.isActive;\n  };\n\n  /**\n   * Whether or not task can be sent to server.\n   *\n   * @public\n   * @method canResolve\n   * @return {boolean}\n   */\n  SavingsSupportedTask.prototype.canResolve = function() {\n    var user = this.$injector.get('user');\n    if (!user.isUser()) {\n      return false;\n    }\n\n    if (this.isLocked()) {\n      return false;\n    }\n\n    if (this.resolved) {\n      return false;\n    }\n\n    if (!this.choice) {\n      return false;\n    }\n\n    return true;\n  };\n\n  /**\n   * Sets up initial state.\n   *\n   * @public\n   * @method init\n   * @return {Void}\n   */\n  SavingsSupportedTask.prototype.init = function() {\n    this.resolved = false;\n  };\n\n  /**\n   * Resets initial state.\n   *\n   * @public\n   * @method reset\n   * @return {Void}\n   */\n  SavingsSupportedTask.prototype.reset = function(){\n    this.init();\n  };\n\n  /**\n   * Sets current selection on `choice`.\n   *\n   * @public\n   * @method update\n   * @param {number} choice\n   * @param {number} selected\n   * @return {void}\n   */\n  SavingsSupportedTask.prototype.update = function(choice, selected){\n    this.choice = selected ? choice : null;\n  };\n\n  /**\n   * Sets `resolved` flag. Calls `onResolve`\n   * callback with JSON result for consumer.\n   *\n   * @public\n   * @method resolve\n   * @return {Void}\n   */\n  SavingsSupportedTask.prototype.resolve = function(){\n    var $q = this.$injector.get('$q');\n\n    if (!this.canResolve()) {\n      var defer = $q.defer();\n      defer.reject();\n\n      return defer.promise;\n    }\n\n    var result = this.onResolve({\n      payload: this.getPayload()\n    });\n\n    var me = this;\n    var successCallback = function() {\n      me.resolved = true;\n    };\n    var failureCallback = function() {\n\n    };\n\n    var promise = $q.when(result);\n    promise.then(\n      successCallback,\n      failureCallback\n    );\n\n    return promise;\n  };\n\n  //\n  // REGISTRY\n  //\n  angular.module(module).directive('savingsSupportedTask', function(){\n    return {\n      scope: {\n        onResolve: '&savingsSupportedTaskOnResolve'\n      },\n      restrict: 'A',\n      transclude: true,\n      bindToController: true,\n      controller: SavingsSupportedTask,\n      controllerAs: 'savingsSupportedTaskController',\n      templateUrl: 'views/directives/tasks/savings-supported-task.html'\n    };\n  });\n\n})(ANGULAR_MODULE, angular);\n\n/* global ANGULAR_MODULE, angular */\n(function(module, angular) {\n  'use strict';\n\n  // --------------------------------------------------\n  // SelfCommitmentTask\n  // --------------------------------------------------\n\n  //\n  // CONTROLLER\n  //\n\n  /**\n   * @constructor\n   */\n  var SelfCommitmentTask = function($scope, $elemnt, $attrs, $injector) {\n    var type = $injector.get('TYPE_SELF_COMMITMENT');\n\n    this.$injector = $injector;\n\n    this.user = this.$injector.get('user');\n    this.task = this.user.getTaskByType(type);\n    this.result = this.user.getPendingByType(type);\n  };\n\n  SelfCommitmentTask.$inject = ['$scope','$element','$attrs', '$injector'];\n\n  // SERVER\n\n  /** @var {object} user Alias to user service. */\n  SelfCommitmentTask.prototype.user = null;\n\n  /** @var {object} task Task's resource from server. */\n  SelfCommitmentTask.prototype.task = null;\n\n  /** @var {object} result Task's pending result from server. */\n  SelfCommitmentTask.prototype.result = null;\n\n  // GAMEPLAY\n\n  /** @var {object} watched Hash storing watched video ids. */\n  SelfCommitmentTask.prototype.videos = {\n    //'ImPxD_FDpKM': false,\n    //'gUYjYEGbxEY': false\n  };\n\n  /** @var {boolean} resolved If player has resolved the game. */\n  SelfCommitmentTask.prototype.resolved = false;\n\n  //\n  // METHODS\n  //\n\n  /**\n   * Proxies to `init()` if controller's ready.\n   *\n   * @public\n   * @method $onInit\n   * @return {void}\n   */\n  SelfCommitmentTask.prototype.$onInit = function() {\n    this.init();\n  };\n\n  /**\n   * Retrieves result payload for server.\n   *\n   * @public\n   * @method getPayload\n   * @return {void}\n   */\n  SelfCommitmentTask.prototype.getPayload = function() {\n    var payload = {\n      task: this.task,\n      json: {\n        videos: this.videos\n      },\n      isPending: this._isPending()\n    };\n\n    if (this.result !== null) {\n      payload = angular.extend(\n        this.result,\n        payload\n      );\n    }\n\n    return payload;\n  };\n\n  /**\n   * Whether or not task is currently locked.\n   *\n   * @public\n   * @method isLocked\n   * @return {boolean}\n   */\n  SelfCommitmentTask.prototype.isLocked = function() {\n    // admins always can watch\n    // videos for explanation!\n    if (!this.user.isUser()) {\n      return false;\n    }\n\n    return !this.task.isActive;\n  };\n\n  /**\n   * Whether or not task can be sent to server.\n   *\n   * @public\n   * @method canResolve\n   * @return {boolean}\n   */\n  SelfCommitmentTask.prototype.canResolve = function() {\n    var user = this.$injector.get('user');\n    if (!user.isUser()) {\n      return false;\n    }\n\n    if (this.isLocked()) {\n      return false;\n    }\n\n    if (this.resolved) {\n      return false;\n    }\n\n    return true;\n  };\n\n  /**\n   * Sets up initial state.\n   *\n   * @public\n   * @method init\n   * @return {void}\n   */\n  SelfCommitmentTask.prototype.init = function() {\n    if (this.result !== null) {\n      var json = this.result.json;\n      this.videos = json.videos;\n    }\n\n    this.resolved = false;\n  };\n\n  /**\n   * Resets initial state.\n   *\n   * @public\n   * @method reset\n   * @return {void}\n   */\n  SelfCommitmentTask.prototype.reset = function(){\n    this.init();\n  };\n\n  /**\n   * Description.\n   *\n   * @public\n   * @method update\n   * @return {void}\n   */\n  SelfCommitmentTask.prototype.update = function(id){\n    if (this.videos[id]) {\n      return;\n    }\n\n    this.videos[id] = true;\n\n    var me = this;\n    var successCallback = function(){};\n    var failureCallback = function(){\n      me.videos[id] = false;\n    };\n\n    this.resolve().then(\n      successCallback,\n      failureCallback\n    );\n  };\n\n  /**\n   * Sets `resolved` flag. Calls `onResolve`\n   * callback with JSON result for consumer.\n   *\n   * @public\n   * @method resolve\n   * @return {void}\n   */\n  SelfCommitmentTask.prototype.resolve = function(){\n    var $q = this.$injector.get('$q');\n\n    if (!this.canResolve()) {\n      var defer = $q.defer();\n      defer.reject();\n\n      return defer.promise;\n    }\n\n    var callback = this.result === null ?\n      this.onResolve :\n      this.onUpdate;\n\n    var payload = this.getPayload();\n    var result = callback({\n      payload: payload\n    });\n\n    var me = this;\n    var successCallback = function(result) {\n      if (result.isPending) {\n        me.result = result;\n        return;\n      }\n\n      me.resolved = true;\n    };\n    var failureCallback = function() {\n\n    };\n\n    var promise = $q.when(result);\n    promise.then(\n      successCallback,\n      failureCallback\n    );\n\n    return promise;\n  };\n\n  /**\n   * Checks if user is allowed to watch videos:\n   * - (Super-)Admins are always allowed\n   * - Users only if not in workshop\n   *\n   * @public\n   * @method canWatch\n   * @return {boolean}\n   */\n  SelfCommitmentTask.prototype.canWatch = function(){\n    if (!this.user.isUser()) {\n      return true;\n    }\n\n    return !this.user.isInWorkshop();\n  };\n\n  /**\n   * Checks if all videos has been watched.\n   *\n   * @private\n   * @method _isPending\n   * @return {boolean}\n   */\n  SelfCommitmentTask.prototype._isPending = function(){\n    for (var id in this.videos) {\n      if (!this.videos[id]) {\n        return true;\n      }\n    }\n\n    return false;\n  };\n\n  //\n  // REGISTRY\n  //\n  angular.module(module).directive('selfCommitmentTask', function(){\n    return {\n      scope: {\n        onUpdate: '&selfCommitmentTaskOnUpdate',\n        onResolve: '&selfCommitmentTaskOnResolve'\n      },\n      restrict: 'A',\n      transclude: true,\n      bindToController: true,\n      controller: SelfCommitmentTask,\n      controllerAs: 'selfCommitmentTaskController',\n      templateUrl: 'views/directives/tasks/self-commitment-task.html'\n    };\n  });\n\n})(ANGULAR_MODULE, angular);\n\n/* global ANGULAR_MODULE, angular, moment */\n/* jshint bitwise: false */\n(function(module, angular) {\n  'use strict';\n\n  // --------------------------------------------------\n  // ProcrastinationTask\n  // --------------------------------------------------\n\n  //\n  // CONTROLLER\n  //\n\n  /**\n   * @constructor\n   */\n  var ProcrastinationTask = function($scope, $elemnt, $attrs, $injector) {\n    var type = $injector.get('TYPE_PROCRASTINATION');\n    var user = $injector.get('user');\n\n    this.$injector = $injector;\n    this.task = user.getTaskByType(type);\n    this.result = user.getPendingByType(type);\n\n    this.domId = 'procrastination-task-' + $scope.$id;\n\n    this._intervalId = null;\n    this._onInterval = this._onInterval.bind(this);\n  };\n\n  ProcrastinationTask.$inject = ['$scope','$element','$attrs', '$injector'];\n\n  // SERVER\n\n  /** @var {string} type Task's `type` property from server. */\n  ProcrastinationTask.prototype.type = null;\n\n  /** @var {object} task Task's resource from server. */\n  ProcrastinationTask.prototype.task = null;\n\n  /** @var {object} result Task's pending result from server. */\n  ProcrastinationTask.prototype.result = null;\n\n  // GAMEPLAY\n\n  /** @var {string} mode One of `ALL` or `SPLIT`. */\n  ProcrastinationTask.prototype.mode = null;\n\n  /** @var {number} rounds Current game round count. */\n  ProcrastinationTask.prototype.count = 0;\n\n  /** @var {number} total Total rounds depends on `mode`. */\n  ProcrastinationTask.prototype.total = 1;\n\n  /** @var {array} rounds Results of single game rounds. */\n  ProcrastinationTask.prototype.rounds = [];\n\n  /** @var {number} openRounds Number of left rounds to play. */\n  ProcrastinationTask.prototype.openRounds = null;\n\n  /** @var {number} minCatched Minimum catched bubbles depends on `mode`. */\n  ProcrastinationTask.prototype.minCatched = null;\n\n  /** @var {number} maxEscaped Maximum escaped bubbles depends on `mode`. */\n  ProcrastinationTask.prototype.maxEscaped = null;\n\n  /** @var {number} updatedAt When last result was written. */\n  ProcrastinationTask.prototype.updatedAt = null;\n\n  /** @var {number} invalidAt When task will be unresolvable. */\n  ProcrastinationTask.prototype.invalidAt = null;\n\n  /** @var {string} state One of `IDLE`, `DECISION`, `PLAYING`. */\n  ProcrastinationTask.prototype.state = 'IDLE';\n\n  /** @var {boolean} resolved If player has resolved the game. */\n  ProcrastinationTask.prototype.resolved = false;\n\n  // MISC\n\n  /** @var {string} domId Unique dom id for this task for scrolling purposes. */\n  ProcrastinationTask.prototype.domId = null;\n\n  /** @var {boolean} warmup If dry-run has been finished. */\n  ProcrastinationTask.prototype.hasWarmup = false;\n\n  /** @var {number} warmupMaxEscaped Maximum escaped bubbles for demo mode. */\n  ProcrastinationTask.prototype.warmupMaxEscaped = 2;\n\n  /** @var {number} warmupMinCatched Minimum catched bubbles for demo mode. */\n  ProcrastinationTask.prototype.warmupMinCatched = 20;\n\n  //\n  // METHODS\n  //\n\n  /**\n   * Proxies to `init()` if controller's ready.\n   *\n   * @public\n   * @method $onInit\n   * @return {void}\n   */\n  ProcrastinationTask.prototype.$onInit = function() {\n    this.init();\n  };\n\n  /**\n   * Proxies to `init()` if controller's ready.\n   *\n   * @public\n   * @method $onInit\n   * @return {void}\n   */\n  ProcrastinationTask.prototype.$onDestroy = function() {\n    var $interval = this.$injector.get('$interval');\n\n    if (this._intervalId !== null) {\n      $interval.cancel(this._intervalId);\n    }\n  };\n\n  /**\n   * Retrieves result payload for server.\n   *\n   * @public\n   * @method getPayload\n   * @return {void}\n   */\n  ProcrastinationTask.prototype.getPayload = function() {\n    var payload = {\n      task: this.task,\n      json: {\n        mode: this.mode,\n        state: this.state,\n        rounds: this.rounds,\n        success: this.hasSuccess()\n      },\n      isPending: this._isPending(),\n      ticketCount: this.getTicketCount()\n    };\n\n    if (this.result !== null) {\n      payload = angular.extend(\n        this.result,\n        payload\n      );\n    }\n\n    return payload;\n  };\n\n  /**\n   * Whether or not task is currently locked.\n   *\n   * @public\n   * @method isLocked\n   * @return {boolean}\n   */\n  ProcrastinationTask.prototype.isLocked = function() {\n    if (this.task === null) {\n      return false;\n    }\n\n    return !this.task.isActive;\n  };\n\n  /**\n   * Whether or not task can be sent to server.\n   *\n   * @public\n   * @method canResolve\n   * @return {boolean}\n   */\n  ProcrastinationTask.prototype.canResolve = function() {\n    var user = this.$injector.get('user');\n    if (!user.isUser()) {\n      return false;\n    }\n\n    if (this.isLocked()) {\n      return false;\n    }\n\n    if (!this.hasWarmup) {\n      return false;\n    }\n\n    if (this.resolved) {\n      return false;\n    }\n\n    return true;\n  };\n\n  /**\n   * Sets up initial state.\n   *\n   * @public\n   * @method init\n   * @return {void}\n   */\n  ProcrastinationTask.prototype.init = function() {\n    // check for pending result\n    if (this.result !== null) {\n      var json = this.result.json;\n\n      // 1) apply round / count\n      this.rounds = json.rounds;\n      this.count = json.rounds.length;\n\n      // 2) call setters only now\n      this.setWarmup(true);\n      this.setMode(json.mode);\n      this.setState(json.state);\n    }\n\n    this.resolved = false;\n  };\n\n  /**\n   * Resets initial state.\n   *\n   * @public\n   * @method reset\n   * @return {void}\n   */\n  ProcrastinationTask.prototype.reset = function(){\n    this.init();\n  };\n\n  /**\n   * Description.\n   *\n   * @public\n   * @method update\n   * @return {void}\n   */\n  ProcrastinationTask.prototype.update = function(result){\n    var state = this.state;\n    var count = this.count;\n\n    switch (this.state) {\n      case 'IDLE':\n        this.setState('DECISION');\n        break;\n\n      case 'DECISION':\n        this.setState('PLAYING');\n        break;\n\n      case 'PLAYING':\n        this.count = this.rounds.push(result);\n        break;\n      default:\n    }\n\n    var me = this;\n    var successCallback = function(){};\n    var failureCallback = function(){\n      me.setState(state);\n      me.count = count;\n    };\n\n    this.resolve().then(\n      successCallback,\n      failureCallback\n    );\n  };\n\n  /**\n   * Sets `resolved` flag. Calls `onResolve`\n   * callback with JSON result for consumer.\n   *\n   * @public\n   * @method resolve\n   * @return {void}\n   */\n  ProcrastinationTask.prototype.resolve = function(){\n    var notification = this.$injector.get('notification');\n    var i18n = this.$injector.get('i18n');\n    var $q = this.$injector.get('$q');\n\n    console.log('>>>RESOLVE!');\n\n    if (!this.canResolve()) {\n      var defer = $q.defer();\n      defer.reject();\n\n      return defer.promise;\n    }\n\n    var callback = this.result === null ?\n      this.onResolve :\n      this.onUpdate;\n\n    var result = callback({\n      payload: this.getPayload()\n    });\n\n    var me = this;\n    var successCallback = function(result) {\n      var message;\n\n      if (result.isPending) {\n        me.result = result;\n\n        switch (me.state) {\n          case 'IDLE': break;\n          case 'DECISION': break;\n          case 'PLAYING':\n            switch (me.mode) {\n              case 'ALL': break;\n              case 'SPLIT':\n                if (me.count > 0) {\n                  message = i18n.get(\n                    'Super, you have succeeded exercise %s of %s!',\n                    me.count,\n                    me.total\n                  );\n                  notification.success(message);\n                }\n                break;\n              default:\n                break;\n            }\n            break;\n          default:\n        }\n\n        return;\n      }\n\n      if (!me.hasSuccess()) {\n        message = i18n.get('Sorry, but the time has expired for this exercise and you retrieve only 1 ticket!');\n        notification.error(message);\n      } else {\n        message = i18n.get('Super, you have successfully done this exercise and retrieve 5 tickets!');\n        notification.success(message);\n      }\n\n      me.resolved = true;\n    };\n\n    var failureCallback = function() {\n\n    };\n\n    var promise = $q.when(result);\n    promise.then(\n      successCallback,\n      failureCallback\n    );\n\n    return promise;\n  };\n\n  /**\n   * Sets game mode to `ALL` or `SPLIT`.\n   *\n   * @public\n   * @method setMode\n   * @param {string} mode\n   * @return {void}\n   */\n  ProcrastinationTask.prototype.setMode = function(mode){\n    switch (mode) {\n      case 'ALL':\n        this.total = 1;\n        this.maxEscaped = 15;\n        this.minCatched = 150;\n        break;\n      case 'SPLIT':\n        this.total = 3;\n        this.maxEscaped = 5;\n        this.minCatched = 50;\n        break;\n      default:\n        return;\n    }\n\n    this.mode = mode;\n    this.openRounds = this.total - this.count;\n  };\n\n  /**\n   * Sets game state to `IDLE`, `DECISION` or `PLAYING`.\n   *\n   * @public\n   * @method setState\n   * @param {string} state\n   * @return {void}\n   */\n  ProcrastinationTask.prototype.setState = function(state){\n    var $interval = this.$injector.get('$interval');\n\n    switch (state) {\n      case 'IDLE':\n        break;\n      case 'DECISION':\n        break;\n      case 'PLAYING':\n        var updatedAt = this.result.updatedAt;\n        this.updatedAt = moment.unix(updatedAt);\n        this.invalidAt = this.updatedAt.clone();\n\n        switch (this.mode) {\n          case 'ALL':\n            this.invalidAt.add(6, 'weeks');\n            break;\n          case 'SPLIT':\n            this.invalidAt.add(2, 'weeks');\n            break;\n          default:\n        }\n\n        this._intervalId = $interval(this._onInterval, 1000);\n\n        break;\n      default:\n        return;\n    }\n\n    this.state = state;\n  };\n\n  /**\n   * Sets `hasWarmup` flag after dry run.\n   *\n   * @public\n   * @method setWarmup\n   * @param {boolean} warmup\n   * @return {void}\n   */\n  ProcrastinationTask.prototype.setWarmup = function(warmup){\n    this.hasWarmup = warmup;\n  };\n\n  /**\n   * Whether or not task is actually invalid.\n   *\n   * @public\n   * @method isInvalid\n   * @return {boolean}\n   */\n  ProcrastinationTask.prototype.isInvalid = function() {\n    if (this.invalidAt === null) {\n      return false;\n    }\n\n    return +this._now() > +this.invalidAt;\n  };\n\n  /**\n   * If amount of results corresponds to `total`.\n   *\n   * @public\n   * @method hasSuccess\n   * @return {boolean}\n   */\n  ProcrastinationTask.prototype.hasSuccess = function() {\n    return this.rounds.length === this.total;\n  };\n\n  /**\n   * Retrieves the current played round.\n   *\n   * @public\n   * @method getCurrentRound\n   * @return {string}\n   */\n  ProcrastinationTask.prototype.getCurrentRound = function(){\n    return this.count + 1;\n  };\n\n  /**\n   * Calculates remaining time for finishing\n   * this task depending on chosen game mode.\n   *\n   * @public\n   * @method getRemainingTime\n   * @return {string}\n   */\n  ProcrastinationTask.prototype.getRemainingTime = function(){\n    var string = this.$injector.get('string');\n    var i18n = this.$injector.get('i18n');\n\n    if (this.invalidAt === null) {\n      return '';\n    }\n\n    var difference = this.invalidAt.diff(this._now());\n    var duration = moment.duration(difference);\n\n    var seconds = ~~duration.asSeconds();\n    var minutes = ~~duration.asMinutes();\n    var hours = ~~duration.asHours();\n    var days = ~~duration.asDays();\n    var value, keys;\n\n    if (days > 0) {\n      value = days;\n      keys = ['day', 'days'];\n    } else if (hours > 0) {\n      value = hours;\n      keys = ['hour', 'hours'];\n    } else if (minutes > 0) {\n      value = minutes;\n      keys = ['minute', 'minutes'];\n    } else {\n      value = seconds >= 0 ? seconds : 0;\n      keys = ['second', 'seconds'];\n    }\n\n    var key = value === 1 ?\n      keys[0] :\n      keys[1];\n\n    var unit = i18n.get(key);\n\n    return string.sprintf('%s %s', value, unit);\n  };\n\n  /**\n   * Calculates final ticket amount by predefined formula.\n   *\n   * @public\n   * @method getTicketCount\n   * @return {number}\n   */\n  ProcrastinationTask.prototype.getTicketCount = function(){\n    if (this.hasSuccess()) {\n      return 5;\n    }\n\n    return 1;\n  };\n\n  /**\n   * Interval callback for checking invalidation.\n   *\n   * @private\n   * @method _onInterval\n   * @return {boolean}\n   */\n  ProcrastinationTask.prototype._onInterval = function() {\n    var $interval = this.$injector.get('$interval');\n    if (!this.isInvalid() || !this.canResolve()) {\n      return;\n    }\n\n    $interval.cancel(this._intervalId);\n    this.count = this.total;\n    this.resolve();\n  };\n\n  /**\n   * Whether or not task is currently pending.\n   *\n   * @private\n   * @method _isPending\n   * @return {boolean}\n   */\n  ProcrastinationTask.prototype._isPending = function() {\n    return this.count < this.total;\n  };\n\n  /**\n   * Gets the current timestamp as moment.\n   *\n   * @private\n   * @method _now\n   * @return {object}\n   */\n  ProcrastinationTask.prototype._now = function() {\n    /*\n    if (!this._testInvalidation) {\n      this._testInvalidation = this.invalidAt.clone().subtract(3, 'seconds')\n    } else {\n      this._testInvalidation.add(1, 'second');\n    }\n    return this._testInvalidation;\n    */\n    return moment();\n  };\n\n  //\n  // REGISTRY\n  //\n  angular.module(module).directive('procrastinationTask', function(){\n    return {\n      scope: {\n        onUpdate: '&procrastinationTaskOnUpdate',\n        onResolve: '&procrastinationTaskOnResolve'\n      },\n      restrict: 'A',\n      transclude: true,\n      bindToController: true,\n      controller: ProcrastinationTask,\n      controllerAs: 'procrastinationTaskController',\n      templateUrl: 'views/directives/tasks/procrastination-task.html'\n    };\n  });\n\n  // --------------------------------------------------\n  // ProcrastinationTask Game\n  // --------------------------------------------------\n\n  //\n  // CONTROLLER\n  //\n\n  /**\n   * @constructor\n   */\n  var ProcrastinationTaskGame = function($scope,$element,$attrs,$injector) {\n    this.$scope = $scope;\n    this.$attrs = $attrs;\n    this.$element = $element;\n    this.$injector = $injector;\n\n    this.bubbles = {};\n    this.viewport = {};\n    this.domId = 'viewport-' + $scope.$id;\n\n    this._nextId = 0;\n    this._tapped = 0;\n    this._rounds = 0;\n    this._retries = 0;\n    this._timeout = 100;\n    this._requestId = null;\n\n    this._loop = this._loop.bind(this);\n    this._update = this._update.bind(this);\n    this._resize = this._resize.bind(this);\n\n    this._window = angular.element(window);\n    this._viewport = this.$element.find('.viewport');\n  };\n\n  ProcrastinationTaskGame.$inject = ['$scope','$element','$attrs','$injector'];\n\n  //\n  // PROPERTIES\n  //\n\n  /** @var {number} catched Count of catched bubbles. */\n  ProcrastinationTaskGame.prototype.catched = 0;\n\n  /** @var {number} escaped Count of escaped bubbles. */\n  ProcrastinationTaskGame.prototype.escaped = 0;\n\n  /** @var {number} accuracy Players scoring accuracy. */\n  ProcrastinationTaskGame.prototype.accuracy = 0;\n\n  /** @var {object} bubbles Hash map keeping bubble objects. */\n  ProcrastinationTaskGame.prototype.bubbles = null;\n\n  /** @var {object} viewport Viewport holding dimensions and offsets. */\n  ProcrastinationTaskGame.prototype.viewport = null;\n\n  /** @var {boolean} state One of `IDLE`, `RUNNING`, `TIMEOUT`, `GAME_OVER` or `GAME_DONE`. */\n  ProcrastinationTaskGame.prototype.state = 'IDLE';\n\n  /** @var {boolean} expired Flag for expiring current game while its running. */\n  ProcrastinationTaskGame.prototype.expired = false;\n\n  /** @var {number} maxRounds Maximum number of rounds after `GAME_DONE`. */\n  ProcrastinationTaskGame.prototype.maxRounds = 1;\n\n  /** @var {number} maxRounds Maximum number of retries after `GAME_OVER`. */\n  ProcrastinationTaskGame.prototype.maxRetries = Number.POSITIVE_INFINITY;\n\n  /** @var {number} maxEscaped Maximum amount of escaped bubbles for `GAME_OVER`. */\n  ProcrastinationTaskGame.prototype.maxEscaped = 15;\n\n  /** @var {number} maxEscaped Maximum amount of escaped bubbles for `GAME_DONE`. */\n  ProcrastinationTaskGame.prototype.minCatched = 150;\n\n  /** @var {string} bubbleDelay Timeout until next bubble will appear on viewport. */\n  ProcrastinationTaskGame.prototype.bubbleDelay = 100;\n\n  //\n  // METHODS\n  //\n\n  /**\n   * Sets up event listeners and animation frame.\n   *\n   * @public\n   * @method $onInit\n   * @return {void}\n   */\n  ProcrastinationTaskGame.prototype.$onInit = function() {\n    this._window.on('resize', this._resize);\n\n    var me = this;\n    this._unwatch = this.$scope.$watch(\n      function() {\n        return me.expired;\n      },\n      function(isExpired) {\n        if (isExpired) {\n          me.expire();\n        }\n      }\n    );\n  };\n\n  /**\n   * Removes event listener and animation frame.\n   *\n   * @public\n   * @method $onDestroy\n   * @return {void}\n   */\n  ProcrastinationTaskGame.prototype.$onDestroy = function() {\n    this._window.off('resize', this._resize);\n    this._unwatch();\n    this._unloop();\n  };\n\n  /**\n   * Invokes game loop and sets `RUNNING` state.\n   *\n   * @public\n   * @method start\n   * @return {void}\n   */\n  ProcrastinationTaskGame.prototype.start = function() {\n    // calculate viewport now that we can\n    // be sure that elements are rendered\n    this.viewport = this._getViewport();\n\n    this.state = 'RUNNING';\n    this._loop();\n  };\n\n  /**\n   * Stops and sets `GAME_OVER` state.\n   *\n   * @public\n   * @method gameOver\n   * @return {void}\n   */\n  ProcrastinationTaskGame.prototype.quit = function() {\n    this._unloop();\n\n    this._retries++;\n\n    this.bubbles = {};\n    this.state = 'GAME_OVER';\n\n    var result = this._getResult();\n    this.onGameOver({ result: result });\n  };\n\n  /**\n   * Stops and sets `FINISHED` state.\n   *\n   * @public\n   * @method done\n   * @return {void}\n   */\n  ProcrastinationTaskGame.prototype.done = function() {\n    this._unloop();\n\n    this._rounds++;\n\n    this.bubbles = {};\n    this.state = 'GAME_DONE';\n\n    var result = this._getResult();\n    this.onGameDone({ result: result });\n  };\n\n  /**\n   * Stops and sets `TIMEOUT` state.\n   *\n   * @public\n   * @method expire\n   * @return {void}\n   */\n  ProcrastinationTaskGame.prototype.expire = function() {\n    this._unloop();\n\n    this.bubbles = {};\n    this.state = 'TIMEOUT';\n  };\n\n  /**\n   * Resets game and sets `IDLE` state.\n   *\n   * @public\n   * @method reset\n   * @return {void}\n   */\n  ProcrastinationTaskGame.prototype.reset = function() {\n    this._unloop();\n\n    this._nextId = 0;\n    this._tapped = 0;\n    this._timeout = 100;\n    this._requestId = null;\n\n    this.catched = 0;\n    this.escaped = 0;\n    this.accuracy = 0;\n    this.state = 'IDLE';\n  };\n\n  /**\n   * Initializes\n   *\n   * @public\n   * @method $onDestroy\n   * @return {void}\n   */\n  ProcrastinationTaskGame.prototype.onClick = function($event) {\n    switch (this.state) {\n      case 'IDLE':\n        this.start();\n        break;\n      case 'RUNNING':\n        this._tapped++;\n\n        var target = $event.target;\n        var viewport = this._viewport.get(0);\n\n        // only update accuracy immediately if\n        // clicked on viewport, otherwise this\n        // will be done after bubble animation!\n        if (viewport.id === target.id) {\n          this._setAccuracy();\n        }\n\n        break;\n      case 'TIMEOUT':\n        // noop - disabled\n        break;\n      case 'GAME_OVER':\n        if (this.canRetry()) {\n          this.reset();\n          this.start();\n        }\n\n        break;\n      case 'GAME_DONE':\n        if (this.canRestart()) {\n          this.reset();\n          this.start();\n        }\n\n        break;\n      default:\n    }\n  };\n\n  /**\n   * True if player can retry game after `GAME_OVER`.\n   *\n   * @public\n   * @method canRetry\n   * @return {void}\n   */\n  ProcrastinationTaskGame.prototype.canRetry = function() {\n    return this._retries < this.maxRetries;\n  };\n\n  /**\n   * True if player can retry game after `GAME_OVER`.\n   *\n   * @public\n   * @method canRestart\n   * @return {void}\n   */\n  ProcrastinationTaskGame.prototype.canRestart = function() {\n    return this._rounds < this.maxRounds;\n  };\n\n  /**\n   * Adds bubble controller to internal hash.\n   *\n   * @public\n   * @method addBubble\n   * @return {void}\n   */\n  ProcrastinationTaskGame.prototype.addBubble = function(bubble) {\n    this.bubbles[bubble.id] = bubble;\n  };\n\n  /**\n   * Removes bubble, update counters and checks game state.\n   *\n   * @public\n   * @method removeBubble\n   * @return {void}\n   */\n  ProcrastinationTaskGame.prototype.removeBubble = function(bubble) {\n    // don't remove twice ($onDestroy)\n    if (!this.bubbles[bubble.id]) {\n      return;\n    }\n\n    // catched - check min count\n    if (bubble.catched) {\n      this.catched++;\n\n      // update accuracy\n      this._setAccuracy();\n\n      var min = this.minCatched;\n      if (this.catched >= min) {\n        this.done();\n      }\n    }\n\n    // escaped - check max count\n    if (bubble.escaped) {\n      this.escaped++;\n\n      var max = this.maxEscaped;\n      if (this.escaped > max) {\n        this.quit();\n      }\n    }\n\n    delete this.bubbles[bubble.id];\n  };\n\n  /**\n   * Actual gaming loop for animation frame.\n   *\n   * @private\n   * @method _loop\n   * @return {void}\n   */\n  ProcrastinationTaskGame.prototype._loop = function() {\n    var animation = this.$injector.get('animation');\n\n    this._requestId = animation.requestAnimationFrame(this._loop);\n    this.$scope.$evalAsync(this._update);\n  };\n\n  /**\n   * Removes current animation frame.\n   *\n   * @public\n   * @method stop\n   * @return {void}\n   */\n  ProcrastinationTaskGame.prototype._unloop = function() {\n    var animation = this.$injector.get('animation');\n    animation.cancelAnimationFrame(this._requestId);\n  };\n\n  /**\n   * Animation frame callback handling creation of new\n   * bubbles being rendered and propagates `update()`.\n   *\n   * @private\n   * @method _update\n   * @return {void}\n   */\n  ProcrastinationTaskGame.prototype._update = function() {\n    var random = this.$injector.get('random');\n\n    this._timeout--;\n    if (this._timeout === 0 ) {\n      this._timeout = random.between(0, this.bubbleDelay) + 25;\n      this.bubbles[this._nextId++] = null;\n    }\n\n    for (var id in this.bubbles) {\n      var bubble = this.bubbles[id];\n      if (!bubble) {\n        continue;\n      }\n\n      bubble.update();\n    }\n  };\n\n  /**\n   * Sets up new `ratio` of viewport and propages `resize()`.\n   *\n   * @private\n   * @method resize\n   * @return {void}\n   */\n  ProcrastinationTaskGame.prototype._resize = function() {\n    this.viewport = this._getViewport();\n\n    var height = this.viewport.height;\n    var width = this.viewport.width;\n\n    this.ratio = width / height;\n\n    for (var id in this.bubbles) {\n      var bubble = this.bubbles[id];\n      if (!bubble) {\n        continue;\n      }\n\n      bubble.resize();\n    }\n  };\n\n  /**\n   * Gets result payload for game callbacks.\n   *\n   * @private\n   * @method _getResult\n   * @return {void}\n   */\n  ProcrastinationTaskGame.prototype._getResult = function() {\n    return {\n      catched: this.catched,\n      escaped: this.escaped,\n      accuracy: this.accuracy\n    };\n  };\n\n  /**\n   * Calculates and sets `accuracy` property.\n   *\n   * @private\n   * @method _setAccuracy\n   * @return {void}\n   */\n  ProcrastinationTaskGame.prototype._setAccuracy = function() {\n    this.accuracy = this.catched / this._tapped;\n  };\n\n  /**\n   * Gets viewport dimensions and offsets.\n   *\n   * @private\n   * @method _getViewport\n   * @return {void}\n   */\n  ProcrastinationTaskGame.prototype._getViewport = function() {\n    var width = this._viewport.width();\n    var height = this._viewport.height();\n    var top = this._viewport.scrollTop();\n    var left = this._viewport.scrollLeft();\n\n    return {\n      top: top,\n      left: left,\n      width: width,\n      height: height,\n      right: left + width,\n      bottom: top + height\n    };\n  };\n\n  //\n  // REGISTRY\n  //\n  angular.module(module).directive('procrastinationTaskGame', function(){\n    return {\n      scope: {\n        expired: '=?procrastinationTaskGameExpired',\n        maxRounds: '=?procrastinationTaskGameMaxRounds',\n        maxRetries: '=?procrastinationTaskGameMaxRetries',\n        onGameDone: '&procrastinationTaskGameOnGameDone',\n        onGameOver: '&procrastinationTaskGameOnGameOver',\n        minCatched: '=?procrastinationTaskGameMinCatched',\n        maxEscaped: '=?procrastinationTaskGameMaxEscaped',\n        bubbleDelay: '=?procrastinationTaskGameBubbleDelay'\n      },\n      restrict: 'A',\n      transclude: true,\n      bindToController: true,\n      controller: ProcrastinationTaskGame,\n      controllerAs: 'procrastinationTaskGameController',\n      templateUrl: 'views/directives/tasks/procrastination-task-game.html'\n    };\n  });\n\n  // --------------------------------------------------\n  // ProcrastinationTask Bubble\n  // --------------------------------------------------\n\n  //\n  // CONTROLLER\n  //\n\n  /**\n   * @constructor\n   */\n  var ProcrastinationTaskBubble = function($scope,$element,$attrs,$injector) {\n    this.$scope = $scope;\n    this.$attrs = $attrs;\n    this.$element = $element;\n    this.$injector = $injector;\n\n    this.domId = 'bubble-' + $scope.$id;\n  };\n\n  ProcrastinationTaskBubble.$inject = ['$scope','$element','$attrs','$injector'];\n\n  //\n  // PROPERTIES\n  //\n\n  /** @var {array} themes Predefined themes for bubbles. */\n  ProcrastinationTaskBubble.prototype.themes = [\n    'theme-1',\n    'theme-2',\n    'theme-3',\n    'theme-4',\n    'theme-5'\n  ];\n\n  /**\n\n  /** @var {string} class CSS class namem for bubble. */\n  ProcrastinationTaskBubble.prototype.class = 'bubble';\n\n  /** @var {object} style Style definitions for bubble. */\n  ProcrastinationTaskBubble.prototype.style = {};\n\n  /** @var {string} theme A random theme for bubble. */\n  ProcrastinationTaskBubble.prototype.theme = null;\n\n  /** @var {number} radius Radius of bubble. */\n  ProcrastinationTaskBubble.prototype.radius = null;\n\n  /** @var {number} radius Animation speed of bubble. */\n  ProcrastinationTaskBubble.prototype.speed = null;\n\n  /** @var {number} wave Horizontal swinging intensity. */\n  ProcrastinationTaskBubble.prototype.wave = null;\n\n  /** @var {number} x Current x position of bubble. */\n  ProcrastinationTaskBubble.prototype.x = null;\n\n  /** @var {number} y Current y position of bubble. */\n  ProcrastinationTaskBubble.prototype.y = null;\n\n  //\n  // METHODS\n  //\n\n  /**\n   * Registeres bubble with game controller after inital setup.\n   *\n   * @public\n   * @method $onInit\n   * @return {void}\n   */\n  ProcrastinationTaskBubble.prototype.$onInit = function() {\n    var random = this.$injector.get('random');\n    var game = this.gameController;\n\n    this.theme = random.pick(this.themes);\n\n    this.radius = random.between(0, 15) + 20;\n    this.speed = random.between(0, 1.25)  + 2.25;\n    this.wave = 1.5 + this.radius;\n\n    var xOffset = this.radius * 2;\n    this.y = game.viewport.height + random.between(0, 50) + 50;\n    this.x = random.between(xOffset, game.viewport.width - xOffset);\n\n    this._originalR = game.ratio;\n    this._originalX = this.x;\n\n    this.style = {\n      top: this.y,\n      left: this.x,\n      width: this.radius * 2,\n      height: this.radius * 2\n    };\n\n    this.gameController.addBubble(this);\n  };\n\n  /**\n   * Unregisteres bubble with game controller.\n   *\n   * @public\n   * @method $onDestroy\n   * @return {void}\n   */\n  ProcrastinationTaskBubble.prototype.$onDestroy = function() {\n    this.gameController.removeBubble(this);\n  };\n\n  /**\n   * Updates `x` and `y` coordinates and applies style.\n   *\n   * @public\n   * @method update\n   * @return {void}\n   */\n  ProcrastinationTaskBubble.prototype.update = function() {\n    var sin = Math.sin(new Date().getTime() * 0.002);\n    this.x = this.wave * sin + this._originalX;\n    this.y = this.y - this.speed;\n\n    this.style.left = this.x;\n    this.style.top = this.y;\n\n    var offscreenY = -this.radius * 2;\n    if (this.y > offscreenY) {\n      return;\n    }\n\n    this.escaped = true;\n    this.gameController.removeBubble(this);\n  };\n\n  /**\n   * Updates `x` coordinate according to new ratio.\n   *\n   * @public\n   * @method resize\n   * @return {void}\n   */\n  ProcrastinationTaskBubble.prototype.resize = function() {\n    var $timeout = this.$injector.get('$timeout');\n\n    var me = this;\n    var timeout = function() {\n      var ratio = me.gameController.ratio;\n      var move = ratio / me._originalR;\n\n      me._originalX *= move;\n      me._resizeId = null;\n    };\n\n    if (this._resizeId) {\n      $timeout.cancel(this._resizeId);\n    }\n\n    this._resizeId = $timeout(timeout, 250);\n  };\n\n  /**\n   *\n   *\n   * @public\n   * @method onClick\n   * @return {void}\n   */\n  ProcrastinationTaskBubble.prototype.onClick = function() {\n    var animation = this.$injector.get('animation');\n    var $timeout = this.$injector.get('$timeout');\n\n    var me = this;\n\n    var evalAsync = function() {\n      me.gameController.removeBubble(me);\n    };\n\n    var onAnimationEnd = function() {\n      me.$scope.$evalAsync(evalAsync);\n      me.$element.off(\n        animation.animationEndEvent,\n        onAnimationEnd\n      );\n    };\n\n    if (animation.animationEndEvent) {\n      this.$element.on(\n        animation.animationEndEvent,\n        onAnimationEnd\n      );\n    } else {\n      $timeout(evalAsync, 50);\n    }\n\n    this.catched = true;\n  };\n\n  //\n  // REGISTRY\n  //\n  angular.module(module).directive('procrastinationTaskBubble', function(){\n    return {\n      scope: {\n        id: '=procrastinationTaskBubble'\n      },\n      restrict: 'A',\n      transclude: true,\n      bindToController: true,\n      controller: ProcrastinationTaskBubble,\n      require: {\n        'gameController': '^procrastinationTaskGame'\n      },\n      controllerAs: 'procrastinationTaskBubbleController',\n      templateUrl: 'views/directives/tasks/procrastination-task-bubble.html'\n    };\n  });\n\n})(ANGULAR_MODULE, angular);\n\n/* global ANGULAR_MODULE, angular */\n(function(module, angular) {\n  'use strict';\n\n /**\n  * @constructor\n  */\n  var LoginFrontend = function($scope, $injector, code) {\n    this.$injector = $injector;\n    this.$scope = $scope;\n\n    // @see: next()\n    this.code = code;\n  };\n\n  LoginFrontend.$inject = ['$scope', '$injector', 'code'];\n\n  //\n  // PROPERTIES\n  //\n\n  /** @var {string} code Workshop code for authentication. */\n  LoginFrontend.prototype.code = null;\n\n  /** @var {string} username User name for authentication. */\n  LoginFrontend.prototype.username = null;\n\n  /** @var {RegExp} codeMinLength Minimum length of password. */\n  LoginFrontend.prototype.codeMinLength = 8;\n\n  /** @var {RegExp} codePattern Regular expression for `username` property. */\n  LoginFrontend.prototype.codePattern = /^[A-Za-z0-9]+$/;\n\n  /** @var {RegExp} userpattern Regular expression for `username` property. */\n  LoginFrontend.prototype.userpattern = /^[A-Za-z][A-Za-z](?:0[1-9]|[12]\\d|3[01])(?:0[1-9]|1[012])\\d$/;\n\n  //\n  // METHODS\n  //\n\n  /**\n   * Signs a user in with personal code to gather JWT token.\n   *\n   * @public\n   * @method signin\n   * @return {Void}\n   */\n  LoginFrontend.prototype.signin = function()\n    {\n      var notification = this.$injector.get('notification');\n      var $timeout = this.$injector.get('$timeout');\n      var $state = this.$injector.get('$state');\n      var auth = this.$injector.get('auth');\n      var i18n = this.$injector.get('i18n');\n\n      var form = this.$scope.loginForm;\n      if (form.$invalid) {\n        return;\n      }\n\n      var successCallback = function()\n      {\n        var message = i18n.get('You have successfully signed in!');\n        notification.success(message);\n\n        // force invokation of redirect\n        // as it sometimes won't change\n        $timeout(function(){\n          $state.go('frontend');\n        });\n      };\n\n      var failureCallback = function()\n      {\n        // @see: httpInterceptor\n      };\n\n      auth.signin({\n        username: this.username\n      }, 'frontend').then(\n        successCallback,\n        failureCallback\n      );\n    };\n\n  /**\n   * Signs a user up with personal and workshop code.\n   *\n   * @public\n   * @method signup\n   * @return {Void}\n   */\n  LoginFrontend.prototype.signup = function()\n    {\n      var notification = this.$injector.get('notification');\n      var $timeout = this.$injector.get('$timeout');\n      var $state = this.$injector.get('$state');\n      var auth = this.$injector.get('auth');\n      var i18n = this.$injector.get('i18n');\n\n      var form = this.$scope.loginForm;\n      if (form.$invalid) {\n        return;\n      }\n\n      var successCallback = function()\n      {\n        var message = i18n.get('You have successfully signed up!');\n        notification.success(message);\n\n        // force invokation of redirect\n        // as it sometimes won't change\n        $timeout(function(){\n          $state.go('frontend');\n        });\n      };\n\n      var failureCallback = function()\n      {\n        // @see: httpInterceptor\n      };\n\n      auth\n        .signup({\n          username: this.username,\n          password: this.code\n        }, 'frontend').then(\n          successCallback,\n          failureCallback\n        );\n    };\n\n  /**\n   * Persists code in storage and navigates to `step2` of signup.\n   *\n   * @public\n   * @method continue\n   * @return {Void}\n   */\n  LoginFrontend.prototype.next = function()\n    {\n      var CODE_STORAGE_KEY = this.$injector.get('CODE_STORAGE_KEY');\n      var storage = this.$injector.get('storage').getProxy();\n      var $state = this.$injector.get('$state');\n\n      storage.setItem(CODE_STORAGE_KEY, this.code);\n      $state.go('login.frontend.signup.step2', {}, {\n        // note: this is important to avoid usual\n        // redirection by refetching resolve data\n        // of `login.frontend` parent state\n        reload: true\n      });\n    };\n\n  angular.module(module).controller('LoginFrontendController', LoginFrontend);\n\n})(ANGULAR_MODULE, angular);\n\n/* global ANGULAR_MODULE, angular */\n(function(module, angular) {\n  'use strict';\n\n /**\n  * @constructor\n  */\n  var LoginBackend = function($scope, $injector) {\n    this.$injector = $injector;\n    this.$scope = $scope;\n  };\n\n  LoginBackend.$inject = ['$scope', '$injector'];\n\n  //\n  // PROPERTIES\n  //\n\n  /** @var {string} username Username for authentication. */\n  LoginBackend.prototype.username = null;\n\n  /** @var {string} workshop Password for authentication. */\n  LoginBackend.prototype.password = null;\n\n  /** @var {RegExp} usernameMinLength Minimum length of username. */\n  LoginBackend.prototype.usernameMinLength = 5;\n\n  /** @var {RegExp} passwordMinLength Minimum length of password. */\n  LoginBackend.prototype.passwordMinLength = 8;\n\n  /** @var {RegExp} passwordMaxLength Maximum length of password. */\n  LoginBackend.prototype.passwordMaxLength = 4096;\n\n  //\n  // METHODS\n  //\n\n  /**\n   * Signs an admin in with username and password.\n   *\n   * @public\n   * @method signin\n   * @return {Void}\n   */\n  LoginBackend.prototype.signin = function()\n    {\n      var notification = this.$injector.get('notification');\n      var $timeout = this.$injector.get('$timeout');\n      var $state = this.$injector.get('$state');\n      var auth = this.$injector.get('auth');\n      var i18n = this.$injector.get('i18n');\n\n      var form = this.$scope.loginForm;\n      if (form.$invalid) {\n        return;\n      }\n\n      var successCallback = function()\n      {\n        var message = i18n.get('You are logged in now!');\n        notification.success(message);\n\n        // force invokation of redirect\n        // as it sometimes won't change\n        $timeout(function(){\n          $state.go('backend');\n        });\n      };\n\n      var failureCallback = function()\n      {\n        // @see: httpInterceptor\n      };\n\n      auth.signin({\n        username: this.username,\n        password: this.password\n      }, 'backend').then(\n        successCallback,\n        failureCallback\n      );\n    };\n\n  angular.module(module).controller('LoginBackendController', LoginBackend);\n\n})(ANGULAR_MODULE, angular);\n\n/* global ANGULAR_MODULE, angular */\n(function(module, angular) {\n  'use strict';\n\n /**\n  * @constructor\n  */\n  var Contact = function($scope, $injector) {\n    this.$injector = $injector;\n    this.$scope = $scope;\n  };\n\n  Contact.$inject = ['$scope','$injector'];\n\n  //\n  // PROPERTIES\n  //\n\n  /** @var {string} name Name of contact. */\n  Contact.prototype.name = null;\n\n  /** @var {string} email Email of contact. */\n  Contact.prototype.email = null;\n\n  /** @var {string} subject Subject of contact. */\n  Contact.prototype.subject = null;\n\n  /** @var {string} message Message of contact. */\n  Contact.prototype.message = null;\n\n  /** @var {string} messageMinLength Message minmimum length. */\n  Contact.prototype.messageMinLength = 25;\n\n  //\n  // METHODS\n  //\n\n  /**\n   * Sends an email from contact form to admins.\n   *\n   * @public\n   * @method submit\n   * @return {Void}\n   */\n  Contact.prototype.submit = function()\n    {\n      var mail = this.$injector.get('mail');\n      var form = this.$scope.contactForm;\n      if (form.$invalid) {\n        return;\n      }\n\n      var me = this;\n\n      var successCallback = function()\n      {\n        me.reset();\n      };\n\n      var failureCallback = function()\n      {\n        // @see: httpInterceptor\n      };\n\n      mail.send({\n        name: this.name,\n        email: this.email,\n        subject: this.subject,\n        message: this.message\n      }).then(\n        successCallback,\n        failureCallback\n      );\n    };\n\n  /**\n   * Resets all form inputs to initial state.\n   *\n   * @public\n   * @method reset\n   * @return {Void}\n   */\n  Contact.prototype.reset = function()\n    {\n      this.name = null;\n      this.email = null;\n      this.subject = null;\n      this.message = null;\n    };\n\n  angular.module(module).controller('ContactController', Contact);\n\n})(ANGULAR_MODULE, angular);\n\n/* global ANGULAR_MODULE, angular */\n(function(module, angular) {\n  'use strict';\n\n /**\n  * @constructor\n  */\n  var Frontend = function($injector) {\n    this.$injector = $injector;\n\n    this.user = $injector.get('user');\n  };\n\n  Frontend.$inject = ['$injector'];\n\n  //\n  // PROPERTIES\n  //\n\n  /** @var {object} user User service object. */\n  Frontend.prototype.user = null;\n\n  /** @var {boolean} confirmLogout Flag for logout confirmation. */\n  Frontend.prototype.confirmLogout = false;\n\n  //\n  // METHODS\n  //\n\n  /**\n   * Creates a new result resource from task payload.\n   *\n   * @public\n   * @method createResult\n   * @param {object} payload\n   * @return {Void}\n   */\n  Frontend.prototype.createResult = function(payload)\n  {\n    var Result = this.$injector.get('Result');\n    var user = this.$injector.get('user');\n\n    var successCallback = function(result)\n      {\n        // update user object from response\n        // handling comparisons for `state`,\n        // `tickets` and showing messages\n        user.update(result);\n      };\n\n    var failureCallback = function()\n      {\n        // noop\n      };\n\n    var result = new Result(payload);\n    var promise = result.$create();\n    promise.then(\n      successCallback,\n      failureCallback\n    );\n\n    return promise;\n  };\n\n  /**\n   * Updates a new result resource from task `result`.\n   *\n   * @public\n   * @method updateResult\n   * @param {object} result\n   * @return {Void}\n   */\n  Frontend.prototype.updateResult = function(payload)\n  {\n    var Result = this.$injector.get('Result');\n    var user = this.$injector.get('user');\n\n    var successCallback = function(result)\n      {\n        // update user object from response\n        // handling comparisons for `state`,\n        // `tickets` and showing messages\n        user.update(result);\n      };\n\n    var failureCallback = function()\n      {\n        // noop\n      };\n\n    var promise = Result.update({ id: payload.id }, payload).$promise;\n    promise.then(\n      successCallback,\n      failureCallback\n    );\n\n    return promise;\n  };\n\n  /**\n   * Destroys user session and redirects to login.\n   *\n   * @public\n   * @method logout\n   * @return {Void}\n   */\n  Frontend.prototype.logout = function()\n    {\n      var $timeout = this.$injector.get('$timeout');\n      var $state = this.$injector.get('$state');\n      var auth = this.$injector.get('auth');\n      var isUser = this.user.isUser();\n\n      var successCallback = function()\n        {\n          // force invokation of redirect\n          // as it sometimes won't change\n          $timeout(function(){\n            if (isUser) {\n              $state.go('login.frontend');\n            } else {\n              $state.go('login.backend');\n            }\n          });\n        };\n\n      var failureCallback = function()\n        {\n\n        };\n\n      auth.signout().then(\n        successCallback,\n        failureCallback\n      );\n    };\n\n  /**\n   * Redirects router to state.\n   *\n   * @public\n   * @method goTo\n   * @param {string} state\n   * @return {Void}\n   */\n  Frontend.prototype.goTo = function(state)\n    {\n      var $state = this.$injector.get('$state');\n\n      $state.go(state);\n    };\n\n  /**\n   * Sets `confirmLogout` flag to true.\n   *\n   * @public\n   * @method markConfirmLogout\n   * @return {Void}\n   */\n  Frontend.prototype.markConfirmLogout = function()\n    {\n      this.confirmLogout = true;\n    };\n\n  angular.module(module).controller('FrontendController', Frontend);\n\n})(ANGULAR_MODULE, angular);\n\n/* global ANGULAR_MODULE, angular */\n(function(module, angular) {\n  'use strict';\n\n /**\n  * @constructor\n  */\n  var Workshop = function($scope, $injector, workshops) {\n    this.workshops = workshops;\n    this.$injector = $injector;\n    this.$scope = $scope;\n\n    this._resultsSource = null;\n    this._userSources = {};\n    this._workshops = {};\n    this._tasks = {};\n\n    this._initWorkshops();\n    this._initListener();\n  };\n\n  Workshop.$inject = ['$scope', '$injector', 'workshops'];\n\n  //\n  // PROPERTIES\n  //\n\n  /** @var {string} name Name of new workshop. */\n  Workshop.prototype.name = null;\n\n  /** @var {string} code Code of new workshop. */\n  Workshop.prototype.code = null;\n\n  /** @var {RegExp} nameMinLength Minimum length of workshop name. */\n  Workshop.prototype.nameMinLength = 8;\n\n  /** @var {RegExp} codeMinLength Minimum length of workshop code. */\n  Workshop.prototype.codeMinLength = 8;\n\n  /** @var {RegExp} userpattern Regular expression for `username` property. */\n  Workshop.prototype.codePattern = /^[A-Za-z0-9]+$/;\n\n  /** @var {object} deleteWorkshop Currently marked workshop for deletion. */\n  Workshop.prototype.deleteWorkshop = null;\n\n  /** @var {object} drawingWorkshop Currently marked workshop for drawing. */\n  Workshop.prototype.drawingWorkshop = null;\n\n  /** @var {array} drawingTickets Randomly picked tickets of drawing. */\n  Workshop.prototype.drawingTickets = null;\n\n  /** @var {array} drawingTicketsOne Randomized tickets for first run. */\n  Workshop.prototype.drawingTicketsOne = null;\n\n  /** @var {array} drawingTicketsTwo Randomized tickets for second run. */\n  Workshop.prototype.drawingTicketsTwo = null;\n\n  /** @var {array} drawingAmount Amount of chosen tickets for drawing. */\n  Workshop.prototype.drawingAmount = 2;\n\n  /** @var {array} chartResults Currently loaded results for chart. */\n  Workshop.prototype.chartResults = null;\n\n  /** @var {object} chartTask Currently selected task of results. */\n  Workshop.prototype.chartTask = null;\n\n  //\n  // METHODS\n  //\n\n  /**\n   * Toggles `$$expanded` flag on workshop depending on query params.\n   * https://ui-router.github.io/ng1/docs/latest/interfaces/ng1.ng1controller.html#uionparamschanged\n   *\n   * @public\n   * @method uiOnParamsChanged\n   * @param {object} params\n   * @return {void}\n   */\n  Workshop.prototype.uiOnParamsChanged = function(params)\n    {\n      var workshop = this._workshops[params.expand];\n\n\n      // close opened workshop before toggling\n      if (this._expanded) {\n        this._expanded.$$expanded = false;\n        this._expanded = null;\n      }\n\n      // expand the new workshop now\n      if (workshop) {\n        workshop.$$expanded = true;\n        this._expanded = workshop;\n      }\n    };\n\n  /**\n   * Creates a new workshop.\n   *\n   * @public\n   * @method create\n   * @return {void}\n   */\n  Workshop.prototype.create = function()\n    {\n      var notification = this.$injector.get('notification');\n      var Workshop = this.$injector.get('Workshop');\n      var i18n = this.$injector.get('i18n');\n\n      var workshop = new Workshop({\n        name: this.name,\n        code: this.code\n      });\n\n      var me = this;\n\n      var successCallback = function(workshop)\n        {\n          var message = i18n.get('Workshop has been created successfully!');\n          notification.success(message);\n\n          me.workshops.unshift(workshop);\n          me._initWorkshop(workshop);\n\n          me.name = null;\n          me.code = null;\n        };\n\n      var failureCallback = function()\n        {\n          // noop\n        };\n\n      workshop.$create().then(\n        successCallback,\n        failureCallback\n      );\n    };\n\n  /**\n   * Deletes a workshop after confirmation.\n   *\n   * @public\n   * @method delete\n   * @param {object} workshop\n   * @return {void}\n   */\n  Workshop.prototype.delete = function(workshop)\n    {\n      var notification = this.$injector.get('notification');\n      var i18n = this.$injector.get('i18n');\n\n      var me = this;\n\n      var successCallback = function()\n        {\n          var message = i18n.get('Workshop has been deleted successfully!');\n          notification.success(message);\n\n          var index = me.workshops.indexOf(workshop);\n          me.workshops.splice(index, 1);\n\n          me._removeUsersStream(workshop);\n        };\n\n      var failureCallback = function()\n        {\n          // noop\n        };\n\n      workshop.$delete().then(\n        successCallback,\n        failureCallback\n      );\n    };\n\n  /**\n   * Loads and randomizes workshop tickets and invokes modal dialog.\n   *\n   * @public\n   * @method markWorkshopForDrawing\n   * @param {object} workshop\n   * @return {void}\n   */\n  Workshop.prototype.markWorkshopForDrawing = function(workshop)\n    {\n      var Ticket = this.$injector.get('Ticket');\n      var random = this.$injector.get('random');\n\n      var me = this;\n\n      var successCallback = function(tickets)\n        {\n          me.drawingTickets = random.shuffle(tickets);\n\n          var ticketHash = {};\n\n          var rightSide = me.drawingTickets.map(\n            function(ticket) {\n              ticketHash[ticket.id] = ticket.username;\n\n              return ticket.id;\n            }\n          );\n          var halfSize = Math.ceil(tickets.length/2);\n          var leftSide = rightSide.splice(0, halfSize);\n\n          me.drawingTicketsOne = leftSide.concat(rightSide);\n          me.drawingTicketsTwo = rightSide.concat(leftSide);\n\n          var indexOne = me.drawingTicketsOne.length - 1;\n          var indexTwo = me.drawingTicketsTwo.length - 1;\n\n          var ticketOne = me.drawingTicketsOne[indexOne];\n          var ticketTwo = me.drawingTicketsTwo[indexTwo];\n\n          me.drawingUserOne = ticketHash[ticketOne];\n          me.drawingUserTwo = ticketHash[ticketTwo];\n\n          me.drawingWorkshop = workshop;\n        };\n\n      var failureCallback = function()\n        {\n        };\n\n      var resource = Ticket.getByWorkshop({ workshopId: workshop.id });\n      resource.$promise.then(\n        successCallback,\n        failureCallback\n      );\n    };\n\n  /**\n   * Sets `$$shuffleOne` and `$$shuffleTwo` flag for drawing workshop to kick off drawing directive.\n   *\n   * @public\n   * @method makeWorkshopDrawing\n   * @return {void}\n   */\n  Workshop.prototype.makeWorkshopDrawing = function() {\n    this.drawingWorkshop.$$shuffleOne = true;\n    this.drawingWorkshop.$$shuffleTwo = true;\n  };\n\n  /**\n   * Unsets drawing workshop flags to ensure clean state in next drawing (if any).\n   *\n   * @public\n   * @method resetWorkshopDrawing\n   * @return {void}\n   */\n  Workshop.prototype.resetWorkshopDrawing = function() {\n    this.drawingWorkshop.$$shuffleOne = null;\n    this.drawingWorkshop.$$shuffleTwo = null;\n    this.drawingWorkshop.$$finishedOne = null;\n    this.drawingWorkshop.$$finishedTwo = null;\n  };\n\n  /**\n   * Invokes confirmation modal for deleting a workshop.\n   *\n   * @public\n   * @method markWorkshopForDeletion\n   * @param {object} workshop\n   * @return {void}\n   */\n  Workshop.prototype.markWorkshopForDeletion = function(workshop)\n    {\n      this.deleteWorkshop = workshop;\n    };\n\n  /**\n   * Toggles `isActive` of a workshop.\n   *\n   * @public\n   * @method toggleWorkshop\n   * @param {object} workshop\n   * @return {void}\n   */\n  Workshop.prototype.toggleWorkshop = function(workshop)\n    {\n      var notification = this.$injector.get('notification');\n      var i18n = this.$injector.get('i18n');\n\n      var me = this;\n\n      var successCallback = function(workshop)\n        {\n          var message = i18n.get(\n            workshop.isActive ?\n              'Workshop has been unlocked successfully. Students can register now!' :\n              'Workshop has been locked successfully. Students can now only use their access from home!'\n          );\n          notification.success(message);\n\n          me._initWorkshop(workshop);\n        };\n\n      var failureCallback = function()\n        {\n          // revert the change on failed update!\n          workshop.isActive = !workshop.isActive;\n        };\n\n      workshop.isActive = !workshop.isActive;\n\n      workshop.$update().then(\n        successCallback,\n        failureCallback\n      );\n    };\n\n  /**\n   * Toggles `$$showCode` of a workshop.\n   *\n   * @public\n   * @method toggleCode\n   * @param {object} workshop\n   * @return {void}\n   */\n  Workshop.prototype.toggleCode = function(workshop)\n    {\n      workshop.$$code = !workshop.$$code;\n    };\n\n  /**\n   * Loads task's results and invokes modal dialog.\n   *\n   * @public\n   * @method markTaskForChart\n   * @param {object} task\n   * @return {void}\n   */\n  Workshop.prototype.markTaskForChart = function(task)\n    {\n      var Result = this.$injector.get('Result');\n\n      var me = this;\n      var successCallback = function(results)\n        {\n          me.chartResults = results;\n          me.chartTask = task;\n        };\n\n      var failureCallback = function()\n        {\n        };\n\n      var resource = Result.getByTask({ taskId: task.id });\n      resource.$promise.then(\n        successCallback,\n        failureCallback\n      );\n    };\n\n  /**\n   * Toggles `isActive` of a task.\n   *\n   * @public\n   * @method toggleTask\n   * @param {object} task\n   * @return {void}\n   */\n  Workshop.prototype.toggleTask = function(task)\n    {\n      var notification = this.$injector.get('notification');\n      var i18n = this.$injector.get('i18n');\n      var Task = this.$injector.get('Task');\n\n      var successCallback = function(/*workshop*/)\n        {\n          var message = i18n.get(\n            task.isActive ?\n              'Task has been unlocked successfully. Students can send results now!' :\n              'Task has been locked successfully. Students cannot send results currently!'\n          );\n          notification.success(message);\n        };\n\n      var failureCallback = function()\n        {\n          // revert the change on failed update!\n          task.isActive = !task.isActive;\n        };\n\n      task.isActive = !task.isActive;\n\n      var resource = Task.update({ id: task.id}, task);\n      resource.$promise.then(\n        successCallback,\n        failureCallback\n      );\n    };\n\n  /**\n   * Sets `expand` query parameter dependending on\n   * workshop's current `$$expanded` flag info.\n   *\n   * @public\n   * @method expand\n   * @param {object} workshop\n   * @return {void}\n   */\n  Workshop.prototype.expand = function(workshop)\n    {\n      var $state = this.$injector.get('$state');\n      var expand = !workshop.$$expanded ?\n        workshop.id : \n        null;\n\n      $state.go('backend.workshops', {\n        expand: expand\n      });\n    };\n\n  /**\n   * Sets up an event source for streaming user count.\n   *\n   * @private\n   * @method _addUsersStream\n   * @param {object} workshop\n   * @return {void}\n   */\n  Workshop.prototype._addUsersStream = function(workshop)\n    {\n      var API_URL = this.$injector.get('API_URL');\n      var sse = this.$injector.get('sse');\n\n      var me = this;\n\n      var _onMessage = function(data) {\n        me.$scope.$evalAsync(function(){\n          workshop.$$users = data;\n        });\n      };\n\n      var url = API_URL + '/sse/workshop/' + workshop.id + '/users';\n      var options = { onMessage: _onMessage, sleep: 10 };\n      var source = sse.addSource(url, options);\n      this._userSources[workshop.id] = source;\n    };\n\n  /**\n   * Removes an event source from internal stack and service.\n   *\n   * @private\n   * @method _removeUsersStream\n   * @param {object} workshop\n   * @return {void}\n   */\n  Workshop.prototype._removeUsersStream = function(workshop)\n    {\n      var sse = this.$injector.get('sse');\n\n      var source = this._userSources[workshop.id];\n      if (!source) {\n        return;\n      }\n\n      delete this._userSources[workshop.id];\n      sse.removeSource(source);\n    };\n\n  /**\n   * Sets up event sources for updating result counters.\n   *\n   * @private\n   * @method _streamResults\n   * @return {void}\n   */\n  Workshop.prototype._streamResults = function()\n    {\n      var API_URL = this.$injector.get('API_URL');\n      var sse = this.$injector.get('sse');\n\n      var me = this;\n\n      // --- SSE ---\n      var _onMessage = function(workshop, data) {\n        me.$scope.$evalAsync(function(){\n          // remove event source if workshop is not\n          // active at the moment === one-shot only\n          if (!workshop.isActive) {\n            sse.removeSource(me._resultsSource);\n          }\n\n          angular.forEach(data, function(item){\n            var task = me._tasks[item.id];\n            task.$$results = item.results;\n          });\n        });\n      };\n\n      var _watchExpression = function() {\n        // workshop must be opened, but we also need\n        // to watch `isActive` state to catch toggle\n        // from property to reinitialize event source\n        return me._expanded && me._expanded.isActive;\n      };\n\n      var _watchCallback = function() {\n        if (me._resultsSource) {\n          sse.removeSource(me._resultsSource);\n        }\n\n        if (me._expanded) {\n          var url = API_URL + '/sse/workshop/' + me._expanded.id + '/results';\n          var onMessage = _onMessage.bind(me, me._expanded);\n          var options = { onMessage: onMessage, sleep: 5 };\n          me._resultsSource = sse.addSource(url, options);\n        }\n      };\n\n      this._unwatch = this.$scope.$watch(\n        _watchExpression,\n        _watchCallback\n      );\n    };\n\n  /**\n   * Maps all workshops to hash maps, sets up streaming and query params.\n   *\n   * @private\n   * @method _initWorkshops\n   * @return {void}\n   */\n  Workshop.prototype._initWorkshops = function()\n    {\n      var $uiRouterGlobals = this.$injector.get('$uiRouterGlobals');\n\n      // create hash maps for workshops and tasks for ease lookups\n      angular.forEach(this.workshops, this._initWorkshop.bind(this));\n\n      // now make the initial call to change handler\n      this.uiOnParamsChanged($uiRouterGlobals.params);\n\n      // kick off general streaming of task results\n      this._streamResults();\n    };\n\n  /**\n   * Adds workshop and tasks to hash map and initializes\n   * streaming for workshop depending on `isActive` flag.\n   *\n   * @private\n   * @method _initWorkshop\n   * @param {object} workshop\n   * @return {void}\n   */\n  Workshop.prototype._initWorkshop = function(workshop)\n    {\n      // map all `tasks` to internal hash and set `$$results`\n      var me = this;\n      angular.forEach(workshop.tasks, function(task){\n        var old = me._tasks[task.id] || null;\n        task.$$results = old !== null ?\n          old.$$results\n          : 0;\n\n        me._tasks[task.id] = task;\n      });\n\n      // initialize `$$code` flag for this workshop\n      workshop.$$code = false;\n\n      // check `$$expanded` flag for this workshop\n      var id = this._expanded && this._expanded.id;\n      workshop.$$expanded = workshop.id === id;\n\n      // initialize `$$users` and set up streaming\n      workshop.$$users = workshop.users.length;\n\n      if (!workshop.isActive) {\n        this._removeUsersStream(workshop);\n      } else {\n        this._addUsersStream(workshop);\n      }\n\n      this._workshops[workshop.id] = workshop;\n    };\n\n  /**\n   * Removes all watches, listeners and sources\n   * as soon as controller's $scope is destroyed.\n   *\n   * @private\n   * @method _initListener\n   * @return {void}\n   */\n  Workshop.prototype._initListener = function()\n    {\n      var sse = this.$injector.get('sse');\n\n      var me = this;\n\n      var _onDestroy = function() {\n        for (var id in me._userSources) {\n          sse.removeSource(me._userSources[id]);\n        }\n\n        if (me._resultsSource) {\n          sse.removeSource(me._resultsSource);\n        }\n\n        me._resultsSource = null;\n        me._userSources = {};\n\n        me._unlisten();\n        me._unwatch();\n      };\n\n      this._unlisten = this.$scope.$on('$destroy', _onDestroy);\n    };\n\n\n  angular.module(module).controller('WorkshopController', Workshop);\n\n})(ANGULAR_MODULE, angular);\n\n/* global ANGULAR_MODULE, angular */\n(function(module, angular) {\n  'use strict';\n\n /**\n  * @constructor\n  */\n  var Admin = function($scope, $injector, admins) {\n    this.admins = admins;\n    this.$injector = $injector;\n    this.$scope = $scope;\n  };\n\n  Admin.$inject = ['$scope', '$injector', 'admins'];\n\n  //\n  // PROPERTIES\n  //\n\n  /** @var {string} name Name of new workshop. */\n  Admin.prototype.username = null;\n\n  /** @var {string} code Code of new workshop. */\n  Admin.prototype.password = null;\n\n  /** @var {RegExp} usernameMinLength Minimum length of workshop name. */\n  Admin.prototype.usernameMinLength = 5;\n\n  /** @var {RegExp} passwordMinLength Minimum length of workshop code. */\n  Admin.prototype.passwordMinLength = 8;\n\n  /** @var {object} editAdmin Currently marked workshop for editing. */\n  Admin.prototype.editAdmin = null;\n\n  /** @var {object} deleteAdmin Currently marked workshop for deletion. */\n  Admin.prototype.deleteAdmin = null;\n\n  //\n  // METHODS\n  //\n\n  /**\n   * Creates a new admin.\n   *\n   * @public\n   * @method create\n   * @return {void}\n   */\n  Admin.prototype.create = function()\n    {\n      var notification = this.$injector.get('notification');\n      var Admin = this.$injector.get('Admin');\n      var i18n = this.$injector.get('i18n');\n\n      var admin = new Admin({\n        username: this.username,\n        password: this.password\n      });\n\n      var me = this;\n\n      var successCallback = function(admin)\n        {\n          var message = i18n.get('Admin has been created successfully!');\n          notification.success(message);\n\n          me.admins.unshift(admin);\n\n          me.username = null;\n          me.password = null;\n        };\n\n      var failureCallback = function()\n        {\n          // noop\n        };\n\n      admin.$create().then(\n        successCallback,\n        failureCallback\n      );\n    };\n\n  /**\n   * Invokes confirmation modal for deleting a admin.\n   *\n   * @public\n   * @method markAdminForDeletion\n   * @param {object} admin\n   * @return {void}\n   */\n  Admin.prototype.markAdminForDeletion = function(admin)\n    {\n      this.deleteAdmin = admin;\n    };\n\n  /**\n   * Deletes a admin after confirmation.\n   *\n   * @public\n   * @method delete\n   * @param {object} admin\n   * @return {void}\n   */\n  Admin.prototype.delete = function(admin)\n    {\n      var notification = this.$injector.get('notification');\n      var i18n = this.$injector.get('i18n');\n\n      var me = this;\n\n      var successCallback = function()\n        {\n          var message = i18n.get('Admin has been deleted successfully!');\n          notification.success(message);\n\n          var index = me.admins.indexOf(admin);\n          me.admins.splice(index, 1);\n        };\n\n      var failureCallback = function()\n        {\n          // noop\n        };\n\n      admin.$delete().then(\n        successCallback,\n        failureCallback\n      );\n    };\n\n  /**\n   * Invokes confirmation modal for editing a admin.\n   *\n   * @public\n   * @method markAdminForEdit\n   * @param {object} admin\n   * @return {void}\n   */\n  Admin.prototype.markAdminForEdit = function(admin)\n    {\n      this.editAdmin = admin;\n    };\n\n  /**\n   * Updates a admin after confirmation.\n   *\n   * @public\n   * @method update\n   * @param {object} admin\n   * @return {void}\n   */\n  Admin.prototype.update = function(admin)\n    {\n      var notification = this.$injector.get('notification');\n      var i18n = this.$injector.get('i18n');\n\n      var successCallback = function()\n        {\n          var message = i18n.get('Password has been successfully updated!');\n          notification.success(message);\n        };\n\n      var failureCallback = function()\n        {\n          // noop\n        };\n\n      admin.$update().then(\n        successCallback,\n        failureCallback\n      );\n    };\n\n  angular.module(module).controller('AdminController', Admin);\n\n})(ANGULAR_MODULE, angular);\n\n/* global ANGULAR_MODULE, angular */\n(function(module, angular) {\n  'use strict';\n\n /**\n  * @constructor\n  */\n  var Backend = function($injector, isSuperAdmin) {\n    this.$injector = $injector;\n\n    this.isSuperAdmin = isSuperAdmin;\n  };\n\n  Backend.$inject = ['$injector', 'isSuperAdmin'];\n\n  //\n  // PROPERTIES\n  //\n\n  /** @var {boolean} isSuperAdmin If user is super admin. */\n  Backend.prototype.isSuperAdmin = false;\n\n  /** @var {boolean} confirmLogout Flag for logout confirmation. */\n  Backend.prototype.confirmLogout = false;\n\n  //\n  // METHODS\n  //\n\n  /**\n   * Destroys user session and redirects to login.\n   *\n   * @public\n   * @method logout\n   * @return {Void}\n   */\n  Backend.prototype.logout = function()\n    {\n      var $timeout = this.$injector.get('$timeout');\n      var $state = this.$injector.get('$state');\n      var auth = this.$injector.get('auth');\n\n      var successCallback = function()\n        {\n          // force invokation of redirect\n          // as it sometimes won't change\n          $timeout(function(){\n            $state.go('login.backend');\n          });\n        };\n\n      var failureCallback = function()\n        {\n\n        };\n\n      auth.signout().then(\n        successCallback,\n        failureCallback\n      );\n    };\n\n  /**\n   * Redirects router to state.\n   *\n   * @public\n   * @method goTo\n   * @param {string} state\n   * @return {Void}\n   */\n  Backend.prototype.goTo = function(state)\n    {\n      var $state = this.$injector.get('$state');\n\n      $state.go(state);\n    };\n\n  /**\n   * Sets `confirmLogout` flag to true.\n   *\n   * @public\n   * @method markConfirmLogout\n   * @return {Void}\n   */\n  Backend.prototype.markConfirmLogout = function()\n    {\n      this.confirmLogout = true;\n    };\n\n  angular.module(module).controller('BackendController', Backend);\n\n})(ANGULAR_MODULE, angular);\n\n/* global ANGULAR_MODULE, angular */\n(function(module, angular) {\n  'use strict';\n\n  //\n  // FACTORY\n  //\n\n  /**\n   * @constructor\n   */\n  var Factory = function($resource, API_URL) {\n    var url = API_URL + '/workshop/:id';\n    var paramDefaults = { id: '@id' };\n    var actions = {\n      validateWorkshopBackend: {\n        method: 'GET',\n        skipGlobalErrorMessage: true,\n        url: API_URL + '/workshop/code/:code'\n      },\n      validateUsernameFrontend: {\n        method: 'GET',\n        skipGlobalErrorMessage: true,\n        url: API_URL + '/auth/validate/username/:username'\n      },\n      validateWorkshopFrontend: {\n        method: 'GET',\n        skipGlobalErrorMessage: true,\n        url: API_URL + '/auth/validate/workshop/:code'\n      }\n    };\n    var options = {\n\n    };\n\n    return $resource(url, paramDefaults, actions, options);\n  };\n\n  Factory.$inject = ['$resource', 'API_URL'];\n\n  //\n  // REGISTRY\n  //\n  angular.module(module).factory('Workshop', Factory);\n\n})(ANGULAR_MODULE, angular);\n\n/* global ANGULAR_MODULE, angular */\n(function(module, angular) {\n  'use strict';\n\n  //\n  // FACTORY\n  //\n\n  /**\n   * @constructor\n   */\n  var Factory = function($resource, API_URL) {\n    var url = API_URL + '/ticket/:id';\n    var paramDefaults = { id: '@id' };\n    var actions = {\n      getByWorkshop: {\n        method: 'GET',\n        isArray: true,\n        url: API_URL + '/ticket/workshop/:workshopId'\n      }\n    };\n    var options = {\n    };\n\n    return $resource(url, paramDefaults, actions, options);\n  };\n\n  Factory.$inject = ['$resource', 'API_URL'];\n\n  //\n  // REGISTRY\n  //\n  angular.module(module).factory('Ticket', Factory);\n\n})(ANGULAR_MODULE, angular);\n\n/* global ANGULAR_MODULE, angular */\n(function(module, angular) {\n  'use strict';\n\n  //\n  // FACTORY\n  //\n\n  /**\n   * @constructor\n   */\n  var Factory = function($resource, $injector, API_URL) {\n    var url = API_URL + '/result/:id';\n    var paramDefaults = { id: '@id' };\n    var actions = {\n      getByTask: {\n        method: 'GET',\n        isArray: true,\n        url: API_URL + '/result/task/:taskId'\n      }\n    };\n    var options = {\n    };\n\n    return $resource(url, paramDefaults, actions, options);\n  };\n\n  Factory.$inject = ['$resource', '$injector', 'API_URL'];\n\n  //\n  // REGISTRY\n  //\n  angular.module(module).factory('Result', Factory);\n\n})(ANGULAR_MODULE, angular);\n\n/* global ANGULAR_MODULE, angular */\n(function(module, angular) {\n  'use strict';\n\n  //\n  // FACTORY\n  //\n\n  /**\n   * @constructor\n   */\n  var Factory = function($resource, API_URL) {\n    var url = API_URL + '/admin/:id';\n    var paramDefaults = { id: '@id' };\n    var actions = {\n      validateAdmin: {\n        method: 'GET',\n        skipGlobalErrorMessage: true,\n        url: API_URL + '/admin/username/:username'\n      }\n    };\n    var options = {\n\n    };\n\n    return $resource(url, paramDefaults, actions, options);\n  };\n\n  Factory.$inject = ['$resource', 'API_URL'];\n\n  //\n  // REGISTRY\n  //\n  angular.module(module).factory('Admin', Factory);\n\n})(ANGULAR_MODULE, angular);\n\n/* global ANGULAR_MODULE, angular */\n(function(module, angular) {\n  'use strict';\n\n  //\n  // FACTORY\n  //\n\n  /**\n   * @constructor\n   */\n  var Factory = function($resource, API_URL) {\n    var url = API_URL + '/task/:id';\n    var paramDefaults = { id: '@id' };\n    var actions = {\n    };\n    var options = {\n    };\n\n    return $resource(url, paramDefaults, actions, options);\n  };\n\n  Factory.$inject = ['$resource', 'API_URL'];\n\n  //\n  // REGISTRY\n  //\n  angular.module(module).factory('Task', Factory);\n\n})(ANGULAR_MODULE, angular);\n\n/* global ANGULAR_MODULE, angular */\n(function(module, angular) {\n  'use strict';\n\n  //\n  // FACTORY\n  //\n\n  /**\n   * @constructor\n   */\n  var Factory = function($resource, API_URL) {\n    var url = API_URL + '/user/:id';\n    var paramDefaults = { id: '@id' };\n    var actions = {\n      current: {\n        method: 'GET',\n        skipGlobalErrorMessage: true,\n        url: API_URL + '/user/current'\n      }\n    };\n    var options = {\n\n    };\n\n    return $resource(url, paramDefaults, actions, options);\n  };\n\n  Factory.$inject = ['$resource', 'API_URL'];\n\n  //\n  // REGISTRY\n  //\n  angular.module(module).factory('User', Factory);\n\n})(ANGULAR_MODULE, angular);\n\n/* global ANGULAR_MODULE, angular */\n(function(module, angular) {\n  'use strict';\n\n  // --------------------------------------------------\n  // i18n\n  // --------------------------------------------------\n  angular.module(module).filter('i18n',['i18n',function(i18n){\n    var filter = function()\n      {\n        return i18n.get.apply(i18n, arguments);\n      };\n\n    filter.$stateful = true;\n\n    return filter;\n  }]);\n\n  // --------------------------------------------------\n  // Percentage\n  // --------------------------------------------------\n  angular.module(module).filter('percent', function(){\n    return function(value, fraction) {\n      fraction = isNaN(fraction) ? 0 : fraction;\n      value = isNaN(value) ? 0 : value * 100;\n\n      return value.toFixed(fraction) + '%';\n    };\n  });\n\n  // --------------------------------------------------\n  // Coin\n  // --------------------------------------------------\n  angular.module(module).filter('coin', function(){\n    return function(value) {\n\n      if (value >= 1) {\n        return value + '&#8364;';\n      }\n\n      return (value*100) + '&#162;';\n    };\n  });\n\n  // --------------------------------------------------\n  // Note\n  // --------------------------------------------------\n  angular.module(module).filter('note', function(){\n    return function(value) {\n      return value + '&#8364;';\n    };\n  });\n\n})(ANGULAR_MODULE, angular);\n\n/* globals UIkit */\n(function() {\n  'use strict';\n\n  UIkit.component('off-canvas-scroll', {\n\n    defaults: {\n      offset: 0,\n      target: '',\n      duration: 1000,\n      transition: 'easeOutExpo'\n    },\n\n    props: {\n      target: String,\n      offset: Number,\n      duration: Number,\n      transition: String\n    },\n\n    computed: {\n        offcanvas: function() {\n          return UIkit.offcanvas(this.target);\n        },\n\n        $offcanvas: function() {\n          return this.offcanvas && this.offcanvas.$el;\n        }\n    },\n\n    init: function() {\n      if (!this.target) {\n        console.error('off-canvas-scroll: Required \"target\" option is not set.');\n        return;\n      }\n\n      if (!this.offcanvas) {\n        console.error('off-canvas-scroll: No offcanvas component found with id: ' + this.target);\n        return;\n      }\n    },\n\n    events: {\n      click: function(event, data) {\n        if (data && data.scroll) {\n          return;\n        }\n\n        this.offcanvas.hide();\n        this.$offcanvas.on('hidden', this._onHidden);\n      }\n    },\n\n    methods: {\n\n      _onHidden: function() {\n        this.$offcanvas.off('hidden', this._onHidden);\n\n        this._dummyScroll = UIkit.scroll(this.$el, {\n          transition: this.transition,\n          duration: this.duration,\n          offset: this.offset\n        });\n\n        this.$el.on('scrolled', this._onScrolled);\n        this.$el.trigger('click', { scroll: true });\n      },\n\n      _onScrolled: function() {\n        this.$el.off('scrolled', this._onScrolled);\n        this._dummyScroll.$destroy();\n      }\n    }\n  });\n\n})();\n"]}