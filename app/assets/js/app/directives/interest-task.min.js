/*!
 * eFit Website
 * An app for financial training in educational environments
 * http://www.e-fit.com
 * @author Armin Pfurtscheller
 * @version 1.0.0
 * Copyright 2017. MIT licensed.
 */
/* global ANGULAR_MODULE, angular */
(function(module, angular) {
  'use strict';

  // --------------------------------------------------
  // InterestTask
  // --------------------------------------------------

  // controller
  var InterestTask = function($scope,$element,$attrs) {
    this.$element = $element;
    this.$scope = $scope;
    this.$attrs = $attrs;

    this.amount = 1000;
    this.rate = 0.02;
    this.years = 1;
  };

  InterestTask.$inject = ['$scope','$element','$attrs'];

  InterestTask.prototype.$onInit = function() {
    this.init();
  };

  InterestTask.prototype.init = function() {
    this.resolved = false;
    this.correctAnswers = 0;
    this.exercise1Answer = 0;
    this.exercise2Answer = 0;
    this.exercise1Correct = false;
    this.exercise2Correct = false;
    this.exercise1Result = this._getResult(1);
    this.exercise2Result = this._getResult(1 + this.years);
  };

  InterestTask.prototype.reset = function(){
    this.init();
  };

  InterestTask.prototype.update = function(value, exercise){
    switch(exercise) {
      case 'exercise1':
        this.exercise1Answer = value;
        break;
      case 'exercise2':
        this.exercise2Answer = value;
        break;
      default:
    }

    this.exercise1Correct = this.exercise1Answer === this.exercise1Result;
    this.exercise2Correct = this.exercise2Answer === this.exercise2Result;

    if (this.exercise1Correct && this.exercise2Correct) {
      this.correctAnswers = 2;
    } else if (this.exercise1Correct) {
      this.correctAnswers = 1;
    } else if (this.exercise2Correct) {
      this.correctAnswers = 1;
    } else {
      this.correctAnswers = 0;
    }
  };

  InterestTask.prototype.resolve = function(){
    this.resolved = true;
    this.onResolve();
  };

  InterestTask.prototype._getResult = function(years) {
    return this.amount * Math.pow(1 + this.rate, years || 1);
  };

  // registry
  angular.module(module).directive('interestTask', function(){
    return {
      scope: {
        rate: '=?interestTaskRate',
        years: '=?interestTaskYears',
        amount: '=?interestTaskAmount',
        onResolve: '&interestTaskOnResolve'
      },
      restrict: 'A',
      transclude: true,
      controller: InterestTask,
      bindToController: true,
      controllerAs: 'interestTaskController',
      templateUrl: 'views/directives/interest-task.html'
    };
  });

  // --------------------------------------------------
  // InterestTask Exercise
  // --------------------------------------------------

  // controller
  var InterestTaskExercise = function($scope,$element,$attrs) {
    this.$element = $element;
    this.$scope = $scope;
    this.$attrs = $attrs;

    this.disabled = false;
    this.stack = [];
    this.sum = 0;

    var me = this;
    this.$scope.$watch(
      function(){Â return me.sum; },
      function(sum) {
        if (!sum) {
          me.sum = 0;
          me.stack = [];
        }
      }
    );
  };

  InterestTaskExercise.$inject = ['$scope','$element','$attrs'];
  InterestTaskExercise.prototype.notes = [500,200,100,50,20,10,5];
  InterestTaskExercise.prototype.coins = [2,1,0.5,0.2,0.1,0.05,0.02,0.01];

  InterestTaskExercise.prototype.onDrop = function(value){
    this.stack.push(value);
    this.sum += value;

    this.onUpdate({
      sum: this.sum
    });
  };

  InterestTaskExercise.prototype.revert = function() {
    this.sum -= this.stack.pop();

    this.onUpdate({
      sum: this.sum
    });
  };

  // registry
  angular.module(module).directive('interestTaskExercise', function(){
    return {
      scope: {
        sum: '=?interestTaskExerciseSum',
        onUpdate: '&interestTaskExerciseOnUpdate',
        disabled: '=?interestTaskExerciseDisabled'
      },
      restrict: 'A',
      transclude: true,
      controller: InterestTaskExercise,
      bindToController: true,
      controllerAs: 'interestTaskExerciseController',
      templateUrl: 'views/directives/interest-task-exercise.html'
    };
  });




})(ANGULAR_MODULE, angular);

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC9kaXJlY3RpdmVzL2ludGVyZXN0LXRhc2suanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImFwcC9kaXJlY3RpdmVzL2ludGVyZXN0LXRhc2subWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyogZ2xvYmFsIEFOR1VMQVJfTU9EVUxFLCBhbmd1bGFyICovXG4oZnVuY3Rpb24obW9kdWxlLCBhbmd1bGFyKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvLyBJbnRlcmVzdFRhc2tcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuICAvLyBjb250cm9sbGVyXG4gIHZhciBJbnRlcmVzdFRhc2sgPSBmdW5jdGlvbigkc2NvcGUsJGVsZW1lbnQsJGF0dHJzKSB7XG4gICAgdGhpcy4kZWxlbWVudCA9ICRlbGVtZW50O1xuICAgIHRoaXMuJHNjb3BlID0gJHNjb3BlO1xuICAgIHRoaXMuJGF0dHJzID0gJGF0dHJzO1xuXG4gICAgdGhpcy5hbW91bnQgPSAxMDAwO1xuICAgIHRoaXMucmF0ZSA9IDAuMDI7XG4gICAgdGhpcy55ZWFycyA9IDE7XG4gIH07XG5cbiAgSW50ZXJlc3RUYXNrLiRpbmplY3QgPSBbJyRzY29wZScsJyRlbGVtZW50JywnJGF0dHJzJ107XG5cbiAgSW50ZXJlc3RUYXNrLnByb3RvdHlwZS4kb25Jbml0ID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5pbml0KCk7XG4gIH07XG5cbiAgSW50ZXJlc3RUYXNrLnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5yZXNvbHZlZCA9IGZhbHNlO1xuICAgIHRoaXMuY29ycmVjdEFuc3dlcnMgPSAwO1xuICAgIHRoaXMuZXhlcmNpc2UxQW5zd2VyID0gMDtcbiAgICB0aGlzLmV4ZXJjaXNlMkFuc3dlciA9IDA7XG4gICAgdGhpcy5leGVyY2lzZTFDb3JyZWN0ID0gZmFsc2U7XG4gICAgdGhpcy5leGVyY2lzZTJDb3JyZWN0ID0gZmFsc2U7XG4gICAgdGhpcy5leGVyY2lzZTFSZXN1bHQgPSB0aGlzLl9nZXRSZXN1bHQoMSk7XG4gICAgdGhpcy5leGVyY2lzZTJSZXN1bHQgPSB0aGlzLl9nZXRSZXN1bHQoMSArIHRoaXMueWVhcnMpO1xuICB9O1xuXG4gIEludGVyZXN0VGFzay5wcm90b3R5cGUucmVzZXQgPSBmdW5jdGlvbigpe1xuICAgIHRoaXMuaW5pdCgpO1xuICB9O1xuXG4gIEludGVyZXN0VGFzay5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24odmFsdWUsIGV4ZXJjaXNlKXtcbiAgICBzd2l0Y2goZXhlcmNpc2UpIHtcbiAgICAgIGNhc2UgJ2V4ZXJjaXNlMSc6XG4gICAgICAgIHRoaXMuZXhlcmNpc2UxQW5zd2VyID0gdmFsdWU7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnZXhlcmNpc2UyJzpcbiAgICAgICAgdGhpcy5leGVyY2lzZTJBbnN3ZXIgPSB2YWx1ZTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgIH1cblxuICAgIHRoaXMuZXhlcmNpc2UxQ29ycmVjdCA9IHRoaXMuZXhlcmNpc2UxQW5zd2VyID09PSB0aGlzLmV4ZXJjaXNlMVJlc3VsdDtcbiAgICB0aGlzLmV4ZXJjaXNlMkNvcnJlY3QgPSB0aGlzLmV4ZXJjaXNlMkFuc3dlciA9PT0gdGhpcy5leGVyY2lzZTJSZXN1bHQ7XG5cbiAgICBpZiAodGhpcy5leGVyY2lzZTFDb3JyZWN0ICYmIHRoaXMuZXhlcmNpc2UyQ29ycmVjdCkge1xuICAgICAgdGhpcy5jb3JyZWN0QW5zd2VycyA9IDI7XG4gICAgfSBlbHNlIGlmICh0aGlzLmV4ZXJjaXNlMUNvcnJlY3QpIHtcbiAgICAgIHRoaXMuY29ycmVjdEFuc3dlcnMgPSAxO1xuICAgIH0gZWxzZSBpZiAodGhpcy5leGVyY2lzZTJDb3JyZWN0KSB7XG4gICAgICB0aGlzLmNvcnJlY3RBbnN3ZXJzID0gMTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5jb3JyZWN0QW5zd2VycyA9IDA7XG4gICAgfVxuICB9O1xuXG4gIEludGVyZXN0VGFzay5wcm90b3R5cGUucmVzb2x2ZSA9IGZ1bmN0aW9uKCl7XG4gICAgdGhpcy5yZXNvbHZlZCA9IHRydWU7XG4gICAgdGhpcy5vblJlc29sdmUoKTtcbiAgfTtcblxuICBJbnRlcmVzdFRhc2sucHJvdG90eXBlLl9nZXRSZXN1bHQgPSBmdW5jdGlvbih5ZWFycykge1xuICAgIHJldHVybiB0aGlzLmFtb3VudCAqIE1hdGgucG93KDEgKyB0aGlzLnJhdGUsIHllYXJzIHx8IDEpO1xuICB9O1xuXG4gIC8vIHJlZ2lzdHJ5XG4gIGFuZ3VsYXIubW9kdWxlKG1vZHVsZSkuZGlyZWN0aXZlKCdpbnRlcmVzdFRhc2snLCBmdW5jdGlvbigpe1xuICAgIHJldHVybiB7XG4gICAgICBzY29wZToge1xuICAgICAgICByYXRlOiAnPT9pbnRlcmVzdFRhc2tSYXRlJyxcbiAgICAgICAgeWVhcnM6ICc9P2ludGVyZXN0VGFza1llYXJzJyxcbiAgICAgICAgYW1vdW50OiAnPT9pbnRlcmVzdFRhc2tBbW91bnQnLFxuICAgICAgICBvblJlc29sdmU6ICcmaW50ZXJlc3RUYXNrT25SZXNvbHZlJ1xuICAgICAgfSxcbiAgICAgIHJlc3RyaWN0OiAnQScsXG4gICAgICB0cmFuc2NsdWRlOiB0cnVlLFxuICAgICAgY29udHJvbGxlcjogSW50ZXJlc3RUYXNrLFxuICAgICAgYmluZFRvQ29udHJvbGxlcjogdHJ1ZSxcbiAgICAgIGNvbnRyb2xsZXJBczogJ2ludGVyZXN0VGFza0NvbnRyb2xsZXInLFxuICAgICAgdGVtcGxhdGVVcmw6ICd2aWV3cy9kaXJlY3RpdmVzL2ludGVyZXN0LXRhc2suaHRtbCdcbiAgICB9O1xuICB9KTtcblxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvLyBJbnRlcmVzdFRhc2sgRXhlcmNpc2VcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuICAvLyBjb250cm9sbGVyXG4gIHZhciBJbnRlcmVzdFRhc2tFeGVyY2lzZSA9IGZ1bmN0aW9uKCRzY29wZSwkZWxlbWVudCwkYXR0cnMpIHtcbiAgICB0aGlzLiRlbGVtZW50ID0gJGVsZW1lbnQ7XG4gICAgdGhpcy4kc2NvcGUgPSAkc2NvcGU7XG4gICAgdGhpcy4kYXR0cnMgPSAkYXR0cnM7XG5cbiAgICB0aGlzLmRpc2FibGVkID0gZmFsc2U7XG4gICAgdGhpcy5zdGFjayA9IFtdO1xuICAgIHRoaXMuc3VtID0gMDtcblxuICAgIHZhciBtZSA9IHRoaXM7XG4gICAgdGhpcy4kc2NvcGUuJHdhdGNoKFxuICAgICAgZnVuY3Rpb24oKXvCoHJldHVybiBtZS5zdW07IH0sXG4gICAgICBmdW5jdGlvbihzdW0pIHtcbiAgICAgICAgaWYgKCFzdW0pIHtcbiAgICAgICAgICBtZS5zdW0gPSAwO1xuICAgICAgICAgIG1lLnN0YWNrID0gW107XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICApO1xuICB9O1xuXG4gIEludGVyZXN0VGFza0V4ZXJjaXNlLiRpbmplY3QgPSBbJyRzY29wZScsJyRlbGVtZW50JywnJGF0dHJzJ107XG4gIEludGVyZXN0VGFza0V4ZXJjaXNlLnByb3RvdHlwZS5ub3RlcyA9IFs1MDAsMjAwLDEwMCw1MCwyMCwxMCw1XTtcbiAgSW50ZXJlc3RUYXNrRXhlcmNpc2UucHJvdG90eXBlLmNvaW5zID0gWzIsMSwwLjUsMC4yLDAuMSwwLjA1LDAuMDIsMC4wMV07XG5cbiAgSW50ZXJlc3RUYXNrRXhlcmNpc2UucHJvdG90eXBlLm9uRHJvcCA9IGZ1bmN0aW9uKHZhbHVlKXtcbiAgICB0aGlzLnN0YWNrLnB1c2godmFsdWUpO1xuICAgIHRoaXMuc3VtICs9IHZhbHVlO1xuXG4gICAgdGhpcy5vblVwZGF0ZSh7XG4gICAgICBzdW06IHRoaXMuc3VtXG4gICAgfSk7XG4gIH07XG5cbiAgSW50ZXJlc3RUYXNrRXhlcmNpc2UucHJvdG90eXBlLnJldmVydCA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuc3VtIC09IHRoaXMuc3RhY2sucG9wKCk7XG5cbiAgICB0aGlzLm9uVXBkYXRlKHtcbiAgICAgIHN1bTogdGhpcy5zdW1cbiAgICB9KTtcbiAgfTtcblxuICAvLyByZWdpc3RyeVxuICBhbmd1bGFyLm1vZHVsZShtb2R1bGUpLmRpcmVjdGl2ZSgnaW50ZXJlc3RUYXNrRXhlcmNpc2UnLCBmdW5jdGlvbigpe1xuICAgIHJldHVybiB7XG4gICAgICBzY29wZToge1xuICAgICAgICBzdW06ICc9P2ludGVyZXN0VGFza0V4ZXJjaXNlU3VtJyxcbiAgICAgICAgb25VcGRhdGU6ICcmaW50ZXJlc3RUYXNrRXhlcmNpc2VPblVwZGF0ZScsXG4gICAgICAgIGRpc2FibGVkOiAnPT9pbnRlcmVzdFRhc2tFeGVyY2lzZURpc2FibGVkJ1xuICAgICAgfSxcbiAgICAgIHJlc3RyaWN0OiAnQScsXG4gICAgICB0cmFuc2NsdWRlOiB0cnVlLFxuICAgICAgY29udHJvbGxlcjogSW50ZXJlc3RUYXNrRXhlcmNpc2UsXG4gICAgICBiaW5kVG9Db250cm9sbGVyOiB0cnVlLFxuICAgICAgY29udHJvbGxlckFzOiAnaW50ZXJlc3RUYXNrRXhlcmNpc2VDb250cm9sbGVyJyxcbiAgICAgIHRlbXBsYXRlVXJsOiAndmlld3MvZGlyZWN0aXZlcy9pbnRlcmVzdC10YXNrLWV4ZXJjaXNlLmh0bWwnXG4gICAgfTtcbiAgfSk7XG5cblxuXG5cbn0pKEFOR1VMQVJfTU9EVUxFLCBhbmd1bGFyKTtcbiJdfQ==
