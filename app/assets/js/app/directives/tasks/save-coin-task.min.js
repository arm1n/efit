/*!
 * eFit Website
 * An app for financial training in educational environments
 * http://www.e-fit.com
 * @author Armin Pfurtscheller
 * @version 1.0.0
 * Copyright 2017. MIT licensed.
 */
/* global ANGULAR_MODULE, angular, Scratchcard */
(function(module, angular) {
  'use strict';

  // --------------------------------------------------
  // SaveCoinTask
  // --------------------------------------------------

  //
  // CONTROLLER
  //

  /**
   * @constructor
   */
  var SaveCoinTask = function($scope, $element, $attrs, $injector) {
    this.$scope = $scope;
    this.$attrs = $attrs;
    this.$element = $element;
    this.$injector = $injector;

    var user = $injector.get('user');
    this.type = $injector.get('TYPE_SAVINGS_TARGET');
    this.task = user.getTaskByType(this.type);
  };

  SaveCoinTask.$inject = ['$scope', '$element', '$attrs', '$injector'];

  //
  // PROPERTIES
  //

  // SERVER

  /** @var {string} type Task's `type` property from server. */
  SaveCoinTask.prototype.type = null;

  /** @var {object} task Task's resource from server. */
  SaveCoinTask.prototype.task = null;

  // GAMEPLAY

  /** @var {boolean} resolved If player has resolved the game. */
  SaveCoinTask.prototype.resolved = false;

  // SETTINGS

  /** @var {number} amount Amount of total cards. */
  SaveCoinTask.prototype.amount = 3;

  /** @var {array} cards Dummy collection of cards. */
  SaveCoinTask.prototype.cards = [];

  /** @var {number} count Number of revealed cards. */
  SaveCoinTask.prototype.count = 0;

  //
  // METHODS
  //

  /**
   * Proxies to `init()` if controller's ready.
   *
   * @public
   * @method $onInit
   * @return {Void}
   */
  SaveCoinTask.prototype.$onInit = function() {
    this.init();
  };

  /**
   * Retrieves result payload for server.
   *
   * @public
   * @method getPayload
   * @return {Void}
   */
  SaveCoinTask.prototype.getPayload = function() {
    return {
      task: this.type,
      json: {
        cards: this.count
      }
    };
  };

  /**
   * Whether or not task is currently locked.
   *
   * @public
   * @method isLocked
   * @return {boolean}
   */
  SaveCoinTask.prototype.isLocked = function() {
    if (this.task === null) {
      return true;
    }

    return !this.task.isActive;
  };

  /**
   * Whether or not task can be sent to server.
   *
   * @public
   * @method canResolve
   * @return {boolean}
   */
  SaveCoinTask.prototype.canResolve = function() {
    var user = this.$injector.get('user');
    if (!user.isUser()) {
      return false;
    }

    if (this.isLocked()) {
      return false;
    }

    if (this.resolved) {
      return false;
    }

    var cur = this.count;
    var max = this.amount;
    if (cur < max) {
      return false;
    }

    return true;
  };

  /**
   * Sets up initial state.
   *
   * @public
   * @method init
   * @return {Void}
   */
  SaveCoinTask.prototype.init = function() {
    this.cards = [];
    for (var i=1; i<=this.amount; i++) {
      this.cards.push(i);
    }

    this.resolved = false;
  };

  /**
   * Resets initial state.
   *
   * @public
   * @method reset
   * @return {Void}
   */
  SaveCoinTask.prototype.reset = function(){
    this.init();
  };

  /**
   * Increases `count` and invokes `resolve()`.
   *
   * @public
   * @method update
   * @return {Void}
   */
  SaveCoinTask.prototype.update = function(){
    this.count++;

    if (this.canResolve()) {
      this.resolve();
    }
  };

  /**
   * Sets `resolved` flag. Calls `onResolve`
   * callback with JSON result for consumer.
   *
   * @public
   * @method resolve
   * @return {Void}
   */
  SaveCoinTask.prototype.resolve = function(){
    var $q = this.$injector.get('$q');
    var me = this;

    var result = this.onResolve({
      payload: this.getPayload()
    });

    var resolve = function() {
      me.resolved = true;
    };

    $q.when(result).then(resolve);
  };

  //
  // REGISTRY
  //
  angular.module(module).directive('saveCoinTask', function(){
    return {
      scope: {
        amount: '=?saveCoinTaskAmount',
        onResolve: '&saveCoinTaskOnResolve'
      },
      restrict: 'A',
      transclude: true,
      controller: SaveCoinTask,
      bindToController: true,
      controllerAs: 'saveCoinTaskController',
      templateUrl: 'views/directives/tasks/save-coin-task.html'
    };
  });

  // --------------------------------------------------
  // SaveCoinTask Card
  // --------------------------------------------------

  //
  // CONTROLLER
  //

  /**
   * @constructor
   */
  var SaveCoinTaskCard = function($scope,$element,$attrs) {
    this.$element = $element;
    this.$scope = $scope;
    this.$attrs = $attrs;

    this._scratchCard = null;
  };

  SaveCoinTaskCard.$inject = ['$scope','$element','$attrs'];

  //
  // PROPERTIES
  //

  /** @var {boolean} complete If card has been revelead. */
  SaveCoinTaskCard.prototype.complete = false;

  /** @var {number} thickness Thickness of rubber in pixel. */
  SaveCoinTaskCard.prototype.thickness = 20;

  /** @var {number} treshold Treshold level when card revels. */
  SaveCoinTaskCard.prototype.threshold = 0.75;

  /** @var {string} color Color of card overlay. */
  SaveCoinTaskCard.prototype.color = '#e5e5e5';

  //
  // METHODS
  //

  /**
   * Initializes element with `Scratchcard` library.
   *
   * @public
   * @method $onInit
   * @return {Void}
   */
  SaveCoinTaskCard.prototype.$onInit = function() {
    this._scratchCard = new Scratchcard(
      this.$element.get(0),
      {
        painter: new Scratchcard.Painter({
          thickness: this.thickness,
          color: this.color
        })
      }
    );

    this._scratchCard.on('progress', this._onProgress.bind(this));
  };

  /**
   * Checks progress' treshold has been exceeded, but is still
   * below 100%. In this case, the card will be revelead and
   * the `onComplete` callback can be invoked.
   *
   * @public
   * @method _onProgress
   * @return {Void}
   */
  SaveCoinTaskCard.prototype._onProgress = function(progress) {
    if (progress>this.threshold &&Â progress<1) {
      var onComplete = this.onComplete.bind(this);
      this.$scope.$evalAsync(onComplete);
      this._scratchCard.complete();

      this.complete = true;
    }
  };

  //
  // REGISTRY
  //
  angular.module(module).directive('saveCoinTaskCard', function(){
    return {
      scope: {
        color: '=?saveCoinTaskColor',
        thickness: '=?saveCoinTaskCardThickness',
        threshold: '=?saveCoinTaskCardThreshold',
        onComplete: '&saveCoinTaskCardOnComplete'
      },
      restrict: 'A',
      transclude: true,
      controller: SaveCoinTaskCard,
      bindToController: true,
      controllerAs: 'saveCoinTaskCardController',
      templateUrl: 'views/directives/tasks/save-coin-task-card.html'
    };
  });

})(ANGULAR_MODULE, angular);

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC9kaXJlY3RpdmVzL3Rhc2tzL3NhdmUtY29pbi10YXNrLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImFwcC9kaXJlY3RpdmVzL3Rhc2tzL3NhdmUtY29pbi10YXNrLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qIGdsb2JhbCBBTkdVTEFSX01PRFVMRSwgYW5ndWxhciwgU2NyYXRjaGNhcmQgKi9cbihmdW5jdGlvbihtb2R1bGUsIGFuZ3VsYXIpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vIFNhdmVDb2luVGFza1xuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG4gIC8vXG4gIC8vIENPTlRST0xMRVJcbiAgLy9cblxuICAvKipcbiAgICogQGNvbnN0cnVjdG9yXG4gICAqL1xuICB2YXIgU2F2ZUNvaW5UYXNrID0gZnVuY3Rpb24oJHNjb3BlLCAkZWxlbWVudCwgJGF0dHJzLCAkaW5qZWN0b3IpIHtcbiAgICB0aGlzLiRzY29wZSA9ICRzY29wZTtcbiAgICB0aGlzLiRhdHRycyA9ICRhdHRycztcbiAgICB0aGlzLiRlbGVtZW50ID0gJGVsZW1lbnQ7XG4gICAgdGhpcy4kaW5qZWN0b3IgPSAkaW5qZWN0b3I7XG5cbiAgICB2YXIgdXNlciA9ICRpbmplY3Rvci5nZXQoJ3VzZXInKTtcbiAgICB0aGlzLnR5cGUgPSAkaW5qZWN0b3IuZ2V0KCdUWVBFX1NBVklOR1NfVEFSR0VUJyk7XG4gICAgdGhpcy50YXNrID0gdXNlci5nZXRUYXNrQnlUeXBlKHRoaXMudHlwZSk7XG4gIH07XG5cbiAgU2F2ZUNvaW5UYXNrLiRpbmplY3QgPSBbJyRzY29wZScsICckZWxlbWVudCcsICckYXR0cnMnLCAnJGluamVjdG9yJ107XG5cbiAgLy9cbiAgLy8gUFJPUEVSVElFU1xuICAvL1xuXG4gIC8vIFNFUlZFUlxuXG4gIC8qKiBAdmFyIHtzdHJpbmd9IHR5cGUgVGFzaydzIGB0eXBlYCBwcm9wZXJ0eSBmcm9tIHNlcnZlci4gKi9cbiAgU2F2ZUNvaW5UYXNrLnByb3RvdHlwZS50eXBlID0gbnVsbDtcblxuICAvKiogQHZhciB7b2JqZWN0fSB0YXNrIFRhc2sncyByZXNvdXJjZSBmcm9tIHNlcnZlci4gKi9cbiAgU2F2ZUNvaW5UYXNrLnByb3RvdHlwZS50YXNrID0gbnVsbDtcblxuICAvLyBHQU1FUExBWVxuXG4gIC8qKiBAdmFyIHtib29sZWFufSByZXNvbHZlZCBJZiBwbGF5ZXIgaGFzIHJlc29sdmVkIHRoZSBnYW1lLiAqL1xuICBTYXZlQ29pblRhc2sucHJvdG90eXBlLnJlc29sdmVkID0gZmFsc2U7XG5cbiAgLy8gU0VUVElOR1NcblxuICAvKiogQHZhciB7bnVtYmVyfSBhbW91bnQgQW1vdW50IG9mIHRvdGFsIGNhcmRzLiAqL1xuICBTYXZlQ29pblRhc2sucHJvdG90eXBlLmFtb3VudCA9IDM7XG5cbiAgLyoqIEB2YXIge2FycmF5fSBjYXJkcyBEdW1teSBjb2xsZWN0aW9uIG9mIGNhcmRzLiAqL1xuICBTYXZlQ29pblRhc2sucHJvdG90eXBlLmNhcmRzID0gW107XG5cbiAgLyoqIEB2YXIge251bWJlcn0gY291bnQgTnVtYmVyIG9mIHJldmVhbGVkIGNhcmRzLiAqL1xuICBTYXZlQ29pblRhc2sucHJvdG90eXBlLmNvdW50ID0gMDtcblxuICAvL1xuICAvLyBNRVRIT0RTXG4gIC8vXG5cbiAgLyoqXG4gICAqIFByb3hpZXMgdG8gYGluaXQoKWAgaWYgY29udHJvbGxlcidzIHJlYWR5LlxuICAgKlxuICAgKiBAcHVibGljXG4gICAqIEBtZXRob2QgJG9uSW5pdFxuICAgKiBAcmV0dXJuIHtWb2lkfVxuICAgKi9cbiAgU2F2ZUNvaW5UYXNrLnByb3RvdHlwZS4kb25Jbml0ID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5pbml0KCk7XG4gIH07XG5cbiAgLyoqXG4gICAqIFJldHJpZXZlcyByZXN1bHQgcGF5bG9hZCBmb3Igc2VydmVyLlxuICAgKlxuICAgKiBAcHVibGljXG4gICAqIEBtZXRob2QgZ2V0UGF5bG9hZFxuICAgKiBAcmV0dXJuIHtWb2lkfVxuICAgKi9cbiAgU2F2ZUNvaW5UYXNrLnByb3RvdHlwZS5nZXRQYXlsb2FkID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHRhc2s6IHRoaXMudHlwZSxcbiAgICAgIGpzb246IHtcbiAgICAgICAgY2FyZHM6IHRoaXMuY291bnRcbiAgICAgIH1cbiAgICB9O1xuICB9O1xuXG4gIC8qKlxuICAgKiBXaGV0aGVyIG9yIG5vdCB0YXNrIGlzIGN1cnJlbnRseSBsb2NrZWQuXG4gICAqXG4gICAqIEBwdWJsaWNcbiAgICogQG1ldGhvZCBpc0xvY2tlZFxuICAgKiBAcmV0dXJuIHtib29sZWFufVxuICAgKi9cbiAgU2F2ZUNvaW5UYXNrLnByb3RvdHlwZS5pc0xvY2tlZCA9IGZ1bmN0aW9uKCkge1xuICAgIGlmICh0aGlzLnRhc2sgPT09IG51bGwpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIHJldHVybiAhdGhpcy50YXNrLmlzQWN0aXZlO1xuICB9O1xuXG4gIC8qKlxuICAgKiBXaGV0aGVyIG9yIG5vdCB0YXNrIGNhbiBiZSBzZW50IHRvIHNlcnZlci5cbiAgICpcbiAgICogQHB1YmxpY1xuICAgKiBAbWV0aG9kIGNhblJlc29sdmVcbiAgICogQHJldHVybiB7Ym9vbGVhbn1cbiAgICovXG4gIFNhdmVDb2luVGFzay5wcm90b3R5cGUuY2FuUmVzb2x2ZSA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciB1c2VyID0gdGhpcy4kaW5qZWN0b3IuZ2V0KCd1c2VyJyk7XG4gICAgaWYgKCF1c2VyLmlzVXNlcigpKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuaXNMb2NrZWQoKSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGlmICh0aGlzLnJlc29sdmVkKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgdmFyIGN1ciA9IHRoaXMuY291bnQ7XG4gICAgdmFyIG1heCA9IHRoaXMuYW1vdW50O1xuICAgIGlmIChjdXIgPCBtYXgpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfTtcblxuICAvKipcbiAgICogU2V0cyB1cCBpbml0aWFsIHN0YXRlLlxuICAgKlxuICAgKiBAcHVibGljXG4gICAqIEBtZXRob2QgaW5pdFxuICAgKiBAcmV0dXJuIHtWb2lkfVxuICAgKi9cbiAgU2F2ZUNvaW5UYXNrLnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5jYXJkcyA9IFtdO1xuICAgIGZvciAodmFyIGk9MTsgaTw9dGhpcy5hbW91bnQ7IGkrKykge1xuICAgICAgdGhpcy5jYXJkcy5wdXNoKGkpO1xuICAgIH1cblxuICAgIHRoaXMucmVzb2x2ZWQgPSBmYWxzZTtcbiAgfTtcblxuICAvKipcbiAgICogUmVzZXRzIGluaXRpYWwgc3RhdGUuXG4gICAqXG4gICAqIEBwdWJsaWNcbiAgICogQG1ldGhvZCByZXNldFxuICAgKiBAcmV0dXJuIHtWb2lkfVxuICAgKi9cbiAgU2F2ZUNvaW5UYXNrLnByb3RvdHlwZS5yZXNldCA9IGZ1bmN0aW9uKCl7XG4gICAgdGhpcy5pbml0KCk7XG4gIH07XG5cbiAgLyoqXG4gICAqIEluY3JlYXNlcyBgY291bnRgIGFuZCBpbnZva2VzIGByZXNvbHZlKClgLlxuICAgKlxuICAgKiBAcHVibGljXG4gICAqIEBtZXRob2QgdXBkYXRlXG4gICAqIEByZXR1cm4ge1ZvaWR9XG4gICAqL1xuICBTYXZlQ29pblRhc2sucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uKCl7XG4gICAgdGhpcy5jb3VudCsrO1xuXG4gICAgaWYgKHRoaXMuY2FuUmVzb2x2ZSgpKSB7XG4gICAgICB0aGlzLnJlc29sdmUoKTtcbiAgICB9XG4gIH07XG5cbiAgLyoqXG4gICAqIFNldHMgYHJlc29sdmVkYCBmbGFnLiBDYWxscyBgb25SZXNvbHZlYFxuICAgKiBjYWxsYmFjayB3aXRoIEpTT04gcmVzdWx0IGZvciBjb25zdW1lci5cbiAgICpcbiAgICogQHB1YmxpY1xuICAgKiBAbWV0aG9kIHJlc29sdmVcbiAgICogQHJldHVybiB7Vm9pZH1cbiAgICovXG4gIFNhdmVDb2luVGFzay5wcm90b3R5cGUucmVzb2x2ZSA9IGZ1bmN0aW9uKCl7XG4gICAgdmFyICRxID0gdGhpcy4kaW5qZWN0b3IuZ2V0KCckcScpO1xuICAgIHZhciBtZSA9IHRoaXM7XG5cbiAgICB2YXIgcmVzdWx0ID0gdGhpcy5vblJlc29sdmUoe1xuICAgICAgcGF5bG9hZDogdGhpcy5nZXRQYXlsb2FkKClcbiAgICB9KTtcblxuICAgIHZhciByZXNvbHZlID0gZnVuY3Rpb24oKSB7XG4gICAgICBtZS5yZXNvbHZlZCA9IHRydWU7XG4gICAgfTtcblxuICAgICRxLndoZW4ocmVzdWx0KS50aGVuKHJlc29sdmUpO1xuICB9O1xuXG4gIC8vXG4gIC8vIFJFR0lTVFJZXG4gIC8vXG4gIGFuZ3VsYXIubW9kdWxlKG1vZHVsZSkuZGlyZWN0aXZlKCdzYXZlQ29pblRhc2snLCBmdW5jdGlvbigpe1xuICAgIHJldHVybiB7XG4gICAgICBzY29wZToge1xuICAgICAgICBhbW91bnQ6ICc9P3NhdmVDb2luVGFza0Ftb3VudCcsXG4gICAgICAgIG9uUmVzb2x2ZTogJyZzYXZlQ29pblRhc2tPblJlc29sdmUnXG4gICAgICB9LFxuICAgICAgcmVzdHJpY3Q6ICdBJyxcbiAgICAgIHRyYW5zY2x1ZGU6IHRydWUsXG4gICAgICBjb250cm9sbGVyOiBTYXZlQ29pblRhc2ssXG4gICAgICBiaW5kVG9Db250cm9sbGVyOiB0cnVlLFxuICAgICAgY29udHJvbGxlckFzOiAnc2F2ZUNvaW5UYXNrQ29udHJvbGxlcicsXG4gICAgICB0ZW1wbGF0ZVVybDogJ3ZpZXdzL2RpcmVjdGl2ZXMvdGFza3Mvc2F2ZS1jb2luLXRhc2suaHRtbCdcbiAgICB9O1xuICB9KTtcblxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvLyBTYXZlQ29pblRhc2sgQ2FyZFxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG4gIC8vXG4gIC8vIENPTlRST0xMRVJcbiAgLy9cblxuICAvKipcbiAgICogQGNvbnN0cnVjdG9yXG4gICAqL1xuICB2YXIgU2F2ZUNvaW5UYXNrQ2FyZCA9IGZ1bmN0aW9uKCRzY29wZSwkZWxlbWVudCwkYXR0cnMpIHtcbiAgICB0aGlzLiRlbGVtZW50ID0gJGVsZW1lbnQ7XG4gICAgdGhpcy4kc2NvcGUgPSAkc2NvcGU7XG4gICAgdGhpcy4kYXR0cnMgPSAkYXR0cnM7XG5cbiAgICB0aGlzLl9zY3JhdGNoQ2FyZCA9IG51bGw7XG4gIH07XG5cbiAgU2F2ZUNvaW5UYXNrQ2FyZC4kaW5qZWN0ID0gWyckc2NvcGUnLCckZWxlbWVudCcsJyRhdHRycyddO1xuXG4gIC8vXG4gIC8vIFBST1BFUlRJRVNcbiAgLy9cblxuICAvKiogQHZhciB7Ym9vbGVhbn0gY29tcGxldGUgSWYgY2FyZCBoYXMgYmVlbiByZXZlbGVhZC4gKi9cbiAgU2F2ZUNvaW5UYXNrQ2FyZC5wcm90b3R5cGUuY29tcGxldGUgPSBmYWxzZTtcblxuICAvKiogQHZhciB7bnVtYmVyfSB0aGlja25lc3MgVGhpY2tuZXNzIG9mIHJ1YmJlciBpbiBwaXhlbC4gKi9cbiAgU2F2ZUNvaW5UYXNrQ2FyZC5wcm90b3R5cGUudGhpY2tuZXNzID0gMjA7XG5cbiAgLyoqIEB2YXIge251bWJlcn0gdHJlc2hvbGQgVHJlc2hvbGQgbGV2ZWwgd2hlbiBjYXJkIHJldmVscy4gKi9cbiAgU2F2ZUNvaW5UYXNrQ2FyZC5wcm90b3R5cGUudGhyZXNob2xkID0gMC43NTtcblxuICAvKiogQHZhciB7c3RyaW5nfSBjb2xvciBDb2xvciBvZiBjYXJkIG92ZXJsYXkuICovXG4gIFNhdmVDb2luVGFza0NhcmQucHJvdG90eXBlLmNvbG9yID0gJyNlNWU1ZTUnO1xuXG4gIC8vXG4gIC8vIE1FVEhPRFNcbiAgLy9cblxuICAvKipcbiAgICogSW5pdGlhbGl6ZXMgZWxlbWVudCB3aXRoIGBTY3JhdGNoY2FyZGAgbGlicmFyeS5cbiAgICpcbiAgICogQHB1YmxpY1xuICAgKiBAbWV0aG9kICRvbkluaXRcbiAgICogQHJldHVybiB7Vm9pZH1cbiAgICovXG4gIFNhdmVDb2luVGFza0NhcmQucHJvdG90eXBlLiRvbkluaXQgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLl9zY3JhdGNoQ2FyZCA9IG5ldyBTY3JhdGNoY2FyZChcbiAgICAgIHRoaXMuJGVsZW1lbnQuZ2V0KDApLFxuICAgICAge1xuICAgICAgICBwYWludGVyOiBuZXcgU2NyYXRjaGNhcmQuUGFpbnRlcih7XG4gICAgICAgICAgdGhpY2tuZXNzOiB0aGlzLnRoaWNrbmVzcyxcbiAgICAgICAgICBjb2xvcjogdGhpcy5jb2xvclxuICAgICAgICB9KVxuICAgICAgfVxuICAgICk7XG5cbiAgICB0aGlzLl9zY3JhdGNoQ2FyZC5vbigncHJvZ3Jlc3MnLCB0aGlzLl9vblByb2dyZXNzLmJpbmQodGhpcykpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBDaGVja3MgcHJvZ3Jlc3MnIHRyZXNob2xkIGhhcyBiZWVuIGV4Y2VlZGVkLCBidXQgaXMgc3RpbGxcbiAgICogYmVsb3cgMTAwJS4gSW4gdGhpcyBjYXNlLCB0aGUgY2FyZCB3aWxsIGJlIHJldmVsZWFkIGFuZFxuICAgKiB0aGUgYG9uQ29tcGxldGVgIGNhbGxiYWNrIGNhbiBiZSBpbnZva2VkLlxuICAgKlxuICAgKiBAcHVibGljXG4gICAqIEBtZXRob2QgX29uUHJvZ3Jlc3NcbiAgICogQHJldHVybiB7Vm9pZH1cbiAgICovXG4gIFNhdmVDb2luVGFza0NhcmQucHJvdG90eXBlLl9vblByb2dyZXNzID0gZnVuY3Rpb24ocHJvZ3Jlc3MpIHtcbiAgICBpZiAocHJvZ3Jlc3M+dGhpcy50aHJlc2hvbGQgJibCoHByb2dyZXNzPDEpIHtcbiAgICAgIHZhciBvbkNvbXBsZXRlID0gdGhpcy5vbkNvbXBsZXRlLmJpbmQodGhpcyk7XG4gICAgICB0aGlzLiRzY29wZS4kZXZhbEFzeW5jKG9uQ29tcGxldGUpO1xuICAgICAgdGhpcy5fc2NyYXRjaENhcmQuY29tcGxldGUoKTtcblxuICAgICAgdGhpcy5jb21wbGV0ZSA9IHRydWU7XG4gICAgfVxuICB9O1xuXG4gIC8vXG4gIC8vIFJFR0lTVFJZXG4gIC8vXG4gIGFuZ3VsYXIubW9kdWxlKG1vZHVsZSkuZGlyZWN0aXZlKCdzYXZlQ29pblRhc2tDYXJkJywgZnVuY3Rpb24oKXtcbiAgICByZXR1cm4ge1xuICAgICAgc2NvcGU6IHtcbiAgICAgICAgY29sb3I6ICc9P3NhdmVDb2luVGFza0NvbG9yJyxcbiAgICAgICAgdGhpY2tuZXNzOiAnPT9zYXZlQ29pblRhc2tDYXJkVGhpY2tuZXNzJyxcbiAgICAgICAgdGhyZXNob2xkOiAnPT9zYXZlQ29pblRhc2tDYXJkVGhyZXNob2xkJyxcbiAgICAgICAgb25Db21wbGV0ZTogJyZzYXZlQ29pblRhc2tDYXJkT25Db21wbGV0ZSdcbiAgICAgIH0sXG4gICAgICByZXN0cmljdDogJ0EnLFxuICAgICAgdHJhbnNjbHVkZTogdHJ1ZSxcbiAgICAgIGNvbnRyb2xsZXI6IFNhdmVDb2luVGFza0NhcmQsXG4gICAgICBiaW5kVG9Db250cm9sbGVyOiB0cnVlLFxuICAgICAgY29udHJvbGxlckFzOiAnc2F2ZUNvaW5UYXNrQ2FyZENvbnRyb2xsZXInLFxuICAgICAgdGVtcGxhdGVVcmw6ICd2aWV3cy9kaXJlY3RpdmVzL3Rhc2tzL3NhdmUtY29pbi10YXNrLWNhcmQuaHRtbCdcbiAgICB9O1xuICB9KTtcblxufSkoQU5HVUxBUl9NT0RVTEUsIGFuZ3VsYXIpO1xuIl19
