/*!
 * eFit Website
 * An app for financial training in educational environments
 * http://www.e-fit.com
 * @author Armin Pfurtscheller
 * @version 1.0.0
 * Copyright 2017. MIT licensed.
 */
!function(t,i){"use strict";var s=function(t,i,s,o,e,r){this.$interval=e,this.$element=s,this.$filter=o,this.$attrs=i,this.$scope=t,this.randomService=r,this.avg=12,this.rows=5,this.cols=5,this.interval=1,this.random=!1,this.dynamic=!1,this.totalBoxes=0,this.stopped=!1,this.started=!1,this.hasBomb=!1,this.resolved=!1,this.remainingBoxes=0,this.collectedBoxes=0};s.$inject=["$scope","$attrs","$element","$filter","$interval","random"],s.prototype.$onInit=function(){this.init()},s.prototype.init=function(){this._initInternals(),this._initMatrix(),this._initBomb(),this._desist(),this.dynamic||this.start()},s.prototype.reset=function(){this._removeState(),this.init()},s.prototype.start=function(t){if(this.dynamic){var i=this,s=this.iterator.length;this._intIndex=t||0,this._intervalId=i.$interval(function(){var t=i.iterator[i._intIndex];i.update(t,!0),i._intIndex++,i._intIndex===s&&i.stop()},1e3*this.interval,s-this._intIndex)}this.started=!0,this._persist()},s.prototype.stop=function(){this.dynamic&&this._intervalId&&this.$interval.cancel(this._intervalId),this.stopped=!0,this._persist()},s.prototype.resolve=function(){for(var t=0;t<this.collection.length;t++)this.collection[t].$$resolved=!0;this.resolved=!0,this.onResolve(),this._persist()},s.prototype.update=function(t,i){var s=this.collection.indexOf(t);i?(s<0&&(this.collection.push(t),this.collectedBoxes++),t.$$active=!0):s>=0&&(this.collection.splice(s,1),t.$$active=!1,this.collectedBoxes--),this.isBomb(t)&&(this.hasBomb=!0);var o=this.totalBoxes,e=this.collectedBoxes;this.remainingBoxes=o-e,this._persist()},s.prototype.trackId=function(t){return t.row+"_"+t.col},s.prototype.isBomb=function(t){return i.equals(this.bomb,t)},s.prototype._getColumn=function(t){var i=t.row-1,s=t.col-1;return this.matrix[i][s]},s.prototype._getState=function(){return null},s.prototype._setState=function(){},s.prototype._removeState=function(){},s.prototype._persist=function(){},s.prototype._desist=function(){},s.prototype._initInternals=function(){this.collection=[],this.hasBomb=!1,this.started=!1,this.stopped=!1,this.resolved=!1,this.collectedBoxes=0,this.remainingBoxes=0,this.totalBoxes=this.rows*this.cols},s.prototype._initMatrix=function(){this.matrix=[],this.iterator=[];for(var t=0;t<this.rows;t++){for(var i=[],s=0;s<this.cols;s++){var o={row:t+1,col:s+1};i.push(o),this.dynamic&&(this.random?this.randomService.push(this.iterator,o):this.iterator.push(o))}this.matrix.push(i)}},s.prototype._initBomb=function(){var t=this.randomService.between(0,this.rows-1),i=this.randomService.between(0,this.cols-1);this.bomb=this.matrix[t][i]},i.module(t).directive("bombTask",function(){return{scope:{avg:"=?bombTaskAvg",rows:"=?bombTaskRows",cols:"=?bombTaskCols",random:"=?bombTaskRandom",dynamic:"=?bombTaskDynamic",interval:"=?bombTaskInterval",onResolve:"&bombTaskOnResolve"},restrict:"A",transclude:!0,controller:s,bindToController:!0,controllerAs:"bombTaskController",templateUrl:"views/directives/bomb-task.html"}});var o=function(){};o.prototype.model=null,o.prototype.isActive=!1,o.prototype.isDisabled=!1,o.prototype.isClickable=!0,o.prototype.toggle=function(){!this.isDisabled&&this.isClickable&&(this.isActive=!this.isActive,this.onToggle({model:this.model,state:this.isActive}))},i.module(t).directive("bombTaskCard",function(){return{scope:{model:"=bombTaskCard",onToggle:"&bombTaskCardOnToggle",isActive:"=?bombTaskCardIsActive",isDisabled:"=?bombTaskCardIsDisabled",isClickable:"=?bombTaskCardIsClickable"},restrict:"A",transclude:!0,controller:o,bindToController:!0,controllerAs:"bombTaskCardController",templateUrl:"views/directives/bomb-task-card.html"}})}(ANGULAR_MODULE,angular);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC9kaXJlY3RpdmVzL2JvbWItdGFzay5qcyJdLCJuYW1lcyI6WyJtb2R1bGUiLCJhbmd1bGFyIiwiQm9tYlRhc2siLCIkc2NvcGUiLCIkYXR0cnMiLCIkZWxlbWVudCIsIiRmaWx0ZXIiLCIkaW50ZXJ2YWwiLCJyYW5kb21TZXJ2aWNlIiwidGhpcyIsImF2ZyIsInJvd3MiLCJjb2xzIiwiaW50ZXJ2YWwiLCJyYW5kb20iLCJkeW5hbWljIiwidG90YWxCb3hlcyIsInN0b3BwZWQiLCJzdGFydGVkIiwiaGFzQm9tYiIsInJlc29sdmVkIiwicmVtYWluaW5nQm94ZXMiLCJjb2xsZWN0ZWRCb3hlcyIsIiRpbmplY3QiLCJwcm90b3R5cGUiLCIkb25Jbml0IiwiaW5pdCIsIl9pbml0SW50ZXJuYWxzIiwiX2luaXRNYXRyaXgiLCJfaW5pdEJvbWIiLCJfZGVzaXN0Iiwic3RhcnQiLCJyZXNldCIsIl9yZW1vdmVTdGF0ZSIsImluZGV4IiwibWUiLCJtYXgiLCJpdGVyYXRvciIsImxlbmd0aCIsIl9pbnRJbmRleCIsIl9pbnRlcnZhbElkIiwiaXRlbSIsInVwZGF0ZSIsInN0b3AiLCJfcGVyc2lzdCIsImNhbmNlbCIsInJlc29sdmUiLCJpIiwiY29sbGVjdGlvbiIsIiQkcmVzb2x2ZWQiLCJvblJlc29sdmUiLCJjb2x1bW4iLCJhY3RpdmUiLCJpbmRleE9mIiwicHVzaCIsIiQkYWN0aXZlIiwic3BsaWNlIiwiaXNCb21iIiwidG90YWwiLCJjb2xsZWN0ZWQiLCJ0cmFja0lkIiwicm93IiwiY29sIiwiZXF1YWxzIiwiYm9tYiIsIl9nZXRDb2x1bW4iLCJkYXRhIiwibWF0cml4IiwiX2dldFN0YXRlIiwiX3NldFN0YXRlIiwiY29sdW1ucyIsImoiLCJiZXR3ZWVuIiwiZGlyZWN0aXZlIiwic2NvcGUiLCJyZXN0cmljdCIsInRyYW5zY2x1ZGUiLCJjb250cm9sbGVyIiwiYmluZFRvQ29udHJvbGxlciIsImNvbnRyb2xsZXJBcyIsInRlbXBsYXRlVXJsIiwiQm9tYlRhc2tDYXJkIiwibW9kZWwiLCJpc0FjdGl2ZSIsImlzRGlzYWJsZWQiLCJpc0NsaWNrYWJsZSIsInRvZ2dsZSIsIm9uVG9nZ2xlIiwic3RhdGUiLCJBTkdVTEFSX01PRFVMRSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Q0FTQSxTQUFVQSxFQUFRQyxHQUNoQixZQU9BLElBQUlDLEdBQVcsU0FBU0MsRUFBUUMsRUFBUUMsRUFBVUMsRUFBU0MsRUFBV0MsR0FHcEVDLEtBQUtGLFVBQVlBLEVBQ2pCRSxLQUFLSixTQUFXQSxFQUNoQkksS0FBS0gsUUFBVUEsRUFDZkcsS0FBS0wsT0FBU0EsRUFDZEssS0FBS04sT0FBU0EsRUFFZE0sS0FBS0QsY0FBZ0JBLEVBRXJCQyxLQUFLQyxJQUFNLEdBQ1hELEtBQUtFLEtBQU8sRUFDWkYsS0FBS0csS0FBTyxFQUNaSCxLQUFLSSxTQUFXLEVBQ2hCSixLQUFLSyxRQUFTLEVBQ2RMLEtBQUtNLFNBQVUsRUFFZk4sS0FBS08sV0FBYSxFQUNsQlAsS0FBS1EsU0FBVSxFQUNmUixLQUFLUyxTQUFVLEVBQ2ZULEtBQUtVLFNBQVUsRUFDZlYsS0FBS1csVUFBVyxFQUNoQlgsS0FBS1ksZUFBaUIsRUFDdEJaLEtBQUthLGVBQWlCLEVBR3hCcEIsR0FBU3FCLFNBQVcsU0FBVSxTQUFVLFdBQVksVUFBVyxZQUFhLFVBRTVFckIsRUFBU3NCLFVBQVVDLFFBQVUsV0FDM0JoQixLQUFLaUIsUUFHUHhCLEVBQVNzQixVQUFVRSxLQUFPLFdBQ3hCakIsS0FBS2tCLGlCQUNMbEIsS0FBS21CLGNBQ0xuQixLQUFLb0IsWUFFTHBCLEtBQUtxQixVQUVBckIsS0FBS00sU0FDUk4sS0FBS3NCLFNBSVQ3QixFQUFTc0IsVUFBVVEsTUFBUSxXQUN6QnZCLEtBQUt3QixlQUVMeEIsS0FBS2lCLFFBR1B4QixFQUFTc0IsVUFBVU8sTUFBUSxTQUFTRyxHQUNsQyxHQUFJekIsS0FBS00sUUFBUyxDQUNoQixHQUFJb0IsR0FBSzFCLEtBQ0wyQixFQUFNM0IsS0FBSzRCLFNBQVNDLE1BRXhCN0IsTUFBSzhC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Z2xvYmFsIEFOR1VMQVJfTU9EVUxFLCBhbmd1bGFyICovXG4oZnVuY3Rpb24obW9kdWxlLCBhbmd1bGFyKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvLyBCb21iVGFza1xuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG4gIC8vIGNvbnRyb2xsZXJcbiAgdmFyIEJvbWJUYXNrID0gZnVuY3Rpb24oJHNjb3BlLCAkYXR0cnMsICRlbGVtZW50LCAkZmlsdGVyLCAkaW50ZXJ2YWwsIHJhbmRvbVNlcnZpY2UpIHtcbiAgICAvLyB0aGlzLl9zdG9yYWdlS2V5ID0gJ2JvbWJfdGFza19zdGF0ZSc7XG5cbiAgICB0aGlzLiRpbnRlcnZhbCA9ICRpbnRlcnZhbDtcbiAgICB0aGlzLiRlbGVtZW50ID0gJGVsZW1lbnQ7XG4gICAgdGhpcy4kZmlsdGVyID0gJGZpbHRlcjtcbiAgICB0aGlzLiRhdHRycyA9ICRhdHRycztcbiAgICB0aGlzLiRzY29wZSA9ICRzY29wZTtcblxuICAgIHRoaXMucmFuZG9tU2VydmljZSA9IHJhbmRvbVNlcnZpY2U7XG5cbiAgICB0aGlzLmF2ZyA9IDEyO1xuICAgIHRoaXMucm93cyA9IDU7XG4gICAgdGhpcy5jb2xzID0gNTtcbiAgICB0aGlzLmludGVydmFsID0gMTtcbiAgICB0aGlzLnJhbmRvbSA9IGZhbHNlO1xuICAgIHRoaXMuZHluYW1pYyA9IGZhbHNlO1xuXG4gICAgdGhpcy50b3RhbEJveGVzID0gMDtcbiAgICB0aGlzLnN0b3BwZWQgPSBmYWxzZTtcbiAgICB0aGlzLnN0YXJ0ZWQgPSBmYWxzZTtcbiAgICB0aGlzLmhhc0JvbWIgPSBmYWxzZTtcbiAgICB0aGlzLnJlc29sdmVkID0gZmFsc2U7XG4gICAgdGhpcy5yZW1haW5pbmdCb3hlcyA9IDA7XG4gICAgdGhpcy5jb2xsZWN0ZWRCb3hlcyA9IDA7XG4gIH07XG5cbiAgQm9tYlRhc2suJGluamVjdCA9IFsnJHNjb3BlJywgJyRhdHRycycsICckZWxlbWVudCcsICckZmlsdGVyJywgJyRpbnRlcnZhbCcsICdyYW5kb20nXTtcblxuICBCb21iVGFzay5wcm90b3R5cGUuJG9uSW5pdCA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuaW5pdCgpO1xuICB9O1xuXG4gIEJvbWJUYXNrLnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5faW5pdEludGVybmFscygpO1xuICAgIHRoaXMuX2luaXRNYXRyaXgoKTtcbiAgICB0aGlzLl9pbml0Qm9tYigpO1xuXG4gICAgdGhpcy5fZGVzaXN0KCk7XG5cbiAgICBpZiAoIXRoaXMuZHluYW1pYykge1xuICAgICAgdGhpcy5zdGFydCgpO1xuICAgIH1cbiAgfTtcblxuICBCb21iVGFzay5wcm90b3R5cGUucmVzZXQgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLl9yZW1vdmVTdGF0ZSgpO1xuXG4gICAgdGhpcy5pbml0KCk7XG4gIH07XG5cbiAgQm9tYlRhc2sucHJvdG90eXBlLnN0YXJ0ID0gZnVuY3Rpb24oaW5kZXgpIHtcbiAgICBpZiAodGhpcy5keW5hbWljKSB7XG4gICAgICB2YXIgbWUgPSB0aGlzO1xuICAgICAgdmFyIG1heCA9IHRoaXMuaXRlcmF0b3IubGVuZ3RoO1xuXG4gICAgICB0aGlzLl9pbnRJbmRleCA9IGluZGV4IHx8IDA7XG4gICAgICB0aGlzLl9pbnRlcnZhbElkID0gbWUuJGludGVydmFsKFxuICAgICAgICBmdW5jdGlvbigpe1xuXG4gICAgICAgICAgdmFyIGl0ZW0gPSBtZS5pdGVyYXRvclttZS5faW50SW5kZXhdO1xuICAgICAgICAgIG1lLnVwZGF0ZShpdGVtLHRydWUpO1xuXG4gICAgICAgICAgbWUuX2ludEluZGV4Kys7XG4gICAgICAgICAgaWYgKG1lLl9pbnRJbmRleD09PW1heCkge1xuICAgICAgICAgICAgbWUuc3RvcCgpO1xuICAgICAgICAgIH1cblxuICAgICAgICB9LFxuICAgICAgICB0aGlzLmludGVydmFsKjEwMDAsIC8vID0gZnJvbSBzZWNvbmRzXG4gICAgICAgIG1heCAtIHRoaXMuX2ludEluZGV4IC8vID0gbWF4IGl0ZXJhdGlvbnNcbiAgICAgICk7XG4gICAgfVxuXG4gICAgdGhpcy5zdGFydGVkID0gdHJ1ZTtcbiAgICB0aGlzLl9wZXJzaXN0KCk7XG4gIH07XG5cbiAgQm9tYlRhc2sucHJvdG90eXBlLnN0b3AgPSBmdW5jdGlvbigpIHtcbiAgICBpZiAodGhpcy5keW5hbWljICYmIHRoaXMuX2ludGVydmFsSWQpIHtcbiAgICAgIHRoaXMuJGludGVydmFsLmNhbmNlbCh0aGlzLl9pbnRlcnZhbElkKTtcbiAgICB9XG5cbiAgICB0aGlzLnN0b3BwZWQgPSB0cnVlO1xuICAgIHRoaXMuX3BlcnNpc3QoKTtcbiAgfTtcblxuICBCb21iVGFzay5wcm90b3R5cGUucmVzb2x2ZSA9IGZ1bmN0aW9uKCkge1xuICAgIGZvciAodmFyIGk9MDsgaTx0aGlzLmNvbGxlY3Rpb24ubGVuZ3RoOyBpKyspIHtcbiAgICAgIHRoaXMuY29sbGVjdGlvbltpXS4kJHJlc29sdmVkID0gdHJ1ZTtcbiAgICB9XG5cbiAgICB0aGlzLnJlc29sdmVkID0gdHJ1ZTtcbiAgICB0aGlzLm9uUmVzb2x2ZSgpO1xuICAgIHRoaXMuX3BlcnNpc3QoKTtcbiAgfTtcblxuICBCb21iVGFzay5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24oY29sdW1uLCBhY3RpdmUpIHtcbiAgICB2YXIgaW5kZXggPSB0aGlzLmNvbGxlY3Rpb24uaW5kZXhPZihjb2x1bW4pO1xuXG4gICAgaWYgKGFjdGl2ZSkge1xuICAgICAgaWYgKGluZGV4PDApwqB7XG4gICAgICAgIHRoaXMuY29sbGVjdGlvbi5wdXNoKGNvbHVtbik7XG4gICAgICAgIHRoaXMuY29sbGVjdGVkQm94ZXMrKztcbiAgICAgIH1cblxuICAgICAgY29sdW1uLiQkYWN0aXZlID0gdHJ1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKGluZGV4Pj0wKSB7XG4gICAgICAgIHRoaXMuY29sbGVjdGlvbi5zcGxpY2UoaW5kZXgsMSk7XG4gICAgICAgIGNvbHVtbi4kJGFjdGl2ZSA9IGZhbHNlO1xuICAgICAgICB0aGlzLmNvbGxlY3RlZEJveGVzLS07XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuaXNCb21iKGNvbHVtbikpIHtcbiAgICAgIHRoaXMuaGFzQm9tYiA9IHRydWU7XG4gICAgfVxuXG4gICAgdmFyIHRvdGFsID0gdGhpcy50b3RhbEJveGVzO1xuICAgIHZhciBjb2xsZWN0ZWQgPSB0aGlzLmNvbGxlY3RlZEJveGVzO1xuICAgIHRoaXMucmVtYWluaW5nQm94ZXMgPSB0b3RhbCAtIGNvbGxlY3RlZDtcblxuICAgIHRoaXMuX3BlcnNpc3QoKTtcbiAgfTtcblxuICBCb21iVGFzay5wcm90b3R5cGUudHJhY2tJZCA9IGZ1bmN0aW9uKGNvbHVtbikge1xuICAgIHJldHVybiBjb2x1bW4ucm93ICsgJ18nICsgY29sdW1uLmNvbDtcbiAgfTtcblxuICBCb21iVGFzay5wcm90b3R5cGUuaXNCb21iID0gZnVuY3Rpb24oY29sdW1uKSB7XG4gICAgcmV0dXJuIGFuZ3VsYXIuZXF1YWxzKHRoaXMuYm9tYixjb2x1bW4pO1xuICB9O1xuXG4gIEJvbWJUYXNrLnByb3RvdHlwZS5fZ2V0Q29sdW1uID0gZnVuY3Rpb24oZGF0YSkge1xuICAgIHZhciByb3cgPSBkYXRhLnJvdyAtIDE7XG4gICAgdmFyIGNvbCA9IGRhdGEuY29sIC0gMTtcblxuICAgIHJldHVybiB0aGlzLm1hdHJpeFtyb3ddW2NvbF07XG4gIH07XG5cbiAgQm9tYlRhc2sucHJvdG90eXBlLl9nZXRTdGF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgIC8qXG4gICAgaWYgKHR5cGVvZiBzZXNzaW9uU3RvcmFnZSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIHJldHVybiBhbmd1bGFyLmZyb21Kc29uKHNlc3Npb25TdG9yYWdlLmdldEl0ZW0odGhpcy5fc3RvcmFnZUtleSkpO1xuICAgIH1cbiAgICAqL1xuXG4gICAgcmV0dXJuIG51bGw7XG4gIH07XG5cbiAgQm9tYlRhc2sucHJvdG90eXBlLl9zZXRTdGF0ZSA9IGZ1bmN0aW9uKC8qZGF0YSovKSB7XG4gICAgLypcbiAgICBpZiAodHlwZW9mIHNlc3Npb25TdG9yYWdlICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSh0aGlzLl9zdG9yYWdlS2V5LGFuZ3VsYXIudG9Kc29uKGRhdGEpKTtcbiAgICB9XG4gICAgKi9cbiAgfTtcblxuICBCb21iVGFzay5wcm90b3R5cGUuX3JlbW92ZVN0YXRlID0gZnVuY3Rpb24oKSB7XG4gICAgLypcbiAgICBpZiAodHlwZW9mIHNlc3Npb25TdG9yYWdlICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgc2Vzc2lvblN0b3JhZ2UucmVtb3ZlSXRlbSh0aGlzLl9zdG9yYWdlS2V5KTtcbiAgICB9XG4gICAgKi9cbiAgfTtcblxuICBCb21iVGFzay5wcm90b3R5cGUuX3BlcnNpc3QgPSBmdW5jdGlvbigpIHtcbiAgICAvKlxuICAgIHZhciBzdGF0ZSA9IHtcbiAgICAgIGJvbWI6IHRoaXMuYm9tYixcbiAgICAgIHN0YXJ0ZWQ6IHRoaXMuc3RhcnRlZCxcbiAgICAgIHN0b3BwZWQ6IHRoaXMuc3RvcHBlZCxcbiAgICAgIHJlc29sdmVkOiB0aGlzLnJlc29sdmVkLFxuICAgICAgY29sbGVjdGlvbjogdGhpcy5jb2xsZWN0aW9uXG4gICAgfTtcblxuICAgIGlmKCB0aGlzLmR5bmFtaWMgKVxuICAgIHtcbiAgICAgIHN0YXRlLml0ZXJhdG9yID0gdGhpcy5pdGVyYXRvcjtcbiAgICAgIHN0YXRlLl9pbnRJbmRleCA9IHRoaXMuX2ludEluZGV4O1xuICAgIH1cblxuICAgIHRoaXMuX3NldFN0YXRlKHN0YXRlKTtcbiAgICAqL1xuICB9O1xuXG4gIEJvbWJUYXNrLnByb3RvdHlwZS5fZGVzaXN0ID0gZnVuY3Rpb24oKSB7XG4gICAgLypcbiAgICB2YXIgc3RhdGUgPSB0aGlzLl9nZXRTdGF0ZSgpO1xuICAgIGlmIChzdGF0ZSA9PT0gbnVsbCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuYm9tYiA9IHRoaXMuX2dldENvbHVtbihzdGF0ZS5ib21iKTtcblxuICAgIHZhciBjb2x1bW47XG5cbiAgICBpZiggc3RhdGUuaXRlcmF0b3IgKVxuICAgIHtcbiAgICAgIHRoaXMuaXRlcmF0b3IgPSBbXTtcbiAgICAgIGZvciggdmFyIGk9MDtpPHN0YXRlLml0ZXJhdG9yLmxlbmd0aDtpKysgKVxuICAgICAge1xuICAgICAgICBjb2x1bW4gPSB0aGlzLl9nZXRDb2x1bW4oXG4gICAgICAgICAgc3RhdGUuaXRlcmF0b3JbaV1cbiAgICAgICAgKTtcblxuICAgICAgICB0aGlzLml0ZXJhdG9yLnB1c2goY29sdW1uKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBmb3IoIHZhciBqPTA7ajxzdGF0ZS5jb2xsZWN0aW9uLmxlbmd0aDtqKysgKSB7XG4gICAgICBjb2x1bW4gPSB0aGlzLl9nZXRDb2x1bW4oXG4gICAgICAgIHN0YXRlLmNvbGxlY3Rpb25bal1cbiAgICAgICk7XG5cbiAgICAgIHRoaXMudXBkYXRlKGNvbHVtbix0cnVlKTtcbiAgICB9XG5cbiAgICBpZiAoc3RhdGUuc3RhcnRlZCkge1xuICAgICAgdGhpcy5zdGFydChzdGF0ZS5faW50SW5kZXgpO1xuICAgIH1cblxuICAgIGlmIChzdGF0ZS5zdG9wcGVkKSB7XG4gICAgICB0aGlzLnN0b3AoKTtcbiAgICB9XG5cbiAgICBpZiAoc3RhdGUucmVzb2x2ZWQpIHtcbiAgICAgIHRoaXMucmVzb2x2ZSgpO1xuICAgIH1cbiAgICAqL1xuICB9O1xuXG4gIEJvbWJUYXNrLnByb3RvdHlwZS5faW5pdEludGVybmFscyA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuY29sbGVjdGlvbiA9IFtdO1xuXG4gICAgdGhpcy5oYXNCb21iID0gZmFsc2U7XG4gICAgdGhpcy5zdGFydGVkID0gZmFsc2U7XG4gICAgdGhpcy5zdG9wcGVkID0gZmFsc2U7XG4gICAgdGhpcy5yZXNvbHZlZCA9IGZhbHNlO1xuXG4gICAgdGhpcy5jb2xsZWN0ZWRCb3hlcyA9IDA7XG4gICAgdGhpcy5yZW1haW5pbmdCb3hlcyA9IDA7XG4gICAgdGhpcy50b3RhbEJveGVzID0gdGhpcy5yb3dzICogdGhpcy5jb2xzO1xuICB9O1xuXG4gIEJvbWJUYXNrLnByb3RvdHlwZS5faW5pdE1hdHJpeCA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMubWF0cml4ID0gW107XG4gICAgdGhpcy5pdGVyYXRvciA9IFtdO1xuXG4gICAgZm9yICh2YXIgaT0wOyBpPHRoaXMucm93czsgaSsrKSB7XG5cbiAgICAgIHZhciBjb2x1bW5zID0gW107XG4gICAgICBmb3IoIHZhciBqPTA7IGo8dGhpcy5jb2xzOyBqKysgKSB7XG4gICAgICAgIHZhciBkYXRhID0ge1xuICAgICAgICAgIHJvdzogaSsxLFxuICAgICAgICAgIGNvbDogaisxXG4gICAgICAgIH07XG5cbiAgICAgICAgY29sdW1ucy5wdXNoKGRhdGEpO1xuXG4gICAgICAgIGlmICh0aGlzLmR5bmFtaWMpIHtcbiAgICAgICAgICBpZiAoIXRoaXMucmFuZG9tKSB7XG4gICAgICAgICAgICB0aGlzLml0ZXJhdG9yLnB1c2goZGF0YSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMucmFuZG9tU2VydmljZS5wdXNoKHRoaXMuaXRlcmF0b3IsZGF0YSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHRoaXMubWF0cml4LnB1c2goY29sdW1ucyk7XG4gICAgfVxuICB9O1xuXG4gIEJvbWJUYXNrLnByb3RvdHlwZS5faW5pdEJvbWIgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgcm93ID0gdGhpcy5yYW5kb21TZXJ2aWNlLmJldHdlZW4oMCx0aGlzLnJvd3MtMSk7XG4gICAgdmFyIGNvbCA9IHRoaXMucmFuZG9tU2VydmljZS5iZXR3ZWVuKDAsdGhpcy5jb2xzLTEpO1xuXG4gICAgdGhpcy5ib21iID0gdGhpcy5tYXRyaXhbcm93XVtjb2xdO1xuICB9O1xuXG4gIC8vIGNvbnRyb2xsZXJcbiAgYW5ndWxhci5tb2R1bGUobW9kdWxlKS5kaXJlY3RpdmUoJ2JvbWJUYXNrJyxmdW5jdGlvbigpe1xuICAgIHJldHVybiB7XG4gICAgICBzY29wZToge1xuICAgICAgICBhdmc6ICc9P2JvbWJUYXNrQXZnJyxcbiAgICAgICAgcm93czogJz0/Ym9tYlRhc2tSb3dzJyxcbiAgICAgICAgY29sczogJz0/Ym9tYlRhc2tDb2xzJyxcbiAgICAgICAgcmFuZG9tOiAnPT9ib21iVGFza1JhbmRvbScsXG4gICAgICAgIGR5bmFtaWM6ICc9P2JvbWJUYXNrRHluYW1pYycsXG4gICAgICAgIGludGVydmFsOiAnPT9ib21iVGFza0ludGVydmFsJyxcbiAgICAgICAgb25SZXNvbHZlOiAnJmJvbWJUYXNrT25SZXNvbHZlJ1xuICAgICAgfSxcbiAgICAgIHJlc3RyaWN0OiAnQScsXG4gICAgICB0cmFuc2NsdWRlOiB0cnVlLFxuICAgICAgY29udHJvbGxlcjogQm9tYlRhc2ssXG4gICAgICBiaW5kVG9Db250cm9sbGVyOiB0cnVlLFxuICAgICAgY29udHJvbGxlckFzOiAnYm9tYlRhc2tDb250cm9sbGVyJyxcbiAgICAgIHRlbXBsYXRlVXJsOiAndmlld3MvZGlyZWN0aXZlcy9ib21iLXRhc2suaHRtbCdcbiAgICB9O1xuICB9KTtcblxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvLyBCb21iVGFzayBDYXJkXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbiAgLy8gY29udHJvbGxlclxuICB2YXIgQm9tYlRhc2tDYXJkID0gZnVuY3Rpb24oKXtcbiAgfTtcblxuICBCb21iVGFza0NhcmQucHJvdG90eXBlLm1vZGVsID0gbnVsbDtcblxuICBCb21iVGFza0NhcmQucHJvdG90eXBlLmlzQWN0aXZlID0gZmFsc2U7XG5cbiAgQm9tYlRhc2tDYXJkLnByb3RvdHlwZS5pc0Rpc2FibGVkID0gZmFsc2U7XG5cbiAgQm9tYlRhc2tDYXJkLnByb3RvdHlwZS5pc0NsaWNrYWJsZSA9IHRydWU7XG5cbiAgQm9tYlRhc2tDYXJkLnByb3RvdHlwZS50b2dnbGUgPSBmdW5jdGlvbigpIHtcbiAgICBpZiAodGhpcy5pc0Rpc2FibGVkIHx8ICF0aGlzLmlzQ2xpY2thYmxlKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5pc0FjdGl2ZSA9ICF0aGlzLmlzQWN0aXZlO1xuXG4gICAgdGhpcy5vblRvZ2dsZSh7XG4gICAgICBtb2RlbDp0aGlzLm1vZGVsLFxuICAgICAgc3RhdGU6dGhpcy5pc0FjdGl2ZVxuICAgIH0pO1xuICB9O1xuXG4gIC8vIHJlZ2lzdHJ5XG4gIGFuZ3VsYXIubW9kdWxlKG1vZHVsZSkuZGlyZWN0aXZlKCdib21iVGFza0NhcmQnLCBmdW5jdGlvbigpe1xuICAgIHJldHVybiB7XG4gICAgICBzY29wZToge1xuICAgICAgICBtb2RlbDonPWJvbWJUYXNrQ2FyZCcsXG4gICAgICAgIG9uVG9nZ2xlOicmYm9tYlRhc2tDYXJkT25Ub2dnbGUnLFxuICAgICAgICBpc0FjdGl2ZTonPT9ib21iVGFza0NhcmRJc0FjdGl2ZScsXG4gICAgICAgIGlzRGlzYWJsZWQ6Jz0/Ym9tYlRhc2tDYXJkSXNEaXNhYmxlZCcsXG4gICAgICAgIGlzQ2xpY2thYmxlOic9P2JvbWJUYXNrQ2FyZElzQ2xpY2thYmxlJ1xuICAgICAgfSxcbiAgICAgIHJlc3RyaWN0OiAnQScsXG4gICAgICB0cmFuc2NsdWRlOiB0cnVlLFxuICAgICAgY29udHJvbGxlcjogQm9tYlRhc2tDYXJkLFxuICAgICAgYmluZFRvQ29udHJvbGxlcjogdHJ1ZSxcbiAgICAgIGNvbnRyb2xsZXJBczogJ2JvbWJUYXNrQ2FyZENvbnRyb2xsZXInLFxuICAgICAgdGVtcGxhdGVVcmw6ICd2aWV3cy9kaXJlY3RpdmVzL2JvbWItdGFzay1jYXJkLmh0bWwnXG4gICAgfTtcbiAgfSk7XG5cbn0pKEFOR1VMQVJfTU9EVUxFLCBhbmd1bGFyKTtcbiJdfQ==
